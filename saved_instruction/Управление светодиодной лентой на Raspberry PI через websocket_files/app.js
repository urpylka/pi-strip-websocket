(function(e,t,n,r,i){var s={},o=function(t){return e.Function("return "+t)()},u=e.document,a,f=function(t,i){var o={exports:{}};s[t]=1,n[t]=o.exports;if(!i)i=i||e[t];else if(typeof i=="function"){var u=c(2,t,p)[1];r[t]&&r[t].sandbox&&typeof u=="function"&&(u=a),i=i(u,o.exports,o)||o.exports}return i=i,n[t]=i},l={},c=function(e,t,n,r){var i=l[e],s;if(i)for(var o=0,u=i.length;o<u;o++)s=i[o](t,n,r)||s,s&&(t=s[0]||t,n=s[1]||n,r=s[2]||r);return s||[t,n,r]},h=function(e,t){l[e]||(l[e]=[]),l[e].push(t)},p=function(e){var t=n[e],r=c(4,e,t);return r&&(e=r[0],t=r[1]),s[e]&&t?t:(typeof t=="string"&&t.indexOf("(function(")===0&&(t=o(t)),f(e,t))},d={exports:{}};for(var v in n)s[v]=0;(function(){function e(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(i(r)+":"+t(e[r]));return"{"+n.join(",")+"}"}function t(n){if(typeof n=="string")return i(n);if(typeof n=="boolean")return""+n;if(n.join){if(n.length==0)return"[]";var r=[];for(var s=0,o=n.length;s<o;s+=1)r.push(t(n[s]));return"["+r.join(",")+"]"}return typeof n=="number"?n:e(n)}function n(e){return"0000".substr(e.length)+e}function r(e){switch(e){case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case'"':return'\\"';case"\\":return"\\\\";default:return"\\u"+n(e.charCodeAt(0).toString(16))}}function i(e){return'"'+e.replace(/[\u0000-\u001f"\\\u007f-\uffff]/g,r)+'"'}function s(e){for(var t=this.length;t-->0;)if(this[t]===e)return t;return-1}})(),function(){function e(e,t){return!s[e]&&typeof t=="string"&&t.charAt(0)=="@"}function t(t,r){if(e(t,r)){t=r.replace("@","");var i=n[t];r=i===r?a:i}return[t,r]}h(4,t)}(),function(){var e=n;p.match=function(t){if(t instanceof RegExp){var n={};for(var r in e)t.test(r)&&(n[r]=p(r));return n}return null}}(),function(){"use strict";p.config=function(e){return i.config?i.config[e]:undefined}}(),function(){"use strict";var e=function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e};h(2,function(t,r){var i=t.split("/");i.pop();var s=function(e){var t,s;if(e.charAt(0)==="."){t=e.split("/"),s=i.slice();for(;;){if(t[0]===".."){t=t.slice(1),s.pop();continue}if(t[0]==="."){t=t.slice(1);continue}break}return s=s.concat(t).join("/"),r(n[s.concat("/index")]?s.concat("/index"):s)}return r(e)};return[t,e(s,r)]})}(),t(c(2,"main",p)[1],d.exports,d)})(this,function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("./core"),o=e("./core/log"),u=e("./core/util"),a=e("cookies-js"),f=e("store");e("./core/touch"),e("es6-collections"),e("./adblock-detector")(function(e){s.config("add-block",e)}),s.ready(function(){s._config.load(r.extend({token:window.initParams.sessionID,logged:window.logined===1,carma:window.uCarma,bid:window.bid,development:window.dev===1,phpSelf:window.phpSelf,tag:window.tag_str,twitMode:window.is_twitmode,scrollMode:window.is_scrollmode,developmentMode:window.developmentMode,facebookWidget:window.nextJS.mv.facebookWidget,gif:{showComment:!1,showStory:!1},user:{id:window.initParams.userID,name:window.initParams.userName},local:window.location.host.indexOf(".l")>-1},window.initParams)),s.config("phpSelf")==="profile.php"&&s.config("twitMode",!1);var t=u.getCommunity();t&&s.config("filter_name",t),i.ajaxSetup({headers:{"X-Csrf-Token":s.config("sessionID")}}),"ontouchstart"in document.documentElement||i("body").addClass("no-touch"),e("./wm");var n=i("#applicationMain");s.findQuery(),window.location.host.indexOf("m-testing.")===0||window.location.host.indexOf("m-testing2.")===0?s.config("environment",s.eEnvironment.testing):s.config("environment",s.eEnvironment[n.data("environment")]),s.config("version",n.data("version")),s.config("clientType","mobile"),(s.config("environment")===s.eEnvironment.testing||s.config("environment")===s.eEnvironment.local||s.config("developmentMode"))&&s.global("require",e),!s.config("testing")&&!s.config("local")&&!s.config("GET:verbose")&&(o.setVerbose(!1),console&&console.log&&r.each(["      .--,--.          ","       `.  ,.'        ","        |___|        ","        :o o:   O   ","       _`~^~'_  |    ","     /'   ^   `=)","   .'  _______ '~|","   `(<=| pik |= /'","       | abu |","       |_____|"," ~~~~~~ ===== ~~~~~~~~"],function(e){console.log(e)})),o.info(":app:",s.config("environment")===s.eEnvironment.testing?"[testing] "+s.config("version"):s.config("environment")===s.eEnvironment.local?"[local]":s.config("version"),s.ua.browser.family,s.ua.browser.version,s.ua.device.type),e("./story-search"),e("./page-story"),e("./page-user-settings"),e("./page-user-profile"),e("./page-comments-incoming"),e("./page-comments-outcoming"),e("./page-comments-top"),e("./page-moderators-chat"),e("./page-saved-stories"),e("./tags-search"),e("./page-test-ua"),e("./page-signin"),e("./page-signup"),e("./page-community-editor"),e("./page-communities"),e("./page-user-notifications"),e("./page-gtpost"),e("./page-ban-list"),e("./page-restore-password"),i(".hide_show").tap(function(t){var n=i(this),r=n.children(".checkbox"),o;if(!s.config("logged"))return e("./sign").showNeedSignin();o=r.hasClass("on"),r.toggleClass("off",o).toggleClass("on",!o),a.set("autohide_news",o?0:2,{expires:31536e6}),a.set("set_autohide_news",o?0:2,{expires:31536e6}),window.location.reload()}),s.config("logged")?setTimeout(function(){i(".hide_show .checkbox").off()},200):i(".hide_show .checkbox").addClass("disabled"),e("./sign");if(["index.php","upcoming.php","authors.php","adult.php","cat.php","subs.php","profile.php","search.php","search_new.php"].indexOf(s.config("phpSelf"))>-1){var l=e("./feed");this.feed=new l(i(".content_container"))}else i(window).on(s.ua.device.family==="iPhone"?"pagehide":"beforeunload",function(){var e=f.get("_p_cache");!e.active&&e.page>0&&(e.active=!0),f.set("_p_cache",e)});e("./feed");var c=e("./custom-advert");c&&c.init();var h=e("./image-viewer");i(document).on("click",'img[data-viewable="true"]',function(t){t.preventDefault(),t.stopPropagation();try{e("./core/metrika").goal(i(t.target).parent().parent().hasClass("b-story-block__content")?"iv-mv__show-story":"iv-mv__show-comment")}catch(t){}(new h).show(this)}),s.matchActive("wm"),s.changeUrl()})},{jquery:"@jQuery",underscore:function(e){return function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){if(e instanceof p)return e;if(!(this instanceof p))return new p(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return e==null?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(e==null)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;r<i;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(e==null)return[];t=p.iteratee(t,n);var r=e.length!==+e.length&&p.keys(e),i=(r||e).length,s=Array(i),o;for(var u=0;u<i;u++)o=r?r[u]:u,s[u]=t(e[o],o,e);return s};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){e==null&&(e=[]),t=d(t,r,4);var i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=0,u;if(arguments.length<3){if(!s)throw new TypeError(v);n=e[i?i[o++]:o++]}for(;o<s;o++)u=i?i[o]:o,n=t(n,e[u],u,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){e==null&&(e=[]),t=d(t,r,4);var i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o;if(arguments.length<3){if(!s)throw new TypeError(v);n=e[i?i[--s]:--s]}while(s--)o=i?i[s]:s,n=t(n,e[o],o,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){if(t(e,n,i))return r=e,!0}),r},p.filter=p.select=function(e,t,n){var r=[];return e==null?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(e==null)return!0;t=p.iteratee(t,n);var r=e.length!==+e.length&&p.keys(e),i=(r||e).length,s,o;for(s=0;s<i;s++){o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},p.some=p.any=function(e,t,n){if(e==null)return!1;t=p.iteratee(t,n);var r=e.length!==+e.length&&p.keys(e),i=(r||e).length,s,o;for(s=0;s<i;s++){o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},p.contains=p.include=function(e,t){return e==null?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=p.iteratee(t,n),p.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},p.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=p.iteratee(t,n),p.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},p.shuffle=function(e){var t=e&&e.length===+e.length?e:p.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=p.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},p.sample=function(e,t,n){return t==null||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);var i=n(t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return e==null?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:t<0?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},p.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;i<o;i++){var a=e[i];!p.isArray(a)&&!p.isArguments(a)?n||r.push(a):t?s.apply(r,a):g(a,t,n,r)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(e==null)return[];p.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=p.iteratee(n,r));var i=[],s=[];for(var o=0,u=e.length;o<u;o++){var a=e[o];if(t)(!o||s!==a)&&i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(e==null)return[];var t=[],n=arguments.length;for(var r=0,i=e.length;r<i;r++){var s=e[r];if(p.contains(t,s))continue;for(var o=1;o<n;o++)if(!p.contains(arguments[o],s))break;o===n&&t.push(s)}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(e==null)return[];var t=p.max(arguments,"length").length,n=Array(t);for(var r=0;r<t;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}for(;r<i;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=e.length;typeof n=="number"&&(r=n<0?r+n+1:Math.min(r,n+1));while(--r>=0)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))},r},p.partial=function(e){var t=o.call(arguments,1);return function(){var n=0,r=t.slice();for(var i=0,s=r.length;i<s;i++)r[i]===p&&(r[i]=arguments[n++]);while(n<arguments.length)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=p.bind(e[r],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;f<t&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){var t=p.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},p.pairs=function(e){var t=p.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){var t={},n=p.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;var t,n;for(var r=1,i=arguments.length;r<i;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r={},i;if(e==null)return r;if(p.isFunction(t)){t=d(t,n);for(i in e){var s=e[i];t(s,i,e)&&(r[i]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;f<l;f++)i=a[f],i in e&&(r[i]=e[i])}return r},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if(i==="[object Array]"){f=e.length,l=f===t.length;if(l)while(f--)if(!(l=b(e[f],t[f],n,r)))break}else{var c=p.keys(e),h;f=c.length,l=p.keys(t).length===f;if(l)while(f--){h=c[f];if(!(l=p.has(t,h)&&b(e[h],t[h],n,r)))break}}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(e==null)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return e.length===0;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&e.nodeType===1},p.isArray=l||function(e){return a.call(e)==="[object Array]"},p.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),typeof /./!="function"&&(p.isFunction=function(e){return typeof e=="function"||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||a.call(e)==="[object Boolean]"},p.isNull=function(e){return e===null},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return e!=null&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(e==null)return!n;e=new Object(e);for(var r=0;r<n;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},p.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(e==null)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return p})}.call(this),_},backbone:function(e){return function(t,n){if(typeof define=="function"&&define.amd)define(["underscore","jquery","exports"],function(e,r,i){t.Backbone=n(t,i,e,r)});else if(typeof exports!="undefined"){var r=e("underscore");n(t,exports,r)}else t.Backbone=n(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),Backbone},momentjs:function(e){return function(t){function n(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function r(e,t){return Ct.call(e,t)}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function s(e){wt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function o(e,t){var n=!0;return p(function(){return n&&(s(e),n=!1),t.apply(this,arguments)},t)}function u(e,t){yn[e]||(s(t),yn[e]=!0)}function a(e,t){return function(n){return m(e.call(this,n),t)}}function f(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function l(){}function c(e,t){t!==!1&&_(e),d(this,e),this._d=new Date(+e._d)}function h(e){var t=N(e),n=t.year||0,r=t.quarter||0,i=t.month||0,s=t.week||0,o=t.day||0,u=t.hour||0,a=t.minute||0,f=t.second||0,l=t.millisecond||0;this._milliseconds=+l+1e3*f+6e4*a+36e5*u,this._days=+o+7*s,this._months=+i+3*r+12*n,this._data={},this._locale=wt.localeData(),this._bubble()}function p(e,t){for(var n in t)r(t,n)&&(e[n]=t[n]);return r(t,"toString")&&(e.toString=t.toString),r(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t){var n,r,i;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Ht.length>0)for(n in Ht)r=Ht[n],i=t[r],"undefined"!=typeof i&&(e[r]=i);return e}function v(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,n){for(var r=""+Math.abs(e),i=e>=0;r.length<t;)r="0"+r;return(i?n?"+":"":"-")+r}function g(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t- +e.clone().add(n.months,"M"),n}function y(e,t){var n;return t=j(t,e),e.isBefore(t)?n=g(e,t):(n=g(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function b(e,t){return function(n,r){var i,s;return null===r||isNaN(+r)||(u(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),s=n,n=r,r=s),n="string"==typeof n?+n:n,i=wt.duration(n,r),w(this,i,e),this}}function w(e,t,n,r){var i=t._milliseconds,s=t._days,o=t._months;r=null==r?!0:r,i&&e._d.setTime(+e._d+i*n),s&&dt(e,"Date",pt(e,"Date")+s*n),o&&ht(e,pt(e,"Month")+o*n),r&&wt.updateOffset(e,s||o)}function E(e){return"[object Array]"===Object.prototype.toString.call(e)}function S(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function x(e,t,n){var r,i=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;i>r;r++)(n&&e[r]!==t[r]||!n&&k(e[r])!==k(t[r]))&&o++;return o+s}function T(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=cn[e]||hn[t]||t}return e}function N(e){var t,n,i={};for(n in e)r(e,n)&&(t=T(n),t&&(i[t]=e[n]));return i}function C(e){var n,r;if(0===e.indexOf("week"))n=7,r="day";else{if(0!==e.indexOf("month"))return;n=12,r="month"}wt[e]=function(i,s){var o,u,a=wt._locale[e],f=[];if("number"==typeof i&&(s=i,i=t),u=function(e){var t=wt().utc().set(r,e);return a.call(wt._locale,t,i||"")},null!=s)return u(s);for(o=0;n>o;o++)f.push(u(o));return f}}function k(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function L(e,t){return(new Date(Date.UTC(e,t+1,0))).getUTCDate()}function A(e,t,n){return at(wt([e,11,31+t-n]),t,n).week}function O(e){return M(e)?366:365}function M(e){return e%4===0&&e%100!==0||e%400===0}function _(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Lt]<0||e._a[Lt]>11?Lt:e._a[At]<1||e._a[At]>L(e._a[kt],e._a[Lt])?At:e._a[Ot]<0||e._a[Ot]>24||24===e._a[Ot]&&(0!==e._a[Mt]||0!==e._a[_t]||0!==e._a[Dt])?Ot:e._a[Mt]<0||e._a[Mt]>59?Mt:e._a[_t]<0||e._a[_t]>59?_t:e._a[Dt]<0||e._a[Dt]>999?Dt:-1,e._pf._overflowDayOfYear&&(kt>t||t>At)&&(t=At),e._pf.overflow=t)}function D(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length&&e._pf.bigHour===t)),e._isValid}function P(e){return e?e.toLowerCase().replace("_","-"):e}function H(e){for(var t,n,r,i,s=0;s<e.length;){for(i=P(e[s]).split("-"),t=i.length,n=P(e[s+1]),n=n?n.split("-"):null;t>0;){if(r=B(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&x(i,n,!0)>=t-1)break;t--}s++}return null}function B(t){var n=null;if(!Pt[t]&&Bt)try{n=wt.locale(),e("./locale/"+t),wt.locale(n)}catch(r){}return Pt[t]}function j(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(wt.isMoment(e)||S(e)?+e:+wt(e))- +n,n._d.setTime(+n._d+r),wt.updateOffset(n,!1),n):wt(e).local()}function F(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function I(e){var t,n,r=e.match(qt);for(t=0,n=r.length;n>t;t++)r[t]=gn[r[t]]?gn[r[t]]:F(r[t]);return function(i){var s="";for(t=0;n>t;t++)s+=r[t]instanceof Function?r[t].call(i,e):r[t];return s}}function q(e,t){return e.isValid()?(t=R(t,e.localeData()),pn[t]||(pn[t]=I(t)),pn[t](e)):e.localeData().invalidDate()}function R(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Rt.lastIndex=0;r>=0&&Rt.test(e);)e=e.replace(Rt,n),Rt.lastIndex=0,r-=1;return e}function U(e,t){var n,r=t._strict;switch(e){case"Q":return Yt;case"DDDD":return en;case"YYYY":case"GGGG":case"gggg":return r?tn:Wt;case"Y":case"G":case"g":return rn;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?nn:Xt;case"S":if(r)return Yt;case"SS":if(r)return Zt;case"SSS":if(r)return en;case"DDD":return zt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return $t;case"a":case"A":return t._locale._meridiemParse;case"x":return Qt;case"X":return Gt;case"Z":case"ZZ":return Jt;case"T":return Kt;case"SSSS":return Vt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?Zt:Ut;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ut;case"Do":return r?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(G(Q(e.replace("\\","")),"i"))}}function z(e){e=e||"";var t=e.match(Jt)||[],n=t[t.length-1]||[],r=(n+"").match(fn)||["-",0,0],i=+(60*r[1])+k(r[2]);return"+"===r[0]?-i:i}function W(e,t,n){var r,i=n._a;switch(e){case"Q":null!=t&&(i[Lt]=3*(k(t)-1));break;case"M":case"MM":null!=t&&(i[Lt]=k(t)-1);break;case"MMM":case"MMMM":r=n._locale.monthsParse(t,e,n._strict),null!=r?i[Lt]=r:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(i[At]=k(t));break;case"Do":null!=t&&(i[At]=k(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=k(t));break;case"YY":i[kt]=wt.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":i[kt]=k(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":i[Ot]=k(t);break;case"m":case"mm":i[Mt]=k(t);break;case"s":case"ss":i[_t]=k(t);break;case"S":case"SS":case"SSS":case"SSSS":i[Dt]=k(1e3*("0."+t));break;case"x":n._d=new Date(k(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=z(t);break;case"dd":case"ddd":case"dddd":r=n._locale.weekdaysParse(t),null!=r?(n._w=n._w||{},n._w.d=r):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=k(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=wt.parseTwoDigitYear(t)}}function X(e){var t,r,i,s,o,u,a;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(o=1,u=4,r=n(t.GG,e._a[kt],at(wt(),1,4).year),i=n(t.W,1),s=n(t.E,1)):(o=e._locale._week.dow,u=e._locale._week.doy,r=n(t.gg,e._a[kt],at(wt(),o,u).year),i=n(t.w,1),null!=t.d?(s=t.d,o>s&&++i):s=null!=t.e?t.e+o:o),a=ft(r,i,s,u,o),e._a[kt]=a.year,e._dayOfYear=a.dayOfYear}function V(e){var t,r,i,s,o=[];if(!e._d){for(i=J(e),e._w&&null==e._a[At]&&null==e._a[Lt]&&X(e),e._dayOfYear&&(s=n(e._a[kt],i[kt]),e._dayOfYear>O(s)&&(e._pf._overflowDayOfYear=!0),r=it(s,0,e._dayOfYear),e._a[Lt]=r.getUTCMonth(),e._a[At]=r.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=o[t]=i[t];for(;7>t;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Ot]&&0===e._a[Mt]&&0===e._a[_t]&&0===e._a[Dt]&&(e._nextDay=!0,e._a[Ot]=0),e._d=(e._useUTC?it:rt).apply(null,o),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm),e._nextDay&&(e._a[Ot]=24)}}function $(e){var t;e._d||(t=N(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],V(e))}function J(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function K(e){if(e._f===wt.ISO_8601)return void Z(e);e._a=[],e._pf.empty=!0;var n,r,i,s,o,u=""+e._i,a=u.length,f=0;for(i=R(e._f,e._locale).match(qt)||[],n=0;n<i.length;n++)s=i[n],r=(u.match(U(s,e))||[])[0],r&&(o=u.substr(0,u.indexOf(r)),o.length>0&&e._pf.unusedInput.push(o),u=u.slice(u.indexOf(r)+r.length),f+=r.length),gn[s]?(r?e._pf.empty=!1:e._pf.unusedTokens.push(s),W(s,r,e)):e._strict&&!r&&e._pf.unusedTokens.push(s);e._pf.charsLeftOver=a-f,u.length>0&&e._pf.unusedInput.push(u),e._pf.bigHour===!0&&e._a[Ot]<=12&&(e._pf.bigHour=t),e._isPm&&e._a[Ot]<12&&(e._a[Ot]+=12),e._isPm===!1&&12===e._a[Ot]&&(e._a[Ot]=0),V(e),_(e)}function Q(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i})}function G(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Y(e){var t,n,r,s,o;if(0===e._f.length)return e._pf.invalidFormat=!0,void (e._d=new Date(0/0));for(s=0;s<e._f.length;s++)o=0,t=d({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=i(),t._f=e._f[s],K(t),D(t)&&(o+=t._pf.charsLeftOver,o+=10*t._pf.unusedTokens.length,t._pf.score=o,(null==r||r>o)&&(r=o,n=t));p(e,n||t)}function Z(e){var t,n,r=e._i,i=sn.exec(r);if(i){for(e._pf.iso=!0,t=0,n=un.length;n>t;t++)if(un[t][1].exec(r)){e._f=un[t][0]+(i[6]||" ");break}for(t=0,n=an.length;n>t;t++)if(an[t][1].exec(r)){e._f+=an[t][0];break}r.match(Jt)&&(e._f+="Z"),K(e)}else e._isValid=!1}function et(e){Z(e),e._isValid===!1&&(delete e._isValid,wt.createFromInputFallback(e))}function tt(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function nt(e){var n,r=e._i;r===t?e._d=new Date:S(r)?e._d=new Date(+r):null!==(n=jt.exec(r))?e._d=new Date(+n[1]):"string"==typeof r?et(e):E(r)?(e._a=tt(r.slice(0),function(e){return parseInt(e,10)}),V(e)):"object"==typeof r?$(e):"number"==typeof r?e._d=new Date(r):wt.createFromInputFallback(e)}function rt(e,t,n,r,i,s,o){var u=new Date(e,t,n,r,i,s,o);return 1970>e&&u.setFullYear(e),u}function it(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function st(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function ot(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function ut(e,t,n){var r=wt.duration(e).abs(),i=Nt(r.as("s")),s=Nt(r.as("m")),o=Nt(r.as("h")),u=Nt(r.as("d")),a=Nt(r.as("M")),f=Nt(r.as("y")),l=i<dn.s&&["s",i]||1===s&&["m"]||s<dn.m&&["mm",s]||1===o&&["h"]||o<dn.h&&["hh",o]||1===u&&["d"]||u<dn.d&&["dd",u]||1===a&&["M"]||a<dn.M&&["MM",a]||1===f&&["y"]||["yy",f];return l[2]=t,l[3]=+e>0,l[4]=n,ot.apply({},l)}function at(e,t,n){var r,i=n-t,s=n-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),r=wt(e).add(s,"d"),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function ft(e,t,n,r,i){var s,o,u=it(e,0,1).getUTCDay();return u=0===u?7:u,n=null!=n?n:i,s=i-u+(u>r?7:0)-(i>u?7:0),o=7*(t-1)+(n-i)+s+1,{year:o>0?e:e-1,dayOfYear:o>0?o:O(e-1)+o}}function lt(e){var n,r=e._i,i=e._f;return e._locale=e._locale||wt.localeData(e._l),null===r||i===t&&""===r?wt.invalid({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),wt.isMoment(r)?new c(r,!0):(i?E(i)?Y(e):K(e):nt(e),n=new c(e),n._nextDay&&(n.add(1,"d"),n._nextDay=t),n))}function ct(e,t){var n,r;if(1===t.length&&E(t[0])&&(t=t[0]),!t.length)return wt();for(n=t[0],r=1;r<t.length;++r)t[r][e](n)&&(n=t[r]);return n}function ht(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),L(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pt(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function dt(e,t,n){return"Month"===t?ht(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function vt(e,t){return function(n){return null!=n?(dt(this,e,n),wt.updateOffset(this,t),this):pt(this,e)}}function mt(e){return 400*e/146097}function gt(e){return 146097*e/400}function yt(e){wt.duration.fn[e]=function(){return this._data[e]}}function bt(e){"undefined"==typeof ender&&(Et=Tt.moment,Tt.moment=e?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",wt):wt)}for(var wt,Et,St,xt="2.8.4",Tt="undefined"!=typeof global?global:this,Nt=Math.round,Ct=Object.prototype.hasOwnProperty,kt=0,Lt=1,At=2,Ot=3,Mt=4,_t=5,Dt=6,Pt={},Ht=[],Bt="undefined"!=typeof module&&module&&module.exports,jt=/^\/?Date\((\-?\d+)/i,Ft=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,It=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,qt=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Rt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ut=/\d\d?/,zt=/\d{1,3}/,Wt=/\d{1,4}/,Xt=/[+\-]?\d{1,6}/,Vt=/\d+/,$t=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Jt=/Z|[\+\-]\d\d:?\d\d/gi,Kt=/T/i,Qt=/[\+\-]?\d+/,Gt=/[\+\-]?\d+(\.\d{1,3})?/,Yt=/\d/,Zt=/\d\d/,en=/\d{3}/,tn=/\d{4}/,nn=/[+-]?\d{6}/,rn=/[+-]?\d+/,sn=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,on="YYYY-MM-DDTHH:mm:ssZ",un=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],an=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],fn=/([\+\-]|\d\d)/gi,ln=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),cn={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},hn={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},pn={},dn={s:45,m:45,h:22,d:26,M:11},vn="DDD w W M D d".split(" "),mn="M D H h m s w W".split(" "),gn={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return k(this.milliseconds()/100)},SS:function(){return m(k(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(k(e/60),2)+":"+m(k(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(k(e/60),2)+m(k(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},yn={},bn=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];vn.length;)St=vn.pop(),gn[St+"o"]=f(gn[St],St);for(;mn.length;)St=mn.pop(),gn[St+St]=a(gn[St],2);gn.DDDD=a(gn.DDD,3),p(l.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var r,i,s;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;12>r;r++){if(i=wt.utc([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(s="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(s.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=wt([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var r=this._calendar[e];return"function"==typeof r?r.apply(t,[n]):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return at(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),wt=function(e,n,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._i=e,o._f=n,o._l=r,o._strict=s,o._isUTC=!1,o._pf=i(),lt(o)},wt.suppressDeprecationWarnings=!1,wt.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),wt.min=function(){var e=[].slice.call(arguments,0);return ct("isBefore",e)},wt.max=function(){var e=[].slice.call(arguments,0);return ct("isAfter",e)},wt.utc=function(e,n,r,s){var o;return"boolean"==typeof r&&(s=r,r=t),o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=r,o._i=e,o._f=n,o._strict=s,o._pf=i(),lt(o).utc()},wt.unix=function(e){return wt(1e3*e)},wt.duration=function(e,t){var n,i,s,o,u=e,a=null;return wt.isDuration(e)?u={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(u={},t?u[t]=e:u.milliseconds=e):(a=Ft.exec(e))?(n="-"===a[1]?-1:1,u={y:0,d:k(a[At])*n,h:k(a[Ot])*n,m:k(a[Mt])*n,s:k(a[_t])*n,ms:k(a[Dt])*n}):(a=It.exec(e))?(n="-"===a[1]?-1:1,s=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},u={y:s(a[2]),M:s(a[3]),d:s(a[4]),h:s(a[5]),m:s(a[6]),s:s(a[7]),w:s(a[8])}):"object"==typeof u&&("from"in u||"to"in u)&&(o=y(wt(u.from),wt(u.to)),u={},u.ms=o.milliseconds,u.M=o.months),i=new h(u),wt.isDuration(e)&&r(e,"_locale")&&(i._locale=e._locale),i},wt.version=xt,wt.defaultFormat=on,wt.ISO_8601=function(){},wt.momentProperties=Ht,wt.updateOffset=function(){},wt.relativeTimeThreshold=function(e,n){return dn[e]===t?!1:n===t?dn[e]:(dn[e]=n,!0)},wt.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return wt.locale(e,t)}),wt.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?wt.defineLocale(e,t):wt.localeData(e),n&&(wt.duration._locale=wt._locale=n)),wt._locale._abbr},wt.defineLocale=function(e,t){return null!==t?(t.abbr=e,Pt[e]||(Pt[e]=new l),Pt[e].set(t),wt.locale(e),Pt[e]):(delete Pt[e],null)},wt.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(e){return wt.localeData(e)}),wt.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return wt._locale;if(!E(e)){if(t=B(e))return t;e=[e]}return H(e)},wt.isMoment=function(e){return e instanceof c||null!=e&&r(e,"_isAMomentObject")},wt.isDuration=function(e){return e instanceof h};for(St=bn.length-1;St>=0;--St)C(bn[St]);wt.normalizeUnits=function(e){return T(e)},wt.invalid=function(e){var t=wt.utc(0/0);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},wt.parseZone=function(){return wt.apply(null,arguments).parseZone()},wt.parseTwoDigitYear=function(e){return k(e)+(k(e)>68?1900:2e3)},p(wt.fn=c.prototype,{clone:function(){return wt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=wt(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():q(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):q(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return D(this)},isDSTShifted:function(){return this._a?this.isValid()&&x(this._a,(this._isUTC?wt.utc(this._a):wt(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=q(this,e||wt.defaultFormat);return this.localeData().postformat(t)},add:b(1,"add"),subtract:b(-1,"subtract"),diff:function(e,t,n){var r,i,s,o=j(e,this),u=6e4*(this.zone()-o.zone());return t=T(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+o.daysInMonth()),i=12*(this.year()-o.year())+(this.month()-o.month()),s=this-wt(this).startOf("month")-(o-wt(o).startOf("month")),s-=6e4*(this.zone()-wt(this).startOf("month").zone()-(o.zone()-wt(o).startOf("month").zone())),i+=s/r,"year"===t&&(i/=12)):(r=this-o,i="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-u)/864e5:"week"===t?(r-u)/6048e5:r),n?i:v(i)},from:function(e,t){return wt.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(wt(),e)},calendar:function(e){var t=e||wt(),n=j(t,this).startOf("day"),r=this.diff(n,"days",!0),i=-6>r?"sameElse":-1>r?"lastWeek":0>r?"lastDay":1>r?"sameDay":2>r?"nextDay":7>r?"nextWeek":"sameElse";return this.format(this.localeData().calendar(i,this,wt(t)))},isLeapYear:function(){return M(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=st(e,this.localeData()),this.add(e-t,"d")):t},month:vt("Month",!0),startOf:function(e){switch(e=T(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=T(e),e===t||"millisecond"===e?this:this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")},isAfter:function(e,t){var n;return t=T("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+this>+e):(n=wt.isMoment(e)?+e:+wt(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=T("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+e>+this):(n=wt.isMoment(e)?+e:+wt(e),+this.clone().endOf(t)<n)},isSame:function(e,t){var n;return t=T(t||"millisecond"),"millisecond"===t?(e=wt.isMoment(e)?e:wt(e),+this===+e):(n=+wt(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=wt.apply(null,arguments),this>e?this:e}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=wt.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,r=this._offset||0;return null==e?this._isUTC?r:this._dateTzOffset():("string"==typeof e&&(e=z(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),r!==e&&(!t||this._changeInProgress?w(this,wt.duration(r-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,wt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?wt(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return L(this.year(),this.month())},dayOfYear:function(e){var t=Nt((wt(this).startOf("day")-wt(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=at(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=at(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=at(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return A(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return A(this.year(),e.dow,e.doy)},get:function(e){return e=T(e),this[e]()},set:function(e,t){return e=T(e),"function"==typeof this[e]&&this[e](t),this},locale:function(e){var n;return e===t?this._locale._abbr:(n=wt.localeData(e),null!=n&&(this._locale=n),this)},lang:o("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return e===t?this.localeData():this.locale(e)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),wt.fn.millisecond=wt.fn.milliseconds=vt("Milliseconds",!1),wt.fn.second=wt.fn.seconds=vt("Seconds",!1),wt.fn.minute=wt.fn.minutes=vt("Minutes",!1),wt.fn.hour=wt.fn.hours=vt("Hours",!0),wt.fn.date=vt("Date",!0),wt.fn.dates=o("dates accessor is deprecated. Use date instead.",vt("Date",!0)),wt.fn.year=vt("FullYear",!0),wt.fn.years=o("years accessor is deprecated. Use year instead.",vt("FullYear",!0)),wt.fn.days=wt.fn.day,wt.fn.months=wt.fn.month,wt.fn.weeks=wt.fn.week,wt.fn.isoWeeks=wt.fn.isoWeek,wt.fn.quarters=wt.fn.quarter,wt.fn.toJSON=wt.fn.toISOString,p(wt.duration.fn=h.prototype,{_bubble:function(){var e,t,n,r=this._milliseconds,i=this._days,s=this._months,o=this._data,u=0;o.milliseconds=r%1e3,e=v(r/1e3),o.seconds=e%60,t=v(e/60),o.minutes=t%60,n=v(t/60),o.hours=n%24,i+=v(n/24),u=v(mt(i)),i-=v(gt(u)),s+=v(i/30),i%=30,u+=v(s/12),s%=12,o.days=i,o.months=s,o.years=u},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return v(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*k(this._months/12)},humanize:function(e){var t=ut(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=wt.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=wt.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=T(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=T(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*mt(t),"month"===e?n:n/12;switch(t=this._days+Math.round(gt(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:wt.fn.lang,locale:wt.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),i=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||i||s?"T":"")+(r?r+"H":"")+(i?i+"M":"")+(s?s+"S":""):"P0D"},localeData:function(){return this._locale}}),wt.duration.fn.toString=wt.duration.fn.toISOString;for(St in ln)r(ln,St)&&yt(St.toLowerCase());wt.duration.fn.asMilliseconds=function(){return this.as("ms")},wt.duration.fn.asSeconds=function(){return this.as("s")},wt.duration.fn.asMinutes=function(){return this.as("m")},wt.duration.fn.asHours=function(){return this.as("h")},wt.duration.fn.asDays=function(){return this.as("d")},wt.duration.fn.asWeeks=function(){return this.as("weeks")},wt.duration.fn.asMonths=function(){return this.as("M")},wt.duration.fn.asYears=function(){return this.as("y")},wt.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===k(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Bt?module.exports=wt:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(Tt.moment=Et),wt}),bt(!0)):bt()}.call(this),function(t){typeof define=="function"&&define.amd?define(["moment"],t):typeof exports=="object"?module.exports=t(e("../moment")):t((typeof global!="undefined"?global:this).moment)}(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?n[1]:n[2]}function n(e,n,r){var i={mm:n?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"};return r==="m"?n?"минута":"минуту":e+" "+t(i[r],+e)}function r(e,t){var n={nominative:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),accusative:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_")},r=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[r][e.month()]}function i(e,t){var n={nominative:"янв_фев_март_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),accusative:"янв_фев_мар_апр_мая_июня_июля_авг_сен_окт_ноя_дек".split("_")},r=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[r][e.month()]}function s(e,t){var n={nominative:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),accusative:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_")},r=/\[ ?[Вв] ?(?:прошлую|следующую|эту)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[r][e.day()]}return e.defineLocale("ru",{months:r,monthsShort:i,weekdays:s,weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[й|я]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i],longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastDay:"[Вчера в] LT",nextWeek:function(){return this.day()===2?"[Во] dddd [в] LT":"[В] dddd [в] LT"},lastWeek:function(e){if(e.week()===this.week())return this.day()===2?"[Во] dddd [в] LT":"[В] dddd [в] LT";switch(this.day()){case 0:return"[В прошлое] dddd [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:n,mm:n,h:"час",hh:n,d:"день",dd:n,M:"месяц",MM:n,y:"год",yy:n},meridiemParse:/ночи|утра|дня|вечера/i,isPM:function(e){return/^(дня|вечера)$/.test(e)},meridiem:function(e,t,n){return e<4?"ночи":e<12?"утра":e<17?"дня":"вечера"},ordinalParse:/\d{1,2}-(й|го|я)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:7}})}),moment},detect:function(e){return function(e,t){Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(this==null)throw new TypeError(" this is null or not defined");var s=Object(this),o=s.length>>>0;if(typeof e!="function")throw new TypeError(e+" is not a function");t&&(n=t),r=new Array(o),i=0;while(i<o){var u,a;i in s&&(u=s[i],a=e.call(n,u,i,s),r[i]=a),i++}return r});var n=e.detect=function(){var e=function(){},t={browser_parsers:[{regex:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",family_replacement:"Wii",manufacturer:"Nintendo"},{regex:"(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Camino",other:!0},{regex:"(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Pale Moon (Firefox Variant)",other:!0},{regex:"(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)(pre)",family_replacment:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"Mobile.*(Firefox)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",family_replacement:"Firefox ($1)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",family_replacement:"Firefox ($1)"},{regex:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"MicroB",tablet:!0},{regex:"(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"},{regex:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",family_replacement:"Flock",other:!0},{regex:"(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Rockmelt",other:!0},{regex:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",family_replacement:"Netscape"},{regex:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(MyIBrow)/(\\d+)\\.(\\d+)",family_replacement:"My Internet Browser",other:!0},{regex:"(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera Tablet",tablet:!0},{regex:"(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",family_replacement:"Opera Mobile"},{regex:"Opera Mobi",family_replacement:"Opera Mobile"},{regex:"(Opera Mini)/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera Mini)/att/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(OPR)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(webOSBrowser)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(webOS)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",family_replacement:"webOS TouchPad"},{regex:"(luakit)",family_replacement:"LuaKit",other:!0},{regex:"(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",family_replacement:"Lightning",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"rekonq",family_replacement:"Rekonq",other:!0},{regex:"(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Conkeror",other:!0},{regex:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Konqueror",other:!0},{regex:"(WeTab)-Browser",family_replacement:"WeTab",other:!0},{regex:"(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Comodo Dragon",other:!0},{regex:"(YottaaMonitor)",family_replacement:"Yottaa Monitor",other:!0},{regex:"(Kindle)/(\\d+)\\.(\\d+)",family_replacement:"Kindle"},{regex:"(Symphony) (\\d+).(\\d+)",family_replacement:"Symphony",other:!0},{regex:"Minimo",family_replacement:"Minimo",other:!0},{regex:"(Edge)/(\\d+)\\.(\\d+)",family_replacement:"Edge"},{regex:"(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile"},{regex:"(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile iOS"},{regex:"(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",family_replacement:"Chrome Mobile"},{regex:"(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Frame"},{regex:"(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"UC Browser",other:!0},{regex:"(SLP Browser)/(\\d+)\\.(\\d+)",family_replacement:"Tizen Browser",other:!0},{regex:"(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"Epiphany",other:!0},{regex:"(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",family_replacement:"Sogou Explorer",other:!0},{regex:"(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",family_replacement:"PingdomBot",other:!0},{regex:"(facebookexternalhit)/(\\d+)\\.(\\d+)",family_replacement:"FacebookBot"},{regex:"(Twitterbot)/(\\d+)\\.(\\d+)",family_replacement:"TwitterBot"},{regex:"(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"},{regex:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"},{regex:"(Android) Donut",v2_replacement:"2",v1_replacement:"1"},{regex:"(Android) Eclair",v2_replacement:"1",v1_replacement:"2"},{regex:"(Android) Froyo",v2_replacement:"2",v1_replacement:"2"},{regex:"(Android) Gingerbread",v2_replacement:"3",v1_replacement:"2"},{regex:"(Android) Honeycomb",v1_replacement:"3"},{regex:"(IEMobile)[ /](\\d+)\\.(\\d+)",family_replacement:"IE Mobile"},{regex:"(MSIE) (\\d+)\\.(\\d+).*XBLWP7",family_replacement:"IE Large Screen"},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{regex:"(Obigo)InternetBrowser",other:!0},{regex:"(Obigo)\\-Browser",other:!0},{regex:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",other:!0},{regex:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",family_replacement:"Maxthon",other:!0},{regex:"(Maxthon|MyIE2|Uzbl|Shiira)",v1_replacement:"0",other:!0},{regex:"(PLAYSTATION) (\\d+)",family_replacement:"PlayStation",manufacturer:"Sony"},{regex:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",manufacturer:"Sony"},{regex:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(POLARIS)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(Embider)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Bon Echo",other:!0},{regex:"(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(AvantGo) (\\d+).(\\d+)",other:!0},{regex:"(Avant)",v1_replacement:"1",other:!0},{regex:"^(Nokia)",family_replacement:"Nokia Services (WAP) Browser",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/5\\.0",v2_replacement:"0",v1_replacement:"7",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/(\\d+)\\.(\\d+)",family_replacement:"Nokia OSS Browser",manufacturer:"Nokia"},{regex:"(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Nokia Series 40 Ovi Browser",manufacturer:"Nokia"},{regex:"(Nokia)[EN]?(\\d+)",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",tablet:!0,manufacturer:"Nokia"},{regex:"(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(Black[bB]erry)\\s?(\\d+)",family_replacement:"Blackberry",manufacturer:"RIM"},{regex:"(OmniWeb)/v(\\d+)\\.(\\d+)",other:!0},{regex:"(Blazer)/(\\d+)\\.(\\d+)",family_replacement:"Palm Blazer",manufacturer:"Palm"},{regex:"(Pre)/(\\d+)\\.(\\d+)",family_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Links) \\((\\d+)\\.(\\d+)",other:!0},{regex:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",other:!0},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",other:!0,tablet:!0},{regex:"(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",family_replacement:"WebKit Nightly"},{regex:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",family_replacement:"Safari"},{regex:"(Safari)/\\d+"},{regex:"(OLPC)/Update(\\d+)\\.(\\d+)",other:!0},{regex:"(OLPC)/Update()\\.(\\d+)",v1_replacement:"0",other:!0},{regex:"(SEMC\\-Browser)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Teleca)",family_replacement:"Teleca Browser",other:!0},{regex:"Trident(.*)rv.(\\d+)\\.(\\d+)",family_replacement:"IE"},{regex:"(MSIE) (\\d+)\\.(\\d+)",family_replacement:"IE"}],os_parsers:[{regex:"(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android) Donut",os_v2_replacement:"2",os_v1_replacement:"1"},{regex:"(Android) Eclair",os_v2_replacement:"1",os_v1_replacement:"2"},{regex:"(Android) Froyo",os_v2_replacement:"2",os_v1_replacement:"2"},{regex:"(Android) Gingerbread",os_v2_replacement:"3",os_v1_replacement:"2"},{regex:"(Android) Honeycomb",os_v1_replacement:"3"},{regex:"(Silk-Accelerated=[a-z]{4,5})",os_replacement:"Android"},{regex:"(Windows Phone 6\\.5)"},{regex:"(Windows (?:NT 5\\.2|NT 5\\.1))",os_replacement:"Windows XP"},{regex:"(XBLWP7)",os_replacement:"Windows Phone OS"},{regex:"(Windows NT 6\\.1)",os_replacement:"Windows 7"},{regex:"(Windows NT 6\\.0)",os_replacement:"Windows Vista"},{regex:"(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"},{regex:"(Windows NT 6\\.4|Windows NT 10\\.0)",os_replacement:"Windows 10"},{regex:"(Windows NT 6\\.2)",os_replacement:"Windows 8"},{regex:"(Windows Phone 8)",os_replacement:"Windows Phone 8"},{regex:"(Windows NT 5\\.0)",os_replacement:"Windows 2000"},{regex:"(Windows Phone OS) (\\d+)\\.(\\d+)"},{regex:"(Windows ?Mobile)",os_replacement:"Windows Mobile"},{regex:"(WinNT4.0)",os_replacement:"Windows NT 4.0"},{regex:"(Win98)",os_replacement:"Windows 98"},{regex:"(Tizen)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",manufacturer:"Apple"},{regex:"(?:PPC|Intel) (Mac OS X)",manufacturer:"Apple"},{regex:"(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod); Opera",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPad); Opera",tablet:!0,manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"Chrome OS"},{regex:"(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Linux Mint)(?:/(\\d+))?",other:!0},{regex:"(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",os_replacement:"Symbian OS"},{regex:"(Symbian/3).+NokiaBrowser/7\\.3",os_replacement:"Symbian^3 Anna"},{regex:"(Symbian/3).+NokiaBrowser/7\\.4",os_replacement:"Symbian^3 Belle"},{regex:"(Symbian/3)",os_replacement:"Symbian^3"},{regex:"(Series 60|SymbOS|S60)",os_replacement:"Symbian OS"},{regex:"(MeeGo)",other:!0},{regex:"Symbian [Oo][Ss]",os_replacement:"Symbian OS"},{regex:"(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Play[Bb]ook)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry)",os_replacement:"Blackberry OS",manufacturer:"RIM"},{regex:"(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"webOS"},{regex:"(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"},{regex:"(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"},{regex:"(Linux|BSD)",other:!0}],mobile_os_families:["Windows Phone 6.5","Windows CE","Symbian OS"],device_parsers:[{regex:"HTC ([A-Z][a-z0-9]+) Build",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_Touch_([A-Za-z0-9]+)",device_replacement:"HTC Touch ($1)",manufacturer:"HTC"},{regex:"USCCHTC(\\d+)",device_replacement:"HTC $1 (US Cellular)",manufacturer:"HTC"},{regex:"Sprint APA(9292)",device_replacement:"HTC $1 (Sprint)",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+ [A-Z])",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC-([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(ADR[A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(HTC)",manufacturer:"HTC"},{regex:"SonyEricsson([A-Za-z0-9]+)/",device_replacement:"Ericsson $1",other:!0,manufacturer:"Sony"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"},{regex:"NokiaN([0-9]+)",device_replacement:"Nokia N$1",manufacturer:"Nokia"},{regex:"Nokia([A-Za-z0-9\\v-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"NOKIA ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Nokia ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Lumia ([A-Za-z0-9\\-]+)",device_replacement:"Lumia $1",manufacturer:"Nokia"},{regex:"Symbian",device_replacement:"Nokia",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS",device_replacement:"Blackberry Playbook",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry [0-9]+);",manufacturer:"RIM"},{regex:"Black[Bb]erry([0-9]+)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(Pre)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Pixi)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pixi",manufacturer:"Palm"},{regex:"(Touchpad)/(\\d+)\\.(\\d+)",device_replacement:"HP Touchpad",manufacturer:"HP"},{regex:"HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",device_replacement:"HP iPAQ $1",manufacturer:"HP"},{regex:"Palm([A-Za-z0-9]+)",device_replacement:"Palm $1",manufacturer:"Palm"},{regex:"Treo([A-Za-z0-9]+)",device_replacement:"Palm Treo $1",manufacturer:"Palm"},{regex:"webOS.*(P160UNA)/(\\d+).(\\d+)",device_replacement:"HP Veer",manufacturer:"HP"},{regex:"(Kindle Fire)",manufacturer:"Amazon"},{regex:"(Kindle)",manufacturer:"Amazon"},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",device_replacement:"Kindle Fire",tablet:!0,manufacturer:"Amazon"},{regex:"(iPad) Simulator;",manufacturer:"Apple"},{regex:"(iPad);",manufacturer:"Apple"},{regex:"(iPod);",manufacturer:"Apple"},{regex:"(iPhone) Simulator;",manufacturer:"Apple"},{regex:"(iPhone);",manufacturer:"Apple"},{regex:"Nexus\\ ([A-Za-z0-9\\-]+)",device_replacement:"Nexus $1"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"Amoi\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"AMOI\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"Asus\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"ASUS\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"BIRD\\-([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD\\.([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD ([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"Dell ([A-Za-z0-9]+)",device_replacement:"Dell $1",manufacturer:"Dell"},{regex:"DoCoMo/2\\.0 ([A-Za-z0-9]+)",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\_W\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"vodafone([A-Za-z0-9]+)",device_replacement:"Huawei Vodafone $1",other:!0},{regex:"i\\-mate ([A-Za-z0-9]+)",device_replacement:"i-mate $1",other:!0},{regex:"Kyocera\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"KWC\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"Lenovo\\-([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Lenovo"},{regex:"Lenovo\\_([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Levovo"},{regex:"LG/([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE VX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG ([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE LG\\-AX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"(KIN)\\.One (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(KIN)\\.Two (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(Motorola)\\-([A-Za-z0-9]+)",manufacturer:"Motorola"},{regex:"MOTO\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"MOT\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"Philips([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"Philips ([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"SAMSUNG-([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"SAMSUNG\\; ([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"Softbank/1\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"Softbank/2\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",device_replacement:"Generic Smartphone"},{regex:"^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",device_replacement:"Generic Feature Phone"},{regex:"^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",device_replacement:"Generic Feature Phone"},{regex:"^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",device_replacement:"Generic Feature Phone"},{regex:"^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",device_replacement:"Generic Feature Phone"},{regex:"(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",device_replacement:"Spider"}],mobile_browser_families:["Firefox Mobile","Opera Mobile","Opera Mini","Mobile Safari","webOS","IE Mobile","Playstation Portable","Nokia","Blackberry","Palm","Silk","Android","Maemo","Obigo","Netfront","AvantGo","Teleca","SEMC-Browser","Bolt","Iris","UP.Browser","Symphony","Minimo","Bunjaloo","Jasmine","Dolfin","Polaris","BREW","Chrome Mobile","Chrome Mobile iOS","UC Browser","Tizen Browser"]};e.parsers=["device_parsers","browser_parsers","os_parsers","mobile_os_families","mobile_browser_families"],e.types=["browser","os","device"],e.regexes=t||function(){var t={};return e.parsers.map(function(e){t[e]=[]}),t}(),e.families=function(){var t={};return e.types.map(function(e){t[e]=[]}),t}();var n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.forEach,o=n.indexOf,u=function(e,t){var n={};for(var r=0;r<t.length;r++){n=t[r](e);if(n)break}return n},a=function(e,t){l(e,function(e){l(t,function(t){delete e[t]})})},f=function(e,t){var n=!1;return e==null?n:o&&e.indexOf===o?e.indexOf(t)!=-1:(n=any(e,function(e){return e===t}),n)},l=forEach=function(e,t,n){if(e==null)return;if(s&&e.forEach===s)e.forEach(t,n);else if(e.length===+e.length)for(var r=0,i=e.length;r<i;r++)t.call(n,e[r],r,e);else for(var o in e)_.has(e,o)&&t.call(n,e[o],o,e)},c=function(e){return l(slice.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},h=function(e){return!!e&&typeof e!="undefined"&&e!=null},p=function(e){var t="";return e=e||{},h(e)&&h(e.major)&&(t+=e.major,h(e.minor)&&(t+="."+e.minor,h(e.patch)&&(t+="."+e.patch))),t},d=function(e){e=e||{};var t=p(e);return t&&(t=" "+t),e&&h(e.family)?e.family+t:""};return e.parse=function(t){var n=function(t){return e.regexes[t+"_parsers"].map(function(e){function n(t){var n=t.match(r);if(!n)return null;var o={};return o.family=(i?i.replace("$1",n[1]):n[1])||"other",o.major=parseInt(s?s:n[2])||null,o.minor=n[3]?parseInt(n[3]):null,o.patch=n[4]?parseInt(n[4]):null,o.tablet=e.tablet,o.man=e.manufacturer||null,o}var r=new RegExp(e.regex),i=e[(t==="browser"?"family":t)+"_replacement"],s=e.major_version_replacement;return n})},r=function(){},i=n("browser"),s=n("os"),o=n("device"),f=new r;f.source=t,f.browser=u(t,i),h(f.browser)?(f.browser.name=d(f.browser),f.browser.version=p(f.browser)):f.browser={},f.os=u(t,s),h(f.os)?(f.os.name=d(f.os),f.os.version=p(f.os)):f.os={},f.device=u(t,o),h(f.device)?(f.device.name=d(f.device),f.device.version=p(f.device)):f.device={tablet:!1,family:"Other"};var l={},c=e.regexes.mobile_browser_families.map(function(e){l[e]=!0}),v=e.regexes.mobile_os_families.map(function(e){l[e]=!0});return f.browser.family==="Spider"?f.device.type="Spider":f.browser.tablet||f.os.tablet||f.device.tablet?f.device.type="Tablet":l.hasOwnProperty(f.browser.family)?f.device.type="Mobile":f.device.type="Desktop",f.device.manufacturer=f.browser.man||f.os.man||f.device.man||null,a([f.browser,f.os,f.device],["tablet","man"]),f},e}();typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.detect=n):e.detect=n,typeof define=="function"&&define.amd&&define(function(e){return n})}(window),detect},doT:function(require){return function(){function o(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function p(e,t,n){return(typeof t=="string"?t:t.toString()).replace(e.define||i,function(t,r,i,s){return r.indexOf("def.")===0&&(r=r.substring(4)),r in n||(i===":"?(e.defineParams&&s.replace(e.defineParams,function(e,t,i){n[r]={arg:t,text:i}}),r in n||(n[r]=s)):(new Function("def","def['"+r+"']="+s))(n)),""}).replace(e.use||i,function(t,r){e.useParams&&(r=r.replace(e.useParams,function(e,t,r,i){if(n[r]&&n[r].arg&&i)return e=(r+":"+i).replace(/'|\\/g,"_"),n.__exp=n.__exp||{},n.__exp[e]=n[r].text.replace(RegExp("(^|[^\\w$])"+n[r].arg+"([^\\w$])","g"),"$1"+i+"$2"),t+"def.__exp['"+e+"']"}));var i=(new Function("def","return "+r))(n);return i?p(e,i,n):i})}function m(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var j={version:"1.0.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:undefined,compile:undefined},q;typeof module!="undefined"&&module.exports?module.exports=j:typeof define=="function"&&define.amd?define(function(){return j}):(q=function(){return this||(0,eval)("this")}(),q.doT=j),String.prototype.encodeHTML=o();var r={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},i=/$^/;j.template=function(e,t,n){t=t||j.templateSettings;var s=t.append?r.append:r.split,u,a=0,f;e=t.use||t.define?p(t,e,n||{}):e,e=("var out='"+(t.strip?e.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):e).replace(/'|\\/g,"\\$&").replace(t.interpolate||i,function(e,t){return s.start+m(t)+s.end}).replace(t.encode||i,function(e,t){return u=!0,s.start+m(t)+s.endencode}).replace(t.conditional||i,function(e,t,n){return t?n?"';}else if("+m(n)+"){out+='":"';}else{out+='":n?"';if("+m(n)+"){out+='":"';}out+='"}).replace(t.iterate||i,function(e,t,n,r){return t?(a+=1,f=r||"i"+a,t=m(t),"';var arr"+a+"="+t+";if(arr"+a+"){var "+n+","+f+"=-1,l"+a+"=arr"+a+".length-1;while("+f+"<l"+a+"){"+n+"=arr"+a+"["+f+"+=1];out+='"):"';} } out+='"}).replace(t.evaluate||i,function(e,t){return"';"+m(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),u&&t.selfcontained&&(e="String.prototype.encodeHTML=("+o.toString()+"());"+e);try{return new Function(t.varname,e)}catch(l){throw typeof console!="undefined"&&console.log("Could not create a template function: "+e),l}},j.compile=function(e,t){return j.template(e,null,t)}}(),doT},"cookies-js":function(e){return function(e){"use strict";var t=function(e,n,r){return arguments.length===1?t.get(e):t.set(e,n,r)};t._document=document,t._navigator=navigator,t.defaults={path:"/"},t.get=function(e){return t._cachedDocumentCookie!==t._document.cookie&&t._renewCache(),t._cache[e]},t.set=function(n,r,i){return i=t._getExtendedOptions(i),i.expires=t._getExpiresDate(r===e?-1:i.expires),t._document.cookie=t._generateCookieString(n,r,i),t},t.expire=function(n,r){return t.set(n,e,r)},t._getExtendedOptions=function(n){return{path:n&&n.path||t.defaults.path,domain:n&&n.domain||t.defaults.domain,expires:n&&n.expires||t.defaults.expires,secure:n&&n.secure!==e?n.secure:t.defaults.secure}},t._isValidDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){n=n||new Date;switch(typeof e){case"number":e=new Date(n.getTime()+e*1e3);break;case"string":e=new Date(e)}if(e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),n=n||{};var r=e+"="+t;return r+=n.path?";path="+n.path:"",r+=n.domain?";domain="+n.domain:"",r+=n.expires?";expires="+n.expires.toUTCString():"",r+=n.secure?";secure":"",r},t._getCookieObjectFromString=function(n){var r={},i=n?n.split("; "):[];for(var s=0;s<i.length;s++){var o=t._getKeyValuePairFromCookieString(i[s]);r[o.key]===e&&(r[o.key]=o.value)}return r},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");return t=t<0?e.length:t,{key:decodeURIComponent(e.substr(0,t)),value:decodeURIComponent(e.substr(t+1))}},t._renewCache=function(){t._cache=t._getCookieObjectFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="cookies.js",n=t.set(e,1).get(e)==="1";return t.expire(e),n},t.enabled=t._areEnabled(),typeof define=="function"&&define.amd?define(function(){return t}):typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.Cookies=t):window.Cookies=t}(),Cookies},store:function(e,t,n){(function(e){function t(){try{return s in e&&e[s]}catch(t){return!1}}var r={},i=e.document,s="localStorage",o="script",u;r.disabled=!1,r.version="1.3.17",r.set=function(e,t){},r.get=function(e,t){},r.has=function(e){return r.get(e)!==undefined},r.remove=function(e){},r.clear=function(){},r.transact=function(e,t,n){n==null&&(n=t,t=null),t==null&&(t={});var i=r.get(e,t);n(i),r.set(e,i)},r.getAll=function(){},r.forEach=function(){},r.serialize=function(e){return JSON.stringify(e)},r.deserialize=function(e){if(typeof e!="string")return undefined;try{return JSON.parse(e)}catch(t){return e||undefined}};if(t())u=e[s],r.set=function(e,t){return t===undefined?r.remove(e):(u.setItem(e,r.serialize(t)),t)},r.get=function(e,t){var n=r.deserialize(u.getItem(e));return n===undefined?t:n},r.remove=function(e){u.removeItem(e)},r.clear=function(){u.clear()},r.getAll=function(){var e={};return r.forEach(function(t,n){e[t]=n}),e},r.forEach=function(e){for(var t=0;t<u.length;t++){var n=u.key(t);e(n,r.get(n))}};else if(i.documentElement.addBehavior){var a,f;try{f=new ActiveXObject("htmlfile"),f.open(),f.write("<"+o+">document.w=window</"+o+'><iframe src="/favicon.ico"></iframe>'),f.close(),a=f.w.frames[0].document,u=a.createElement("div")}catch(l){u=i.createElement("div"),a=i.body}var c=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(u),a.appendChild(u),u.addBehavior("#default#userData"),u.load(s);var n=e.apply(r,t);return a.removeChild(u),n}},h=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function p(e){return e.replace(/^d/,"___$&").replace(h,"___")}r.set=c(function(e,t,n){return t=p(t),n===undefined?r.remove(t):(e.setAttribute(t,r.serialize(n)),e.save(s),n)}),r.get=c(function(e,t,n){t=p(t);var i=r.deserialize(e.getAttribute(t));return i===undefined?n:i}),r.remove=c(function(e,t){t=p(t),e.removeAttribute(t),e.save(s)}),r.clear=c(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(s);for(var n=0,r;r=t[n];n++)e.removeAttribute(r.name);e.save(s)}),r.getAll=function(e){var t={};return r.forEach(function(e,n){t[e]=n}),t},r.forEach=c(function(e,t){var n=e.XMLDocument.documentElement.attributes;for(var i=0,s;s=n[i];++i)t(s.name,r.deserialize(e.getAttribute(s.name)))})}try{var d="__storejs__";r.set(d,d),r.get(d)!=d&&(r.disabled=!0),r.remove(d)}catch(l){r.disabled=!0}r.enabled=!r.disabled,typeof n!="undefined"&&n.exports&&this.module!==n?n.exports=r:typeof define=="function"&&define.amd?define(r):e.store=r})(Function("return this")())},FileAPI:function(e){return function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,s,o,u,a,f;e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURIComponent(e.split(",")[1]),s=new ArrayBuffer(t.length),o=new Uint8Array(s);for(u=0;u<t.length;u+=1)o[u]=t.charCodeAt(u);return a=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([r?o:s],{type:a}):(f=new i,f.append(s),f.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){r&&t.toDataURL&&s?e(s(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&s&&(t.toBlob=function(e,t,n){e(s(this.toDataURL(t,n)))})),e.dataURLtoBlob=s}(window),function(e,t){"use strict";function n(e,t,n,r,i){var s={type:n.type||n,target:e,result:r};Q(s,i),t(s)}function r(e){return x&&!!x.prototype["readAs"+e]}function i(e,i,s,o){if(nt.isBlob(e)&&r(s)){var u=new x;G(u,W,function f(t){var r=t.type;r=="progress"?n(e,i,t,t.target.result,{loaded:t.loaded,total:t.total}):r=="loadend"?(Y(u,W,f),u=null):n(e,i,t,t.target.result)});try{o?u["readAs"+s](e,o):u["readAs"+s](e)}catch(a){n(e,i,"error",t,{error:a.toString()})}}else n(e,i,"error",t,{error:"filreader_not_support_"+s})}function s(e,t){if(!e.type&&(y||e.size%4096===0&&e.size<=102400))if(x)try{var n=new x;Z(n,W,function(e){var r=e.type!="error";r?((n.readyState==null||n.readyState===n.LOADING)&&n.abort(),t(r)):t(!1,n.error)}),n.readAsDataURL(e)}catch(r){t(!1,r)}else t(null,new Error("FileReader is not supported"));else t(!0)}function o(e){return e&&(e.isFile||e.isDirectory)}function u(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function a(e,t){if(!e){var n=new Error("invalid entry");e=new Object(e),e.error=n,t(n.message,[],[e])}else if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])});else if(e.isDirectory){var r=e.createReader(),i=!0,s=[],o=[e],f=function(n){e.error=n,t("DirectoryError.code: "+n.code,s,o)},l=function c(n){i&&(i=!1,n.length||(e.error=new Error("directory is empty"))),n.length?nt.afor(n,function(e,t){a(t,function(t,n,i){t||(s=s.concat(n)),o=o.concat(i),e?e():r.readEntries(c,f)})}):t(!1,s,o)};r.readEntries(l,f)}else a(u(e),t)}function f(e){var t={};return K(e,function(e,n){e&&typeof e=="object"&&e.nodeType===void 0&&(e=Q({},e)),t[n]=e}),t}function l(e){return H.test(e&&e.tagName)}function c(e){return(e.originalEvent||e||"").dataTransfer||{}}function h(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||t==="overlay"||t==="filter"))return!0;return!1}var p=1,d=function(){},v=e.document,m=v.doctype||{},g=e.navigator.userAgent,y=/safari\//i.test(g)&&!/chrome\//i.test(g),b=/iemobile\//i.test(g),w=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,E=e.Blob,S=e.File,x=e.FileReader,T=e.FormData,N=e.XMLHttpRequest,C=e.jQuery,k=!!(S&&x&&(e.Uint8Array||T||N.prototype.sendAsBinary))&&!(y&&/windows/i.test(g)&&!b),L=k&&"withCredentials"in new N,A=k&&!!E&&!!(E.prototype.webkitSlice||E.prototype.mozSlice||E.prototype.slice),O=(""+"".normalize).indexOf("[native code]")>0,M=e.dataURLtoBlob,_=/img/i,D=/canvas/i,P=/img|canvas/i,H=/input/i,B=/^data:[^,]+,/,j={}.toString,F,I,q=e.Math,R=function(t){return t=new e.Number(q.pow(1024,t)),t.from=function(e){return q.round(e*this)},t},U={},z=[],W="abort progress error load loadend",X="status statusText readyState response responseXML responseText responseBody".split(" "),V="currentTarget",$="preventDefault",J=function(e){return e&&"length"in e},K=function(e,t,n){if(e)if(J(e))for(var r=0,i=e.length;r<i;r++)r in e&&t.call(n,e[r],r,e);else for(var s in e)e.hasOwnProperty(s)&&t.call(n,e[s],s,e)},Q=function(e){var t=arguments,n=1,r=function(t,n){e[n]=t};for(;n<t.length;n++)K(t[n],r);return e},G=function(e,t,n){if(e){var r=nt.uid(e);U[r]||(U[r]={});var i=x&&e&&e instanceof x;K(t.split(/\s+/),function(t){C&&!i?C.event.add(e,t,n):(U[r][t]||(U[r][t]=[]),U[r][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},Y=function(e,t,n){if(e){var r=nt.uid(e),i=U[r]||{},s=x&&e&&e instanceof x;K(t.split(/\s+/),function(t){if(C&&!s)C.event.remove(e,t,n);else{var r=i[t]||[],o=r.length;while(o--)if(r[o]===n){r.splice(o,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},Z=function(e,t,n){G(e,t,function r(i){Y(e,t,r),n(i)})},et=function(t){return t.target||(t.target=e.event&&e.event.srcElement||v),t.target.nodeType===3&&(t.target=t.target.parentNode),t},tt=function(e){var t=v.createElement("input");return t.setAttribute("type","file"),e in t},nt={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(t!=null?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:R(1),MB:R(2),GB:R(3),TB:R(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[nt.expando]=e[nt.expando]||nt.uid():(++p,nt.expando+p)},log:function(){nt.debug&&F&&(I?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=v.createElement("img");return t&&nt.event.one(n,"error load",function(e){t(e.type=="error",n),n=null}),n.src=e,n},getXHR:function(){var t;if(N)t=new N;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:J,support:{dnd:L&&"ondrop"in v.createElement("div"),cors:L,html5:k,chunked:A,dataURI:!0,accept:tt("accept"),multiple:tt("multiple")},event:{on:G,off:Y,one:Z,fix:et},throttle:function(t,n){var r,i;return function(){i=arguments,r||(t.apply(e,i),r=setTimeout(function(){r=0,t.apply(e,i)},n))}},F:function(){},parseJSON:function(t){var n;return e.JSON&&JSON.parse?n=JSON.parse(t):n=(new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");"))(),n},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e=[],n,r,i={resolve:function(t,s){i.resolve=d,r=t||!1,n=s;while(s=e.shift())s(r,n)},then:function(i){r!==t?i(r,n):e.push(i)}};return i},queue:function(e){var t=0,n=0,r=!1,i=!1,s={inc:function(){n++},next:function(){t++,setTimeout(s.check,0)},check:function(){t>=n&&!r&&s.end()},isFail:function(){return r},fail:function(){!r&&e(r=!0)},end:function(){i||(i=!0,e())}};return s},each:K,afor:function(e,t){var n=0,r=e.length;J(e)&&r--?function i(){t(r!=n&&i,e[n],n++)}():t(!1)},extend:Q,isFile:function(e){return j.call(e)==="[object File]"},isBlob:function(e){return this.isFile(e)||j.call(e)==="[object Blob]"},isCanvas:function(e){return e&&D.test(e.nodeName)},getFilesFilter:function(e){return e=typeof e=="string"?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){nt.isCanvas(e)?n(e,t,"load",nt.toDataURL(e)):i(e,t,"DataURL")},readAsBinaryString:function(e,t){r("BinaryString")?i(e,t,"BinaryString"):i(e,function(e){if(e.type=="load")try{e.result=nt.toBinaryString(e.result)}catch(n){e.type="error",e.message=n.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){i(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),i(e,n,"Text",t)},toDataURL:function(e,t){if(typeof e=="string")return e;if(e.toDataURL)return e.toDataURL(t||"image/png")},toBinaryString:function(t){return e.atob(nt.toDataURL(t).replace(B,""))},readAsImage:function(e,r,i){if(nt.isBlob(e))if(w){var s=w.createObjectURL(e);s===t?n(e,r,"error"):nt.readAsImage(s,r,i)}else nt.readAsDataURL(e,function(t){t.type=="load"?nt.readAsImage(t.result,r,i):(i||t.type=="error")&&n(e,r,t,null,{loaded:t.loaded,total:t.total})});else if(nt.isCanvas(e))n(e,r,"load",e);else if(_.test(e.nodeName))if(e.complete)n(e,r,"load",e);else{var o="error abort load";Z(e,o,function a(t){t.type=="load"&&w&&w.revokeObjectURL(e.src),Y(e,o,a),n(e,r,t,e)})}else if(e.iframe)n(e,r,{type:"error"});else{var u=nt.newImage(e.dataURL||e);nt.readAsImage(u,r,i)}},checkFileObj:function(e){var t={},n=nt.accept;return typeof e=="object"?t=e:t.name=(e+"").split(/\\|\//g).pop(),t.type==null&&(t.type=t.name.split(".").pop()),K(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i");if(e.test(t.type)||nt.ext2mime[t.type])t.type=nt.ext2mime[t.type]||n.split("/")[0]+"/"+t.type}),t},getDropFiles:function(e,t){var n=[],r=[],i,f=c(e),l=f.files,h=f.items,p=J(h)&&h[0]&&u(h[0]),d=nt.queue(function(){t(n,r)});if(p)if(O&&l){var v=l.length,m,g;i=new Array(v);while(v--){m=l[v];try{g=u(h[v])}catch(y){nt.log("[err] getDropFiles: ",y),g=null}o(g)?g.isDirectory||g.isFile&&m.name==m.name.normalize("NFC")?i[v]=g:i[v]=m:i[v]=m}}else i=h;else i=l;K(i||[],function(e){d.inc();try{p&&o(e)?a(e,function(e,t,i){e?nt.log("[err] getDropFiles:",e):n.push.apply(n,t),r.push.apply(r,i),d.next()}):s(e,function(t,i){t?n.push(e):e.error=i,r.push(e),d.next()})}catch(t){d.next(),nt.log("[err] getDropFiles: ",t)}}),d.check()},getFiles:function(e,t,n){var r=[];return n?(nt.filterFiles(nt.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){r=r.concat(nt.getFiles(this))}),e=r,r=[]),typeof t=="string"&&(t=nt.getFilesFilter(t)),e.originalEvent?e=et(e.originalEvent):e.srcElement&&(e=et(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(r=e.files,k||(r[0].blob=e,r[0].iframe=!0)):!k&&l(e)?nt.trim(e.value)&&(r=[nt.checkFileObj(e.value)],r[0].blob=e,r[0].iframe=!0):J(e)&&(r=e),nt.filter(r,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){var t=0,n=e&&e.length;while(n--)t+=e[n].size;return t},getInfo:function(e,t){var n={},r=z.concat();nt.isBlob(e)?function i(){var s=r.shift();s?s.test(e.type)?s(e,function(e,r){e?t(e):(Q(n,r),i())}):i():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},z.push(t)},filter:function(e,t){var n=[],r=0,i=e.length,s;for(;r<i;r++)r in e&&(s=e[r],t.call(s,s,r,e)&&n.push(s));return n},filterFiles:function(e,t,n){if(e.length){var r=e.concat(),i,s=[],o=[];(function u(){r.length?(i=r.shift(),nt.getInfo(i,function(e,n){(t(i,e?!1:n)?s:o).push(i),u()})):n(s,o)})()}else n([],e)},upload:function(e){e=Q({jsonp:"callback",prepare:nt.F,beforeupload:nt.F,upload:nt.F,fileupload:nt.F,fileprogress:nt.F,filecomplete:nt.F,progress:nt.F,complete:nt.F,pause:nt.F,imageOriginal:!0,chunkSize:nt.chunkSize,chunkUploadRetry:nt.chunkUploadRetry,uploadRetry:nt.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t=new nt.XHR(e),n=this._getFilesDataArray(e.files),r=this,i=0,s=0,o,u=!1;return K(n,function(e){i+=e.size}),t.files=[],K(n,function(e){t.files.push(e.file)}),t.total=i,t.loaded=0,t.filesLeft=n.length,e.beforeupload(t,e),o=function(){var a=n.shift(),l=a&&a.file,c=!1,h=f(e);t.filesLeft=n.length,l&&l.name===nt.expando&&(l=null,nt.log("[warn] FileAPI.upload() — called without files"));if((t.statusText!="abort"||t.current)&&a){u=!1,t.currentFile=l;if(l&&e.prepare(l,h)===!1){o.call(r);return}h.file=l,r._getFormData(h,a,function(u){s||e.upload(t,e);var f=new nt.XHR(Q({},h,{upload:l?function(){e.fileupload(l,f,h)}:d,progress:l?function(n){c||(c=n.loaded===n.total,e.fileprogress({type:"progress",total:a.total=n.total,loaded:a.loaded=n.loaded},l,f,h),e.progress({type:"progress",total:i,loaded:t.loaded=s+a.size*(n.loaded/n.total)||0},l,f,h))}:d,complete:function(n){K(X,function(e){t[e]=f[e]}),l&&(a.total=a.total||a.size,a.loaded=a.total,n||(this.progress(a),c=!0,s+=a.size,t.loaded=s),e.filecomplete(n,f,l,h)),setTimeout(function(){o.call(r)},0)}}));t.abort=function(e){e||(n.length=0),this.current=e,f.abort()},f.send(u)})}else{var p=t.status==200||t.status==201||t.status==204;e.complete(p?!1:t.statusText||"error",t,e),u=!0}},setTimeout(o,0),t.append=function(e,s){e=nt._getFilesDataArray([].concat(e)),K(e,function(e){i+=e.size,t.files.push(e.file),s?n.unshift(e):n.push(e)}),t.statusText="",u&&o.call(r)},t.remove=function(e){var t=n.length,r;while(t--)n[t].file==e&&(r=n.splice(t,1),i-=r.size);return r},t},_getFilesDataArray:function(e){var t=[],n={};if(l(e)){var r=nt.getFiles(e);n[e.name||"file"]=e.getAttribute("multiple")!==null?r:r[0]}else J(e)&&l(e[0])?K(e,function(e){n[e.name||"file"]=nt.getFiles(e)}):n=e;return K(n,function i(e,n){J(e)?K(e,function(e){i(e,n)}):e&&(e.name||e.image)&&t.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),t.length||t.push({file:{name:nt.expando}}),t},_getFormData:function(e,t,n){var r=t.file,i=t.name,s=r.name,o=r.type,u=nt.support.transform&&e.imageTransform,a=new nt.Form,f=nt.queue(function(){n(a)}),l=u&&h(u),c=nt.postNameConcat;K(e.data,function p(e,t){typeof e=="object"?K(e,function(e,n){p(e,c(t,n))}):a.append(t,e)}),function d(t){t.image?(f.inc(),t.toData(function(e,n){t.file&&(n.type=t.file.type,n.quality=t.matrix.quality,s=t.file&&t.file.name),s=s||(new Date).getTime()+".png",d(n),f.next()})):nt.Image&&u&&(/^image/.test(t.type)||P.test(t.nodeName))?(f.inc(),l&&(u=[u]),nt.Image.transform(t,u,e.imageAutoOrientation,function(n,r){if(l&&!n)!M&&!nt.flashEngine&&(a.multipart=!0),a.append(i,r[0],s,u[0].type||o);else{var h=0;n||K(r,function(e,t){!M&&!nt.flashEngine&&(a.multipart=!0),u[t].postName||(h=1),a.append(u[t].postName||c(i,t),e,s,u[t].type||o)}),(n||e.imageOriginal)&&a.append(c(i,h?"original":null),t,s,o)}f.next()})):s!==nt.expando&&a.append(i,t,s)}(r),f.check()},reset:function(e,t){var n,r;return C?(r=C(e).clone(!0).insertBefore(e).val("")[0],t||C(e).remove()):(n=e.parentNode,r=n.insertBefore(e.cloneNode(!0),e),r.value="",t||n.removeChild(e),K(U[nt.uid(e)],function(t,n){K(t,function(t){Y(e,n,t),G(r,n,t)})})),r},load:function(e,t){var n=nt.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),G(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(n.readyState==4){n.onreadystatechange=null;if(n.status==200){e=e.split("/");var r={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};r.dataURL="data:"+r.type+";base64,"+nt.encode64(n.responseBody||n.responseText),t({type:"load",result:r},n)}else t({type:"error"},n)}},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",r=0;typeof e!="string"&&(e=String(e));while(r<e.length){var i=e.charCodeAt(r++)&255,s=e.charCodeAt(r++)&255,o=e.charCodeAt(r++)&255,u=i>>2,a=(i&3)<<4|s>>4,f,l;isNaN(s)?f=l=64:(f=(s&15)<<2|o>>6,l=isNaN(o)?64:o&63),n+=t.charAt(u)+t.charAt(a)+t.charAt(f)+t.charAt(l)}return n}};nt.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=nt.defer();nt.readAsImage(e,function(e){var t=e.target;n.resolve(e.type=="load"?!1:"error",{width:t.width,height:t.height}),t.src=nt.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),nt.event.dnd=function(e,t,n){var r,i;n||(n=t,t=nt.F),x?(G(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){var n=c(e).types,s=n&&n.length,o=!1;while(s--)if(~n[s].indexOf("File")){e[$](),i!==e.type&&(i=e.type,i!="dragleave"&&t.call(e[V],!0,e),o=!0);break}o&&(clearTimeout(r),r=setTimeout(function(){t.call(e[V],i!="dragleave",e)},50))}),G(e,"drop",n.ff=n.ff||function(e){e[$](),i=0,t.call(e[V],!1,e),nt.getDropFiles(e,function(t,r){n.call(e[V],t,r,e)})})):nt.log("Drag'n'Drop -- not supported")},nt.event.dnd.off=function(e,t,n){Y(e,"dragenter dragleave dragover",t.ff),Y(e,"drop",n.ff)},C&&!C.fn.dnd&&(C.fn.dnd=function(e,t){return this.each(function(){nt.event.dnd(this,e,t)})},C.fn.offdnd=function(e,t){return this.each(function(){nt.event.dnd.off(this,e,t)})}),e.FileAPI=Q(nt,e.FileAPI),nt.log("FileAPI: "+nt.version),nt.log("protocol: "+e.location.protocol),nt.log("doctype: ["+m.name+"] "+m.publicId+" "+m.systemId),K(v.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&nt.log("meta.http-equiv: "+e.getAttribute("content"))});try{F=!!console.log,I=!!console.log.apply}catch(rt){}nt.flashUrl||(nt.flashUrl=nt.staticPath+"FileAPI.flash.swf"),nt.flashImageUrl||(nt.flashImageUrl=nt.staticPath+"FileAPI.flash.image.swf"),nt.flashWebcamUrl||(nt.flashWebcamUrl=nt.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){"use strict";function r(t){if(t instanceof r){var n=new r(t.file);return e.extend(n.matrix,t.matrix),n}if(!(this instanceof r))return new r(t);this.file=t,this.size=t.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}var i=Math.min,s=Math.round,o=function(){return t.createElement("canvas")},u=!1,a={8:270,3:180,6:90,7:270,4:180,5:90};try{u=o().toDataURL("image/png").indexOf("data:image/png")>-1}catch(f){}r.prototype={image:!0,constructor:r,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,r,i){return r===n&&(r=e,i=t,e=t=0),this.set({sx:e,sy:t,sw:r,sh:i||r})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new r(this)},_load:function(t,n){var r=this;/img|video/i.test(t.nodeName)?n.call(r,null,t):e.readAsImage(t,function(e){n.call(r,e.type!="load",e.result)})},_apply:function(t,n){var s=o(),u=this.getMatrix(t),a=s.getContext("2d"),f=t.videoWidth||t.width,l=t.videoHeight||t.height,c=u.deg,h=u.dw,p=u.dh,d=f,v=l,m=u.filter,g,y=t,b=u.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),E=e.renderImageToCanvas;c-=Math.floor(c/360)*360,t._type=this.file.type;while(u.multipass&&i(d/h,v/p)>2)d=d/2+.5|0,v=v/2+.5|0,g=o(),g.width=d,g.height=v,y!==t?(E(g,y,0,0,y.width,y.height,0,0,d,v),y=g):(y=g,E(y,t,u.sx,u.sy,u.sw,u.sh,0,0,d,v),u.sx=u.sy=u.sw=u.sh=0);s.width=c%180?p:h,s.height=c%180?h:p,s.type=u.type,s.quality=u.quality,a.rotate(c*Math.PI/180),E(a.canvas,y,u.sx,u.sy,u.sw||y.width,u.sh||y.height,c==180||c==270?-h:0,c==90||c==180?-p:0,h,p),h=s.width,p=s.height,b&&e.each([].concat(b),function(t){w.inc();var n=new window.Image,r=function(){var i=t.x|0,s=t.y|0,o=t.w||n.width,u=t.h||n.height,f=t.rel;i=f==1||f==4||f==7?(h-o+i)/2:f==2||f==5||f==8?h-(o+i):i,s=f==3||f==4||f==5?(p-u+s)/2:f>=6?p-(u+s):s,e.event.off(n,"error load abort",r);try{a.globalAlpha=t.opacity||1,a.drawImage(n,i,s,o,u)}catch(l){}w.next()};e.event.on(n,"error load abort",r),n.src=t.src,n.complete&&r()}),m&&(w.inc(),r.applyFilter(s,m,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),r=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,o=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,u=n.dw=n.dw||r,a=n.dh=n.dh||o,f=r/o,l=u/a,c=n.resize;if(c=="preview"){if(u!=r||a!=o){var h,p;l>=f?(h=r,p=h/l):(p=o,h=p*l);if(h!=r||p!=o)n.sx=~~((r-h)/2),n.sy=~~((o-p)/2),r=h,o=p}}else c=="height"?u=a*f:c=="width"?a=u/f:c&&(r>u||o>a?c=="min"?(u=s(f<l?i(r,u):a*f),a=s(f<l?u/f:i(o,a))):(u=s(f>=l?i(r,u):a*f),a=s(f>=l?u/f:i(o,a))):(u=r,a=o));return n.sw=r,n.sh=o,n.dw=u,n.dh=a,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,r){if(n)t(n);else try{this._apply(r,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,r=n.matrix;r.deg=="auto"?e.getInfo(n.file,function(e,i){r.deg=a[i&&i.exif&&i.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},r.exifOrientation=a,r.transform=function(t,i,s,o){function u(u,a){var f={},l=e.queue(function(e){o(e,f)});u?l.fail():e.each(i,function(e,i){if(!l.isFail()){var o=new r(a.nodeType?a:t),u=typeof e=="function";u?e(a,o):e.width?o[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(a.width>e.maxWidth||a.height>e.maxHeight)&&o.resize(e.maxWidth,e.maxHeight,"max");if(e.crop){var c=e.crop;o.crop(c.x|0,c.y|0,c.w||c.width,c.h||c.height)}e.rotate===n&&s&&(e.rotate="auto"),o.set({type:o.matrix.type||e.type||t.type||"image/png"}),u||o.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),l.inc(),o.toData(function(e,t){e?l.fail():(f[i]=t,l.next())})}})}t.width?u(!1,t):e.getInfo(t,u)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,i){r[t+"_"+e]=n*3+i,r[e+"_"+t]=n*3+i})}),r.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},r.fromDataURL=function(t,n,r){var i=e.newImage(t);e.extend(i,n),r(i)},r.applyFilter=function(t,n,i){typeof n=="function"?n(t,i):window.Caman&&window.Caman(t.tagName=="IMG"?r.toCanvas(t):t,function(){typeof n=="string"?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(i)})},e.renderImageToCanvas=function(t,n,r,i,s,o,u,a,f,l){try{return t.getContext("2d").drawImage(n,r,i,s,o,u,a,f,l)}catch(c){throw e.log("renderImageToCanvas failed"),c}},e.support.canvas=e.support.transform=u,e.Image=r}(FileAPI,document),function(e){"use strict";e(FileAPI)}(function(e){"use strict";if(!window.navigator||!window.navigator.platform||!/iP(hone|od|ad)/.test(window.navigator.platform))return;var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-e.width+1,0),n.getImageData(0,0,1,1).data[3]===0):!1},e.detectVerticalSquash=function(e,t){var n=e.naturalHeight||e.height,r=document.createElement("canvas"),i=r.getContext("2d"),s,o,u,a,f;t&&(n/=2),r.width=1,r.height=n,i.drawImage(e,0,0),s=i.getImageData(0,0,1,n).data,o=0,u=n,a=n;while(a>o)f=s[(a-1)*4+3],f===0?u=a:o=a,a=u+o>>1;return a/n||1},e.renderImageToCanvas=function(n,r,i,s,o,u,a,f,l,c){if(r._type==="image/jpeg"){var h=n.getContext("2d"),p=document.createElement("canvas"),d=1024,v=p.getContext("2d"),m,g,y,b;p.width=d,p.height=d,h.save(),m=e.detectSubsampling(r),m&&(i/=2,s/=2,o/=2,u/=2),g=e.detectVerticalSquash(r,m);if(m||g!==1){s*=g,l=Math.ceil(d*l/o),c=Math.ceil(d*c/u/g),f=0,b=0;while(b<u){a=0,y=0;while(y<o)v.clearRect(0,0,d,d),v.drawImage(r,i,s,o,u,-y,-b,o,u),h.drawImage(p,0,0,d,d,a,f,l,c),y+=d,a+=l;b+=d,f+=c}return h.restore(),n}}return t(n,r,i,s,o,u,a,f,l,c)}}),function(e,t){"use strict";function n(t,n,r){var i=t.blob,s=t.file;if(s){if(!i.toDataURL){e.readAsBinaryString(i,function(e){e.type=="load"&&n(t,e.result)});return}var o={"image/jpeg":".jpe?g","image/png":".png"},u=o[t.type]?t.type:"image/png",a=o[u]||".png",f=i.quality||1;s.match(new RegExp(a+"$","i"))||(s+=a.replace("?","")),t.file=s,t.type=u,!r&&i.toBlob?i.toBlob(function(e){n(t,e)},u,f):n(t,e.toBinaryString(i.toDataURL(u,f)))}else n(t,i)}var r=t.document,i=t.FormData,s=function(){this.items=[]},o=t.encodeURIComponent;s.prototype={append:function(e,t,n,r){this.items.push({name:e,blob:t&&t.blob||(t==void 0?"":t),file:t&&(n||t.name),type:t&&(r||t.type)})},each:function(e){var t=0,n=this.items.length;for(;t<n;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&e.filter(this.items,function(e){return e.file}).length==1,e.support.html5?!e.formData||this.multipart||!i?(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,r,i){var s=e.queue(function(){n(t)});this.each(function(o){try{r(o,t,s,i)}catch(u){e.log("FileAPI.Form._to: "+u.message),n(u)}}),s.check()},toHtmlData:function(t){this._to(r.createDocumentFragment(),t,function(t,n){var i=t.blob,s;t.file?(e.reset(i,!0),i.name=t.name,i.disabled=!1,n.appendChild(i)):(s=r.createElement("input"),s.name=t.name,s.type="hidden",s.value=i,n.appendChild(s))})},toPlainData:function(e){this._to({},e,function(e,t,r){e.file&&(t.type=e.file),e.blob.toBlob?(r.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,r.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(o(e.name)+"="+o(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new i,e,function(e,t,r){e.blob&&e.blob.toBlob?(r.inc(),n(e,function(e,n){t.append(e.name,n,e.file),r.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,r,i){r.inc(),n(e,function(e,n){t.push("--_"+i+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+o(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n"+"\r\n"+(e.file?n:o(n))+"\r\n")),r.next()},!0)},e.expando)}},e.Form=s}(FileAPI,window),function(e,t){"use strict";var n=function(){},r=e.document,i=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},s={"":1,XML:1,Text:1,Body:1};i.prototype={status:0,statusText:"",constructor:i,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(r,i){var s=this,o=s.options;s.end=s.abort=n,s.status=r,i&&(s.statusText=i),t.log("xhr.end:",r,i),o.complete(r==200||r==201?!1:s.statusText||"unknown",s),s.xhr&&s.xhr.node&&setTimeout(function(){var t=s.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[s.uid]}catch(n){}e[s.uid]=s.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,i){var o=this,u,a=o.uid,f=o.uid+"Load",l=n.url;t.log("XHR._send:",i),n.cache||(l+=(~l.indexOf("?")?"&":"?")+t.uid());if(i.nodeName){var c=n.jsonp;l=l.replace(/([a-z]+)=(\?)/i,"$1="+a),n.upload(n,o);var h=function(e){if(~l.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==a&&p(n.status,n.statusText,n.response)}catch(r){p(0,r.message)}},p=e[a]=function(n,r,i){o.readyState=4,o.responseText=i,o.end(n,r),t.event.off(e,"message",h),e[a]=u=v=e[f]=null};o.xhr.abort=function(){try{v.stop?v.stop():v.contentWindow.stop?v.contentWindow.stop():v.contentWindow.document.execCommand("Stop")}catch(e){}p(0,"abort")},t.event.on(e,"message",h),e[f]=function(){try{var e=v.contentWindow,n=e.document,r=e.result||t.parseJSON(n.body.innerHTML);p(r.status,r.statusText,r.response)}catch(i){t.log("[transport.onload]",i)}},u=r.createElement("div"),u.innerHTML='<form target="'+a+'" action="'+l+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;">'+'<iframe name="'+a+'" src="javascript:false;" onload="window.'+f+" && "+f+'();"></iframe>'+(c&&n.url.indexOf("=?")<0?'<input value="'+a+'" name="'+c+'" type="hidden"/>':"")+"</form>";var d=u.getElementsByTagName("form")[0],v=u.getElementsByTagName("iframe")[0];d.appendChild(i),t.log(d.parentNode.innerHTML),r.body.appendChild(u),o.xhr.node=u,o.readyState=2;try{d.submit()}catch(m){t.log("iframe.error: "+m)}d=null}else{l=l.replace(/([a-z]+)=(\?)&?/i,"");if(this.xhr&&this.xhr.aborted){t.log("Error: already aborted");return}u=o.xhr=t.getXHR(),i.params&&(l+=(l.indexOf("?")<0?"?":"&")+i.params.join("&")),u.open("POST",l,!0),t.withCredentials&&(u.withCredentials="true"),(!n.headers||!n.headers["X-Requested-With"])&&u.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){u.setRequestHeader(t,e)});if(n._chunked){u.upload&&u.upload.addEventListener("progress",t.throttle(function(e){i.retry||n.progress({type:e.type,total:i.size,loaded:i.start+e.loaded,totalSize:i.size},o,n)},100),!1),u.onreadystatechange=function(){var e=parseInt(u.getResponseHeader("X-Last-Known-Byte"),10);o.status=u.status,o.statusText=u.statusText,o.readyState=u.readyState;if(u.readyState==4){for(var r in s)o["response"+r]=u["response"+r];u.onreadystatechange=null;if(!u.status||u.status-201>0){t.log("Error: "+u.status);if((!u.status&&!u.aborted||500==u.status||416==u.status)&&++i.retry<=n.chunkUploadRetry){var a=u.status?0:t.chunkNetworkDownRetryTimeout;n.pause(i.file,n),t.log("X-Last-Known-Byte: "+e),e?i.end=e:(i.end=i.start-1,416==u.status&&(i.end=i.end-n.chunkSize)),setTimeout(function(){o._send(n,i)},a)}else o.end(u.status)}else i.retry=0,i.end==i.size-1?o.end(u.status):(t.log("X-Last-Known-Byte: "+e),e&&(i.end=e),i.file.FileAPIReadPosition=i.end,setTimeout(function(){o._send(n,i)},0));u=null}},i.start=i.end+1,i.end=Math.max(Math.min(i.start+n.chunkSize,i.size)-1,i.start);var g=i.file,y=(g.slice||g.mozSlice||g.webkitSlice).call(g,i.start,i.end+1);i.size&&!y.size?setTimeout(function(){o.end(-1)}):(u.setRequestHeader("Content-Range","bytes "+i.start+"-"+i.end+"/"+i.size),u.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(i.name)),u.setRequestHeader("Content-Type",i.type||"application/octet-stream"),u.send(y)),g=y=null}else{u.upload&&u.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,o,n)},100),!1),u.onreadystatechange=function(){o.status=u.status,o.statusText=u.statusText,o.readyState=u.readyState;if(u.readyState==4){for(var e in s)o["response"+e]=u["response"+e];u.onreadystatechange=null;if(!u.status||u.status>201){t.log("Error: "+u.status);if((!u.status&&!u.aborted||500==u.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var r=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){o._send(n,i)},r)}else o.end(u.status)}else o.end(u.status);u=null}};if(t.isArray(i)){u.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var b=i.join("")+"--_"+t.expando+"--";if(u.sendAsBinary)u.sendAsBinary(b);else{var w=Array.prototype.map.call(b,function(e){return e.charCodeAt(0)&255});u.send((new Uint8Array(w)).buffer)}}else u.send(i)}}}},t.XHR=i}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function r(e){var n=s.createElement("canvas"),r,i=!1;try{r=n.getContext("2d"),r.drawImage(e,0,0,1,1),i=r.getImageData(0,0,1,1).data[4]!=255}catch(o){t.log("[FileAPI.Camera] detectVideoSignal:",o)}return i}var i=e.URL||e.webkitURL,s=e.document,o=e.navigator,u=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,a=!!u;t.support.media=a;var f=function(e){this.video=e};f.prototype={isActive:function(){return!!this._active},start:function(e){var t=this,n=t.video,s,a,f=function(n){t._active=!n,clearTimeout(a),clearTimeout(s),e&&e(n,t)};u.call(o,{video:!0},function(e){t.stream=e,n.src=i.createObjectURL(e),s=setInterval(function(){r(n)&&f(null)},1e3),a=setTimeout(function(){f("timeout")},5e3),n.play()},f)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(e){t.each(this.stream.getTracks(),function(e){e.stop()})}this.stream=null}catch(e){t.log("[FileAPI.Camera] stop:",e)}},shot:function(){return new l(this.video)}},f.get=function(e){return new f(e.firstChild)},f.publish=function(r,i,o){typeof i=="function"&&(o=i,i={}),i=t.extend({},{width:"100%",height:"100%",start:!0},i),r.jquery&&(r=r[0]);var u=function(e){if(e)o(e);else{var t=f.get(r);i.start?t.start(o):o(null,t)}};r.style.width=n(i.width),r.style.height=n(i.height);if(t.html5&&a){var l=s.createElement("video");l.style.width=n(i.width),l.style.height=n(i.height),e.jQuery?jQuery(r).empty():r.innerHTML="",r.appendChild(l),u()}else f.fallback(r,i,u)},f.fallback=function(e,t,n){n("not_support_camera")};var l=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,r=t.Image(n);return r.type="image/png",r.width=n.width,r.height=n.height,r.size=n.width*n.height*4,r};f.Shot=l,t.Camera=f}(window,FileAPI),function(e,t,n){"use strict";var r=e.document,i=e.location,s=e.navigator,o=n.each;n.support.flash=function(){var t=s.mimeTypes,r=!1;if(s.plugins&&typeof s.plugins["Shockwave Flash"]=="object")r=s.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{r=!!(e.ActiveXObject&&new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(o){n.log("Flash -- does not supported.")}return r&&/^file:/i.test(i)&&n.log("[warn] Flash does not work on `file:` protocol."),r}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function u(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'">'+'<param name="movie" value="#src#" />'+'<param name="flashvars" value="#flashvars#" />'+'<param name="swliveconnect" value="true" />'+'<param name="allowscriptaccess" value="always" />'+'<param name="allownetworking" value="all" />'+'<param name="menu" value="false" />'+'<param name="wmode" value="#wmode#" />'+'<embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed>'+"</object>").replace(/#(\w+)#/ig,function(t,n){return e[n]})}function a(e,t){if(e&&e.style){var n,r;for(n in t){r=t[n],typeof r=="number"&&(r+="px");try{e.style[n]=r}catch(i){}}}}function f(e,t){o(t,function(t,n){var r=e[n];e[n]=function(){return this.parent=r,t.apply(this,arguments)}})}function l(e){return e&&!e.flashId}function c(e){var t=e.wid=n.uid();return E._fn[t]=e,"FileAPI.Flash._fn."+t}function h(e){try{E._fn[e.wid]=null,delete E._fn[e.wid]}catch(t){}}function p(e,t){if(!w.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=i.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+i.host+e),w.test(e)||(e=i.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function d(e,t,i){function s(){try{var e=E.get(f);e.setImage(t)}catch(r){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',r)}}var o,f=n.uid(),l=r.createElement("div"),d=10;for(o in e)l.setAttribute(o,e[o]),l[o]=e[o];a(l,e),e.width="100%",e.height="100%",l.innerHTML=u(n.extend({id:f,src:p(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+c(function v(){return h(v),--d>0&&s(),!0})},e)),i(!1,l),l=null}function v(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function m(t){var n=t.getBoundingClientRect(),i=r.body,s=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||s.scrollTop)-(s.clientTop||i.clientTop||0),left:n.left+(e.pageXOffset||s.scrollLeft)-(s.clientLeft||i.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var g=n.uid(),y=0,b={},w=/^https?:/i,E={_fn:{},init:function(){var e=r.body&&r.body.firstChild;if(e)do if(e.nodeType==1){n.log("FlashAPI.state: awaiting");var t=r.createElement("div");t.id="_"+g,a(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),e.parentNode.insertBefore(t,e),E.publish(t,g);return}while(e=e.nextSibling);y<10&&setTimeout(E.init,++y*50)},publish:function(e,t,r){r=r||{},e.innerHTML=u({id:t,src:p(n.flashUrl,"r="+n.version),wmode:r.camera?"":"transparent",flashvars:"callback="+(r.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+s.userAgent.match(/\d/ig).join("")+"_"+n.version+(E.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(r.camera?"&useCamera="+p(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},r)},ready:function(){n.log("FlashAPI.state: ready"),E.ready=n.F,E.isReady=!0,E.patch(),E.patchCamera&&E.patchCamera(),n.event.on(r,"mouseover",E.mouseover),n.event.on(r,"click",function(e){E.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return r.getElementById("_"+g)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==r.body)},mouseover:function(e){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&t.type=="file"&&!t.disabled){var i=t.getAttribute(g),s=E.getWrapper(t);if(n.multiFlash){if(i=="i"||i=="r")return!1;if(i!="p"){t.setAttribute(g,"i");var o=r.createElement("div");if(!s){n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");return}a(o,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:"2147483647",position:"absolute"}),s.appendChild(o),E.publish(o,n.uid()),t.setAttribute(g,"p")}return!0}if(s){var u=m(s);a(E.getEl(),u),E.curInp=t}}else/object|embed/i.test(t.nodeName)||a(E.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if(t=="ready"){try{E.getInput(e.flashId).setAttribute(g,"r")}catch(r){}return E.ready(),setTimeout(function(){E.mouseenter(e)},50),!0}t==="ping"?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):t==="log"?n.log("(flash -> js).log:",e.target):t in E&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),E[t](e)},1)},mouseenter:function(e){var t=E.getInput(e.flashId);if(t){E.cmd(e,"multiple",t.getAttribute("multiple")!=null);var r=[],i={};o((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&o(n.accept[e].split(" "),function(e){i[e]=1})}),o(i,function(e,t){r.push(t)}),E.cmd(e,"accept",r.length?r.join(",")+","+r.join(",").toUpperCase():"*")}},get:function(t){return r[t]||e[t]||r.embeds[t]},getInput:function(e){if(!n.multiFlash)return E.curInp;try{var t=E.getWrapper(E.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(r){n.log('[err] Can not find "input" by flashId:',e,r)}},select:function(e){var i=E.getInput(e.flashId),s=n.uid(i),u=e.target.files,a;o(u,function(e){n.checkFileObj(e)}),b[s]=u,r.createEvent?(a=r.createEvent("Event"),a.files=u,a.initEvent("change",!0,!0),i.dispatchEvent(a)):t?t(i).trigger({type:"change",files:u}):(a=r.createEventObject(),a.files=u,i.fireEvent("onchange",a))},cmd:function(e,t,r,i){try{return n.log("(js -> flash)."+t+":",r),E.get(e.flashId||e).cmd(t,r)}catch(s){n.log("(js -> flash).onError:",s.toString()),i||setTimeout(function(){E.cmd(e,t,r,!0)},50)}},patch:function(){n.flashEngine=!0,f(n,{getFiles:function(e,t,r){if(r)return n.filterFiles(n.getFiles(e),t,r),null;var i=n.isArray(e)?e:b[n.uid(e.target||e.srcElement||e)];return i?(t&&(t=n.getFilesFilter(t),i=n.filter(i,function(e){return t.test(e.name)})),i):this.parent.apply(this,arguments)},getInfo:function(e,t){if(l(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var r=e.__info=n.defer();E.cmd(e,"getFileInfo",{id:e.id,callback:c(function i(t,n){h(i),r.resolve(t,e.info=n)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&f(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){n.log("FlashAPI.Image._load:",e);if(l(e))this.parent.apply(this,arguments);else{var r=this;n.getInfo(e,function(n){t.call(r,n,e)})}},_apply:function(e,t){n.log("FlashAPI.Image._apply:",e);if(l(e))this.parent.apply(this,arguments);else{var r=this.getMatrix(e.info),i=t;E.cmd(e,"imageTransform",{id:e.id,matrix:r,callback:c(function s(o,u){n.log("FlashAPI.Image._apply.callback:",o),h(s),o?i(o):!n.support.html5&&(!n.support.dataURI||u.length>3e4)?d({width:r.deg%180?r.dh:r.dw,height:r.deg%180?r.dw:r.dh,scale:r.scaleMode},u,i):(r.filter&&(i=function(e,i){e?t(e):n.Image.applyFilter(i,r.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+u,i))})})}},toData:function(e){var t=this.file,r=t.info,i=this.getMatrix(r);n.log("FlashAPI.Image.toData"),l(t)?this.parent.apply(this,arguments):(i.deg=="auto"&&(i.deg=n.Image.exifOrientation[r&&r.exif&&r.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:i}))}}),n.Image&&f(n.Image,{fromDataURL:function(e,t,r){!n.support.dataURI||e.length>3e4?d(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){r(t)}):this.parent(e,t,r)}}),f(n.Form.prototype,{toData:function(e){var t=this.items,r=t.length;for(;r--;)if(t[r].file&&l(t[r].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),f(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&typeof t[0]=="string")return this.parent.apply(this,arguments);var r={},i={},s=this,u,a;o(t,function(e){e.file?(i[e.name]=e=v(e.blob),a=e.id,u=e.flashId):r[e.name]=e.blob}),a||(u=g);if(!u)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+u+" -> "+a),s.xhr={headers:{},abort:function(){E.cmd(u,"abort",{id:a})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var f=n.queue(function(){E.cmd(u,"upload",{url:p(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:r,files:a?i:null,headers:e.headers||{},callback:c(function t(r){var i=r.type,o=r.result;n.log("FlashAPI.upload."+i);if(i=="progress")r.loaded=Math.min(r.loaded,r.total),r.lengthComputable=!0,e.progress(r);else if(i=="complete")h(t),typeof o=="string"&&(s.responseText=o.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),s.end(r.status||200);else if(i=="abort"||i=="error")s.end(r.status||0,r.message),h(t)})})});o(i,function(e){f.inc(),n.getInfo(e,f.next)}),f.check()}})}};n.Flash=E,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=t.width==1&&t.height==1,E.init()})}()}(window,window.jQuery,FileAPI),function(e,t,n){"use strict";var r=n.each,i=[];n.support.flash&&n.media&&(!n.support.media||!n.html5)&&function(){function e(e){var t=e.wid=n.uid();return n.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function t(e){try{n.Flash._fn[e.wid]=null,delete n.Flash._fn[e.wid]}catch(t){}}var s=n.Flash;n.extend(n.Flash,{patchCamera:function(){n.Camera.fallback=function(r,i,o){var u=n.uid();n.log("FlashAPI.Camera.publish: "+u),s.publish(r,u,n.extend(i,{camera:!0,onEvent:e(function a(e){e.type==="camera"&&(t(a),e.error?(n.log("FlashAPI.Camera.publish.error: "+e.error),o(e.error)):(n.log("FlashAPI.Camera.publish.success: "+u),o(null)))})}))},r(i,function(e){n.Camera.fallback.apply(n.Camera,e)}),i=[],n.extend(n.Camera.prototype,{_id:function(){return this.video.id},start:function(r){var i=this;s.cmd(this._id(),"camera.on",{callback:e(function o(e){t(o),e.error?(n.log("FlashAPI.camera.on.error: "+e.error),r(e.error,i)):(n.log("FlashAPI.camera.on.success: "+i._id()),i._active=!0,r(null,i))})})},stop:function(){this._active=!1,s.cmd(this._id(),"camera.off")},shot:function(){n.log("FlashAPI.Camera.shot:",this._id());var e=n.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}})}}),n.Camera.fallback=function(){i.push(arguments)}}()}(window,window.jQuery,FileAPI),typeof define=="function"&&define.amd&&define("FileAPI",[],function(){return FileAPI}),FileAPI},"jquery-sortable":function(e){return!function(e,t,n,r){function i(e,t){var n=Math.max(0,e[0]-t[0],t[0]-e[1]),r=Math.max(0,e[2]-t[1],t[1]-e[3]);return n+r}function s(t,n,r,i){var s=t.length,o=i?"offset":"position";r=r||0;while(s--){var u=t[s].el?t[s].el:e(t[s]),a=u[o]();a.left+=parseInt(u.css("margin-left"),10),a.top+=parseInt(u.css("margin-top"),10),n[s]=[a.left-r,a.left+u.outerWidth()+r,a.top-r,a.top+u.outerHeight()+r]}}function o(e,t){var n=t.offset();return{left:e.left-n.left,top:e.top-n.top}}function u(e,t,n){t=[t.left,t.top],n=n&&[n.left,n.top];var r,s=e.length,o=[];while(s--)r=e[s],o[s]=[s,i(r,t),n&&i(r,n)];return o=o.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]}),o}function a(t){this.options=e.extend({},h,t),this.containers=[],this.options.rootGroup||(this.scrollProxy=e.proxy(this.scroll,this),this.dragProxy=e.proxy(this.drag,this),this.dropProxy=e.proxy(this.drop,this),this.placeholder=e(this.options.placeholder),t.isValidTarget||(this.options.isValidTarget=r))}function f(t,n){this.el=t,this.options=e.extend({},c,n),this.group=a.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var r=this.rootGroup.options.itemPath;this.target=r?this.el.find(r):this.el,this.target.on(l.start,this.handle,e.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var l,c={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},h={afterMove:function(e,t,n){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(e,t){return!0},onCancel:function(e,t,n,r){},onDrag:function(e,t,n,r){e.css(t)},onDragStart:function(t,n,r,i){t.css({height:t.outerHeight(),width:t.outerWidth()}),t.addClass(n.group.options.draggedClass),e("body").addClass(n.group.options.bodyClass)},onDrop:function(t,n,r,i){t.removeClass(n.group.options.draggedClass).removeAttr("style"),e("body").removeClass(n.group.options.bodyClass)},onMousedown:function(e,t,n){if(!n.target.nodeName.match(/^(input|select|textarea)$/i))return n.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(t,n,r){var i=e.extend({},t.data());return r?[n]:(n[0]&&(i.children=n),delete i.subContainers,delete i.sortable,i)},tolerance:0},p={},d=0,v={left:0,top:0,bottom:0,right:0},l={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},m="subContainers";a.get=function(e){return p[e.group]||(e.group===r&&(e.group=d++),p[e.group]=new a(e)),p[e.group]},a.prototype={dragInit:function(t,n){this.$document=e(n.el[0].ownerDocument);var r=e(t.target).closest(this.options.itemSelector);if(r.length){this.item=r,this.itemContainer=n;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,h.onMousedown,t))return;this.setPointer(t),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0}},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,h.onDragStart,e),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(e),this.options.onDrag(this.item,o(this.pointer,this.item.offsetParent()),h.onDrag,e);var t=this.getPointer(e),n=this.sameResultBox,i=this.options.tolerance;if(!n||n.top-i>t.top||n.bottom+i<t.top||n.left-i>t.left||n.right+i<t.left)this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=r)},drop:function(e){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,h.onCancel,e),this.options.onDrop(this.item,this.getContainer(this.item),h.onDrop,e),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=r,this.dragging=!1)},searchValidTarget:function(e,t){e||(e=this.relativePointer||this.pointer,t=this.lastRelativePointer||this.lastPointer);var n=u(this.getContainerDimensions(),e,t),i=n.length;while(i--){var s=n[i][0],a=n[i][1];if(!a||this.options.pullPlaceholder){var f=this.containers[s];if(!f.disabled){if(!this.$getOffsetParent()){var l=f.getItemOffsetParent();e=o(e,l),t=o(t,l)}if(f.searchValidTarget(e,t))return!0}}}this.sameResultBox&&(this.sameResultBox=r)},movePlaceholder:function(e,t,n,r){var i=this.lastAppendedItem;if(!r&&i&&i[0]===t[0])return;t[n](this.placeholder),this.lastAppendedItem=t,this.sameResultBox=r,this.options.afterMove(this.placeholder,e,t)},getContainerDimensions:function(){return this.containerDimensions||s(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(n)},$getOffsetParent:function(){if(this.offsetParent===r){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup)while(e--)if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=!1;break}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);if(this.$getOffsetParent()){var n=o(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=n}this.lastPointer=this.pointer,this.pointer=t},distanceMet:function(e){var t=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(e){var t=e.originalEvent||e.originalEvent.touches&&e.originalEvent.touches[0];return{left:e.pageX||t.pageX,top:e.pageY||t.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){e.delayMet=!0},this.options.delay))},scroll:function(e){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(t){var n=this,r=["drag","drop","scroll"];e.each(r,function(e,r){n.$document[t](l[r],n[r+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=r},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);var t=this.containers.length;while(t--)this.containers[t].traverse(e)},_clearDimensions:function(){this.containerDimensions=r},_destroy:function(){p[this.options.group]=r}},f.prototype={dragInit:function(e){var t=this.rootGroup;!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)&&t.dragInit(e,this)},isValidDrag:function(e){return e.which==1||e.type=="touchstart"&&e.originalEvent.touches.length==1},searchValidTarget:function(e,t){var n=u(this.getItemDimensions(),e,t),r=n.length,i=this.rootGroup,s=!i.options.isValidTarget||i.options.isValidTarget(i.item,this);if(!r&&s)return i.movePlaceholder(this,this.target,"append"),!0;while(r--){var o=n[r][0],a=n[r][1];if(!a&&this.hasChildGroup(o)){var f=this.getContainerGroup(o).searchValidTarget(e,t);if(f)return!0}else if(s)return this.movePlaceholder(o,e),!0}},movePlaceholder:function(t,n){var r=e(this.items[t]),i=this.itemDimensions[t],s="after",o=r.outerWidth(),u=r.outerHeight(),a=r.offset(),f={left:a.left,right:a.left+o,top:a.top,bottom:a.top+u};if(this.options.vertical){var l=(i[2]+i[3])/2,c=n.top<=l;c?(s="before",f.bottom-=u/2):f.top+=u/2}else{var h=(i[0]+i[1])/2,p=n.left<=h;p?(s="before",f.right-=o/2):f.left+=o/2}this.hasChildGroup(t)&&(f=v),this.rootGroup.movePlaceholder(this,r,s,f)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),s(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;return t.css("position")==="relative"||t.css("position")==="absolute"||t.css("position")==="fixed"?e=t:e=t.offsetParent(),e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var i=e.data(this.items[t],m);if(i===r){var s=this.$getChildren(this.items[t],"container");i=!1;if(s[0]){var o=e.extend({},this.options,{rootGroup:this.rootGroup,group:d++});i=s[n](o).data(n).group}e.data(this.items[t],m,i)}return i},$getChildren:function(t,n){var r=this.rootGroup.options,i=r[n+"Path"],s=r[n+"Selector"];return t=e(t),i&&(t=t.find(i)),t.children(s)},_serialize:function(t,n){var r=this,i=n?"item":"container",s=this.$getChildren(t,i).not(this.options.exclude).map(function(){return r._serialize(e(this),!n)}).get();return this.rootGroup.options.serialize(t,s,n)},traverse:function(t){e.each(this.items||[],function(n){var r=e.data(this,m);r&&r.traverse(t)}),t(this)},_clearDimensions:function(){this.itemDimensions=r},_destroy:function(){var t=this;this.target.off(l.start,this.handle),this.el.removeData(n),this.options.drop&&(this.group.containers=e.grep(this.group.containers,function(e){return e!=t})),e.each(this.items||[],function(){e.removeData(this,m)})}};var g={enable:function(){this.traverse(function(e){e.disabled=!1})},disable:function(){this.traverse(function(e){e.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};e.extend(f.prototype,g),e.fn[n]=function(t){var i=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),o=s.data(n);return o&&g[t]?g[t].apply(o,i)||this:(!o&&(t===r||typeof t=="object")&&s.data(n,new f(s,t)),this)})}}(jQuery,window,"sortable"),jQuery},adbix:function(e){return function(){"use strict";function e(e,t){if(typeof e.forEach=="function")return e.forEach(t);for(var n=0;n<e.length;n++)t.apply(e,[e[n],n,e])}function t(e,t){if(typeof e.some=="function")return e.some(t);var n=Object(e),r=n.length>>>0,i=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<r;s++)if(s in n&&t.call(i,n[s],s,n))return!0;return!1}function n(e,t){return e[t]||parseInt(e.style[t])||e.getAttribute(t)}function r(e){if(!e)return;var n=["video",".mp4",".webm",".avi",".3gp"];return t(n,function(t){return e.search(t)!=-1})}function i(){var e=document.getElementsByTagName("script")[0],t=document.createElement("script"),n="//jwpsrv.com/library/LfKchEjWEeSH9SIAC0WXxA.js";o(t,"load",m),o(t,"load",s),t.setAttribute("src",n),e.parentNode.insertBefore(t,e)}function s(){x.groupCollapsed("adbix::onPlayerAPIReady");var e=function(){g(),T.autodetectDisabled?T.getNextCampaign():(T.conf.videoRoll&&(T.setup(".adbix-player"),T.videoAutodetect()),T.conf.contentRoll&&T.contentRollSetup(),u(document,"adbix.setup.completed"))};T.getUserDataEnabled?T.getUserData(function(){u(document,"adbix.ready")}):e(),o(document,"adbix.ready",e),x.groupEnd()}function o(e,t,n){try{e.addEventListener(t,n,!1)}catch(r){e.attachEvent(t,n)}}function u(e,t){var n;document.createEvent?(n=document.createEvent("HTMLEvents"),n.initEvent(t,!0,!0)):(n=document.createEventObject(),n.eventType=t),n.eventName=t,document.createEvent?e.dispatchEvent(n):e.fireEvent("on"+n.eventType,n)}function a(e,t){var n;try{n=new XMLHttpRequest;if(!("withCredentials"in n))throw new Error;n.withCredentials=!0,n.open(e,t,!0)}catch(r){typeof XDomainRequest!="undefined"?(n=new XDomainRequest,n.open(e,t)):(n.open(e,t,!0),n.withCredentials=!0)}if(!n)throw new Error("CORS not supported");return n}function f(e,t,n){var r=n?"POST":"GET",i=a(r,e);n&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(i.readyState!=4)return;if(i.status!=200&&i.status!=304)return;t&&t(JSON.parse(i.response))};if(i.readyState==4)return;i.send(h(n)||null)}function l(e){var t=document.createElement("script");t.src=e,document.body.appendChild(t)}function c(e,t){var n={};for(var r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}function h(e){var t="";for(var n in e){t!==""&&(t+="&");var r=e[n];try{r=r.join(",")}catch(i){}t+=n+"="+encodeURIComponent(r)}return t}function p(t){var n=document.createElement("a"),r={};n.href=t;var i=n.search;return t.indexOf("#")>=0&&(i+=t.substr(t.indexOf("#"))),i.length>0&&(i=i.substr(1),e(i.split("&"),function(e){var t=e.split("=");r[t[0]]=t[1]})),r}function d(e,t){return t.renderingMode=e.player.getRenderingMode(),{error:JSON.stringify(t)}}function v(e,t){try{if(b.campaign==31){var n=t||{};n.adblock=T.userData.adblock,mixpanel.track(e,c(b,n))}}catch(r){x.warn(r)}}function m(){var e=document.createElement("div"),t=document.getElementsByTagName("body")[0];e.className="ad_panel ad_rect ad_column",e.id=A,t.appendChild(e)}function g(){var e=document.getElementById(A);T.userData.adblock=e.offsetWidth===0,e.parentElement.removeChild(e)}function y(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}if(window.Adbix&&window.Adbix.setupPlayer)return;var b={},w=location.href.search("localhost")!==-1||location.href.search("testpage")!==-1||location.search.search("debug")!==-1,E=location.protocol+"//"+location.host,S=window.console,x={};e(["log","info","debug","warn","group","groupCollapsed","groupEnd"],function(e){x[e]=function(){if(w&&S)return S[e].apply(S,arguments)}});var T=function(){function r(e,t){var i=this;t=t||{},i.opts=c(i.defaults,t),i.opts.playerConfig=t.playerConfig||{},i.opts.onlyads===undefined&&(i.opts.onlyads=i.opts.playerConfig.onlyads),i.opts.mode=i.getEmbedderMode(),x.groupCollapsed("adbix::Embedder::init"),x.info("Embedder(",e,t,")"),i.element=e,i.opts.width=n(e,"width"),i.opts.height=n(e,"height"),x.log("width: %s, height: %s",i.opts.width,i.opts.height);var s=e.getAttribute("data-download-video");s!==null?i.opts.downloadVideo=Boolean(parseInt(s)):i.opts.downloadVideo=r.conf.downloadVideo,i.opts.playerType=e.getAttribute("data-player-type")||i.opts.playerType,x.log("downloadVideo: %s, primary: %s",i.opts.downloadVideo,i.opts.playerType),x.groupEnd(),i.getPlayerConfig(function(e){var t=c(e,i.opts.playerConfig),n=i.getConfigFunctions(t);x.debug("player config",t);if(!r.conf.adsEnabled){x.warn("ads disabled for this site."),adsNotFound();return}t=n.prepare.bind(i)(t);if(!t)return;i.preparePlayerElement(),i.player=jwplayer(i.element.id).setup(t).onReady(i.onReady.bind(i)).onPlay(i.onPlay.bind(i)).onPause(i.onPause.bind(i)).onComplete(i.onComplete.bind(i)).onSetupError(i.onSetupError.bind(i)).onError(i.onError.bind(i)).onAdError(i.onAdError.bind(i)).onAdPlay(function(){v("adPlay")}).onAdPause(function(){v("adPause")}).onAdImpression(i.onAdImpression.bind(i)).onAdComplete(i.onAdComplete.bind(i)).onAdClick(i.onAdClick.bind(i)),n.postConfig.bind(i)(),o(window,"beforeunload",i.onBeforeunload.bind(i))}.bind(i))}return r.played=[],r.maxId=0,r.userData={},r.getNextCampaignUrl="http://adbix.tv/platforms/4/get_campaign_id.json",r.getUserDataJson="//counter.yadro.ru/bix-info.txt?for="+encodeURIComponent(E),r.getUserDataEnabled=!0,r.defaultVideo=[{file:"http://adbix.tv/static/v/video.webm"}],r.isMobile=!1,r.autodetectDisabled="1",r.conf={contentRoll:!1,downloadVideo:!1,videoRoll:!0,adsEnabled:!0},r.prototype.defaults={analyticsUrl:"http://adbix.tv/analytics/",getVideoUrl:"http://adbix.tv/BzJPMN3/get_video/",platformId:"4",playerType:"flash",videoAdsConfig:[{tag:"http://adbix.tv/platforms/4/vast.xml",params:{t:"post"},offset:"post"}],contentAdsConfig:[{tag:"http://adbix.tv/platforms/4/vast.xml",params:{t:"content"},offset:"pre"}],width:420,height:315,display:"inline-block",STATE_INIT:"video_init",STATE_START:"video_start",STATE_STOP:"video_stop",STATE_COMPLETE:"video_complete",STATE_AD_PLAY:"start",STATE_AD_COMPELTE:"complete",STATE_AD_CLICK:"click",STATE_AD_ERROR:"ad_play_error",STATE_INIT_ERROR:"player_init_error",STATE_PLAY_ERROR:"video_play_error"},r.prototype.onlyAdsConfig=function(e){var t=this,n=function(){x.log("adsNotFound"),typeof e.adsNotFound=="function"&&e.adsNotFound.bind(t)()},i=function(){x.log("adsCompleted"),typeof e.adsCompleted=="function"&&e.adsCompleted.bind(t)()};if(!r.hasNextCampaign()){x.log("no ads to show."),n();return}return e.sources=r.defaultVideo,e.autostart=!0,r.getNextCampaign(),t.onlyAdsCallbacks={adsNotFound:n,adsCompleted:i},e},r.prototype.onlyAdsPostConfig=function(){var e=this,t=e.onlyAdsCallbacks.adsCompleted,n=e.onlyAdsCallbacks.adsNotFound;e.player.onAdSkipped(t),e.player.onAdComplete(t),e.player.onAdError(t),e.player.onAdImpression(e.lowerVolume.bind(e)),e.player.onAdComplete(e.restoreVolume.bind(e)),e.player.onAdSkipped(e.restoreVolume.bind(e))},r.prototype.contentRollConfig=function(e){var t=this;return x.log("Content Roll Config."),e.sources=r.defaultVideo,e.width="100%",e},r.prototype.contentRollPostConfig=function(){function e(){if(u)return;try{r.player.container.parentElement.style.height=s+"px"}catch(e){}r.player.getState()in{IDLE:0,PAUSED:0}&&r.player.play()}function t(){r.player.getState()=="PLAYING"&&r.player.play()}function n(){y(r.player.container)?e():t()}x.log("Content Roll Post Config."),w&&(window.emb=this);var r=this,i,s,u;r.player.setMute(!0),o(window,"scroll",n),o(window,"blur",function(){t(),r.player.setMute(!0),setTimeout(function(){O()||t()},100)}),o(window,"focus",n),r.player.onReady(function(){var e=r.player.container,t=e.parentElement;s=t.clientHeight,t.style.cssText="height: 0; overflow: hidden; transition: height .7s ease;",o(e,"mouseenter",function(){r.player.setMute(!1)}),o(e,"mouseleave",function(){r.player.setMute(!0)}),r.player.onAdComplete(function(){u=!0})})},r.prototype.getEmbedderMode=function(){var e=this,t="default";return e.opts.onlyads?t="onlyads":e.opts.contentRoll&&(t="contentRoll"),t},r.prototype.getConfigFunctions=function(e){var t=this,n={onlyads:["onlyAdsConfig","onlyAdsPostConfig"],contentRoll:["contentRollConfig","contentRollPostConfig"],"default":[]},r=function(e){return e},i=n[t.opts.mode];return{prepare:t[i[0]]||r,postConfig:t[i[1]]||r}},r.prototype.generateElementId=function(){var e=r.maxId;return r.maxId+=1,"adbix-player-"+e},r.prototype.preparePlayerElement=function(){var e=this;if(e.element.tagName!=="div"){var t=document.createElement("div");t.className="adbix-player",t.width=n(e.element,"width"),t.height=n(e.element,"height"),e.element.parentNode.replaceChild(t,e.element),e.element=t}return e.element.id||(e.element.id=e.generateElementId()),e.element},r.prototype.getAdsSchedule=function(){var t=this,n={},i=[];return t.opts.mode=="contentRoll"?i=t.opts.contentAdsConfig:i=t.opts.videoAdsConfig,e(i,function(e){var t=e.tag;if(e.params){var i=c(e.params||{},r.userData);r.hasNextCampaign()&&(i.c=r.nextCampaignId,b={campaign:r.nextCampaignId}),t=t+"?"+h(i)}n["ads_"+e.offset]={offset:e.offset,tag:t}}),n},r.prototype.getPlayerConfig=function(e){var t=this,n={width:t.opts.width,height:t.opts.height,primary:t.opts.playerType,playlist:t.opts.playlist};r.conf.adsEnabled&&(n.advertising={client:"vast",schedule:t.getAdsSchedule(),admessage:"Реклама закончится через xx секунд.",skipmessage:"Пропуск xx",skiptext:"Пропустить"});if(!t.opts.downloadVideo){if(t.opts.downloadOnly){x.warn(t.opts.videoUrl,"this video can be displayed only when downloadVideo enabled;");return}e(c({file:t.opts.videoUrl},n))}else f(t.opts.getVideoUrl,function(r){if(r.error){x.log(t.element.id,r.error),x.log(t.element.id,"ads disabled"),delete r.error,delete n.advertising;if(t.opts.downloadOnly){x.warn(t.opts.videoUrl,"this video is not downloaded yet; skip player replace;");return}}e(c(n,r))},{videoUrl:t.opts.videoUrl})},r.prototype.sendState=function(e,t){var n=this,i=c(r.userData,{state:e,platform:n.opts.platformId,ad_type:e.search("video")!==-1?"video":"pre"});t&&(i=c(i,t)),f(n.opts.analyticsUrl+"?"+h(i))},r.prototype.onReady=function(){this.sendState(this.opts.STATE_INIT)},r.prototype.onPlay=function(e){if(r.played.indexOf(this.element.id)!==-1)return;r.played.push(this.element.id),this.sendState(this.opts.STATE_START)},r.prototype.onPause=function(e){var t=this.player.getPosition();typeof t=="number"&&this.sendState(this.opts.STATE_STOP,{position:t})},r.prototype.onComplete=function(e){var t=this.player.getPosition();typeof t=="number"&&this.sendState(this.opts.STATE_STOP,{position:t})},r.prototype.onAdImpression=function(e){e.tag.indexOf("://adbix.tv/")<=-1&&this.sendState(this.opts.STATE_AD_PLAY),v("adImpression")},r.prototype.onSetupError=function(e){e=d(this,e),x.debug("setupError",e),this.sendState(this.opts.STATE_INIT_ERROR,e),v("setupError",e)},r.prototype.onError=function(e){e=d(this,e),x.debug("playError",e),this.sendState(this.opts.STATE_PLAY_ERROR,e),v("playError",e)},r.prototype.onAdError=function(e){e=d(this,e),x.debug("adError",e),this.sendState(this.opts.STATE_AD_ERROR,e),v("adError",e)},r.prototype.onAdComplete=function(e){e.tag.indexOf("://adbix.tv/")<=-1&&this.sendState(this.opts.STATE_AD_COMPLETE),v("adComplete")},r.prototype.onAdClick=function(e){e.tag.indexOf("://adbix.tv/")<=-1&&this.sendState(this.opts.STATE_AD_CLICK),v("adClick")},r.prototype.onBeforeunload=function(e){this.onPause(null)},r.prototype.lowerVolume=function(){this.player.getVolume()==100&&this.player.setVolume(43.1)},r.prototype.restoreVolume=function(){this.player.getVolume()===43.1&&this.player.setVolume(100)},r.prototype.playbackFix=function(){var e=this;if(e.opts.downloadVideo)return;e.player.setMute(!0),setTimeout(function(){x.log("youtube playback fix",e.player.getState(),e.player.getPosition(),e.player.getDuration());var t=e.player.getPosition();e.player.stop(),e.player.setMute(!1),e.player.seek(t)},500)},r.prototype.appendIframeAds=function(e){var t=this,n=t.element,r=n.parentElement,i=document.createElement("iframe"),s=document.createElement("div"),o=document.createElement("button");i.src="http://adbix.tv/static/dumedia-test.html?v=1",i.setAttribute("frameborder","0"),i.scrolling="no",i.style.width="100%",i.style.height="100%",o.style.float="right",o.textContent="✖ Закрыть",o.href="#close()",o.onclick=function(t){t.preventDefault(),typeof e=="function"?(r.removeChild(s),e()):r.replaceChild(n,s)},s.appendChild(o),s.appendChild(i),s.style.cssText=n.style.cssText,r.replaceChild(s,n),t.sendState(t.opts.STATE_START,{iframeads:!0})},r.getUserData=function(e){var t=function(t){x.log("received",t),r.userData=c(r.userData,t),e(r)};r.getUserDataJsonp?(window._adb_process_userdata=t,l(r.getUserDataUrl)):f(r.getUserDataJson,t)},r.getNextCampaign=function(e,t){var n=c({t:e||"post"},r.userData),i=r.getNextCampaignUrl+"?"+h(n);f(i,function(e){r.nextCampaignId=e.campaign,typeof t=="function"&&t(e)})},r.hasNextCampaign=function(){return Boolean(r.nextCampaignId)},r.setupPlayer=function(e,t,n){var i=document.getElementById(e),s=new r(i,{videoUrl:t,playerConfig:n});return s},r.setup=function(t){var n=document.querySelectorAll(t);e(n,function(e){return new r(e,{videoUrl:e.getAttribute("data-video-url")})})},r.videoAutodetect=function(){var n=document.querySelectorAll("iframe, object, embed"),r=[N,C,k,L];e(n,function(e){if(e.getAttribute("data-adbix-ignore")==="true")return;if(e.tagName.toLowerCase()==="embed"&&e.parentNode.tagName.toLowerCase()==="object")return;t(r,function(t){try{return t(e)}catch(n){x.warn(n)}})})},r.contentRollSetup=function(){var t=document.querySelectorAll("div[data-adbix=content-roll]");e(t,function(e){r.getNextCampaign("content",function(t){if(!t.campaign){x.warn("no ads to display");return}var n=e.appendChild(document.createElement("div"));n.innerHTML="Реклама",n.style.cssText="width: 100px; margin-left: auto; margin-right: auto;font-size: 10px;";var i=e.appendChild(document.createElement("div")),s=e.appendChild(document.createElement("div"));return s.innerHTML="Для включения звука наведите курсор на видео",s.style.cssText="width: 300px; margin-left: auto; margin-right: auto;font-size: 11px;",new r(i,{contentRoll:!0,campaign:t.campaign})})})},r}(),N=function(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,n=function(e){var n="";switch(e.tagName.toLowerCase()){case"object":n=e.getAttribute("data")||e.querySelector("embed").src;break;default:n=e.src}var r=n.match(t);if(r){var i=p(n);return!i.v&&r[1].length==11&&(i.v=r[1]),i}x.warn("youtube: url don't match regex",n)},r=function(e){var t=n(e);if(!t||t.list||!t.v)return;var r=null,i=null,s="/0.jpg";return r="https://www.youtube.com/watch?v="+t.v,e.getAttribute("data-maxresdefault")&&(s="/maxresdefault.jpg"),i="https://img.youtube.com/vi/"+t.v+s,new T(e,{image:i,videoUrl:r})};return r(e)},C=function(e){if(e.tagName!="OBJECT"||e.type!="application/x-shockwave-flash")return;var t=p("?"+e.querySelector("param[name=flashvars]").value);if(!r(t.file)){x.debug("uppod not detected");return}return new T(e,{videoUrl:t.file,playerConfig:{autostart:t.auto==="play"}})},k=function(e){if(e.tagName!="IFRAME")return;var t=["/vk.com/video_ext.php","vkontakte.ru/video_ext.php"];if(e.src.indexOf(t[0])==-1&&e.src.indexOf(t[1])==-1)return;var n=p(e.src);if(n.oid&&n.id)return new T(e,{videoUrl:"//vk.com/video"+n.oid+"_"+n.id,downloadOnly:!0})},L=function(e){try{var t=jwplayer(e).config.file;if(typeof t=="string")return new T(e,{videoUrl:t})}catch(n){}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(this===null)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(i===0)return-1;var s=+t||0;Math.abs(s)===Infinity&&(s=0);if(s>=i)return-1;n=Math.max(s>=0?s:i-Math.abs(s),0);while(n<i){var o;if(n in r&&r[n]===e)return n;n++}return-1}),T.isMobile?x.log("mobile detected; do nothing;"):(i(),T.onEvent=o,window.Adbix=T);var A="4mVsfH34ImwcxCi8zX6GfA==",O=function(){var e,t,n={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(e in n)if(e in document){t=n[e];break}return function(n){return n&&o(document,t,n),!document[e]}}()}(),function(e,t){if(!t.__SV){var n,r,i,s;window.mixpanel=t,t._i=[],t.init=function(e,n,r){function o(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var u=t;"undefined"!=typeof r?u=t[r]=[]:r="mixpanel",u.people=u.people||[],u.toString=function(e){var t="mixpanel";return"mixpanel"!==r&&(t+="."+r),e||(t+=" (stub)"),t},u.people.toString=function(){return u.toString(1)+".people (stub)"},i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(s=0;s<i.length;s++)o(u,i[s]);t._i.push([e,n,r])},t.__SV=1.2,n=e.createElement("script"),n.type="text/javascript",n.async=!0,n.src="//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",r=e.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r)}}(document,window.mixpanel||[]),mixpanel.init("59f62b69025f91e1a4940066ada6c906"),Adbix},visibilityjs:function(e){return function(e){"use strict";var t=-1,n={onVisible:function(e){var t=n.isSupported();if(!t||!n.hidden())return e(),t;var r=n.change(function(t,i){n.hidden()||(n.unbind(r),e())});return r},change:function(e){if(!n.isSupported())return!1;t+=1;var r=t;return n._callbacks[r]=e,n._listen(),r},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){var t=n.isSupported(),r="prerender";if(!t||r!=n.state())return e(),t;var i=n.change(function(t,s){r!=s&&(n.unbind(i),e())});return i},hidden:function(){return!!n._doc.hidden||!!n._doc.webkitHidden},state:function(){return n._doc.visibilityState||n._doc.webkitVisibilityState||"visible"},isSupported:function(){return!!n._doc.visibilityState||!!n._doc.webkitVisibilityState},_doc:document||{},_callbacks:{},_change:function(e){var t=n.state();for(var r in n._callbacks)n._callbacks[r].call(n._doc,e,t)},_listen:function(){if(n._init)return;var e="visibilitychange";n._doc.webkitVisibilityState&&(e="webkit"+e);var t=function(){n._change.apply(n,arguments)};n._doc.addEventListener?n._doc.addEventListener(e,t):n._doc.attachEvent(e,t),n._init=!0}};typeof module!="undefined"&&module.exports?module.exports=n:e.Visibility=n}(this),function(e){"use strict";if(e.visibilityState||e.webkitVisibilityState)return;e.hidden=!1,e.visibilityState="visible";var t=null,n=0,r=function(){e.createEvent?(t||(t=e.createEvent("HTMLEvents"),t.initEvent("visibilitychange",!0,!0)),e.dispatchEvent(t)):typeof Visibility=="object"&&Visibility._change.call(Visibility,{})},i=function(){e.hidden=!1,e.visibilityState="visible",r()},s=function(){e.hidden=!0,e.visibilityState="hidden",r()};e.addEventListener?(window.addEventListener("focus",i,!0),window.addEventListener("blur",s,!0)):(e.attachEvent("onfocusin",i),e.attachEvent("onfocusout",s))}(document),Visibility},knob:function(e){return function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={},n=Math.max,r=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var r;for(r in t)n.o[r]=t[r];n._carve().init(),n._configure()._draw()};if(this.$.data("kontroled"))return;this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:this.$.data("min")!==undefined?this.$.data("min"):0,max:this.$.data("max")!==undefined?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||this.$.attr("readonly")==="readonly",cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip=this.o.rotation==="anticlockwise"||this.o.rotation==="acw",this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var r=e(this);n.i[t]=r,n.v[t]=n.o.parse(r.val()),r.bind("change blur",function(){var e={};e[t]=r.val(),n.val(n._validate(e))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),this.v===""&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+"px;"+'"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),this.scale!==1&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var r=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===!1)return;n.change(n._validate(t)),n._draw()};return this.t=t.c.t(e),r(e),t.c.d.bind("touchmove.k",r).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var r=function(e){var t=n.xy2val(e.pageX,e.pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===!1)return;n.change(n._validate(t)),n._draw()};return r(e),t.c.d.bind("mousemove.k",r).bind("keyup.k",function(e){if(e.keyCode===27){t.c.d.unbind("mouseup.k mousemove.k keyup.k");if(n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){var t=~~((e<0?-0.5:.5)+e/this.o.step)*this.o.step;return Math.round(t*100)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){if(null==e)return this.v;e=this.o.parse(e);if(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1)return;this.cv=this.o.stopper?n(r(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw()},this.xy2val=function(e,t){var i,s;return i=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(i=this.angleArc-i-this.PI2),this.angleArc!=this.PI2&&i<0&&i>-0.5?i=0:i<0&&(i+=this.PI2),s=i*(this.o.max-this.o.min)/this.angleArc+this.o.min,this.o.stopper&&(s=n(r(s,this.o.max),this.o.min)),s},this.listen=function(){var t=this,i,s,o=function(e){e.preventDefault();var o=e.originalEvent,u=o.detail||o.wheelDeltaX,a=o.detail||o.wheelDeltaY,f=t._validate(t.o.parse(t.$.val()))+(u>0||a>0?t.o.step:u<0||a<0?-t.o.step:0);f=n(r(f,t.o.max),t.o.min),t.val(f,!1),t.rH&&(clearTimeout(i),i=setTimeout(function(){t.rH(f),i=null},100),s||(s=setTimeout(function(){i&&t.rH(f),s=null},200)))},u,a,f=1,l={37:-t.o.step,38:t.o.step,39:t.o.step,40:-t.o.step};this.$.bind("keydown",function(i){var s=i.keyCode;s>=96&&s<=105&&(s=i.keyCode=s-48),u=parseInt(String.fromCharCode(s));if(isNaN(u)){s!==13&&s!==8&&s!==9&&s!==189&&(s!==190||t.$.val().match(/\./))&&i.preventDefault();if(e.inArray(s,[37,38,39,40])>-1){i.preventDefault();var o=t.o.parse(t.$.val())+l[s]*f;t.o.stopper&&(o=n(r(o,t.o.max),t.o.min)),t.change(t._validate(o)),t._draw(),a=window.setTimeout(function(){f*=2},30)}}}).bind("keyup",function(e){isNaN(u)?a&&(window.clearTimeout(a),a=null,f=1,t.val(t.$.val())):t.$.val()>t.o.max&&t.$.val(t.o.max)||t.$.val()<t.o.min&&t.$.val(t.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",o),this.$.bind("mousewheel DOMMouseScroll",o)},this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(this.w*3/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e=this.g,t=this.arc(this.cv),n,r=1;e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,this.o.bgColor!=="none"&&(e.beginPath(),e.strokeStyle=this.o.bgColor,e.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),e.stroke()),this.o.displayPrevious&&(n=this.arc(this.v),e.beginPath(),e.strokeStyle=this.pColor,e.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),e.stroke(),r=this.cv==this.v),e.beginPath(),e.strokeStyle=r?this.o.fgColor:this.fgColor,e.arc(this.xy,this.xy,this.radius,t.s,t.e,t.d),e.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var r=new t.Dial;r.o=n,r.$=e(this),r.run()}).parent()}}),jQuery},screenfull:function(e,t,n){(function(){"use strict";var e=typeof n!="undefined"&&n.exports,t=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,s={};for(;r<i;r++){e=n[r];if(e&&e[1]in document){for(r=0,t=e.length;r<t;r++)s[n[0][r]]=e[r];return s}}return!1}(),i={request:function(e){var n=r.requestFullscreen;e=e||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[n]():e[n](t&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[r.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:r};if(!r){e?n.exports=!1:window.screenfull=!1;return}Object.defineProperties(i,{isFullscreen:{get:function(){return!!document[r.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[r.fullscreenEnabled]}}}),e?n.exports=i:window.screenfull=i})()},tooltipster:function(e){return function(e,t,n){function r(t,n){this.bodyOverflowX,this.callbacks={hide:[],show:[]},this.checkInterval=null,this.Content,this.$el=e(t),this.$elProxy,this.elProxyPosition,this.enabled=!0,this.options=e.extend({},a,n),this.mouseIsOverProxy=!1,this.namespace="tooltipster-"+Math.round(Math.random()*1e5),this.Status="hidden",this.timerHide=null,this.timerShow=null,this.$tooltip,this.options.iconTheme=this.options.iconTheme.replace(".",""),this.options.theme=this.options.theme.replace(".",""),this._init()}function i(t,n){var r=!0;return e.each(t,function(e,i){if(typeof n[e]=="undefined"||t[e]!==n[e])return r=!1,!1}),r}function s(){return!l&&f}function o(){var e=n.body||n.documentElement,t=e.style,r="transition";if(typeof t[r]=="string")return!0;v=["Moz","Webkit","Khtml","O","ms"],r=r.charAt(0).toUpperCase()+r.substr(1);for(var i=0;i<v.length;i++)if(typeof t[v[i]+r]=="string")return!0;return!1}var u="tooltipster",a={animation:"fade",arrow:!0,arrowColor:"",autoClose:!0,content:null,contentAsHTML:!1,contentCloning:!0,debug:!0,delay:200,minWidth:0,maxWidth:null,functionInit:function(e,t){},functionBefore:function(e,t){t()},functionReady:function(e,t){},functionAfter:function(e){},icon:"(?)",iconCloning:!0,iconDesktop:!1,iconTouch:!1,iconTheme:"tooltipster-icon",interactive:!1,interactiveTolerance:350,multiple:!1,offsetX:0,offsetY:0,onlyOne:!1,position:"top",positionTracker:!1,speed:350,timer:0,theme:"tooltipster-default",touchDevices:!0,trigger:"hover",updateAnimation:!0};r.prototype={_init:function(){var t=this;if(n.querySelector){if(t.options.content!==null)t._content_set(t.options.content);else{var r=t.$el.attr("title");typeof r=="undefined"&&(r=null),t._content_set(r)}var i=t.options.functionInit.call(t.$el,t.$el,t.Content);typeof i!="undefined"&&t._content_set(i),t.$el.removeAttr("title").addClass("tooltipstered"),!f&&t.options.iconDesktop||f&&t.options.iconTouch?(typeof t.options.icon=="string"?(t.$elProxy=e('<span class="'+t.options.iconTheme+'"></span>'),t.$elProxy.text(t.options.icon)):t.options.iconCloning?t.$elProxy=t.options.icon.clone(!0):t.$elProxy=t.options.icon,t.$elProxy.insertAfter(t.$el)):t.$elProxy=t.$el,t.options.trigger=="hover"?(t.$elProxy.on("mouseenter."+t.namespace,function(){if(!s()||t.options.touchDevices)t.mouseIsOverProxy=!0,t._show()}).on("mouseleave."+t.namespace,function(){if(!s()||t.options.touchDevices)t.mouseIsOverProxy=!1}),f&&t.options.touchDevices&&t.$elProxy.on("touchstart."+t.namespace,function(){t._showNow()})):t.options.trigger=="click"&&t.$elProxy.on("click."+t.namespace,function(){(!s()||t.options.touchDevices)&&t._show()})}},_show:function(){var e=this;e.Status!="shown"&&e.Status!="appearing"&&(e.options.delay?e.timerShow=setTimeout(function(){(e.options.trigger=="click"||e.options.trigger=="hover"&&e.mouseIsOverProxy)&&e._showNow()},e.options.delay):e._showNow())},_showNow:function(n){var r=this;r.options.functionBefore.call(r.$el,r.$el,function(){if(r.enabled&&r.Content!==null){n&&r.callbacks.show.push(n),r.callbacks.hide=[],clearTimeout(r.timerShow),r.timerShow=null,clearTimeout(r.timerHide),r.timerHide=null,r.options.onlyOne&&e(".tooltipstered").not(r.$el).each(function(t,n){var r=e(n),i=r.data("tooltipster-ns");e.each(i,function(e,t){var n=r.data(t),i=n.status(),s=n.option("autoClose");i!=="hidden"&&i!=="disappearing"&&s&&n.hide()})});var i=function(){r.Status="shown",e.each(r.callbacks.show,function(e,t){t.call(r.$el)}),r.callbacks.show=[]};if(r.Status!=="hidden"){var s=0;r.Status==="disappearing"?(r.Status="appearing",o()?(r.$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-"+r.options.animation+"-show"),r.options.speed>0&&r.$tooltip.delay(r.options.speed),r.$tooltip.queue(i)):r.$tooltip.stop().fadeIn(i)):r.Status==="shown"&&i()}else{r.Status="appearing";var s=r.options.speed;r.bodyOverflowX=e("body").css("overflow-x"),e("body").css("overflow-x","hidden");var u="tooltipster-"+r.options.animation,a="-webkit-transition-duration: "+r.options.speed+"ms; -webkit-animation-duration: "+r.options.speed+"ms; -moz-transition-duration: "+r.options.speed+"ms; -moz-animation-duration: "+r.options.speed+"ms; -o-transition-duration: "+r.options.speed+"ms; -o-animation-duration: "+r.options.speed+"ms; -ms-transition-duration: "+r.options.speed+"ms; -ms-animation-duration: "+r.options.speed+"ms; transition-duration: "+r.options.speed+"ms; animation-duration: "+r.options.speed+"ms;",l=r.options.minWidth?"min-width:"+Math.round(r.options.minWidth)+"px;":"",c=r.options.maxWidth?"max-width:"+Math.round(r.options.maxWidth)+"px;":"",h=r.options.interactive?"pointer-events: auto;":"";r.$tooltip=e('<div class="tooltipster-base '+r.options.theme+'" style="'+l+" "+c+" "+h+" "+a+'"><div class="tooltipster-content"></div></div>'),o()&&r.$tooltip.addClass(u),r._content_insert(),r.$tooltip.appendTo("body"),r.reposition(),r.options.functionReady.call(r.$el,r.$el,r.$tooltip),o()?(r.$tooltip.addClass(u+"-show"),r.options.speed>0&&r.$tooltip.delay(r.options.speed),r.$tooltip.queue(i)):r.$tooltip.css("display","none").fadeIn(r.options.speed,i),r._interval_set(),e(t).on("scroll."+r.namespace+" resize."+r.namespace,function(){r.reposition()});if(r.options.autoClose){e("body").off("."+r.namespace);if(r.options.trigger=="hover"){f&&setTimeout(function(){e("body").on("touchstart."+r.namespace,function(){r.hide()})},0);if(r.options.interactive){f&&r.$tooltip.on("touchstart."+r.namespace,function(e){e.stopPropagation()});var p=null;r.$elProxy.add(r.$tooltip).on("mouseleave."+r.namespace+"-autoClose",function(){clearTimeout(p),p=setTimeout(function(){r.hide()},r.options.interactiveTolerance)}).on("mouseenter."+r.namespace+"-autoClose",function(){clearTimeout(p)})}else r.$elProxy.on("mouseleave."+r.namespace+"-autoClose",function(){r.hide()})}else r.options.trigger=="click"&&(setTimeout(function(){e("body").on("click."+r.namespace+" touchstart."+r.namespace,function(){r.hide()})},0),r.options.interactive&&r.$tooltip.on("click."+r.namespace+" touchstart."+r.namespace,function(e){e.stopPropagation()}))}}r.options.timer>0&&(r.timerHide=setTimeout(function(){r.timerHide=null,r.hide()},r.options.timer+s))}})},_interval_set:function(){var t=this;t.checkInterval=setInterval(function(){if(e("body").find(t.$el).length===0||e("body").find(t.$elProxy).length===0||t.Status=="hidden"||e("body").find(t.$tooltip).length===0)(t.Status=="shown"||t.Status=="appearing")&&t.hide(),t._interval_cancel();else if(t.options.positionTracker){var n=t._repositionInfo(t.$elProxy),r=!1;i(n.dimension,t.elProxyPosition.dimension)&&(t.$elProxy.css("position")==="fixed"?i(n.position,t.elProxyPosition.position)&&(r=!0):i(n.offset,t.elProxyPosition.offset)&&(r=!0)),r||t.reposition()}},200)},_interval_cancel:function(){clearInterval(this.checkInterval),this.checkInterval=null},_content_set:function(e){typeof e=="object"&&e!==null&&this.options.contentCloning&&(e=e.clone(!0)),this.Content=e},_content_insert:function(){var e=this,t=this.$tooltip.find(".tooltipster-content");typeof e.Content=="string"&&!e.options.contentAsHTML?t.text(e.Content):t.empty().append(e.Content)},_update:function(e){var t=this;t._content_set(e),t.Content!==null?t.Status!=="hidden"&&(t._content_insert(),t.reposition(),t.options.updateAnimation&&(o()?(t.$tooltip.css({width:"","-webkit-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-moz-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing"),setTimeout(function(){t.Status!="hidden"&&(t.$tooltip.removeClass("tooltipster-content-changing"),setTimeout(function(){t.Status!=="hidden"&&t.$tooltip.css({"-webkit-transition":t.options.speed+"ms","-moz-transition":t.options.speed+"ms","-o-transition":t.options.speed+"ms","-ms-transition":t.options.speed+"ms",transition:t.options.speed+"ms"})},t.options.speed))},t.options.speed)):t.$tooltip.fadeTo(t.options.speed,.5,function(){t.Status!="hidden"&&t.$tooltip.fadeTo(t.options.speed,1)}))):t.hide()},_repositionInfo:function(e){return{dimension:{height:e.outerHeight(!1),width:e.outerWidth(!1)},offset:e.offset(),position:{left:parseInt(e.css("left")),top:parseInt(e.css("top"))}}},hide:function(n){var r=this;n&&r.callbacks.hide.push(n),r.callbacks.show=[],clearTimeout(r.timerShow),r.timerShow=null,clearTimeout(r.timerHide),r.timerHide=null;var i=function(){e.each(r.callbacks.hide,function(e,t){t.call(r.$el)}),r.callbacks.hide=[]};if(r.Status=="shown"||r.Status=="appearing"){r.Status="disappearing";var s=function(){r.Status="hidden",typeof r.Content=="object"&&r.Content!==null&&r.Content.detach(),r.$tooltip.remove(),r.$tooltip=null,e(t).off("."+r.namespace),e("body").off("."+r.namespace).css("overflow-x",r.bodyOverflowX),e("body").off("."+r.namespace),r.$elProxy.off("."+r.namespace+"-autoClose"),r.options.functionAfter.call(r.$el,r.$el),i()};o()?(r.$tooltip.clearQueue().removeClass("tooltipster-"+r.options.animation+"-show").addClass("tooltipster-dying"),r.options.speed>0&&r.$tooltip.delay(r.options.speed),r.$tooltip.queue(s)):r.$tooltip.stop().fadeOut(r.options.speed,s)}else r.Status=="hidden"&&i();return r},show:function(e){return this._showNow(e),this},update:function(e){return this.content(e)},content:function(e){return typeof e=="undefined"?this.Content:(this._update(e),this)},reposition:function(){var n=this;if(e("body").find(n.$tooltip).length!==0){n.$tooltip.css("width",""),n.elProxyPosition=n._repositionInfo(n.$elProxy);var r=null,i=e(t).width(),s=n.elProxyPosition,o=n.$tooltip.outerWidth(!1),u=n.$tooltip.innerWidth()+1,a=n.$tooltip.outerHeight(!1);if(n.$elProxy.is("area")){var f=n.$elProxy.attr("shape"),l=n.$elProxy.parent().attr("name"),c=e('img[usemap="#'+l+'"]'),h=c.offset().left,p=c.offset().top,d=n.$elProxy.attr("coords")!==undefined?n.$elProxy.attr("coords").split(","):undefined;if(f=="circle"){var v=parseInt(d[0]),m=parseInt(d[1]),g=parseInt(d[2]);s.dimension.height=g*2,s.dimension.width=g*2,s.offset.top=p+m-g,s.offset.left=h+v-g}else if(f=="rect"){var v=parseInt(d[0]),m=parseInt(d[1]),y=parseInt(d[2]),b=parseInt(d[3]);s.dimension.height=b-m,s.dimension.width=y-v,s.offset.top=p+m,s.offset.left=h+v}else if(f=="poly"){var w=[],E=[],S=0,x=0,T=0,N=0,C="even";for(var k=0;k<d.length;k++){var L=parseInt(d[k]);C=="even"?(L>T&&(T=L,k===0&&(S=T)),L<S&&(S=L),C="odd"):(L>N&&(N=L,k==1&&(x=N)),L<x&&(x=L),C="even")}s.dimension.height=N-x,s.dimension.width=T-S,s.offset.top=p+x,s.offset.left=h+S}else s.dimension.height=c.outerHeight(!1),s.dimension.width=c.outerWidth(!1),s.offset.top=p,s.offset.left=h}var A=0,O=0,M=0,_=parseInt(n.options.offsetY),D=parseInt(n.options.offsetX),P=n.options.position;function H(){var n=e(t).scrollLeft();A-n<0&&(r=A-n,A=n),A+o-n>i&&(r=A-(i+n-o),A=i+n-o)}function B(n,r){s.offset.top-e(t).scrollTop()-a-_-12<0&&r.indexOf("top")>-1&&(P=n),s.offset.top+s.dimension.height+a+12+_>e(t).scrollTop()+e(t).height()&&r.indexOf("bottom")>-1&&(P=n,M=s.offset.top-a-_-12)}if(P=="top"){var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left+D-j/2,M=s.offset.top-a-_-12,H(),B("bottom","top")}P=="top-left"&&(A=s.offset.left+D,M=s.offset.top-a-_-12,H(),B("bottom-left","top-left")),P=="top-right"&&(A=s.offset.left+s.dimension.width+D-o,M=s.offset.top-a-_-12,H(),B("bottom-right","top-right"));if(P=="bottom"){var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left-j/2+D,M=s.offset.top+s.dimension.height+_+12,H(),B("top","bottom")}P=="bottom-left"&&(A=s.offset.left+D,M=s.offset.top+s.dimension.height+_+12,H(),B("top-left","bottom-left")),P=="bottom-right"&&(A=s.offset.left+s.dimension.width+D-o,M=s.offset.top+s.dimension.height+_+12,H(),B("top-right","bottom-right"));if(P=="left"){A=s.offset.left-D-o-12,O=s.offset.left+D+s.dimension.width+12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A<0&&O+o>i){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=o+A-I;n.$tooltip.css("width",q+"px"),a=n.$tooltip.outerHeight(!1),A=s.offset.left-D-q-12-I,F=s.offset.top+a-(s.offset.top+s.dimension.height),M=s.offset.top-F/2-_}else A<0&&(A=s.offset.left+D+s.dimension.width+12,r="left")}if(P=="right"){A=s.offset.left+D+s.dimension.width+12,O=s.offset.left-D-o-12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A+o>i&&O<0){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=i-A-I;n.$tooltip.css("width",q+"px"),a=n.$tooltip.outerHeight(!1),F=s.offset.top+a-(s.offset.top+s.dimension.height),M=s.offset.top-F/2-_}else A+o>i&&(A=s.offset.left-D-o-12,r="right")}if(n.options.arrow){var R="tooltipster-arrow-"+P;if(n.options.arrowColor.length<1)var U=n.$tooltip.css("background-color");else var U=n.options.arrowColor;r?r=="left"?(R="tooltipster-arrow-right",r=""):r=="right"?(R="tooltipster-arrow-left",r=""):r="left:"+Math.round(r)+"px;":r="";if(P=="top"||P=="top-left"||P=="top-right")var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color");else if(P=="bottom"||P=="bottom-left"||P=="bottom-right")var z=parseFloat(n.$tooltip.css("border-top-width")),W=n.$tooltip.css("border-top-color");else if(P=="left")var z=parseFloat(n.$tooltip.css("border-right-width")),W=n.$tooltip.css("border-right-color");else if(P=="right")var z=parseFloat(n.$tooltip.css("border-left-width")),W=n.$tooltip.css("border-left-color");else var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color");z>1&&z++;var X="";if(z!==0){var V="",$="border-color: "+W+";";R.indexOf("bottom")!==-1?V="margin-top: -"+Math.round(z)+"px;":R.indexOf("top")!==-1?V="margin-bottom: -"+Math.round(z)+"px;":R.indexOf("left")!==-1?V="margin-right: -"+Math.round(z)+"px;":R.indexOf("right")!==-1&&(V="margin-left: -"+Math.round(z)+"px;"),X='<span class="tooltipster-arrow-border" style="'+V+" "+$+';"></span>'}n.$tooltip.find(".tooltipster-arrow").remove();var J='<div class="'+R+' tooltipster-arrow" style="'+r+'">'+X+'<span style="border-color:'+U+';"></span></div>';n.$tooltip.append(J)}n.$tooltip.css({top:Math.round(M)+"px",left:Math.round(A)+"px"})}return n},enable:function(){return this.enabled=!0,this},disable:function(){return this.hide(),this.enabled=!1,this},destroy:function(){var t=this;t.hide(),t.$el[0]!==t.$elProxy[0]&&t.$elProxy.remove(),t.$el.removeData(t.namespace).off("."+t.namespace);var n=t.$el.data("tooltipster-ns");if(n.length===1){var r=typeof t.Content=="string"?t.Content:e("<div></div>").append(t.Content).html();t.$el.removeClass("tooltipstered").attr("title",r).removeData(t.namespace).removeData("tooltipster-ns").off("."+t.namespace)}else n=e.grep(n,function(e,n){return e!==t.namespace}),t.$el.data("tooltipster-ns",n);return t},elementIcon:function(){return this.$el[0]!==this.$elProxy[0]?this.$elProxy[0]:undefined},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:undefined},option:function(e,t){return typeof t=="undefined"?this.options[e]:(this.options[e]=t,this)},status:function(){return this.Status}},e.fn[u]=function(){var t=arguments;if(this.length===0){if(typeof t[0]=="string"){var n=!0;switch(t[0]){case"setDefaults":e.extend(a,t[1]);break;default:n=!1}return n?!0:this}return this}if(typeof t[0]=="string"){var i="#*$~&";return this.each(function(){var n=e(this).data("tooltipster-ns"),r=n?e(this).data(n[0]):null;if(!r)throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element');if(typeof r[t[0]]!="function")throw new Error('Unknown method .tooltipster("'+t[0]+'")');var s=r[t[0]](t[1],t[2]);if(s!==r)return i=s,!1}),i!=="#*$~&"?i:this}var s=[],o=t[0]&&typeof t[0].multiple!="undefined",u=o&&t[0].multiple||!o&&a.multiple,f=t[0]&&typeof t[0].debug!="undefined",l=f&&t[0].debug||!f&&a.debug;return this.each(function(){var n=!1,i=e(this).data("tooltipster-ns"),o=null;i?u?n=!0:l&&console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.'):n=!0,n&&(o=new r(this,t[0]),i||(i=[]),i.push(o.namespace),e(this).data("tooltipster-ns",i),e(this).data(o.namespace,o)),s.push(o)}),u?s:this};var f="ontouchstart"in t,l=!1;e("body").one("mousemove",function(){l=!0})}(jQuery,window,document),jQuery},swfobject:function(e){var t=function(){function e(){if(W||!document.getElementsByTagName("body")[0])return;try{var e,t=y("span");t.style.display="none",e=D.getElementsByTagName("body")[0].appendChild(t),e.parentNode.removeChild(e),e=null,t=null}catch(n){return}W=!0;var r=B.length;for(var i=0;i<r;i++)B[i]()}function n(e){W?e():B[B.length]=e}function r(e){if(typeof _.addEventListener!=N)_.addEventListener("load",e,!1);else if(typeof D.addEventListener!=N)D.addEventListener("load",e,!1);else if(typeof _.attachEvent!=N)w(_,"onload",e);else if(typeof _.onload=="function"){var t=_.onload;_.onload=function(){t(),e()}}else _.onload=e}function i(){var e=D.getElementsByTagName("body")[0],t=y(C);t.setAttribute("style","visibility: hidden;"),t.setAttribute("type",A);var n=e.appendChild(t);if(n){var r=0;(function i(){if(typeof n.GetVariable!=N)try{var o=n.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),Q.pv=[b(o[0]),b(o[1]),b(o[2])])}catch(u){Q.pv=[8,0,0]}else if(r<10){r++,setTimeout(i,10);return}e.removeChild(t),n=null,s()})()}else s()}function s(){var e=j.length;if(e>0)for(var t=0;t<e;t++){var n=j[t].id,r=j[t].callbackFn,i={success:!1,id:n};if(Q.pv[0]>0){var s=g(n);if(s)if(E(j[t].swfVersion)&&!(Q.wk&&Q.wk<312))x(n,!0),r&&(i.success=!0,i.ref=o(n),i.id=n,r(i));else if(j[t].expressInstall&&u()){var l={};l.data=j[t].expressInstall,l.width=s.getAttribute("width")||"0",l.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(l.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(l.align=s.getAttribute("align"));var c={},h=s.getElementsByTagName("param"),p=h.length;for(var d=0;d<p;d++)h[d].getAttribute("name").toLowerCase()!="movie"&&(c[h[d].getAttribute("name")]=h[d].getAttribute("value"));a(l,c,n,r)}else f(s),r&&r(i)}else{x(n,!0);if(r){var v=o(n);v&&typeof v.SetVariable!=N&&(i.success=!0,i.ref=v,i.id=v.id),r(i)}}}}function o(e){var t=null,n=g(e);return n&&n.nodeName.toUpperCase()==="OBJECT"&&(typeof n.SetVariable!==N?t=n:t=n.getElementsByTagName(C)[0]||n),t}function u(){return!X&&E("6.0.65")&&(Q.win||Q.mac)&&!(Q.wk&&Q.wk<312)}function a(e,t,n,r){var i=g(n);n=m(n),X=!0,U=r||null,z={success:!1,id:n};if(i){i.nodeName.toUpperCase()=="OBJECT"?(q=l(i),R=null):(q=i,R=n),e.id=O;if(typeof e.width==N||!/%$/.test(e.width)&&b(e.width)<310)e.width="310";if(typeof e.height==N||!/%$/.test(e.height)&&b(e.height)<137)e.height="137";var s=Q.ie?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURIComponent(_.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+s+"&MMdoctitle="+encodeURIComponent(D.title.slice(0,47)+" - Flash Player Installation");typeof t.flashvars!=N?t.flashvars+="&"+o:t.flashvars=o;if(Q.ie&&i.readyState!=4){var u=y("div");n+="SWFObjectNew",u.setAttribute("id",n),i.parentNode.insertBefore(u,i),i.style.display="none",d(i)}h(e,t,n)}}function f(e){if(Q.ie&&e.readyState!=4){e.style.display="none";var t=y("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(l(e),t),d(e)}else e.parentNode.replaceChild(l(e),e)}function l(e){var t=y("div");if(Q.win&&Q.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(C)[0];if(n){var r=n.childNodes;if(r){var i=r.length;for(var s=0;s<i;s++)(r[s].nodeType!=1||r[s].nodeName!="PARAM")&&r[s].nodeType!=8&&t.appendChild(r[s].cloneNode(!0))}}}return t}function c(e,t){var n=y("div");return n.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+e+"'>"+t+"</object>",n.firstChild}function h(e,t,n){var r,i=g(n);n=m(n);if(Q.wk&&Q.wk<312)return r;if(i){var s=Q.ie?y("div"):y(C),o,u,a;typeof e.id==N&&(e.id=n);for(a in t)t.hasOwnProperty(a)&&a.toLowerCase()!=="movie"&&p(s,a,t[a]);Q.ie&&(s=c(e.data,s.innerHTML));for(o in e)e.hasOwnProperty(o)&&(u=o.toLowerCase(),u==="styleclass"?s.setAttribute("class",e[o]):u!=="classid"&&u!=="data"&&s.setAttribute(o,e[o]));Q.ie?F[F.length]=e.id:(s.setAttribute("type",A),s.setAttribute("data",e.data)),i.parentNode.replaceChild(s,i),r=s}return r}function p(e,t,n){var r=y("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function d(e){var t=g(e);t&&t.nodeName.toUpperCase()=="OBJECT"&&(Q.ie?(t.style.display="none",function n(){if(t.readyState==4){for(var e in t)typeof t[e]=="function"&&(t[e]=null);t.parentNode.removeChild(t)}else setTimeout(n,10)}()):t.parentNode.removeChild(t))}function v(e){return e&&e.nodeType&&e.nodeType===1}function m(e){return v(e)?e.id:e}function g(e){if(v(e))return e;var t=null;try{t=D.getElementById(e)}catch(n){}return t}function y(e){return D.createElement(e)}function b(e){return parseInt(e,10)}function w(e,t,n){e.attachEvent(t,n),I[I.length]=[e,t,n]}function E(e){e+="";var t=Q.pv,n=e.split(".");return n[0]=b(n[0]),n[1]=b(n[1])||0,n[2]=b(n[2])||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function S(e,t,n,r){var i=D.getElementsByTagName("head")[0];if(!i)return;var s=typeof n=="string"?n:"screen";r&&(V=null,$=null);if(!V||$!=s){var o=y("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),V=i.appendChild(o),Q.ie&&typeof D.styleSheets!=N&&D.styleSheets.length>0&&(V=D.styleSheets[D.styleSheets.length-1]),$=s}V&&(typeof V.addRule!=N?V.addRule(e,t):typeof D.createTextNode!=N&&V.appendChild(D.createTextNode(e+" {"+t+"}")))}function x(e,t){if(!J)return;var n=t?"visible":"hidden",r=g(e);W&&r?r.style.visibility=n:typeof e=="string"&&S("#"+e,"visibility:"+n)}function T(e){var t=/[\\\"<>\.;]/,n=t.exec(e)!=null;return n&&typeof encodeURIComponent!=N?encodeURIComponent(e):e}var N="undefined",C="object",k="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",A="application/x-shockwave-flash",O="SWFObjectExprInst",M="onreadystatechange",_=window,D=document,P=navigator,H=!1,B=[],j=[],F=[],I=[],q,R,U,z,W=!1,X=!1,V,$,J=!0,K=!1,Q=function(){var e=typeof D.getElementById!=N&&typeof D.getElementsByTagName!=N&&typeof D.createElement!=N,t=P.userAgent.toLowerCase(),n=P.platform.toLowerCase(),r=n?/win/.test(n):/win/.test(t),i=n?/mac/.test(n):/mac/.test(t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=P.appName==="Microsoft Internet Explorer",u=[0,0,0],a=null;if(typeof P.plugins!=N&&typeof P.plugins[k]==C)a=P.plugins[k].description,a&&typeof P.mimeTypes!=N&&P.mimeTypes[A]&&P.mimeTypes[A].enabledPlugin&&(H=!0,o=!1,a=a.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),u[0]=b(a.replace(/^(.*)\..*$/,"$1")),u[1]=b(a.replace(/^.*\.(.*)\s.*$/,"$1")),u[2]=/[a-zA-Z]/.test(a)?b(a.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof _.ActiveXObject!=N)try{var f=new ActiveXObject(L);f&&(a=f.GetVariable("$version"),a&&(o=!0,a=a.split(" ")[1].split(","),u=[b(a[0]),b(a[1]),b(a[2])]))}catch(l){}return{w3:e,pv:u,wk:s,ie:o,win:r,mac:i}}(),G=function(){if(!Q.w3)return;(typeof D.readyState!=N&&(D.readyState==="complete"||D.readyState==="interactive")||typeof D.readyState==N&&(D.getElementsByTagName("body")[0]||D.body))&&e(),W||(typeof D.addEventListener!=N&&D.addEventListener("DOMContentLoaded",e,!1),Q.ie&&(D.attachEvent(M,function t(){D.readyState=="complete"&&(D.detachEvent(M,t),e())}),_==top&&function n(){if(W)return;try{D.documentElement.doScroll("left")}catch(t){setTimeout(n,0);return}e()}()),Q.wk&&function r(){if(W)return;if(!/loaded|complete/.test(D.readyState)){setTimeout(r,0);return}e()}())}();B[0]=function(){H?i():s()};var Y=function(){Q.ie&&window.attachEvent("onunload",function(){var e=I.length;for(var n=0;n<e;n++)I[n][0].detachEvent(I[n][1],I[n][2]);var r=F.length;for(var i=0;i<r;i++)d(F[i]);for(var s in Q)Q[s]=null;Q=null;for(var o in t)t[o]=null;t=null})}();return{registerObject:function(e,t,n,r){if(Q.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,j[j.length]=i,x(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(Q.w3)return o(e)},embedSWF:function(e,t,r,i,s,o,f,l,c,p){var d=m(t),v={success:!1,id:d};Q.w3&&!(Q.wk&&Q.wk<312)&&e&&t&&r&&i&&s?(x(d,!1),n(function(){r+="",i+="";var n={};if(c&&typeof c===C)for(var m in c)n[m]=c[m];n.data=e,n.width=r,n.height=i;var g={};if(l&&typeof l===C)for(var y in l)g[y]=l[y];if(f&&typeof f===C)for(var b in f)if(f.hasOwnProperty(b)){var w=K?encodeURIComponent(b):b,S=K?encodeURIComponent(f[b]):f[b];typeof g.flashvars!=N?g.flashvars+="&"+w+"="+S:g.flashvars=w+"="+S}if(E(s)){var T=h(n,g,t);n.id==d&&x(d,!0),v.success=!0,v.ref=T,v.id=T.id}else{if(o&&u()){n.data=o,a(n,g,t,p);return}x(d,!0)}p&&p(v)})):p&&p(v)},switchOffAutoHideShow:function(){J=!1},enableUriEncoding:function(e){K=typeof e===N?!0:e},ua:Q,getFlashPlayerVersion:function(){return{major:Q.pv[0],minor:Q.pv[1],release:Q.pv[2]}},hasFlashPlayerVersion:E,createSWF:function(e,t,n){return Q.w3?h(e,t,n):undefined},showExpressInstall:function(e,t,n,r){Q.w3&&u()&&a(e,t,n,r)},removeSWF:function(e){Q.w3&&d(e)},createCSS:function(e,t,n,r){Q.w3&&S(e,t,n,r)},addDomLoadEvent:n,addLoadEvent:r,getQueryParamValue:function(e){var t=D.location.search||D.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return T(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return T(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(X){var e=g(O);e&&q&&(e.parentNode.replaceChild(q,e),R&&(x(R,!0),Q.ie&&(q.style.display="block")),U&&U(z)),X=!1}},version:"2.3"}}();return window.swfobject=t},froogaloop:function(e){var t=function(){function e(t){return new e.fn.init(t)}function t(e,t,n){if(!n.contentWindow.postMessage)return!1;var r=n.getAttribute("src").split("?")[0],e=JSON.stringify({method:e,value:t});"//"===r.substr(0,2)&&(r=window.location.protocol+r),n.contentWindow.postMessage(e,r)}function n(e){var t,n;try{t=JSON.parse(e.data),n=t.event||t.method}catch(r){}"ready"==n&&!s&&(s=!0);if(e.origin!=o)return!1;var e=t.value,u=t.data,a=""===a?null:t.player_id;return t=a?i[a][n]:i[n],n=[],t?(void 0!==e&&n.push(e),u&&n.push(u),a&&n.push(a),0<n.length?t.apply(null,n):t.call()):!1}function r(e,t,n){n?(i[n]||(i[n]={}),i[n][e]=t):i[e]=t}var i={},s=!1,o="";return e.fn=e.prototype={element:null,init:function(e){"string"==typeof e&&(e=document.getElementById(e)),this.element=e,e=this.element.getAttribute("src"),"//"===e.substr(0,2)&&(e=window.location.protocol+e);for(var e=e.split("/"),t="",n=0,r=e.length;n<r;n++){if(!(3>n))break;t+=e[n],2>n&&(t+="/")}return o=t,this},api:function(e,n){if(!this.element||!e)return!1;var i=this.element,s=""!==i.id?i.id:null,o=!n||!n.constructor||!n.call||!n.apply?n:null,u=n&&n.constructor&&n.call&&n.apply?n:null;return u&&r(e,u,s),t(e,o,i),this},addEvent:function(e,n){if(!this.element)return!1;var i=this.element,o=""!==i.id?i.id:null;return r(e,n,o),"ready"!=e?t("addEventListener",e,i):"ready"==e&&s&&n.call(null,o),this},removeEvent:function(e){if(!this.element)return!1;var n=this.element,r;e:{if((r=""!==n.id?n.id:null)&&i[r]){if(!i[r][e]){r=!1;break e}i[r][e]=null}else{if(!i[e]){r=!1;break e}i[e]=null}r=!0}"ready"!=e&&r&&t("removeEventListener",e,n)}},e.fn.init.prototype=e.fn,window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),window.Froogaloop=window.$f=e}();return t},autosize:function(e){return function(e,t){if(typeof define=="function"&&define.amd)define(["exports","module"],t);else if(typeof exports!="undefined"&&typeof module!="undefined")t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,function(e,t){"use strict";function n(e){function t(){var t=window.getComputedStyle(e,null);t.resize==="vertical"?e.style.resize="none":t.resize==="both"&&(e.style.resize="horizontal"),t.boxSizing==="content-box"?a=-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):a=parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(a)&&(a=0),u()}function n(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t,i()}function r(e){var t=[];while(e&&e.parentNode&&e.parentNode instanceof Element)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function i(){var t=e.style.height,n=r(e),i=document.documentElement&&document.documentElement.scrollTop;e.style.height="auto";var s=e.scrollHeight+a;if(e.scrollHeight===0){e.style.height=t;return}e.style.height=s+"px",f=e.clientWidth,n.forEach(function(e){e.node.scrollTop=e.scrollTop}),i&&(document.documentElement.scrollTop=i)}function u(){i();var t=window.getComputedStyle(e,null),r=Math.round(parseFloat(t.height)),s=Math.round(parseFloat(e.style.height));r!==s?t.overflowY!=="visible"&&n("visible"):t.overflowY!=="hidden"&&n("hidden");if(l!==r){l=r;var u=o("autosize:resized");e.dispatchEvent(u)}}if(!e||!e.nodeName||e.nodeName!=="TEXTAREA"||s.has(e))return;var a=null,f=e.clientWidth,l=null,c=function(){e.clientWidth!==f&&u()},h=function(t){window.removeEventListener("resize",c,!1),e.removeEventListener("input",u,!1),e.removeEventListener("keyup",u,!1),e.removeEventListener("autosize:destroy",h,!1),e.removeEventListener("autosize:update",u,!1),s["delete"](e),Object.keys(t).forEach(function(n){e.style[n]=t[n]})}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",h,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",u,!1),window.addEventListener("resize",c,!1),e.addEventListener("input",u,!1),e.addEventListener("autosize:update",u,!1),s.add(e),e.style.overflowX="hidden",e.style.wordWrap="break-word",t()}function r(e){if(!e||!e.nodeName||e.nodeName!=="TEXTAREA")return;var t=o("autosize:destroy");e.dispatchEvent(t)}function i(e){if(!e||!e.nodeName||e.nodeName!=="TEXTAREA")return;var t=o("autosize:update");e.dispatchEvent(t)}var s=typeof Set=="function"?new Set:function(){var e=[];return{has:function(t){return Boolean(e.indexOf(t)>-1)},add:function(t){e.push(t)},"delete":function(t){e.splice(e.indexOf(t),1)}}}(),o=function(e){return new Event(e)};try{new Event("test")}catch(u){o=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var a=null;typeof window=="undefined"||typeof window.getComputedStyle!="function"?(a=function(e){return e},a.destroy=function(e){return e},a.update=function(e){return e}):(a=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return n(e,t)}),e},a.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],r),e},a.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e}),t.exports=a}),autosize},"medium-editor":function(e,t,n){"classList"in document.createElement("_")||function(e){"use strict";if(!("Element"in e))return;var t="classList",n="prototype",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(){var e=arguments,t=0,n=e.length,r,i=!1;do r=e[t]+"",a(this,r)===-1&&(this.push(r),i=!0);while(++t<n);i&&this._updateClassName()},l.remove=function(){var e=arguments,t=0,n=e.length,r,i=!1,s;do{r=e[t]+"",s=a(this,r);while(s!==-1)this.splice(s,1),i=!0,s=a(this,r)}while(++t<n);i&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),function(e){"use strict";e.URL=e.URL||e.webkitURL;if(e.Blob&&e.URL)try{new Blob;return}catch(t){}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},i=n.prototype,s=r.prototype,o=e.FileReaderSync,u=function(e){this.code=this[this.name=e]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),f=a.length,l=e.URL||e.webkitURL||e,c=l.createObjectURL,h=l.revokeObjectURL,p=l,d=e.btoa,v=e.atob,m=e.ArrayBuffer,g=e.Uint8Array,y=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;r.fake=s.fake=!0;while(f--)u.prototype[a[f]]=f+1;return l.createObjectURL||(p=e.URL=function(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","a"),n;return t.href=e,"origin"in t||(t.protocol.toLowerCase()==="data:"?t.origin=null:(n=e.match(y),t.origin=n&&n[1])),t}),p.createObjectURL=function(e){var t=e.type,n;t===null&&(t="application/octet-stream");if(e instanceof r)return n="data:"+t,e.encoding==="base64"?n+";base64,"+e.data:e.encoding==="URI"?n+","+decodeURIComponent(e.data):d?n+";base64,"+d(e.data):n+","+encodeURIComponent(e.data);if(c)return c.call(l,e)},p.revokeObjectURL=function(e){e.substring(0,5)!=="data:"&&h&&h.call(l,e)},i.append=function(e){var n=this.data;if(g&&(e instanceof m||e instanceof g)){var i="",s=new g(e),a=0,f=s.length;for(;a<f;a++)i+=String.fromCharCode(s[a]);n.push(i)}else if(t(e)==="Blob"||t(e)==="File"){if(!o)throw new u("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof r?e.encoding==="base64"&&v?n.push(v(e.data)):e.encoding==="URI"?n.push(decodeURIComponent(e.data)):e.encoding==="raw"&&n.push(e.data):(typeof e!="string"&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},s.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,t){var r=t?t.type||"":"",i=new n;if(e)for(var s=0,o=e.length;s<o;s++)Uint8Array&&e[s]instanceof Uint8Array?i.append(e[s].buffer):i.append(e[s]);var u=i.getBlob(r);return!u.slice&&u.webkitSlice&&(u.slice=u.webkitSlice),u};var r=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=r(new e.Blob)}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content||this),function(e,t){"use strict";typeof n=="object"?n.exports=t:typeof define=="function"&&define.amd?define(function(){return t}):e.MediumEditor=t}(this,function(){"use strict";function e(e,t){return this.init(e,t)}return e.extensions={},function(t){function n(e,t){var n,r=Array.prototype.slice.call(arguments,2);t=t||{};for(var i=0;i<r.length;i++){var s=r[i];if(s)for(n in s)s.hasOwnProperty(n)&&typeof s[n]!="undefined"&&(e||t.hasOwnProperty(n)===!1)&&(t[n]=s[n])}return t}var r=!1;try{var i=document.createElement("div"),s=document.createTextNode(" ");i.appendChild(s),r=i.contains(s)}catch(o){}var u={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&(new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(e){return u.isMac&&e.metaKey||!u.isMac&&e.ctrlKey?!0:!1},isKey:function(e,t){var n=u.getKeyCode(e);return!1===Array.isArray(t)?n===t:-1===t.indexOf(n)?!1:!0},getKeyCode:function(e){var t=e.which;return null===t&&(t=e.charCode!==null?e.charCode:e.keyCode),t},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var e=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},defaults:function(){var e=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},createLink:function(e,t,n,r){var i=e.createElement("a");return u.moveTextRangeIntoElement(t[0],t[t.length-1],i),i.setAttribute("href",n),r&&i.setAttribute("target",r),i},findOrCreateMatchingTextNodes:function(e,t,n){var r=e.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1),i=[],s=0,o=!1,a=null,f=null;while((a=r.nextNode())!==null){if(a.nodeType>3)continue;if(a.nodeType===3){!o&&n.start<s+a.nodeValue.length&&(o=!0,f=u.splitStartNodeIfNeeded(a,n.start,s)),o&&u.splitEndNodeIfNeeded(a,f,n.end,s);if(o&&s===n.end)break;if(o&&s>n.end+1)throw new Error("PerformLinking overshot the target!");o&&i.push(f||a),s+=a.nodeValue.length,f!==null&&(s+=f.nodeValue.length,r.nextNode()),f=null}else a.tagName.toLowerCase()==="img"&&(!o&&n.start<=s&&(o=!0),o&&i.push(a))}return i},splitStartNodeIfNeeded:function(e,t,n){return t!==n?e.splitText(t-n):null},splitEndNodeIfNeeded:function(e,t,n,r){var i,s;i=r+(t||e).nodeValue.length+(t?e.nodeValue.length:0)-1,s=(t||e).nodeValue.length-(i+1-n),i>=n&&r!==i&&s!==0&&(t||e).splitText(s)},splitByBlockElements:function(t){if(t.nodeType!==3&&t.nodeType!==1)return[];var n=[],r=e.util.blockContainerElementNames.join(",");if(t.nodeType===3||t.querySelectorAll(r).length===0)return[t];for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(s.nodeType===3)n.push(s);else if(s.nodeType===1){var o=s.querySelectorAll(r);o.length===0?n.push(s):n=n.concat(e.util.splitByBlockElements(s))}}return n},findAdjacentTextNodeWithContent:function(e,t,n){var r=!1,i,s=n.createNodeIterator(e,NodeFilter.SHOW_TEXT,null,!1);i=s.nextNode();while(i){if(i===t)r=!0;else if(r&&i.nodeType===3&&i.nodeValue&&i.nodeValue.trim().length>0)break;i=s.nextNode()}return i},findPreviousSibling:function(e){if(!e||u.isMediumEditorElement(e))return!1;var t=e.previousSibling;while(!t&&!u.isMediumEditorElement(e.parentNode))e=e.parentNode,t=e.previousSibling;return t},isDescendant:function(e,t,n){if(!e||!t)return!1;if(e===t)return!!n;if(e.nodeType!==1)return!1;if(r||t.nodeType!==3)return e.contains(t);var i=t.parentNode;while(i!==null){if(i===e)return!0;i=i.parentNode}return!1},isElement:function(e){return!!e&&e.nodeType===1},throttle:function(e,t){var n=50,r,i,s,o=null,u=0,a=function(){u=Date.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return!t&&t!==0&&(t=n),function(){var n=Date.now(),f=t-(n-u);return r=this,i=arguments,f<=0||f>t?(o&&(clearTimeout(o),o=null),u=n,s=e.apply(r,i),o||(r=i=null)):o||(o=setTimeout(a,f)),s}},traverseUp:function(e,t){if(!e)return!1;do{if(e.nodeType===1){if(t(e))return e;if(u.isMediumEditorElement(e))return!1}e=e.parentNode}while(e);return!1},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(t,n){var r,i,s,o,a,f,l,c=!1,h=["insertHTML",!1,n];if(!e.util.isEdge&&t.queryCommandSupported("insertHTML"))try{return t.execCommand.apply(t,h)}catch(p){}r=t.getSelection();if(r.rangeCount){i=r.getRangeAt(0),l=i.commonAncestorContainer;if(u.isMediumEditorElement(l)&&!l.firstChild)i.selectNode(l.appendChild(t.createTextNode("")));else if(l.nodeType===3&&i.startOffset===0&&i.endOffset===l.nodeValue.length||l.nodeType!==3&&l.innerHTML===i.toString()){while(!u.isMediumEditorElement(l)&&l.parentNode&&l.parentNode.childNodes.length===1&&!u.isMediumEditorElement(l.parentNode))l=l.parentNode;i.selectNode(l)}i.deleteContents(),s=t.createElement("div"),s.innerHTML=n,o=t.createDocumentFragment();while(s.firstChild)a=s.firstChild,f=o.appendChild(a);i.insertNode(o),f&&(i=i.cloneRange(),i.setStartAfter(f),i.collapse(!0),e.selection.selectRange(t,i)),c=!0}return t.execCommand.callListeners&&t.execCommand.callListeners(h,c),c},execFormatBlock:function(t,n){var r=u.getTopBlockContainer(e.selection.getSelectionStart(t)),i;if(n==="blockquote"){if(r){i=Array.prototype.slice.call(r.childNodes);if(i.some(function(e){return u.isBlockContainer(e)}))return t.execCommand("outdent",!1,null)}if(u.isIE)return t.execCommand("indent",!1,n)}r&&n===r.nodeName.toLowerCase()&&(n="p"),u.isIE&&(n="<"+n+">");if(r&&r.nodeName.toLowerCase()==="blockquote"){if(u.isIE&&n==="<p>")return t.execCommand("outdent",!1,n);if((u.isFF||u.isEdge)&&n==="p")return i=Array.prototype.slice.call(r.childNodes),i.some(function(e){return!u.isBlockContainer(e)})&&t.execCommand("formatBlock",!1,n),t.execCommand("outdent",!1,n)}return t.execCommand("formatBlock",!1,n)},setTargetBlank:function(e,t){var n,r=t||!1;if(e.nodeName.toLowerCase()==="a")e.target="_blank";else{e=e.getElementsByTagName("a");for(n=0;n<e.length;n+=1)if(!1===r||r===e[n].attributes.href.value)e[n].target="_blank"}},removeTargetBlank:function(e,t){var n;if(e.nodeName.toLowerCase()==="a")e.removeAttribute("target");else{e=e.getElementsByTagName("a");for(n=0;n<e.length;n+=1)t===e[n].attributes.href.value&&e[n].removeAttribute("target")}},addClassToAnchors:function(e,t){var n=t.split(" "),r,i;if(e.nodeName.toLowerCase()==="a")for(i=0;i<n.length;i+=1)e.classList.add(n[i]);else{e=e.getElementsByTagName("a");for(r=0;r<e.length;r+=1)for(i=0;i<n.length;i+=1)e[r].classList.add(n[i])}},isListItem:function(e){if(!e)return!1;if(e.nodeName.toLowerCase()==="li")return!0;var t=e.parentNode,n=t.nodeName.toLowerCase();while(n==="li"||!u.isBlockContainer(t)&&n!=="div"){if(n==="li")return!0;t=t.parentNode;if(!t)return!1;n=t.nodeName.toLowerCase()}return!1},cleanListDOM:function(t,n){if(n.nodeName.toLowerCase()!=="li")return;var r=n.parentElement;r.parentElement.nodeName.toLowerCase()==="p"&&(u.unwrap(r.parentElement,t),e.selection.moveCursor(t,n.firstChild,n.firstChild.textContent.length))},splitOffDOMTree:function(e,t,n){var r=t,i=null,s=!n;while(r!==e){var o=r.parentNode,u=o.cloneNode(!1),a=s?r:o.firstChild,f;i&&(s?u.appendChild(i):f=i),i=u;while(a){var l=a.nextSibling;a===r?(a.hasChildNodes()?a=a.cloneNode(!1):a.parentNode.removeChild(a),a.textContent&&i.appendChild(a),a=s?l:null):(a.parentNode.removeChild(a),(a.hasChildNodes()||a.textContent)&&i.appendChild(a),a=l)}f&&i.appendChild(f),r=o}return i},moveTextRangeIntoElement:function(e,t,n){if(!e||!t)return!1;var r=u.findCommonRoot(e,t);if(!r)return!1;if(t===e){var i=e.parentNode,s=e.nextSibling;return i.removeChild(e),n.appendChild(e),s?i.insertBefore(n,s):i.appendChild(n),n.hasChildNodes()}var o=[],a,f,l;for(var c=0;c<r.childNodes.length;c++){l=r.childNodes[c];if(!a)u.isDescendant(l,e,!0)&&(a=l);else{if(u.isDescendant(l,t,!0)){f=l;break}o.push(l)}}var h=f.nextSibling,p=r.ownerDocument.createDocumentFragment();return a===e?(a.parentNode.removeChild(a),p.appendChild(a)):p.appendChild(u.splitOffDOMTree(a,e)),o.forEach(function(e){e.parentNode.removeChild(e),p.appendChild(e)}),f===t?(f.parentNode.removeChild(f),p.appendChild(f)):p.appendChild(u.splitOffDOMTree(f,t,!0)),n.appendChild(p),f.parentNode===r?r.insertBefore(n,f):h?r.insertBefore(n,h):r.appendChild(n),n.hasChildNodes()},depthOfNode:function(e){var t=0,n=e;while(n.parentNode!==null)n=n.parentNode,t++;return t},findCommonRoot:function(e,t){var n=u.depthOfNode(e),r=u.depthOfNode(t),i=e,s=t;while(n!==r)n>r?(i=i.parentNode,n-=1):(s=s.parentNode,r-=1);while(i!==s)i=i.parentNode,s=s.parentNode;return i},isElementAtBeginningOfBlock:function(e){var t,n;while(!u.isBlockContainer(e)&&!u.isMediumEditorElement(e)){n=e;while(n=n.previousSibling){t=n.nodeType===3?n.nodeValue:n.textContent;if(t.length>0)return!1}e=e.parentNode}return!0},isMediumEditorElement:function(e){return e&&e.getAttribute&&!!e.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(e){return u.traverseUp(e,function(e){return u.isMediumEditorElement(e)})},isBlockContainer:function(e){return e&&e.nodeType!==3&&u.blockContainerElementNames.indexOf(e.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(e){return u.traverseUp(e,function(e){return u.isBlockContainer(e)||u.isMediumEditorElement(e)})},getTopBlockContainer:function(e){var t=u.isBlockContainer(e)?e:!1;return u.traverseUp(e,function(e){return u.isBlockContainer(e)&&(t=e),!t&&u.isMediumEditorElement(e)?(t=e,!0):!1}),t},getFirstSelectableLeafNode:function(e){while(e&&e.firstChild)e=e.firstChild;e=u.traverseUp(e,function(e){return u.emptyElementNames.indexOf(e.nodeName.toLowerCase())===-1});if(e.nodeName.toLowerCase()==="table"){var t=e.querySelector("th, td");t&&(e=t)}return e},getFirstTextNode:function(e){return u.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),u._getFirstTextNode(e)},_getFirstTextNode:function(e){if(e.nodeType===3)return e;for(var t=0;t<e.childNodes.length;t++){var n=u._getFirstTextNode(e.childNodes[t]);if(n!==null)return n}return null},ensureUrlHasProtocol:function(e){return e.indexOf("://")===-1?"http://"+e:e},warn:function(){t.console!==undefined&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(e,t,n){var r=e+" is deprecated, please use "+t+" instead.";n&&(r+=" Will be removed in "+n),u.warn(r)},deprecatedMethod:function(e,t,n,r){u.deprecated(e,t,r),typeof this[t]=="function"&&this[t].apply(this,n)},cleanupAttrs:function(e,t){t.forEach(function(t){e.removeAttribute(t)})},cleanupTags:function(e,t){t.forEach(function(t){e.nodeName.toLowerCase()===t&&e.parentNode.removeChild(e)})},getClosestTag:function(e,t){return u.traverseUp(e,function(e){return e.nodeName.toLowerCase()===t.toLowerCase()})},unwrap:function(e,t){var n=t.createDocumentFragment(),r=Array.prototype.slice.call(e.childNodes);for(var i=0;i<r.length;i++)n.appendChild(r[i]);n.childNodes.length?e.parentNode.replaceChild(n,e):e.parentNode.removeChild(e)},guid:function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};e.util=u}(window),function(){var t=function(t){e.util.extend(this,t)};t.extend=function(t){var n=this,r;t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){return n.apply(this,arguments)},e.util.extend(r,n);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,t&&e.util.extend(r.prototype,t),r},t.prototype={init:function(){},base:undefined,name:undefined,checkState:undefined,destroy:undefined,queryCommandState:undefined,isActive:undefined,isAlreadyApplied:undefined,setActive:undefined,setInactive:undefined,window:undefined,document:undefined,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(e){return this.base.options[e]}},["execAction","on","off","subscribe","trigger"].forEach(function(e){t.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(t){return e.util.isBlockContainer(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(t,n){var r=n.getSelection(),i,s;return r.rangeCount===0?!1:(i=r.getRangeAt(0),s=i.commonAncestorContainer,e.util.traverseUp(s,t))},getSelectionElement:function(t){return this.findMatchingSelectionParent(function(t){return e.util.isMediumEditorElement(t)},t)},exportSelection:function(e,t){if(!e)return null;var n=null,r=t.getSelection();if(r.rangeCount>0){var i=r.getRangeAt(0),s=i.cloneRange(),o;s.selectNodeContents(e),s.setEnd(i.startContainer,i.startOffset),o=s.toString().length,n={start:o,end:o+i.toString().length},this.doesRangeStartWithImages(i,t)&&(n.startsWithImage=!0);var u=this.getTrailingImageCount(e,n,i.endContainer,i.endOffset);u&&(n.trailingImageCount=u);if(o!==0){var a=this.getIndexRelativeToAdjacentEmptyBlocks(t,e,i.startContainer,i.startOffset);a!==-1&&(n.emptyBlocksIndex=a)}}return n},importSelection:function(e,t,n,r){if(!e||!t)return;var i=n.createRange();i.setStart(t,0),i.collapse(!0);var s=t,o=[],u=0,a=!1,f=!1,l=0,c=!1,h,p=!1,d=null;if(r||e.startsWithImage||typeof e.emptyBlocksIndex!="undefined")p=!0;while(!c&&s){if(s.nodeType>3){s=o.pop();continue}if(s.nodeType===3&&!f)h=u+s.length,!a&&e.start>=u&&e.start<=h&&(p||e.start<h?(i.setStart(s,e.start-u),a=!0):d=s),a&&e.end>=u&&e.end<=h&&(e.trailingImageCount?f=!0:(i.setEnd(s,e.end-u),c=!0)),u=h;else{if(e.trailingImageCount&&f){s.nodeName.toLowerCase()==="img"&&l++;if(l===e.trailingImageCount){var v=0;while(s.parentNode.childNodes[v]!==s)v++;i.setEnd(s.parentNode,v+1),c=!0}}if(!c&&s.nodeType===1){var m=s.childNodes.length-1;while(m>=0)o.push(s.childNodes[m]),m-=1}}c||(s=o.pop())}!a&&d&&(i.setStart(d,d.length),i.setEnd(d,d.length)),typeof e.emptyBlocksIndex!="undefined"&&(i=this.importSelectionMoveCursorPastBlocks(n,t,e.emptyBlocksIndex,i)),r&&(i=this.importSelectionMoveCursorPastAnchor(e,i)),this.selectRange(n,i)},importSelectionMoveCursorPastAnchor:function(t,n){var r=function(e){return e.nodeName.toLowerCase()==="a"};if(t.start===t.end&&n.startContainer.nodeType===3&&n.startOffset===n.startContainer.nodeValue.length&&e.util.traverseUp(n.startContainer,r)){var i=n.startContainer,s=n.startContainer.parentNode;while(s!==null&&s.nodeName.toLowerCase()!=="a")s.childNodes[s.childNodes.length-1]!==i?s=null:(i=s,s=s.parentNode);if(s!==null&&s.nodeName.toLowerCase()==="a"){var o=null;for(var u=0;o===null&&u<s.parentNode.childNodes.length;u++)s.parentNode.childNodes[u]===s&&(o=u);n.setStart(s.parentNode,o+1),n.collapse(!0)}}return n},importSelectionMoveCursorPastBlocks:function(n,r,i,s){var o=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),u=s.startContainer,a,f,l=0;i=i||1,u.nodeType===3&&e.util.isBlockContainer(u.previousSibling)?a=u.previousSibling:a=e.util.getClosestBlockContainer(u);while(o.nextNode())if(!f)a===o.currentNode&&(f=o.currentNode);else{f=o.currentNode,l++;if(l===i)break;if(f.textContent.length>0)break}return f||(f=a),s.setStart(e.util.getFirstSelectableLeafNode(f),0),s},getIndexRelativeToAdjacentEmptyBlocks:function(n,r,i,s){if(i.textContent.length>0&&s>0)return-1;var o=i;o.nodeType!==3&&(o=i.childNodes[s]);if(o){if(!e.util.isElementAtBeginningOfBlock(o))return-1;var u=e.util.findPreviousSibling(o);if(!u)return-1;if(u.nodeValue)return-1}var a=e.util.getClosestBlockContainer(i),f=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),l=0;while(f.nextNode()){var c=f.currentNode.textContent==="";if(c||l>0)l+=1;if(f.currentNode===a)return l;c||(l=0)}return l},doesRangeStartWithImages:function(e,t){if(e.startOffset!==0||e.startContainer.nodeType!==1)return!1;if(e.startContainer.nodeName.toLowerCase()==="img")return!0;var n=e.startContainer.querySelector("img");if(!n)return!1;var r=t.createTreeWalker(e.startContainer,NodeFilter.SHOW_ALL,null,!1);while(r.nextNode()){var i=r.currentNode;if(i===n)break;if(i.nodeValue)return!1}return!0},getTrailingImageCount:function(e,t,n,r){if(r===0||n.nodeType!==1)return 0;if(n.nodeName.toLowerCase()!=="img"&&!n.querySelector("img"))return 0;var i=n.childNodes[r-1];while(i.hasChildNodes())i=i.lastChild;var s=e,o=[],u=0,a=!1,f=!1,l=!1,c,h=0;while(!l&&s){if(s.nodeType>3){s=o.pop();continue}if(s.nodeType===3&&!f)h=0,c=u+s.length,!a&&t.start>=u&&t.start<=c&&(a=!0),a&&t.end>=u&&t.end<=c&&(f=!0),u=c;else{s.nodeName.toLowerCase()==="img"&&h++;if(s===i)l=!0;else if(s.nodeType===1){var p=s.childNodes.length-1;while(p>=0)o.push(s.childNodes[p]),p-=1}}l||(s=o.pop())}return h},selectionContainsContent:function(e){var t=e.getSelection();if(!t||t.isCollapsed||!t.rangeCount)return!1;if(t.toString().trim()!=="")return!0;var n=this.getSelectedParentElement(t.getRangeAt(0));if(n)if(n.nodeName.toLowerCase()==="img"||n.nodeType===1&&n.querySelector("img"))return!0;return!1},selectionInContentEditableFalse:function(e){var t,n=this.findMatchingSelectionParent(function(e){var n=e&&e.getAttribute("contenteditable");return n==="true"&&(t=!0),e.nodeName!=="#text"&&n==="false"},e);return!t&&n},getSelectionHtml:function(e){var t,n="",r=e.getSelection(),i,s;if(r.rangeCount){s=e.createElement("div");for(t=0,i=r.rangeCount;t<i;t+=1)s.appendChild(r.getRangeAt(t).cloneContents());n=s.innerHTML}return n},getCaretOffsets:function(e,t){var n,r;return t||(t=window.getSelection().getRangeAt(0)),n=t.cloneRange(),r=t.cloneRange(),n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset),r.selectNodeContents(e),r.setStart(t.endContainer,t.endOffset),{left:n.toString().length,right:r.toString().length}},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(e){return e?this.rangeSelectsSingleNode(e)&&e.startContainer.childNodes[e.startOffset].nodeType!==3?e.startContainer.childNodes[e.startOffset]:e.startContainer.nodeType===3?e.startContainer.parentNode:e.startContainer:null},getSelectedElements:function(e){var t=e.getSelection(),n,r,i;if(!t.rangeCount||t.isCollapsed||!t.getRangeAt(0).commonAncestorContainer)return[];n=t.getRangeAt(0);if(n.commonAncestorContainer.nodeType===3){r=[],i=n.commonAncestorContainer;while(i.parentNode&&i.parentNode.childNodes.length===1)r.push(i.parentNode),i=i.parentNode;return r}return[].filter.call(n.commonAncestorContainer.getElementsByTagName("*"),function(e){return typeof t.containsNode=="function"?t.containsNode(e,!0):!0})},selectNode:function(e,t){var n=t.createRange();n.selectNodeContents(e),this.selectRange(t,n)},select:function(e,t,n,r,i){var s=e.createRange();return s.setStart(t,n),r?s.setEnd(r,i):s.collapse(!0),this.selectRange(e,s),s},clearSelection:function(e,t){t?e.getSelection().collapseToStart():e.getSelection().collapseToEnd()},moveCursor:function(e,t,n){this.select(e,t,n)},getSelectionRange:function(e){var t=e.getSelection();return t.rangeCount===0?null:t.getRangeAt(0)},selectRange:function(e,t){var n=e.getSelection();n.removeAllRanges(),n.addRange(t)},getSelectionStart:function(e){var t=e.getSelection().anchorNode,n=t&&t.nodeType===3?t.parentNode:t;return n}};e.selection=n}(),function(){var t=function(e){this.base=e,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};t.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(t,n,r,i){t=e.util.isElement(t)||[window,document].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){e.addEventListener(n,r,i),this.events.push([e,n,r,i])}.bind(this))},detachDOMEvent:function(t,n,r,i){var s,o;t=e.util.isElement(t)||[window,document].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){s=this.indexOfListener(e,n,r,i),s!==-1&&(o=this.events.splice(s,1)[0],o[0].removeEventListener(o[1],o[2],o[3]))}.bind(this))},indexOfListener:function(e,t,n,r){var i,s,o;for(i=0,s=this.events.length;i<s;i+=1){o=this.events[i];if(o[0]===e&&o[1]===t&&o[2]===n&&o[3]===r)return i}return-1},detachAllDOMEvents:function(){var e=this.events.pop();while(e)e[0].removeEventListener(e[1],e[2],e[3]),e=this.events.pop()},detachAllEventsFromElement:function(e){var t=this.events.filter(function(t){return t&&t[0].getAttribute&&t[0].getAttribute("medium-editor-index")===e.getAttribute("medium-editor-index")});for(var n=0,r=t.length;n<r;n++){var i=t[n];this.detachDOMEvent(i[0],i[1],i[2],i[3])}},attachAllEventsToElement:function(e){this.listeners.editableInput&&(this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(t){this.attachDOMEvent(e,t.name,t.handler.bind(this))},this)},enableCustomEvent:function(e){this.disabledEvents[e]!==undefined&&delete this.disabledEvents[e]},disableCustomEvent:function(e){this.disabledEvents[e]=!0},attachCustomEvent:function(e,t){this.setupListener(e),this.customEvents[e]||(this.customEvents[e]=[]),this.customEvents[e].push(t)},detachCustomEvent:function(e,t){var n=this.indexOfCustomListener(e,t);n!==-1&&this.customEvents[e].splice(n,1)},indexOfCustomListener:function(e,t){return!this.customEvents[e]||!this.customEvents[e].length?-1:this.customEvents[e].indexOf(t)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(e,t,n){this.customEvents[e]&&!this.disabledEvents[e]&&this.customEvents[e].forEach(function(e){e(t,n)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(e){e.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){if(this.execCommandListener)return;this.execCommandListener=function(e){this.handleDocumentExecCommand(e)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener)},detachExecCommand:function(){var e=this.options.ownerDocument;if(!this.execCommandListener||!e.execCommand.listeners)return;var t=e.execCommand.listeners.indexOf(this.execCommandListener);t!==-1&&e.execCommand.listeners.splice(t,1),e.execCommand.listeners.length||this.unwrapExecCommand()},wrapExecCommand:function(){var e=this.options.ownerDocument;if(e.execCommand.listeners)return;var t=function(t,n){e.execCommand.listeners&&e.execCommand.listeners.forEach(function(e){e({command:t[0],value:t[2],args:t,result:n})})},n=function(){var n=e.execCommand.orig.apply(this,arguments);if(!e.execCommand.listeners)return n;var r=Array.prototype.slice.call(arguments);return t(r,n),n};n.orig=e.execCommand,n.listeners=[],n.callListeners=t,e.execCommand=n},unwrapExecCommand:function(){var e=this.options.ownerDocument;if(!e.execCommand.orig)return;e.execCommand=e.execCommand.orig},setupListener:function(e){if(this.listeners[e])return;switch(e){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(e){this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[e]=!0},attachToEachElement:function(e,t){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(n){this.attachDOMEvent(n,e,t.bind(this))},this),this.eventsCache.push({name:e,handler:t})},cleanupElement:function(e){var t=e.getAttribute("medium-editor-index");t&&(this.detachAllEventsFromElement(e),delete this.contentCache[t])},focusElement:function(e){e.focus(),this.updateFocus(e,{target:e,type:"focus"})},updateFocus:function(t,n){var r=this.base.getExtensionByName("toolbar"),i=r?r.getToolbarElement():null,s=this.base.getExtensionByName("anchor-preview"),o=s&&s.getPreviewElement?s.getPreviewElement():null,u=this.base.getFocusedElement(),a;u&&n.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(u,this.lastMousedownTarget,!0)||e.util.isDescendant(i,this.lastMousedownTarget,!0)||e.util.isDescendant(o,this.lastMousedownTarget,!0))&&(a=u),a||this.base.elements.some(function(n){return!a&&e.util.isDescendant(n,t,!0)&&(a=n),!!a},this);var f=!e.util.isDescendant(u,t,!0)&&!e.util.isDescendant(i,t,!0)&&!e.util.isDescendant(o,t,!0);a!==u&&(u&&f&&(u.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",n,u)),a&&(a.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",n,a))),f&&this.triggerCustomEvent("externalInteraction",n)},updateInput:function(e,t){if(!this.contentCache)return;var n=e.getAttribute("medium-editor-index"),r=e.innerHTML;r!==this.contentCache[n]&&this.triggerCustomEvent("editableInput",t,e),this.contentCache[n]=r},handleDocumentSelectionChange:function(t){if(t.currentTarget&&t.currentTarget.activeElement){var n=t.currentTarget.activeElement,r;this.base.elements.some(function(t){return e.util.isDescendant(t,n,!0)?(r=t,!0):!1},this),r&&this.updateInput(r,{target:n,currentTarget:r})}},handleDocumentExecCommand:function(){var e=this.base.getFocusedElement();e&&this.updateInput(e,{target:e,currentTarget:e})},handleBodyClick:function(e){this.updateFocus(e.target,e)},handleBodyFocus:function(e){this.updateFocus(e.target,e)},handleBodyMousedown:function(e){this.lastMousedownTarget=e.target},handleInput:function(e){this.updateInput(e.currentTarget,e)},handleClick:function(e){this.triggerCustomEvent("editableClick",e,e.currentTarget)},handleBlur:function(e){this.triggerCustomEvent("editableBlur",e,e.currentTarget)},handleKeypress:function(e){this.triggerCustomEvent("editableKeypress",e,e.currentTarget);if(this.keypressUpdateInput){var t={target:e.target,currentTarget:e.currentTarget};setTimeout(function(){this.updateInput(t.currentTarget,t)}.bind(this),0)}},handleKeyup:function(e){this.triggerCustomEvent("editableKeyup",e,e.currentTarget)},handleMouseover:function(e){this.triggerCustomEvent("editableMouseover",e,e.currentTarget)},handleDragging:function(e){this.triggerCustomEvent("editableDrag",e,e.currentTarget)},handleDrop:function(e){this.triggerCustomEvent("editableDrop",e,e.currentTarget)},handlePaste:function(e){this.triggerCustomEvent("editablePaste",e,e.currentTarget)},handleKeydown:function(t){this.triggerCustomEvent("editableKeydown",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.ENTER)||t.ctrlKey&&e.util.isKey(t,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",t,t.currentTarget);if(e.util.isKey(t,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",t,t.currentTarget)}},e.Events=t}(),function(){var t=e.Extension.extend({action:undefined,aria:undefined,tagNames:undefined,style:undefined,useQueryState:undefined,contentDefault:undefined,contentFA:undefined,classList:undefined,attrs:undefined,constructor:function(n){t.isBuiltInButton(n)?e.Extension.call(this,this.defaults[n]):e.Extension.call(this,n)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var e=this.document.createElement("button"),t=this.contentDefault,n=this.getAria(),r=this.getEditorOption("buttonLabels");return e.classList.add("medium-editor-action"),e.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(t){e.classList.add(t)}),e.setAttribute("data-action",this.getAction()),n&&(e.setAttribute("title",n),e.setAttribute("aria-label",n)),this.attrs&&Object.keys(this.attrs).forEach(function(t){e.setAttribute(t,this.attrs[t])},this),r==="fontawesome"&&this.contentFA&&(t=this.contentFA),e.innerHTML=t,e},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.getAction();t&&this.execAction(t)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var e=null;return this.useQueryState&&(e=this.base.queryCommandState(this.getAction())),e},isAlreadyApplied:function(e){var t=!1,n=this.getTagNames(),r,i;return this.knownState===!1||this.knownState===!0?this.knownState:(n&&n.length>0&&(t=n.indexOf(e.nodeName.toLowerCase())!==-1),!t&&this.style&&(r=this.style.value.split("|"),i=this.window.getComputedStyle(e,null).getPropertyValue(this.style.prop),r.forEach(function(e){if(!this.knownState){t=i.indexOf(e)!==-1;if(t||this.style.prop!=="text-decoration")this.knownState=t}},this)),t)}});t.isBuiltInButton=function(t){return typeof t=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(t)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.hideToolbarDefaultActions()},setToolbarPosition:function(){var e=this.base.getExtensionByName("toolbar");e&&e.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(t){t.preventDefault(),t.stopPropagation();var n=e.selection.getSelectionRange(this.document);return n.startContainer.nodeName.toLowerCase()==="a"||n.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(n),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(t){e.util.isKey(t,e.util.keyCode.K)&&e.util.isMetaCtrlKey(t)&&!t.shiftKey&&this.handleClick(t)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var e=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return e.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),e.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target">',"<label>",this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),e.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(t){var n=this.getInput(),r=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox();t=t||{url:""},typeof t=="string"&&(t={url:t}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),n.value=t.url,n.focus(),r&&(r.checked=t.target==="_blank");if(i){var s=t.buttonClass?t.buttonClass.split(" "):[];i.checked=s.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var e=this.getAnchorTargetCheckbox(),t=this.getAnchorButtonCheckbox(),n={url:this.getInput().value.trim()};return this.linkValidation&&(n.url=this.checkLinkFormat(n.url)),n.target="_self",e&&e.checked&&(n.target="_blank"),t&&t.checked&&(n.buttonClass=this.customClassOption),n},doFormSave:function(){var e=this.getFormOpts();this.completeFormSave(e)},completeFormSave:function(e){this.base.restoreSelection(),this.execAction(this.action,e),this.base.checkSelection()},checkLinkFormat:function(e){var t=/^([a-z]+:)?\/\/|^(mailto|tel|maps):/i,n=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/;return n.test(e)?"tel:"+e:(t.test(e)?"":"http://")+encodeURI(e)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(e){var t=e.querySelector(".medium-editor-toolbar-close"),n=e.querySelector(".medium-editor-toolbar-save"),r=e.querySelector(".medium-editor-toolbar-input");this.on(e,"click",this.handleFormClick.bind(this)),this.on(r,"keyup",this.handleTextboxKeyup.bind(this)),this.on(t,"click",this.handleCloseClick.bind(this)),this.on(n,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var e=this.document,t=e.createElement("div");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),t.innerHTML=this.getTemplate(),this.attachFormEvents(t),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(t){if(t.keyCode===e.util.keyCode.ENTER){t.preventDefault(),this.doFormSave();return}t.keyCode===e.util.keyCode.ESCAPE&&(t.preventDefault(),this.doFormCancel())},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var e=this.document.createElement("div");return e.id="medium-editor-anchor-preview-"+this.getEditorId(),e.className="medium-editor-anchor-preview",e.innerHTML=this.getTemplate(),this.on(e,"click",this.handleClick.bind(this)),e},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(e){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||e.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=e.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=e.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=e,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(e){e=e||this.activeAnchor;var t=this.anchorPreview.offsetHeight,n=e.getBoundingClientRect(),r=(n.left+n.right)/2,i=this.diffLeft,s=this.diffTop,o,u;o=this.anchorPreview.offsetWidth/2;var a=this.base.getExtensionByName("toolbar");a&&(i=a.diffLeft,s=a.diffTop),u=i-o,this.anchorPreview.style.top=Math.round(t+n.bottom-s+this.window.pageYOffset-this.anchorPreview.offsetHeight)+"px",this.anchorPreview.style.right="initial",r<o?(this.anchorPreview.style.left=u+o+"px",this.anchorPreview.style.right="initial"):this.window.innerWidth-r<o?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=u+r+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(e){var t=this.base.getExtensionByName("anchor"),n=this.activeAnchor;t&&n&&(e.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(n){var e={url:n.attributes.href.value,target:n.getAttribute("target"),buttonClass:n.getAttribute("class")};t.showForm(e),n=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(t){var n=e.util.getClosestTag(t.target,"a");if(!1===n)return;if(!/href=["']\S+["']/.test(n.outerHTML)||/href=["']#\S+["']/.test(n.outerHTML))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==n&&this.detachPreviewHandlers(),this.anchorToPreview=n,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(e){if(!e.relatedTarget||!/anchor-preview/.test(e.relatedTarget.className))this.hovering=!1},updatePreview:function(){if(this.hovering)return!0;var e=(new Date).getTime()-this.lastOver;e>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){function t(t){return!e.util.getClosestTag(t,"a")}var n,r,i,s;n=[" ","	","\n","\r"," "," "," "," "," ","\u2028","\u2029"],r="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+r+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’]))"+")|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+r+"))",s=new RegExp("^("+r+")$","i");var o=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){var e=0;for(var t=0;t<this.window._mediumEditors.length;t++){var n=this.window._mediumEditors[t];n!==null&&n.getExtensionByName("autoLink")!==undefined&&e++}return e===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(e,t){this.performLinking(t)},onKeypress:function(t){if(this.disableEventHandling)return;e.util.isKey(t,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var e=this.base.exportSelection();this.performLinking(t.target)&&this.base.importSelection(e,!0)}catch(n){window.console&&window.console.error("Failed to perform linking",n),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(t){var n=e.util.splitByBlockElements(t),r=!1;n.length===0&&(n=[t]);for(var i=0;i<n.length;i++)r=this.removeObsoleteAutoLinkSpans(n[i])||r,r=this.performLinkingWithinElement(n[i])||r;return this.base.events.updateInput(t,{target:t,currentTarget:t}),r},removeObsoleteAutoLinkSpans:function(n){if(!n||n.nodeType===3)return!1;var r=n.querySelectorAll('span[data-auto-link="true"]'),i=!1;for(var s=0;s<r.length;s++){var o=r[s].textContent;o.indexOf("://")===-1&&(o=e.util.ensureUrlHasProtocol(o));if(r[s].getAttribute("data-href")!==o&&t(r[s])){i=!0;var u=o.replace(/\s+$/,"");if(r[s].getAttribute("data-href")===u){var a=o.length-u.length,f=e.util.splitOffDOMTree(r[s],this.splitTextBeforeEnd(r[s],a));r[s].parentNode.insertBefore(f,r[s].nextSibling)}else e.util.unwrap(r[s],this.document)}}return i},splitTextBeforeEnd:function(e,t){var n=this.document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),r=!0;while(r)r=n.lastChild()!==null;var i,s,o;while(t>0&&o!==null)i=n.currentNode,s=i.nodeValue,s.length>t?(o=i.splitText(s.length-t),t=0):(o=n.previousNode(),t-=s.length);return o},performLinkingWithinElement:function(t){var n=this.findLinkableText(t),r=!1;for(var i=0;i<n.length;i++){var s=e.util.findOrCreateMatchingTextNodes(this.document,t,n[i]);if(this.shouldNotLink(s))continue;this.createAutoLink(s,n[i].href)}return r},shouldNotLink:function(t){var n=!1;for(var r=0;r<t.length&&n===!1;r++)n=!!e.util.traverseUp(t[r],function(e){return e.nodeName.toLowerCase()==="a"||e.getAttribute&&e.getAttribute("data-auto-link")==="true"});return n},findLinkableText:function(e){var t=new RegExp(i,"gi"),r=e.textContent,o=null,u=[];while((o=t.exec(r))!==null){var a=!0,f=o.index+o[0].length;a=(o.index===0||n.indexOf(r[o.index-1])!==-1)&&(f===r.length||n.indexOf(r[f])!==-1),a=a&&(o[0].indexOf("/")!==-1||s.test(o[0].split(".").pop().split("?").shift())),a&&u.push({href:o[0],start:o.index,end:f})}return u},createAutoLink:function(t,n){n=e.util.ensureUrlHasProtocol(n);var r=e.util.createLink(this.document,t,n,this.getEditorOption("targetBlank")?"_blank":null),i=this.document.createElement("span");i.setAttribute("data-auto-link","true"),i.setAttribute("data-href",n),r.insertBefore(i,r.firstChild);while(r.childNodes.length>1)i.appendChild(r.childNodes[1])}});e.extensions.autoLink=o}(),function(){function t(t){var r=e.util.getContainerEditorElement(t),i=Array.prototype.slice.call(r.parentElement.querySelectorAll("."+n));i.forEach(function(e){e.classList.remove(n)})}var n="medium-editor-dragover",r=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy";var r=e.target.classList?e.target:e.target.parentElement;t(r),e.type==="dragover"&&r.classList.add(n)},handleDrop:function(e){e.preventDefault(),e.stopPropagation(),this.base.selectElement(e.target);var n=this.base.exportSelection();n.start=n.end,this.base.importSelection(n),e.dataTransfer.files&&Array.prototype.slice.call(e.dataTransfer.files).forEach(function(e){this.isAllowedFile(e)&&e.type.match("image")&&this.insertImageFile(e)},this),t(e.target)},isAllowedFile:function(e){return this.allowedTypes.some(function(t){return!!e.type.match(t)})},insertImageFile:function(t){if(typeof FileReader!="function")return;var n=new FileReader;n.readAsDataURL(t),n.addEventListener("load",function(t){var n=this.document.createElement("img");n.src=t.target.result,e.util.insertHTMLCommand(this.document,n.outerHTML)}.bind(this))}});e.extensions.fileDragging=r}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(e){var t=e.key.charCodeAt(0);this.keys[t]||(this.keys[t]=[]),this.keys[t].push(e)},this)},handleKeydown:function(t){var n=e.util.getKeyCode(t);if(!this.keys[n])return;var r=e.util.isMetaCtrlKey(t),i=!!t.shiftKey,s=!!t.altKey;this.keys[n].forEach(function(e){e.meta===r&&e.shift===i&&(e.alt===s||undefined===e.alt)&&(t.preventDefault(),t.stopPropagation(),typeof e.command=="function"?e.command.apply(this):!1!==e.command&&this.execAction(e.command))},this)}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){e.preventDefault(),e.stopPropagation();if(!this.isDisplayed()){var t=this.document.queryCommandValue("fontName")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(e){var t=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("select"),r=e.createElement("a"),i=e.createElement("a"),s;t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this));for(var o=0;o<this.fonts.length;o++)s=e.createElement("option"),s.innerHTML=this.fonts[o],s.value=this.fonts[o],n.appendChild(s);return n.className="medium-editor-toolbar-select",t.appendChild(n),this.on(n,"change",this.handleFontChange.bind(this)),i.setAttribute("href","#"),i.className="medium-editor-toobar-save",i.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(i),this.on(i,"click",this.handleSaveClick.bind(this),!0),r.setAttribute("href","#"),r.className="medium-editor-toobar-close",r.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",t.appendChild(r),this.on(r,"click",this.handleCloseClick.bind(this)),t},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(e){e.nodeName.toLowerCase()==="font"&&e.hasAttribute("face")&&e.removeAttribute("face")})},handleFontChange:function(){var e=this.getSelect().value;e===""?this.clearFontName():this.execAction("fontName",{name:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){e.preventDefault(),e.stopPropagation();if(!this.isDisplayed()){var t=this.document.queryCommandValue("fontSize")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(e){var t=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("input"),r=e.createElement("a"),i=e.createElement("a");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this)),n.setAttribute("type","range"),n.setAttribute("min","1"),n.setAttribute("max","7"),n.className="medium-editor-toolbar-input",t.appendChild(n),this.on(n,"change",this.handleSliderChange.bind(this)),i.setAttribute("href","#"),i.className="medium-editor-toobar-save",i.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(i),this.on(i,"click",this.handleSaveClick.bind(this),!0),r.setAttribute("href","#"),r.className="medium-editor-toobar-close",r.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",t.appendChild(r),this.on(r,"click",this.handleCloseClick.bind(this)),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(e){e.nodeName.toLowerCase()==="font"&&e.hasAttribute("size")&&e.removeAttribute("size")})},handleSliderChange:function(){var e=this.getInput().value;e==="4"?this.clearFontSize():this.execAction("fontSize",{size:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){function t(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function n(e,t,n){var r=e.clipboardData||t.clipboardData||n.dataTransfer,i={};if(!r)return i;if(r.getData){var s=r.getData("Text");s&&s.length>0&&(i["text/plain"]=s)}if(r.types)for(var o=0;o<r.types.length;o++){var u=r.types[o];i[u]=r.getData(u)}return i}var r="%ME_PASTEBIN%",i=null,s=null,o=function(e){e.stopPropagation()},u=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],init:function(){e.Extension.prototype.init.apply(this,arguments);if(this.forcePlainText||this.cleanPastedHTML)this.subscribe("editablePaste",this.handlePaste.bind(this)),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(e,t){if(e.defaultPrevented)return;var r=n(e,this.window,this.document),i=r["text/html"],s=r["text/plain"];this.window.clipboardData&&e.clipboardData===undefined&&!i&&(i=s);if(i||s)e.preventDefault(),this.doPaste(i,s,t)},doPaste:function(t,n,r){var i,s="",o;if(this.cleanPastedHTML&&t)return this.cleanPaste(t);if(!(this.getEditorOption("disableReturn")||r&&r.getAttribute("data-disable-return"))){i=n.split(/[\r\n]+/g);if(i.length>1)for(o=0;o<i.length;o+=1)i[o]!==""&&(s+="<p>"+e.util.htmlEntities(i[o])+"</p>");else s=e.util.htmlEntities(i[0])}else s=e.util.htmlEntities(n);e.util.insertHTMLCommand(this.document,s)},handlePasteBinPaste:function(e){if(e.defaultPrevented){this.removePasteBin();return}var t=n(e,this.window,this.document),r=t["text/html"],i=t["text/plain"],o=s;if(!this.cleanPastedHTML||r){e.preventDefault(),this.removePasteBin(),this.doPaste(r,i,o);return}setTimeout(function(){this.cleanPastedHTML&&(r=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(r,i,o)}.bind(this),0)},handleKeydown:function(t,n){if(!e.util.isKey(t,e.util.keyCode.V)||!e.util.isMetaCtrlKey(t))return;t.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(n)},createPasteBin:function(t){var n,u=e.selection.getSelectionRange(this.document),a=this.window.pageYOffset;s=t,u&&(n=u.getClientRects(),n.length?a+=n[0].top:a+=u.startContainer.getBoundingClientRect().top),i=u;var f=this.document.createElement("div");f.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),f.setAttribute("style","border: 1px red solid; position: absolute; top: "+a+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),f.setAttribute("contentEditable",!0),f.innerHTML=r,this.document.body.appendChild(f),this.on(f,"focus",o),this.on(f,"focusin",o),this.on(f,"focusout",o),f.focus(),e.selection.selectNode(f,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(f,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==i&&(e.selection.selectRange(this.document,i),i=null),null!==s&&(s=null);var t=this.getPasteBin();if(!t)return;t&&(this.off(t,"focus",o),this.off(t,"focusin",o),this.off(t,"focusout",o),this.off(t,"paste",this.boundHandlePaste),t.parentElement.removeChild(t))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var e=this.getPasteBin();if(!e)return!1;if(e.firstChild&&e.firstChild.id==="mcepastebin")return!1;var t=e.innerHTML;return!t||t===r?!1:t},cleanPaste:function(e){var n,r,i,s,o=/<p|<br|<div/.test(e),u=[].concat(this.preCleanReplacements||[],t(),this.cleanReplacements||[]);for(n=0;n<u.length;n+=1)e=e.replace(u[n][0],u[n][1]);if(!o)return this.pasteHTML(e);i=this.document.createElement("div"),i.innerHTML="<p>"+e.split("<br><br>").join("</p><p>")+"</p>",r=i.querySelectorAll("a,p,div,br");for(n=0;n<r.length;n+=1){s=r[n],s.innerHTML=s.innerHTML.replace(/\n/gi," ");switch(s.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(s);break;case"br":this.filterLineBreak(s)}}this.pasteHTML(i.innerHTML)},pasteHTML:function(t,n){n=e.util.defaults({},n,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags});var r,i,s,o,u=this.document.createDocumentFragment();u.appendChild(this.document.createElement("body")),o=u.querySelector("body"),o.innerHTML=t,this.cleanupSpans(o),r=o.querySelectorAll("*");for(s=0;s<r.length;s+=1)i=r[s],"a"===i.nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(i),e.util.cleanupAttrs(i,n.cleanAttrs),e.util.cleanupTags(i,n.cleanTags);e.util.insertHTMLCommand(this.document,o.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&(e.nodeName.toLowerCase()==="p"||e.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(e){/^\s*$/.test(e.textContent)&&e.parentNode&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?this.removeWithParent(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?e.parentNode&&e.parentNode.childElementCount===1&&e.parentNode.textContent===""&&this.removeWithParent(e):this.removeWithParent(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&e.parentNode.childElementCount===1?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e))},cleanupSpans:function(t){var n,r,i,s=t.querySelectorAll(".replace-with"),o=function(e){return e&&e.nodeName!=="#text"&&e.getAttribute("contenteditable")==="false"};for(n=0;n<s.length;n+=1)r=s[n],i=this.document.createElement(r.classList.contains("bold")?"b":"i"),r.classList.contains("bold")&&r.classList.contains("italic")?i.innerHTML="<i>"+r.innerHTML+"</i>":i.innerHTML=r.innerHTML,r.parentNode.replaceChild(i,r);s=t.querySelectorAll("span");for(n=0;n<s.length;n+=1){r=s[n];if(e.util.traverseUp(r,o))return!1;e.util.unwrap(r,this.document)}}});e.extensions.paste=u}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(function(e){e.getAttribute("data-placeholder")||e.setAttribute("data-placeholder",this.text),this.updatePlaceholder(e)},this)},destroy:function(){this.getEditorElements().forEach(function(e){e.getAttribute("data-placeholder")===this.text&&e.removeAttribute("data-placeholder")},this)},showPlaceholder:function(e){e&&e.classList.add("medium-editor-placeholder")},hidePlaceholder:function(e){e&&e.classList.remove("medium-editor-placeholder")},updatePlaceholder:function(e,t){if(e.querySelector("img, blockquote, ul, ol")||e.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(e);t||this.showPlaceholder(e)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this))},handleInput:function(e,t){var n=this.hideOnClick&&t===this.base.getFocusedElement();this.updatePlaceholder(t,n)},handleFocus:function(e,t){this.hidePlaceholder(t)},handleBlur:function(e,t){this.updatePlaceholder(t)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,"static":!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(e,t){return this.base.extensions.forEach(function(n){if(n===this)return;return e.apply(t||this,arguments)},this)},createToolbar:function(){var e=this.document.createElement("div");return e.id="medium-editor-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e},createToolbarButtons:function(){var t=this.document.createElement("ul"),n,r,i,s,o,u;return t.id="medium-editor-toolbar-actions"+this.getEditorId(),t.className="medium-editor-toolbar-actions",t.style.display="block",this.buttons.forEach(function(i){typeof i=="string"?(o=i,u=null):(o=i.name,u=i),s=this.base.addBuiltInExtension(o,u),s&&typeof s.getButton=="function"&&(r=s.getButton(this.base),n=this.document.createElement("li"),e.util.isElement(r)?n.appendChild(r):n.innerHTML=r,t.appendChild(n))},this),i=t.querySelectorAll("button"),i.length>0&&(i[0].classList.add(this.firstButtonClass),i[i.length-1].classList.add(this.lastButtonClass)),t},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(t){if(t&&t.target&&e.util.isDescendant(this.getToolbarElement(),t.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(e){e.hasForm&&e.isDisplayed()&&e.hideForm()})},multipleBlockElementsSelected:function(){var t=/<[^\/>][^>]*><\/[^>]+>/gim,n=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),r=e.selection.getSelectionHtml(this.document).replace(t,""),i=r.match(n);return!!i&&i.length>1},modifySelection:function(){var t=this.window.getSelection(),n=t.getRangeAt(0);if(this.standardizeSelectionStart&&n.startContainer.nodeValue&&n.startOffset===n.startContainer.nodeValue.length){var r=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),n.startContainer,this.document);if(r){var i=0;while(r.nodeValue.substr(i,1).trim().length===0)i+=1;n=e.selection.select(this.document,r,i,n.endContainer,n.endOffset)}}},checkState:function(){if(this.base.preventSelectionUpdates)return;if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var t=e.selection.getSelectionElement(this.window);if(!t||this.getEditorElements().indexOf(t)===-1||t.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(e){typeof e.isActive=="function"&&typeof e.setInactive=="function"&&e.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var t=[],n=null,r=e.selection.getSelectionRange(this.document),i,s=function(e){typeof e.checkState=="function"?e.checkState(i):typeof e.isActive=="function"&&typeof e.isAlreadyApplied=="function"&&typeof e.setActive=="function"&&!e.isActive()&&e.isAlreadyApplied(i)&&e.setActive()};if(!r)return;this.forEachExtension(function(e){if(typeof e.queryCommandState=="function"){n=e.queryCommandState();if(n!==null){n&&typeof e.setActive=="function"&&e.setActive();return}}t.push(e)}),i=e.selection.getSelectedParentElement(r);if(!this.getEditorElements().some(function(t){return e.util.isDescendant(t,i,!0)}))return;while(i){t.forEach(s);if(e.util.isMediumEditorElement(i))break;i=i.parentNode}},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var e=this.base.getFocusedElement(),t=this.window.getSelection();if(!e)return this;if(this.static||!t.isCollapsed)this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(e):this.positionToolbar(t)),this.trigger("positionedToolbar",{},this.base.getFocusedElement())},positionStaticToolbar:function(e){this.getToolbarElement().style.left="0";var t=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,n=this.window.innerWidth,r=this.getToolbarElement(),i=e.getBoundingClientRect(),s=i.top+t,o=i.left+i.width/2,u=r.offsetHeight,a=r.offsetWidth,f=a/2,l;this.sticky?t>s+e.offsetHeight-u-this.stickyTopOffset?(r.style.top=s+e.offsetHeight-u+"px",r.classList.remove("medium-editor-sticky-toolbar")):t>s-u-this.stickyTopOffset?(r.classList.add("medium-editor-sticky-toolbar"),r.style.top=this.stickyTopOffset+"px"):(r.classList.remove("medium-editor-sticky-toolbar"),r.style.top=s-u+"px"):r.style.top=s-u+"px";switch(this.align){case"left":l=i.left;break;case"right":l=i.right-a;break;case"center":l=o-f}l<0?l=0:l+a>n&&(l=n-Math.ceil(a)-1),r.style.left=l+"px"},positionToolbar:function(e){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var t=e.getRangeAt(0),n=t.getBoundingClientRect();if(!n||n.height===0&&n.width===0&&t.startContainer===t.endContainer)t.startContainer.nodeType===1&&t.startContainer.querySelector("img")?n=t.startContainer.querySelector("img").getBoundingClientRect():n=t.startContainer.getBoundingClientRect();var r=this.window.innerWidth,i=(n.left+n.right)/2,s=this.getToolbarElement(),o=s.offsetHeight,u=s.offsetWidth,a=u/2,f=50,l=this.diffLeft-a;n.top<f?(s.classList.add("medium-toolbar-arrow-over"),s.classList.remove("medium-toolbar-arrow-under"),s.style.top=f+n.bottom-this.diffTop+this.window.pageYOffset-o+"px"):(s.classList.add("medium-toolbar-arrow-under"),s.classList.remove("medium-toolbar-arrow-over"),s.style.top=n.top+this.diffTop+this.window.pageYOffset-o+"px"),i<a?(s.style.left=l+a+"px",s.style.right="initial"):r-i<a?(s.style.left="auto",s.style.right=0):(s.style.left=l+i+"px",s.style.right="initial")}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){var t="medium-editor-dragover";e.preventDefault(),e.dataTransfer.dropEffect="copy",e.type==="dragover"?e.target.classList.add(t):e.type==="dragleave"&&e.target.classList.remove(t)},handleDrop:function(t){var n="medium-editor-dragover",r;t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&(r=Array.prototype.slice.call(t.dataTransfer.files,0),r.some(function(t){if(t.type.match("image")){var n,r;n=new FileReader,n.readAsDataURL(t),r="medium-img-"+ +(new Date),e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+r+'" />'),n.onload=function(){var e=this.document.getElementById(r);e&&(e.removeAttribute("id"),e.removeAttribute("class"),e.src=n.result)}.bind(this)}}.bind(this))),t.target.classList.remove(n)}});e.extensions.imageDragging=t}(),function(){function t(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r=n.textContent,i=e.selection.getCaretOffsets(n);(r[i.left-1]===undefined||r[i.left-1].trim()===""||r[i.left]!==undefined&&r[i.left].trim()==="")&&t.preventDefault()}function n(t,n){if(this.options.disableReturn||n.getAttribute("data-disable-return"))t.preventDefault();else if(this.options.disableDoubleReturn||n.getAttribute("data-disable-double-return")){var r=e.selection.getSelectionStart(this.options.ownerDocument);(r&&r.textContent.trim()===""&&r.nodeName.toLowerCase()!=="li"||r.previousElementSibling&&r.previousElementSibling.nodeName.toLowerCase()!=="br"&&r.previousElementSibling.textContent.trim()==="")&&t.preventDefault()}}function r(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r=n&&n.nodeName.toLowerCase();r==="pre"&&(t.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(n)&&(t.preventDefault(),t.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function i(t){var n,r=e.selection.getSelectionStart(this.options.ownerDocument),i=r.nodeName.toLowerCase(),s=/^(\s+|<br\/?>)?$/i,o=/h\d/i;e.util.isKey(t,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&r.previousElementSibling&&o.test(i)&&e.selection.getCaretOffsets(r).left===0?e.util.isKey(t,e.util.keyCode.BACKSPACE)&&s.test(r.previousElementSibling.innerHTML)?(r.previousElementSibling.parentNode.removeChild(r.previousElementSibling),t.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(t,e.util.keyCode.ENTER)&&(n=this.options.ownerDocument.createElement("p"),n.innerHTML="<br>",r.previousElementSibling.parentNode.insertBefore(n,r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.DELETE)&&r.nextElementSibling&&r.previousElementSibling&&!o.test(i)&&s.test(r.innerHTML)&&o.test(r.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,r.nextElementSibling),r.previousElementSibling.parentNode.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&i==="li"&&s.test(r.innerHTML)&&!r.previousElementSibling&&!r.parentElement.previousElementSibling&&r.nextElementSibling&&r.nextElementSibling.nodeName.toLowerCase()==="li"?(n=this.options.ownerDocument.createElement("p"),n.innerHTML="<br>",r.parentElement.parentElement.insertBefore(n,r.parentElement),e.selection.moveCursor(this.options.ownerDocument,n),r.parentElement.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(r,"blockquote")!==!1&&e.selection.getCaretOffsets(r).left===0&&(t.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p"))}function s(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r;if(!n)return;e.util.isMediumEditorElement(n)&&n.children.length===0&&!e.util.isBlockContainer(n)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(t,e.util.keyCode.ENTER)&&!e.util.isListItem(n)&&!e.util.isBlockContainer(n)&&(r=n.nodeName.toLowerCase(),r==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!t.shiftKey&&!t.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"))}function o(e,t){var n=t.parentNode.querySelector('textarea[medium-editor-textarea-id="'+t.getAttribute("medium-editor-textarea-id")+'"]');n&&(n.value=t.innerHTML.trim())}function u(e){e._mediumEditors||(e._mediumEditors=[null]),this.id||(this.id=e._mediumEditors.length),e._mediumEditors[this.id]=this}function a(e){if(!e._mediumEditors||!e._mediumEditors[this.id])return;e._mediumEditors[this.id]=null}function f(t,n,r){var i=[];t||(t=[]),typeof t=="string"&&(t=n.querySelectorAll(t)),e.util.isElement(t)&&(t=[t]);if(r)for(var s=0;s<t.length;s++){var o=t[s];e.util.isElement(o)&&!o.getAttribute("data-medium-editor-element")&&!o.getAttribute("medium-editor-textarea-id")&&i.push(o)}else i=Array.prototype.slice.apply(t);return i}function l(e){var t=e.parentNode.querySelector('textarea[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]');t&&(t.classList.remove("medium-editor-hidden"),t.removeAttribute("medium-editor-textarea-id")),e.parentNode&&e.parentNode.removeChild(e)}function c(e,t){return Object.keys(t).forEach(function(n){e[n]===undefined&&(e[n]=t[n])}),e}function h(e,t,n){var r={window:n.options.contentWindow,document:n.options.ownerDocument,base:n};return e=c(e,r),typeof e.init=="function"&&e.init(),e.name||(e.name=t),e}function p(){return this.elements.every(function(e){return!!e.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function d(){return p.call(this)?this.options.anchorPreview!==!1:!1}function v(){return this.options.placeholder!==!1}function m(){return this.options.autoLink!==!1}function g(){return this.options.imageDragging!==!1}function y(){return this.options.keyboardCommands!==!1}function b(){return!this.options.extensions.imageDragging}function w(e,t,n){var r=n.createElement("div"),i=Date.now(),s="medium-editor-"+i+"-"+t,o=e.attributes;while(n.getElementById(s))i++,s="medium-editor-"+i+"-"+t;r.className=e.className,r.id=s,r.innerHTML=e.value,e.setAttribute("medium-editor-textarea-id",s);for(var u=0,a=o.length;u<a;u++)r.hasAttribute(o[u].nodeName)||r.setAttribute(o[u].nodeName,o[u].nodeValue);return e.classList.add("medium-editor-hidden"),e.parentNode.insertBefore(r,e),r}function E(t,r){return t.getAttribute("data-medium-editor-element")||(t.nodeName.toLowerCase()==="textarea"&&(t=w(t,r,this.options.ownerDocument),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=o.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!t.getAttribute("data-disable-editing")&&(t.setAttribute("contentEditable",!0),t.setAttribute("spellcheck",this.options.spellcheck)),!this.instanceHandleEditableKeydownEnter&&(t.getAttribute("data-disable-return")||t.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!t.getAttribute("data-disable-return")&&this.on(t,"keyup",s.bind(this)),t.setAttribute("data-medium-editor-element",!0),t.setAttribute("role","textbox"),t.setAttribute("aria-multiline",!0),t.setAttribute("medium-editor-index",e.util.guid()),this.events.attachAllEventsToElement(t)),t}function S(){this.subscribe("editableKeydownTab",r.bind(this)),this.subscribe("editableKeydownDelete",i.bind(this)),this.subscribe("editableKeydownEnter",i.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),!this.instanceHandleEditableKeydownEnter&&(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function x(){this.extensions=[],Object.keys(this.options.extensions).forEach(function(e){e!=="toolbar"&&this.options.extensions[e]&&this.extensions.push(h(this.options.extensions[e],e,this))},this);if(b.call(this)){var t=this.options.fileDragging;t||(t={},g.call(this)||(t.allowedTypes=[])),this.addBuiltInExtension("fileDragging",t)}var n={paste:!0,"anchor-preview":d.call(this),autoLink:m.call(this),keyboardCommands:y.call(this),placeholder:v.call(this)};Object.keys(n).forEach(function(e){n[e]&&this.addBuiltInExtension(e)},this);var r=this.options.extensions.toolbar;if(!r&&p.call(this)){var i=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});r=new e.extensions.toolbar(i)}r&&this.extensions.push(h(r,"toolbar",this))}function T(t,n){var r=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return n&&r.forEach(function(t){n.hasOwnProperty(t[0])&&n[t[0]]!==undefined&&e.util.deprecated(t[0],t[1],"v6.0.0")}),e.util.defaults({},n,t)}function N(t,n){var r=/^append-(.+)$/gi,i=/justify([A-Za-z]*)$/g,s;s=r.exec(t);if(s)return e.util.execFormatBlock(this.options.ownerDocument,s[1]);if(t==="fontSize")return this.options.ownerDocument.execCommand("fontSize",!1,n.size);if(t==="fontName")return this.options.ownerDocument.execCommand("fontName",!1,n.name);if(t==="createLink")return this.createLink(n);if(t==="image"){var o=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,o)}if(i.exec(t)){var u=this.options.ownerDocument.execCommand(t,!1,null),a=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return a&&C.call(this,e.util.getTopBlockContainer(a)),u}return this.options.ownerDocument.execCommand(t,!1,null)}function C(t){if(!t)return;var n,r=Array.prototype.slice.call(t.childNodes).filter(function(e){var t=e.nodeName.toLowerCase()==="div";return t&&!n&&(n=e.style.textAlign),t});r.length&&(this.saveSelection(),r.forEach(function(t){if(t.style.textAlign===n){var r=t.lastChild;if(r){e.util.unwrap(t,this.options.ownerDocument);var i=this.options.ownerDocument.createElement("BR");r.parentNode.insertBefore(i,r.nextSibling)}}},this),t.style.textAlign=n,this.restoreSelection())}e.prototype={init:function(e,t){return this.options=T.call(this,this.defaults,t),this.origElements=e,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){if(this.isActive)return;this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements);if(this.elements.length===0)return;this.isActive=!0,u.call(this,this.options.contentWindow),x.call(this),S.call(this)},destroy:function(){if(!this.isActive)return;this.isActive=!1,this.extensions.forEach(function(e){typeof e.destroy=="function"&&e.destroy()},this),this.events.destroy(),this.elements.forEach(function(e){this.options.spellcheck&&(e.innerHTML=e.innerHTML),e.removeAttribute("contentEditable"),e.removeAttribute("spellcheck"),e.removeAttribute("data-medium-editor-element"),e.removeAttribute("role"),e.removeAttribute("aria-multiline"),e.removeAttribute("medium-editor-index"),e.getAttribute("medium-editor-textarea-id")&&l(e)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,a.call(this,this.options.contentWindow)},on:function(e,t,n,r){return this.events.attachDOMEvent(e,t,n,r),this},off:function(e,t,n,r){return this.events.detachDOMEvent(e,t,n,r),this},subscribe:function(e,t){return this.events.attachCustomEvent(e,t),this},unsubscribe:function(e,t){return this.events.detachCustomEvent(e,t),this},trigger:function(e,t,n){return this.events.triggerCustomEvent(e,t,n),this},delay:function(e){var t=this;return setTimeout(function(){t.isActive&&e()},this.options.delay)},serialize:function(){var e,t,n={},r=this.elements.length;for(e=0;e<r;e+=1)t=this.elements[e].id!==""?this.elements[e].id:"element-"+e,n[t]={value:this.elements[e].innerHTML.trim()};return n},getExtensionByName:function(e){var t;return this.extensions&&this.extensions.length&&this.extensions.some(function(n){return n.name===e?(t=n,!0):!1}),t},addBuiltInExtension:function(t,n){var r=this.getExtensionByName(t),i;if(r)return r;switch(t){case"anchor":i=e.util.extend({},this.options.anchor,n),r=new e.extensions.anchor(i);break;case"anchor-preview":r=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":r=new e.extensions.autoLink;break;case"fileDragging":r=new e.extensions.fileDragging(n);break;case"fontname":r=new e.extensions.fontName(this.options.fontName);break;case"fontsize":r=new e.extensions.fontSize(n);break;case"keyboardCommands":r=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":r=new e.extensions.paste(this.options.paste);break;case"placeholder":r=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(t)&&(n?(i=e.util.defaults({},n,e.extensions.button.prototype.defaults[t]),r=new e.extensions.button(i)):r=new e.extensions.button(t))}return r&&this.extensions.push(h(r,t,this)),r},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var e=this.getExtensionByName("toolbar");return e&&e.checkState(),this},queryCommandState:function(e){var t=/^full-(.+)$/gi,n,r=null;n=t.exec(e),n&&(e=n[1]);try{r=this.options.ownerDocument.queryCommandState(e)}catch(i){r=null}return r},execAction:function(t,n){var r=/^full-(.+)$/gi,i,s;return i=r.exec(t),i?(this.saveSelection(),this.selectAllContents(),s=N.call(this,i[1],n),this.restoreSelection()):s=N.call(this,t,n),(t==="insertunorderedlist"||t==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),s},getSelectedParentElement:function(t){return t===undefined&&(t=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(t)},selectAllContents:function(){var t=e.selection.getSelectionElement(this.options.contentWindow);if(t){while(t.children.length===1)t=t.children[0];this.selectElement(t)}},selectElement:function(t){e.selection.selectNode(t,this.options.ownerDocument);var n=e.selection.getSelectionElement(this.options.contentWindow);n&&this.events.focusElement(n)},getFocusedElement:function(){var e;return this.elements.some(function(t){return!e&&t.getAttribute("data-medium-focused")&&(e=t),!!e},this),e},exportSelection:function(){var t=e.selection.getSelectionElement(this.options.contentWindow),n=this.elements.indexOf(t),r=null;return n>=0&&(r=e.selection.exportSelection(t,this.options.ownerDocument)),r!==null&&n!==0&&(r.editableElementIndex=n),r},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(t,n){if(!t)return;var r=this.elements[t.editableElementIndex||0];e.selection.importSelection(t,r,this.options.ownerDocument,n)},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(t){var n=e.selection.getSelectionElement(this.options.contentWindow),r={};if(this.elements.indexOf(n)===-1)return;try{this.events.disableCustomEvent("editableInput");if(t.url&&t.url.trim().length>0){var i=this.options.contentWindow.getSelection();if(i){var s=i.getRangeAt(0),o=s.commonAncestorContainer,u,a,f,l;s.endContainer.nodeType===3&&s.startContainer.nodeType!==3&&s.startOffset===0&&s.startContainer.firstChild===s.endContainer&&(o=s.endContainer),a=e.util.getClosestBlockContainer(s.startContainer),f=e.util.getClosestBlockContainer(s.endContainer);if(o.nodeType!==3&&o.textContent.length!==0&&a===f){var c=a||n,h=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),u=this.exportSelection(),h.appendChild(c.cloneNode(!0)),n===c?e.selection.select(this.options.ownerDocument,c.firstChild,0,c.lastChild,c.lastChild.nodeType===3?c.lastChild.nodeValue.length:c.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,c,0,c,c.childNodes.length);var p=this.exportSelection();l=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,h,{start:u.start-p.start,end:u.end-p.start,editableElementIndex:u.editableElementIndex}),l.length===0&&(h=this.options.ownerDocument.createDocumentFragment(),h.appendChild(o.cloneNode(!0)),l=[h.firstChild.firstChild,h.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,l,t.url.trim());var d=(h.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,h.firstChild.innerHTML.replace(/^\s+/,"")),u.start-=d,u.end-=d,this.importSelection(u)}else this.options.ownerDocument.execCommand("createLink",!1,t.url);this.options.targetBlank||t.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),t.url):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),t.url),t.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),t.buttonClass)}}if(this.options.targetBlank||t.target==="_blank"||t.buttonClass){r=this.options.ownerDocument.createEvent("HTMLEvents"),r.initEvent("input",!0,!0,this.options.contentWindow);for(var v=0,m=this.elements.length;v<m;v+=1)this.elements[v].dispatchEvent(r)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",r,n)},cleanPaste:function(e){this.getExtensionByName("paste").cleanPaste(e)},pasteHTML:function(e,t){this.getExtensionByName("paste").pasteHTML(e,t)},setContent:function(e,t){t=t||0;if(this.elements[t]){var n=this.elements[t];n.innerHTML=e,this.checkContentChanged(n)}},checkContentChanged:function(t){t=t||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(t,{target:t,currentTarget:t})},addElements:function(e){var t=f(e,this.options.ownerDocument,!0);if(t.length===0)return!1;t.forEach(function(e){e=E.call(this,e),this.elements.push(e)},this)},removeElements:function(e){var t=f(e,this.options.ownerDocument),n=t.map(function(e){return e.getAttribute("medium-editor-textarea-id")&&e.parentNode?e.parentNode.querySelector('div[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]'):e});this.elements=this.elements.filter(function(e){return n.indexOf(e)!==-1?(this.events.cleanupElement(e),e.getAttribute("medium-editor-textarea-id")&&l(e),!1):!0},this)}}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(e){var t=e.split("-"),n=t[0].split("."),r=t.length>1?t[1]:"";return{major:parseInt(n[0],10),minor:parseInt(n[1],10),revision:parseInt(n[2],10),preRelease:r,toString:function(){return[n[0],n[1],n[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,{version:"5.17.0"}.version),e}())},password_strength:function(e){var t=function(){function e(){this.username=null,this.password=null,this.score=0,this.status=null}var t=/\d.*?\d.*?\d/,n=/[!@#$%^&*?_~].*?[!@#$%^&*?_~]/,r=/([a-z].*[A-Z])|([A-Z].*[a-z])/,i=/[!@#\$%^&*?_~]/;return e.fn=e.prototype,e.fn.test=function(){var e;return this.score=e=0,this.containInvalidMatches()?this.status="invalid":this.usesCommonWord()?this.status="invalid":(e+=this.scoreFor("password_size"),e+=this.scoreFor("numbers"),e+=this.scoreFor("symbols"),e+=this.scoreFor("uppercase_lowercase"),e+=this.scoreFor("numbers_chars"),e+=this.scoreFor("numbers_symbols"),e+=this.scoreFor("symbols_chars"),e+=this.scoreFor("only_chars"),e+=this.scoreFor("only_numbers"),e+=this.scoreFor("username"),e+=this.scoreFor("sequences"),e+=this.scoreFor("repetitions"),e<0&&(e=0),e>100&&(e=100),e<35&&(this.status="weak"),e>=35&&e<70&&(this.status="good"),e>=70&&(this.status="strong")),this.score=e,this.score},e.fn.scoreFor=function(e){score=0;switch(e){case"password_size":this.password.length<6?score=-100:score=this.password.length*4;break;case"numbers":this.password.match(t)&&(score=5);break;case"symbols":this.password.match(n)&&(score=5);break;case"uppercase_lowercase":this.password.match(r)&&(score=10);break;case"numbers_chars":this.password.match(/[a-z]/i)&&this.password.match(/[0-9]/)&&(score=15);break;case"numbers_symbols":this.password.match(/[0-9]/)&&this.password.match(i)&&(score=15);break;case"symbols_chars":this.password.match(/[a-z]/i)&&this.password.match(i)&&(score=15);break;case"only_chars":this.password.match(/^[a-z]+$/i)&&(score=-15);break;case"only_numbers":this.password.match(/^\d+$/i)&&(score=-15);break;case"username":this.password==this.username?score=-100:this.password.indexOf(this.username)!=-1&&(score=-15);break;case"sequences":score+=-15*this.sequences(this.password),score+=-15*this.sequences(this.reversed(this.password));break;case"repetitions":score+=-(this.repetitions(this.password,2)*4),score+=-(this.repetitions(this.password,3)*3),score+=-(this.repetitions(this.password,4)*2)}return score},e.fn.isGood=function(){return this.status=="good"},e.fn.isWeak=function(){return this.status=="weak"},e.fn.isStrong=function(){return this.status=="strong"},e.fn.isInvalid=function(){return this.status=="invalid"},e.fn.isValid=function(e){return e=="strong"?this.isStrong():e=="good"?this.isStrong()||this.isGood():!this.containInvalidMatches()&&!this.usesCommonWord()},e.fn.containInvalidMatches=function(){return this.exclude?this.exclude.test?this.exclude.test(this.password.toString()):!1:!1},e.fn.usesCommonWord=function(){return e.commonWords.indexOf(this.password.toLowerCase())>=0},e.fn.sequences=function(e){var t=0,n=0,r=[],i=e.length,s,o;for(var u=0;u<i;u++)o=e.charCodeAt(u),s=r[r.length-1],r.push(o),s&&(o==s+1||s==o?n+=1:n=0),n==2&&(t+=1);return t},e.fn.repetitions=function(e,t){var n=0,r={},i=e.length,s,o,u;for(var a=0;a<i;a++){s=e.substr(a,t),o=0,u=e;if(r[s]||s.length<t)continue;r[s]=!0;while((a=u.indexOf(s))!=-1)o+=1,u=u.substr(a+1);o>1&&(n+=1)}return n},e.fn.reversed=function(e){var t="",n=e.length;for(var r=n-1;r>=0;r--)t+=e.charAt(r);return t},e.test=function(t,n){return strength=new e,strength.username=t,strength.password=n,strength.test(),strength},e.commonWords=["!qaz1qaz","!qaz2wsx","!qaz2wsx","!qazxsw2","!qazzaq1","#edc4rfv","000000","010203","1111","11111","111111","11111111","112233","1212","121212","123123","1234","12345","123456","1234567","12345678","123456789","1234567890","123qweasd","12qw!@qw","1313","131313","1941.salembbb.41","1qaz!qaz","1qaz@wsx","1qazxsw@","1qazzaq!","2000","2112","2222","232323","2wsx@wsx","3333","3edc#edc","4128","4321","4444","5150","5555","555555","654321","6666","666666","6969","696969","7777","777777","7777777","8675309","987654","@wsx2wsx","aaaa","aaaaaa","aaliyah1","abc123","abc123abc","abc123abc","abcabc123","abcabc123","abcd1234","abcdef","abgrtyu","abigail1","access","access14","action","addison1","admin","adobe123","airforce1","alabama1","albert","alex","alexander1","alexandra1","alexis","allison1","amanda","amateur","america1","anderson1","andrea","andrew","angel","angel101","angel123","angela","angelina1","angels","animal","annabelle1","anthony","anthony1","anthony11","antonio1","apollo","apple","apples","arianna1","arsenal","arsenal1","arsenal12","arsenal123","arthur","asdf","asdfgh","ashley","ashley12","asshole","asshole1","atlanta1","august","august08","august10","august12","august20","august22","austin","austin02","austin316","australia1","awesome1","azerty","baby","babyboy1","babygirl1","babygirl1","babygurl1","badboy","bailey","bailey12","banana","barcelona1","barney","baseball","baseball1","batista1","batman","beach","bear","beautiful1","beaver","beavis","beckham7","beer","bella123","benjamin1","bentley1","bethany1","bigcock","bigdaddy","bigdaddy1","bigdick","bigdog","bigtits","bill","billy","birdie","bitch","bitches","biteme","black","blazer","blessed1","blink-182","blink182","blonde","blondes","blondie1","blowjob","blowme","blue","bond007","bonnie","booboo","boobs","booger","boomer","booty","boricua1","boston","bradley1","brandon","brandon1","brandon2","brandon7","brandy","braves","braxton1","brayden1","brazil","breanna1","brian","brianna1","brittany1","brittney1","bronco","broncos","broncos1","brooklyn1","brownie1","bubba","bubbles1","buddy","buddy123","bulldog","buster","butter","buttercup1","butterfly1","butterfly7","butthead","buttons1","calvin","camaro","cameron","cameron1","canada","candy123","captain","carlos","carolina1","carter","casper","cassandra1","catherine1","celtic1888","chargers1","charles","charles1","charlie","charlie1","charlotte1","charmed1","cheese","chelsea","chelsea1","chelsea123","chester","chester1","chevy","cheyenne1","chicago","chicago1","chicken","chicken1","chocolate1","chopper1","chris","chris123","christian1","christina1","christine1","christmas1","classof08","clayton1","cocacola","cock","coffee","college","college1","colombia1","colorado1","compaq","computer","computer1","cookie","cool","cooper","corvette","courtney1","cowboy","cowboys","cowboys1","cream","cricket1","crystal","crystal1","cumming","cumshot","cunt","cutiepie1","daisy123","dakota","dallas","dallas22","dan1elle","daniel","daniela1","danielle","danielle1","dave","david","david123","death666","debbie","december1","december21","dennis","derrick1","destiny1","deuseamor","devil666","diablo","diamond","diamond1","diamonds1","dick","dirty","doctor","doggie","dolphin","dolphin1","dolphins","dolphins1","dominic1","donald","douglas1","dragon","dreams","driver","eagle","eagle1","eagles","edward","einstein","elizabeth1","elizabeth2","england1","enjoy","enter","eric","erotic","extreme","falcon","falcons1","falcons7","familia","fender","ferrari","fire","firebird","fish","fishing","florida","florida1","flower","flyers","football","football1","ford","forever","forever1","forever21","formula1","frank","frankie1","fred","freddie1","freddy","freedom","freedom1","friday13","friends1","friends2","fuck","fucked","fucker","fucking","fuckme","fuckoff1","fuckyou","fuckyou1","fuckyou2","fuckyou2","gabriel1","gandalf","gangsta1","garrett1","gateway","gateway1","gators","gemini","genesis1","george","georgia1","gerrard8","giants","giggles1","ginger","girl","girls","goddess1","godislove1","golden","golf","golfer","gordon","gordon24","grandma1","great","green","greenday1","gregory","guitar","gunner","hammer","hannah","happy","hardcore","harley","harry123","hawaii50","heather","heather1","hello","hello123","helpme","hentai","hershey1","hockey","holiday1","hollywood1","honey123","hooters","horney","horny","hotdog","house","houston1","hunter","hunter01","hunting","iceman","iloveme1","iloveme2","iloveyou","iloveyou1","iloveyou2","iloveyou2","internet","internet1","inuyasha1","ireland1","isabella1","isabelle1","iverson3","iwantu","iydgtvmujl6f","jack","jackie","jackson","jackson1","jackson5","jaguar","jake","jamaica1","james","james123","january1","january29","japan","jasmine","jasmine1","jason","jasper","jazmine1","jeffrey1","jehovah1","jennifer","jennifer1","jennifer2","jeremiah1","jeremy","jessica","jessica1","jessica7","jesus","jesus123","jesus143","jesus1st","jesus4me","jesus777","jesuscristo","jesusis#1","jesusis1","john","john3:16","johncena1","johnny","johnson","jonathan1","jordan","jordan01","jordan12","jordan23","joseph","joshua","joshua01","juice","junior","justice1","justin","justin01","justin11","justin21","justin23","katelyn1","katherine1","kathryn1","katrina1","kelly","kendall1","kennedy1","kenneth1","kevin","killer","kimberly1","king","kitty","knight","kristen1","kristin1","l6fkiy9on","ladies","ladybug1","lakers","lakers24","lampard8","laura123","lauren","leather","lebron23","legend","letmein","letmein1","liberty1","lindsay1","lindsey1","little","liverp00l","liverpool1","liverpool123","london","longhorns1","love","love4ever","lover","lovers","loveyou2","lucky","lucky123","m1chelle","mackenzie1","maddog","madison","madison01","madison1","madonna1","maggie","magic","magnum","makayla1","marcelo","marie123","marine","marines1","marissa1","mark","marlboro","marshall1","martin","marvin","master","matrix","matt","matthew","matthew1","matthew2","matthew3","maverick","maxwell","maxwell1","melanie1","melissa","melissa1","member","mercedes","mercedes1","merlin","metallica1","michael","michael01","michael07","michael1","michael2","michael7","micheal1","michele1","michelle","michelle1","michelle2","mickey","midnight","midnight1","mike","miller","mine","miranda1","mistress","molly123","money","monica","monique1","monkey","monkey01","monkey12","monkey13","monkeys1","monster","monster1","montana1","morgan","mother","mountain","movie","muffin","murphy","music","music123","mustang","mustang1","myspace1","naked","nascar","natalie1","natasha1","nathan","nathan06","naughty","ncc1701","newyork","newyork1","nicholas","nicholas1","nichole1","nicole","nicole12","ninja","nipple","nipples","nirvana1","november1","november11","november15","november16","nursing1","october1","october13","october22","oliver","omarion1","orange","orlando1","ou812","p4ssword","p@$$w0rd","p@55w0rd","p@ssw0rd","pa$$w0rd","pa55w0rd","pa55word","packers","panther","panther1","panthers1","panties","paris","parker","pass","pass1234","passion1","passw0rd","passw0rd","passw0rd1","password","password01","password1","password1","password1!","password11","password12","password12","password123","password123","password13","password2","password21","password3","password4","password5","password7","password9","patches1","patricia1","patrick","patrick1","paul","peaches","peaches1","peanut","peanut01","peanut11","pebbles1","penguin1","penis","pepper","peter","phantom","phantom1","phoenix","phoenix1","photoshop","pickles1","playboy1","player","please","pokemon1","poohbear1","poohbear1","pookie","popcorn1","porn","porno","porsche","power","pr1nc3ss","pr1ncess","precious1","preston1","prince","princess","princess01","princess07","princess08","princess1","princess12","princess123","princess13","princess15","princess18","princess19","princess2","princess21","princess23","princess24","princess4","princess5","princess7","private","prototype1","pumpkin1","purple","pussies","pussy","qazwsx","qwert","qwerty","qwerty123","qwertyui","rabbit","rachel","racing","raiders","raiders1","rainbow","rainbow1","ranger","rangers","rangers1","raymond1","rebecca","rebecca1","rebelde1","redskins","redskins1","redsox","redwings","ricardo1","richard","richard1","robert","robert01","rock","rocket","rockstar1","rocky123","rockyou1","rockyou1","ronaldo7","rosebud","runner","rush2112","russell1","russia","rusty123","sabrina1","sail2boat3","samantha","samantha1","sammy","samson","sandra","santana1","saturn","savannah1","scooby","scooter","scooter1","scorpio","scorpio1","scorpion","scotland1","scott","scrappy1","sebastian1","secret","senior06","senior07","september1","serenity1","sexsex","sexy","shadow","shannon","shannon1","shaved","shit","shopping1","sierra","silver","skippy","skittles1","slayer","slipknot1","slut","smith","smokey","smokey01","snickers1","snoopy","snowball1","soccer","soccer11","soccer12","soccer13","soccer14","soccer17","softball1","sophie","spanky","sparky","spartan117","special1","spencer1","spider","spiderman1","spongebob1","squirt","srinivas","star","stars","start123","startrek","starwars","starwars1","steelers","steelers1","stephanie1","stephen1","steve","steven","sticky","stupid","success","suckit","summer","summer01","summer05","summer06","summer07","summer08","summer99","sunshine","sunshine1","super","superman","superman1","superstar1","surfer","sweetie1","sweetpea1","swimming","sydney","taylor","taylor13","tbfkiy9on","teddybear1","teens","tennis","teresa","test","tester","testing","theman","thesims2","thirteen13","thomas","thumper1","thunder","thunder1","thx1138","tiffany","tiffany1","tiger","tiger123","tigers","tigger","tigger01","tigger12","tigger123","time","timothy1","tinkerbell1","titanic1","tits","tomcat","topgun","toyota","travis","trinity1","trinity3","tristan1","trouble","trouble1","trustno1","trustno1","trustno1","tucker","turtle","twilight1","twitter","unicorn1","united","vagina","valerie1","vampire1","vanessa1","vanilla1","veronica1","victor","victoria","victoria1","video","viking","vincent1","viper","voodoo","voyager","walter","warrior","welcome","welcome1","welcome123","welcome2","whatever","whatever1","white","whitney1","william","william1","willie","wilson","winner","winston","winston1","winter","winter06","wizard","wolf","women","xavier","xxxx","xxxxx","xxxxxx","xxxxxxxx","yamaha","yankee","yankees","yankees1","yankees2","yellow","young","z,iyd86i","zachary1","zaq!1qaz","zaq!2wsx","zaq!xsw2","zaq1!qaz","zaq1@wsx","zaq1zaq!","zxcvbn","zxcvbnm","zzzzzz"],e}();return t},"es6-collections":function(e){return function(e){"use strict";function t(e,t){function r(e){if(!this||this.constructor!==r)return new r(e);this._keys=[],this._values=[],this._itp=[],this.objectOnly=t,e&&n.call(this,e)}return t||b(e,"size",{get:m}),e.constructor=r,r.prototype=e,r}function n(e){var t;this.add?e.forEach(this.add,this):e.forEach(function(e){this.set(e[0],e[1])},this)}function r(e){return this.has(e)&&(this._keys.splice(y,1),this._values.splice(y,1),this._itp.forEach(function(e){y<e[0]&&e[0]--})),-1<y}function i(e){return this.has(e)?this._values[y]:undefined}function s(e,t){if(this.objectOnly&&t!==Object(t))throw new TypeError("Invalid value used as weak collection key");if(t!=t||t===0)for(y=e.length;y--&&!w(e[y],t););else y=e.indexOf(t);return-1<y}function o(e){return s.call(this,this._values,e)}function u(e){return s.call(this,this._keys,e)}function a(e,t){return this.has(e)?this._values[y]=t:this._values[this._keys.push(e)-1]=t,this}function f(e){return this.has(e)||this._values.push(e),this}function l(){(this._keys||0).length=this._values.length=0}function c(){return v(this._itp,this._keys)}function h(){return v(this._itp,this._values)}function p(){return v(this._itp,this._keys,this._values)}function d(){return v(this._itp,this._values,this._values)}function v(e,t,n){var r=[0],i=!1;return e.push(r),{next:function(){var s,o=r[0];return!i&&o<t.length?(s=n?[t[o],n[o]]:t[o],r[0]++):(i=!0,e.splice(e.indexOf(r),1)),{done:i,value:s}}}}function m(){return this._values.length}function g(e,t){var n=this.entries();for(;;){var r=n.next();if(r.done)break;e.call(t,r.value[1],r.value[0],this)}}var y,b=Object.defineProperty,w=function(e,t){return isNaN(e)?isNaN(t):e===t};typeof WeakMap=="undefined"&&(e.WeakMap=t({"delete":r,clear:l,get:i,has:u,set:a},!0));if(typeof Map=="undefined"||typeof (new Map).values!="function"||!(new Map).values().next)e.Map=t({"delete":r,has:u,get:i,set:a,keys:c,values:h,entries:p,forEach:g,clear:l});if(typeof Set=="undefined"||typeof (new Set).values!="function"||!(new Set).values().next)e.Set=t({has:o,add:f,"delete":r,clear:l,keys:h,values:h,entries:d,forEach:g});typeof WeakSet=="undefined"&&(e.WeakSet=t({"delete":r,add:f,clear:l,has:o},!0))}(typeof exports!="undefined"&&typeof global!="undefined"?global:window),Set},"/app":function(e,t,n){var r=e("underscore"),i=e("jquery"),s=e("./core"),o=e("./core/log"),u=e("./core/util"),a=e("cookies-js"),f=e("store");e("./core/touch"),e("es6-collections"),e("./adblock-detector")(function(e){s.config("add-block",e)}),s.ready(function(){s._config.load(r.extend({token:window.initParams.sessionID,logged:window.logined===1,carma:window.uCarma,bid:window.bid,development:window.dev===1,phpSelf:window.phpSelf,tag:window.tag_str,twitMode:window.is_twitmode,scrollMode:window.is_scrollmode,developmentMode:window.developmentMode,facebookWidget:window.nextJS.mv.facebookWidget,gif:{showComment:!1,showStory:!1},user:{id:window.initParams.userID,name:window.initParams.userName},local:window.location.host.indexOf(".l")>-1},window.initParams)),s.config("phpSelf")==="profile.php"&&s.config("twitMode",!1);var t=u.getCommunity();t&&s.config("filter_name",t),i.ajaxSetup({headers:{"X-Csrf-Token":s.config("sessionID")}}),"ontouchstart"in document.documentElement||i("body").addClass("no-touch"),e("./wm");var n=i("#applicationMain");s.findQuery(),window.location.host.indexOf("m-testing.")===0||window.location.host.indexOf("m-testing2.")===0?s.config("environment",s.eEnvironment.testing):s.config("environment",s.eEnvironment[n.data("environment")]),s.config("version",n.data("version")),s.config("clientType","mobile"),(s.config("environment")===s.eEnvironment.testing||s.config("environment")===s.eEnvironment.local||s.config("developmentMode"))&&s.global("require",e),!s.config("testing")&&!s.config("local")&&!s.config("GET:verbose")&&(o.setVerbose(!1),console&&console.log&&r.each(["      .--,--.          ","       `.  ,.'        ","        |___|        ","        :o o:   O   ","       _`~^~'_  |    ","     /'   ^   `=)","   .'  _______ '~|","   `(<=| pik |= /'","       | abu |","       |_____|"," ~~~~~~ ===== ~~~~~~~~"],function(e){console.log(e)})),o.info(":app:",s.config("environment")===s.eEnvironment.testing?"[testing] "+s.config("version"):s.config("environment")===s.eEnvironment.local?"[local]":s.config("version"),s.ua.browser.family,s.ua.browser.version,s.ua.device.type),e("./story-search"),e("./page-story"),e("./page-user-settings"),e("./page-user-profile"),e("./page-comments-incoming"),e("./page-comments-outcoming"),e("./page-comments-top"),e("./page-moderators-chat"),e("./page-saved-stories"),e("./tags-search"),e("./page-test-ua"),e("./page-signin"),e("./page-signup"),e("./page-community-editor"),e("./page-communities"),e("./page-user-notifications"),e("./page-gtpost"),e("./page-ban-list"),e("./page-restore-password"),i(".hide_show").tap(function(t){var n=i(this),r=n.children(".checkbox"),o;if(!s.config("logged"))return e("./sign").showNeedSignin();o=r.hasClass("on"),r.toggleClass("off",o).toggleClass("on",!o),a.set("autohide_news",o?0:2,{expires:31536e6}),a.set("set_autohide_news",o?0:2,{expires:31536e6}),window.location.reload()}),s.config("logged")?setTimeout(function(){i(".hide_show .checkbox").off()},200):i(".hide_show .checkbox").addClass("disabled"),e("./sign");if(["index.php","upcoming.php","authors.php","adult.php","cat.php","subs.php","profile.php","search.php","search_new.php"].indexOf(s.config("phpSelf"))>-1){var l=e("./feed");this.feed=new l(i(".content_container"))}else i(window).on(s.ua.device.family==="iPhone"?"pagehide":"beforeunload",function(){var e=f.get("_p_cache");!e.active&&e.page>0&&(e.active=!0),f.set("_p_cache",e)});e("./feed");var c=e("./custom-advert");c&&c.init();var h=e("./image-viewer");i(document).on("click",'img[data-viewable="true"]',function(t){t.preventDefault(),t.stopPropagation();try{e("./core/metrika").goal(i(t.target).parent().parent().hasClass("b-story-block__content")?"iv-mv__show-story":"iv-mv__show-comment")}catch(t){}(new h).show(this)}),s.matchActive("wm"),s.changeUrl()})},"a/adbix":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log"),u=e("../core/util"),a=e("../core"),f=e("../core/template"),l=e("../core/events"),c,h=!1,p=[],d={initialized:"initialized",ready:"ready",waiting:"waiting",playing:"playing",complete:"complete"},v,m=function(e){},g=function(e,t){var n=this;this.$el=r(e),this.$els={player:r(document.createElement("div")).appendTo(this.$el)},this.options=i.defaults(t,{width:100,height:100}),this._onComplete=function(){n.state=d.complete,n.emit("complete")},this._onReady=function(){n.state=d.ready,n.emit("ready")},this._onCanPlay=function(){if(n.state!==d.ready)return!1;n.state=d.waiting,n.embedder.player.pauseAd(),n.emit("waiting")}};i.extend(g.prototype,l,{_initialized:!1,eState:d,state:d.initialized,$:function(e){return this.$el.find(e)},destroy:function(){this.embedder&&this.embedder.player&&this.embedder.player.destroyPlayer(),this.off(),this.$els.player.remove()},init:function(){return a.config("adbix")||["adbixtest"].indexOf(a.config("user:name"))>-1||a.config("GET").adbix?m(this):this.emit("complete"),this},providerReady:function(){this.embedder=new c(this.$els.player[0],{videoUrl:null,playerConfig:{height:this.options.height,width:this.options.width,onlyads:!0,adsCompleted:this._onComplete,adsNotFound:this._onComplete}});try{this.embedder.player.onAdPlay(this._onCanPlay),this.embedder.player.onPlaylistComplete(this._onComplete),this.embedder.player.onReady(this._onReady),this.embedder.player.onAdClick(this._onComplete)}catch(e){}return this},play:function(){return this.state=d.playing,this.embedder.player.play(),this}}),n.exports={Adbix:g}},"adblock-detector/css-renamer":function(e,t,n){function r(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);if(t.length==0)return;var r=document.getElementsByTagName("link"),i=new RegExp("\\.("+t.join(",")+")([^-A-Za-z0-9_])","g"),s=[];for(var o=0,u=r.length;o<u;o++){var a=r[o];if(/(style_new|style2013_1|style)\.css/.test(a.href)&&a.sheet){var f=a.sheet.cssRules;for(var l=0,c=f.length;l<c;l++){var h=String(f[l].cssText);i.lastIndex=0,i.test(h)&&(i.lastIndex=0,s.push(h.replace(i,function(t,n,r){return"."+e[n]+r})))}}}s.length>0&&document.write("<style>"+s.join(";")+"</style>")}n.exports=function(){var e=cookies("ls"),t=String.fromCharCode(65+~~((new Date).getMinutes()/5));if(typeof e=="string"&&/^[A-Z][0-1]$/.test(e)&&e.substr(0,1)===t){callback(e.substr(1,1)!=="1");return}DetectAdBlock(function(e){cookies.set("ls",t+(e?"1":"0"),{expires:10800}),callback(e)})}},"adblock-detector/index":function(e,t,n){function r(e){function t(e){y===undefined&&(y=e,r(),o())}function n(e){b===undefined&&(b=e,r(),c())}function r(){b!==undefined&&y!==undefined&&e(b||y)}function i(e){v.test(this.src)&&t(!0)}function s(e){v.test(this.src)&&/\/(page|meta)\//.test(this.src)&&t(!1)}function o(){u(),delete p.adbOnerror,delete p.adbOnload,d.createElement=E,d.write=S}function u(){var e=document.getElementsByTagName("script");for(var t=0,n=e.length;t<n;t++)e[t].removeEventListener("load",s),e[t].removeEventListener("error",i)}function a(e){var t="абвгдежзиклмнопрстуфхцчшщъыьэюя",n="abcdefghijklmnopqrstuvwxyz",r=100,i=3,s=7,o=2,u=10,a=e?n:t,f=e?1:Math.floor(Math.random()*(s-i)+i),l=[];for(var c=0;c<f;c++){var h="",p=e?r:Math.floor(Math.random()*(u-o)+o);for(var d=0;d<p;d++)h+=a[Math.floor(Math.random()*a.length)];l.push(h)}return l.join(" ")}function f(){var e=m.replace("{TITLE}",a()).replace("{BODY}",a()).replace("{LINK}",a(!0));document.createElement("YATAG"),w=document.createElement("div"),w.style="position:absolute; left:-100px; top:-100px; width:100px; height:100px;",w.innerHTML=e,document.body.appendChild(w),setTimeout(function(){l(w)},g)}function l(e){try{var t=e.getElementsByClassName("yap-title-block__text"),r=e.getElementsByClassName("yap-layout__body");if(!t.length||!r.length){n(!0);return}var i=t[0].getBoundingClientRect(),s=r[0].getBoundingClientRect();if(i.width*i.height<=1||s.width*s.height<=1){n(!0);return}n(!1)}catch(o){n(!1)}}function c(){w.parentNode.removeChild(w)}function h(){try{return document.documentElement.getBoundingClientRect().width,!1}catch(e){return!0}}e=e||function(){};if(h())return;var p=window,d=document,v=/\/\/an\.yandex\.ru\/(system|resource|page|meta)\//,m='<yatag class="yap-reset"><yatag class="yap-layout yap-layout_type_vertical"><yatag class="yap-layout__logo">Яндекс.Директ</yatag><yatag class="yap-layout__wrapper"><table class="yap-layout__items"><tr><td class="yap-layout__item yap-layout__item_nth_1"><yatag class="yap-layout__outer"><yatag class="yap-layout__inner"><yatag class="yap-layout__content"><yatag class="yap-layout__title"><a class="yap-title-block__text" href="//an.yandex.ru/count/{LINK}">{TITLE}</a></yatag><yatag class="yap-layout__body">{BODY}</yatag></yatag></yatag></yatag></td></tr></table></yatag></yatag></yatag>',g=50,y,b,w,E=d.createElement,S=d.write;p.adbOnerror=i,p.adbOnload=s,d.createElement=function(){var e=E.apply(this,arguments);return e.nodeName==="SCRIPT"&&(e.addEventListener("error",i),e.addEventListener("load",s)),e},d.write=function(e){var t="<script ";if(e.indexOf(t)===0&&v.test(e)){var n=t.length;e=e.slice(0,n)+'onload="adbOnload.call(this)" onerror="adbOnerror.call(this)" '+e.slice(n)}S.apply(this,arguments)},document.addEventListener("DOMContentLoaded",f)}var i=e("cookies-js");n.exports=function(e){var t=i("ls"),n=String.fromCharCode(65+~~((new Date).getMinutes()/5));if(typeof t=="string"&&/^[A-Z][0-1]$/.test(t)&&t.substr(0,1)===n){e(t.substr(1,1)!=="1");return}r(function(t){i.set("ls",n+(t?"1":"0"),{expires:10800}),e(t)})}},"blocks/message":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log"),u,a=function(e,t,n){this._close=i.bind(this.close,this),this.$el=r(document.createElement("div")).addClass("top-message").addClass("top-message_type_"+t).hide().appendTo(n||r("body")).html(e).click(this._close)};i.extend(a.prototype,{show:function(){this.$el.show().css("top",r(window).scrollTop()).addClass("top-message_show_yes"),setTimeout(this._close,3e3)},changeTop:function(){this.$el.css("top",r(window).scrollTop())},close:function(){var e=this;if(this._destroy)return!1;this._destroy=!0,this.$el.removeClass("top-message_show_yes").addClass("top-message_show_no"),setTimeout(function(){e.$el.hide(),e.$el.remove()},300)}}),r(document).scroll(i.debounce(function(){u&&u.changeTop()},100,!0)),n.exports=function(e,t,n){u&&u.close(),u=new a(e,t,n),u.show()}},"blocks/tabs":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log"),u=function(e){var t=this;this.options=i.defaults(e,{current:0,listClass:".submenu",containerClass:".content_container",itemCurrentClass:"active",tabClass:".item_list",tabHiddenClass:"hidden"}),this.$el=this.options.$el,this.$els={list:this.$el.find(this.options.listClass),container:this.$el.find(this.options.containerClass)},this.$els.items=this.$els.list.children().click(function(){t.change(r(this).data("ref"))}),i.each(this.$els.items,function(e,n){var i=r(e);i.hasClass(t.options.itemCurrentClass)&&(t._current=n),i.data("ref",n)}),this.$els.tabs=this.$els.container.find(this.options.tabClass),(this._current>-1||this.options.current)&&this.toggle(this._current>-1?this._current:this.options.current,!0)};i.extend(u.prototype,{_current:-1,change:function(e){return this._current===e?this:(this._current!==-1&&this.toggle(this._current,!1),this.toggle(e,!0),i.isFunction(this.options.onChange)&&this.options.onChange(e),this)},toggle:function(e,t){var n=this.$els.tabs[e]?r(this.$els.tabs[e]):!1,i=this.$els.items[e]?r(this.$els.items[e]):!1;return n?(n.toggleClass(this.options.tabHiddenClass,!t),i.toggleClass(this.options.itemCurrentClass,t),t&&(this._current=e),this):this}}),n.exports={Tabs:u}},"calendar/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core"),u=e("../core/events"),a=function(){this._requestAnimation=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/24)}}(),this._isMobileView=o.config("clientType")=="mobile",this._useTouchEvent="ontouchstart"in document.documentElement;if(!this._useTouchEvent){var e=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(String(navigator.userAgent||navigator.vendor||window.opera).substr(0,4)),t=e||/ipad|android|xoom|sch-i800|playbook|kindle/i.test(navigator.userAgent||navigator.vendor||window.opera);this._useTouchEvent=t||e}this._renderCallback=i.bind(this._render,this),this._interruptCallback=i.bind(this._interrupt,this)};i.extend(a.prototype,u),i.extend(a.prototype,{_isMobileView:!1,_useTouchEvent:null,_showButtonsPanel:!0,_months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],_months2:["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],_element:null,_canvases:null,_contexts:null,_monthCache:null,_monthCacheKeys:null,_width:450,_dayCellSize:28,_requestAnimation:null,_renderCallback:null,_interruptCallback:null,_interruptTimer:null,_displayMonth:null,_timeLine:106.9,_lastTimeLine:0,_timelineProps:null,_calendarProps:null,_needRedraw:!1,_needRedrawHeadBorder:!1,_ownEventHandlers:null,_dayUnderPoiner:null,_selectedRange:null,_textWidthCache:null,_skipRollerDrag:!1,_date1:null,_date2:null,_headArrowPos:null,_datesRangeMode:!1,_gcTimer:0,_initDates:null,_minDateProps:{year:2008,month:1},_errMsgBox:null,_presetButtons:[],setDatesRangeMode:function(e){return this._datesRangeMode=e===!0,this},setDate:function(e,t){var n=this._parseDate(e),r=t?this._parseDate(t):n;if(this._calendarProps)r===null&&(r=n),this._selectedRange={from:n,to:r,force_new_range:!1},this._initDates={from:n,to:r},this._date1.val(this._getFormattedDate(n)),this._date2.val(this._getFormattedDate(r)),this._needRedraw=!0;else{if(n===null)return this._initDates=null,this;r===null&&(r=n),this._initDates={from:n,to:r}}return this},setWidth:function(e){return e=Number(e),e!=e?this:(this._width=Math.max(200,Math.min(1e3,e)),this)},showButtonsPanel:function(e){return this._showButtonsPanel=e===!0,this},getElement:function(){return this._element||this._create(),this._element[0]},getSelectedDatesCaption:function(){return this._getSelectionParams().caption},getSelectedDates:function(){return this._getSelectionParams()},isFullRangeSelected:function(){return this._getSelectionParams().caption=="всё время"},addPresetButton:function(e,t,n){return this._presetButtons.push({caption:e,callback:t,pressed:n===!0}),this},_parseDate:function(e){var t,n,r=new Date,i=(new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0)).getTime(),s=(new Date(this._minDateProps.year,this._minDateProps.month-1,1,0,0,0,0)).getTime();if(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(e)){n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/);var o=Math.min(r.getFullYear(),Math.max(parseInt(n[1]),this._minDateProps.year)),u=Math.min(12,Math.max(1,parseInt(n[2]))),a=Math.max(1,Math.min(31,parseInt(n[3])));t=new Date(o,u-1,a,0,0,0,0);if(t)return Math.min(i,Math.max(s,t.getTime()))}return null},_create:function(){this._prepareData(),this._element=r("<div>").addClass("uical"+(this._isMobileView?" uical-mobile":"")).css("width",String(this._width)+"px").append(this._createHeadPanel()).append(this._createCalendarBody()),this._datesRangeMode&&this._date1.val()==""&&this._element.find('a[data-type="all_time"]').addClass("uical-selected"),this._interrupt(),this._render()},_prepareData:function(){this._canvases={},this._contexts={},this._monthCache={},this._monthCacheKeys=[],this._displayMonth=[],this._ownEventHandlers=[],this._textWidthCache={},this._gcTimer=40,this._headArrowPos={pos:0,lastPos:0,current:0,requested:0},this._selectedRange={from:null,to:null,force_new_range:!1};var e,t=this._dayCellSize,n=new Date,r=n,i=this._minDateProps.year,s=n.getFullYear(),o=this._width;e=this._calendarProps={},e.calWidth=t*7,e.calHeight=t*9,e.headSize=t*2.5,e.cellSize2=t/2,e.oneDayMs=864e5,this._initDates&&(r=new Date(this._initDates.from),this._selectedRange.from=this._initDates.from,this._selectedRange.to=this._initDates.to,this._selectedRange.force_new_range=!0),this._timeLine=(r.getFullYear()-1970)*12+r.getMonth(),e=this._timelineProps={},e.from=i,e.to=s,e.years=s-i+1,e.yearStep=~~(t*2.3),e.fullWidth=e.yearStep*e.years,e.viewHeight=40,e.viewHeight2=e.viewHeight/2,e.viewWidth=Math.min(e.fullWidth,~~(o*.8/e.yearStep)*e.yearStep),e.x=~~((o-e.viewWidth)/2),e.y=this._calendarProps.calHeight-5,e.minTimeLine=(i-1970)*12,e.maxTimeLine=(s-1970)*12+n.getMonth(),e.maxTime=new Date(s,n.getMonth(),n.getDate(),0,0,0,0),e.viewTimeLineFrom=0,e.viewTimeLineTo=Number.MAX_VALUE,e.timeLineScrollYears=0,e.timeLineScrollYearsCurr=0,e.timeLineScrollYearsForm=0,e.timeLineScrollYearsCounter=0,e.timeLineViewScollX=0,e.timeLineViewYears=~~(e.viewWidth/e.yearStep),e.rollerWidth=30,e.rollerViewX=0,e.scaleWidth=e.fullWidth-e.rollerWidth,e.scaleMonthStep=e.scaleWidth/(e.years*12-1),e.easingTo=0,e.easingCurrent=0,e.easingFrom=0,e.moveSpeed=0,e.moveDeltaX=0,this._updateTimeline(this._timeLine,!0,!0);var u=this._timeLine;this._timeLine-=2,this._easingTimeline(u)},_easingTimeline:function(e){var t=this._timelineProps;e!=this._timeLine&&(t.easingTo=e,t.easingFrom=this._timeLine,t.easingCurrent=0,t.moveSpeed=0)},_updateTimeline:function(e,t,n){var r=this._timelineProps;e!==undefined?(t?e=Math.max(Math.min(e,r.viewTimeLineTo),r.viewTimeLineFrom):e=Math.max(Math.min(e,r.maxTimeLine),r.minTimeLine),this._timeLine=e):e=this._timeLine;if(n){var i=!0;while(i)i=!1,r.viewTimeLineFrom=Math.max(r.minTimeLine+r.timeLineScrollYearsCurr*12,r.minTimeLine),r.viewTimeLineTo=Math.min(r.viewTimeLineFrom+r.timeLineViewYears*12,r.maxTimeLine),e<r.viewTimeLineFrom+2&&r.timeLineScrollYears>=1?(r.timeLineScrollYears=Math.max(r.timeLineScrollYears-2,0),i=!0):e>r.viewTimeLineTo-2&&r.timeLineScrollYears<=r.years-r.timeLineViewYears-1&&(r.timeLineScrollYears=Math.min(r.timeLineScrollYears+2,r.years-r.timeLineViewYears),i=!0),r.timeLineScrollYearsCurr=r.timeLineScrollYears}else r.timeLineScrollYearsCounter==0&&(e<r.viewTimeLineFrom+2&&r.timeLineScrollYears>=1?(r.timeLineScrollYears=Math.max(r.timeLineScrollYears-2,0),r.timeLineScrollYearsForm=r.timeLineScrollYearsCurr,r.timeLineScrollYearsCounter=20,this._skipRollerDrag=!0):e>r.viewTimeLineTo-2&&r.timeLineScrollYears<=r.years-r.timeLineViewYears-1&&(r.timeLineScrollYears=Math.min(r.timeLineScrollYears+2,r.years-r.timeLineViewYears),r.timeLineScrollYearsForm=r.timeLineScrollYearsCurr,r.timeLineScrollYearsCounter=20,this._skipRollerDrag=!0));r.timeLineViewScollX=~~(r.timeLineScrollYearsCurr*r.yearStep),r.viewTimeLineFrom=Math.max(r.minTimeLine+r.timeLineScrollYearsCurr*12,r.minTimeLine),r.viewTimeLineTo=Math.min(r.viewTimeLineFrom+r.timeLineViewYears*12,r.maxTimeLine),r.rollerViewX=~~((e-r.minTimeLine)*r.scaleMonthStep)-r.timeLineViewScollX},_render:function(){var e=this._requestAnimation;if(this._needRedraw){var t=this._displayMonth,n=this._contexts.body,r=this._canvases.body;n.fillStyle="white",n.rect(0,0,r.width,r.height),n.fill();for(var i=0,s=t.length;i<s;i++)this._drawMonth(t[i].month,n,t[i].x,0);this._drawTimeline(n),this._needRedraw=!1}this._needRedrawHeadBorder&&(this._drawHeadBorder(),this._needRedrawHeadBorder=!1),e(this._renderCallback)},_interrupt:function(){clearTimeout(this._interruptTimer);var e=this._timelineProps,t=this._headArrowPos;if(e.moveDeltaX!=0){var n=e.moveDeltaX;n>0?(n-=.3,n<0&&(n=0)):n<0&&(n+=.3,n>0&&(n=0)),e.moveDeltaX=n}if(e.easingTo>0&&e.easingTo!=this._timeLine)this._timeLine=this._easing("cubic",++e.easingCurrent,e.easingFrom,e.easingTo,20);else if(e.moveSpeed!=0){var r=e.moveSpeed;r>0?(r-=r*.1,r<.05&&(r=0)):r<0&&(r+=-r*.1,r>-0.05&&(r=0)),this._timeLine+=r,e.moveSpeed=r}if(this._lastTimeLine!=this._timeLine){this._updateTimeline(this._timeLine);var i,s=this._dayCellSize,o=this._timeLine,u=~~o,a=s/2,f=s*8,l=f/2,c=this._width/2,h=~~(this._width/f)+4,p=-((o-u)*f),d=new Array(h),v=u-~~(h/2);for(i=0;i<h;i++)d[i]={name:"month_"+(v+i),month:v+i,x:c-h*l+i*f+a+p};this._displayMonth=d,this._needRedraw=!0,this._lastTimeLine=this._timeLine}e.timeLineScrollYears!=e.timeLineScrollYearsCurr&&(e.timeLineScrollYearsCounter>0?e.timeLineScrollYearsCurr=this._easing("cubic",20- --e.timeLineScrollYearsCounter,e.timeLineScrollYearsForm,e.timeLineScrollYears,20):e.timeLineScrollYearsCurr=e.timeLineScrollYears,this._updateTimeline(),this._needRedraw=!0),t.pos!=t.requested&&(t.pos=this._easing("elastic",++t.current,t.lastPos,t.requested,45),this._needRedrawHeadBorder=!0),--this._gcTimer==0&&(this._removeUnusedMonths(),this._gcTimer=40),this._interruptTimer=setTimeout(this._interruptCallback,1e3/24)},_removeUnusedMonths:function(){if(this._monthCacheKeys.length>this._displayMonth.length){var e=this._monthCacheKeys,t=this._displayMonth,n,r;for(var i=0,s=e.length;i<s;i++){n=!1,r=e[i];for(var o=0,u=t.length;o<u;o++)if(r==t[o].name){n=!0;break}n||(delete this._monthCache[r],delete this._canvases[r],delete this._contexts[r],e.splice(i,1),i--,s--)}}},_createHeadPanel:function(){var e=r("<div>").addClass("uical-head"),t="",n,s,o;if(this._datesRangeMode){if(this._showButtonsPanel)if(this._presetButtons.length>0){n=this._presetButtons;for(s=0,o=n.length;s<o;s++)t+='<a data-type="preset" data-idx="'+s+'" '+(n[s].pressed?'class="uical-selected"':"")+">"+n[s].caption+"</a>";e.append(r("<div>").addClass("uical-top-btns").append(t))}else e.append(r("<div>").addClass("uical-top-btns").append('<a data-type="all_time">всё время</a><a data-type="month">месяц</a><a data-type="week">неделю</a>'));e.append(r("<div>").addClass("uical-date").append(r('<input type="text" value="" maxlength="10" placeholder="ДД/ММ/ГГГГ">').attr("data-type","from").val(this._selectedRange.from?this._getFormattedDate(this._selectedRange.from):""))),e.append('<span class="uical-separator">&mdash;</span>'),e.append(r("<div>").addClass("uical-date").append(r('<input type="text" value="" maxlength="10" placeholder="ДД/ММ/ГГГГ">').attr("data-type","to").val(this._selectedRange.to?this._getFormattedDate(this._selectedRange.to):"")))}else{if(this._presetButtons.length>0&&this._showButtonsPanel){n=this._presetButtons;for(s=0,o=n.length;s<o;s++)t+='<a data-type="preset" data-idx="'+s+'" '+(n[s].pressed?'class="uical-selected"':"")+">"+n[s].caption+"</a>";e.append(r("<div>").addClass("uical-top-btns").append(t))}e.append(r("<div>").addClass("uical-arrow").attr("data-type","left").css("background-image",'URL("'+this._getArrowImageURI(!0)+'")')).append(r("<div>").addClass("uical-date").append(r('<input type="text" value="" maxlength="10" placeholder="ДД/ММ/ГГГГ">').attr("data-type","from").val(this._selectedRange.from?this._getFormattedDate(this._selectedRange.from):""))).append(r("<div>").addClass("uical-arrow").attr("data-type","right").css("background-image",'URL("'+this._getArrowImageURI(!1)+'")'))}e.append(this._createHeadBorder());var u=i.bind(this._filterDateInput,this),a=this;return e.find("a").on("click",function(){e.find("a").removeClass("uical-selected");var t=this.getAttribute("data-type");switch(t){case"all_time":case"month":case"week":case"today":a.setRangeByType(t);break;case"preset":a._presetButtons[Number(this.getAttribute("data-idx"))].callback();break;default:return}r(this).addClass("uical-selected")}),this._datesRangeMode||e.find("div[data-type]").on("click",function(){var e,t=a._date1.val();if(t==""){var n=new Date;e=(new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)).getTime(),a._date1.val(a._getFormattedDate(e))}e=a._filterDateInput(a._date1[0],!0);if(e===null){a._date1.val(t).change();return}switch(this.getAttribute("data-type")){case"left":a._date1.val(a._getFormattedDate(e-864e5));break;case"right":a._date1.val(a._getFormattedDate(e+864e5));break;default:return}a._filterDateInput(a._date1[0],!0)===null?a._date1.val(t):a._date1.change()}),e.find("input").on("keydown",function(e){e.which==13&&r(this).blur()}).on("keypress",function(e){var t=e.which>=46&&e.which<58||e.which==8||e.which==0;t||e.preventDefault()}).on("blur change",function(){var e=u(this);e!==null&&a._selectDate(e,r(this).attr("data-type"))}).on("paste",function(){i.defer(u,this)}),this._updateHeadBorder(),this._date1=r('input[data-type="from"]',e),this._datesRangeMode&&(this._date2=r('input[data-type="to"]',e)),e},setRangeByType:function(e){this._element||this._create();var t=(new Date).getTime();switch(e){default:case"all_time":var n=1970+~~(this._timelineProps.minTimeLine/12),r=this._timelineProps.minTimeLine-(n-1970)*12,i=new Date(n,r,1,0,0,0,0);this._date1.val(this._getFormattedDate(i.getTime())).change(),this._date2.val(this._getFormattedDate(t)).change();break;case"month":this._date2.val(this._getFormattedDate(t)).change(),this._date1.val(this._getFormattedDate(t-2592e6)).change();break;case"week":this._date2.val(this._getFormattedDate(t)).change(),this._date1.val(this._getFormattedDate(t-6048e5)).change();break;case"today":this._date2.val(this._getFormattedDate(t)).change(),this._date1.val(this._getFormattedDate(t)).change()}},_getArrowImageURI:function(e){var t="arrow_"+(e?"left":"right"),n=14,r=24,i=this._createCanvas(t,n*2,r),s=0;return e?(s=0,i.strokeStyle="#cacaca",i.beginPath(),i.moveTo(s+n-2,2),i.lineTo(s+2,r/2),i.lineTo(s+n-2,r-2),i.stroke(),s=n,i.strokeStyle="#217cb6",i.beginPath(),i.moveTo(s+n-2,2),i.lineTo(s+2,r/2),i.lineTo(s+n-2,r-2),i.stroke()):(s=0,i.strokeStyle="#cacaca",i.beginPath(),i.moveTo(s+2,2),i.lineTo(s+n-2,r/2),i.lineTo(s+2,r-2),i.stroke(),s=n,i.strokeStyle="#217cb6",i.beginPath(),i.moveTo(s+2,2),i.lineTo(s+n-2,r/2),i.lineTo(s+2,r-2),i.stroke()),this._canvases[t].toDataURL("image/png")},_filterDateInput:function(e,t){var n=e.value,r,i="";t===undefined&&(t=!1),n=n.replace(/[^0-9\/]/gi,"");if(n=="")return e.value="",0;if(/^[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{2,4}$/.test(n)){r=n.match(/^([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{2,4})$/);var o=parseInt(r[1]);if(o==o&&o>0&&o<=31){var u=Number(r[2]);if(u==u&&u>0&&u<=12){var a=Number(r[3]);a==a&&a<50&&(a+=2e3);if(a==a&&a>1970&&a<=3e3){var f=new Date(a,u-1,o,0,0,0,0);if(f.getDate()==o){var l=(a-1970)*12+(u-1);if(l>=this._timelineProps.minTimeLine&&l<=this._timelineProps.maxTimeLine){var c=f.getTime();return e.value=this._getFormattedDate(c),c}i="Дата выходит за диапазон календаря"}else i="Введенной даты не существует"}else i="Неправильный год"}else i="Месяц должен быть от 1 до 12"}else i="Дата дня должна быть от 1 до 31"}else i="Странный формат даты";if(i!=""&&!t){if(this._errMsgBox&&this._errMsgBox.isShown())return null;this._isMobileView?this._errMsgBox=(new s).showMessage(e,i):this._errMsgBox=(new s).append(i).setColorScheme("black").setDirection("top").setDistance(10).setTimeout(3e3).show(e)}return null},_getFormattedDate:function(e,t){if(e==0||e===null)return"";var n=new Date;n.setTime(e);var r=String(n.getDate());while(r.length<2)r="0"+r;var i=String(n.getMonth()+1);while(i.length<2)i="0"+i;var s=String(n.getFullYear());while(s.length<4)s="0"+s;return t!==!0?r+"/"+i+"/"+s:s+"-"+i+"-"+r},_createHeadBorder:function(){return this._createCanvas("border",this._width,10),r(this._canvases.border).attr("data-border","y")},_drawHeadBorder:function(){var e=this._contexts.border,t=this._headArrowPos.pos;e.clearRect(0,0,this._width,10),e.fillStyle="#ffffff",e.rect(0,0,this._width,10),e.fill(),e.fillStyle="#fdfdfd",e.beginPath(),e.moveTo(0,9.5),e.lineTo(t-5,9.5),e.lineTo(t,2.5),e.lineTo(t+5,9.5),e.lineTo(this._width,9.5),e.lineTo(this._width,0),e.lineTo(0,0),e.lineTo(0,9.5),e.closePath(),e.fill(),e.lineWidth=1,e.strokeStyle="#e5e5e5",e.beginPath(),e.moveTo(0,9.5),e.lineTo(t-5,9.5),e.lineTo(t,2.5),e.lineTo(t+5,9.5),e.lineTo(this._width,9.5),e.stroke()},_updateHeadBorder:function(){var e=this._headArrowPos,t;this._datesRangeMode?this._selectedRange.from===null||this._selectedRange.from!==this._selectedRange.to?t=~~(this._width/2-70):t=~~(this._width/2+70):t=~~(this._width/2),e.requested!=t&&(e.requested=t,e.current=0,e.lastPos=e.pos)},_createCalendarBody:function(){this._createCanvas("body",this._width,310);var e=r("<div>").addClass(".uical-body").append(this._canvases.body),t=e[0],n=this,i=!1,s=!1,o=0,u=0,a=0,f=0,l=0,c=this._timelineProps;return this._addEvent(t,this._useTouchEvent?"touchstart":"mousedown",function(e){o=n._timeLine,f=u=e.clientX||e.pageX,l=e.clientY||e.pageY,i=!0,a=c.moveDeltaX=c.moveSpeed=0,c.easingTo=0,c.easingFrom=0,c.easingCurrent=0;var r=t.getBoundingClientRect(),h=f-r.left,p=l-r.top;s=!1;if(p>=c.y&&p<c.y+c.viewHeight){var d=c.rollerViewX+c.x;h>=d&&h<=d+c.rollerWidth&&(s=!0,n._skipRollerDrag=!1)}}),this._useTouchEvent||(this._addEvent(t,this._useTouchEvent?"touchmove":"mousemove",function(e){var r="default";if(!i){f=e.clientX||e.pageX,l=e.clientY||e.pageY;var s=t.getBoundingClientRect(),o=f-s.left,u=l-s.top,a=n._getDateForPointer(o,u);a!==n._dayUnderPoiner&&(n._dayUnderPoiner=a,n._needRedraw=!0,a&&(r="pointer"));if(!a&&u>=c.y&&u<c.y+c.viewHeight){var h=c.rollerViewX+c.x;o>=h&&o<=h+c.rollerWidth&&(r="pointer")}}t.style.cursor!=r&&(t.style.cursor=r)}),this._addEvent(t,"mouseout",function(){n._dayUnderPoiner=null,n._needRedraw=!0})),this._addEvent(t,this._useTouchEvent?"touchend":"click",function(e){if(a>4)return;var r=t.getBoundingClientRect(),i=n._getDateForPointer((e.clientX||e.pageX||f)-r.left,(e.clientY||e.pageY||l)-r.top);i&&n._selectDate(i.date)}),this._addEvent(document,this._useTouchEvent?"touchmove":"mousemove",function(e){if(i){f=e.clientX||e.pageX,l=e.clientY||e.pageY;var t=f-u;if(s){if(n._skipRollerDrag){i=!1,s=!1;return}n._updateTimeline(o+t/c.scaleMonthStep,!0)}else c.moveDeltaX=-(t/(n._dayCellSize*8)),a+=Math.abs(t),n._updateTimeline(o+c.moveDeltaX,!0);e.preventDefault(),e.stopPropagation()}},!0),this._addEvent(document,this._useTouchEvent?"touchend":"mouseup",function(e){i&&(i=!1,s=!1,Math.abs(c.moveDeltaX)>.1&&(c.moveSpeed=c.moveDeltaX/2),e.preventDefault())},!0),e},_selectDate:function(e,t){var n=this._getFormattedDate(e),r=this._selectedRange,i,s;t!==undefined?t=="from"?this._datesRangeMode?(e==0?(r.from=null,r.to=null):r.from=e,r.to||(r.to=e),this._date2.val(this._getFormattedDate(r.to))):(r.from=r.to=e,this._date1.val(n)):t=="to"&&(e==0?r.to=r.from:r.to=e,e>0&&!r.from&&(r.from=e),this._date1.val(this._getFormattedDate(r.from))):this._datesRangeMode?r.from===null||r.force_new_range?(r.force_new_range=!1,r.from=e,r.to=e,this._date1.val(n),this._date2&&this._date2.val(n)):r.from===r.to?(i=r.from,r.from=Math.min(i,e),r.to=Math.max(i,e),this._date1.val(this._getFormattedDate(r.from)),this._date2&&this._date2.val(this._getFormattedDate(r.to))):(r.from=e,r.to=e,this._date1.val(n),this._date2&&this._date2.val(n)):(r.from=r.to=e,this._date1.val(n)),this._datesRangeMode&&r.from!==null&&r.from>r.to&&(i=r.from,r.from=Math.min(i,e),r.to=Math.max(i,e),this._date1.val(this._getFormattedDate(r.from)),this._date2&&this._date2.val(this._getFormattedDate(r.to))),t!==undefined&&e!=0&&(s=new Date,s.setTime(e),this._easingTimeline((s.getFullYear()-1970)*12+s.getMonth())),this._updateHeadBorder(),this._needRedraw=!0,this._datesRangeMode&&this._element.find("a.uical-selected").removeClass("uical-selected"),this.trigger("select",this._getSelectionParams())},_getSelectionParams:function(){var e,t=this._selectedRange,n=this._calendarProps,r=!1;t||(t=this._initDates);var i={caption:"",start_date:"",end_date:""};if(n&&t.from!==null){e=new Date;var s=1970+~~(this._timelineProps.minTimeLine/12),o=this._timelineProps.minTimeLine-(s-1970)*12,u=(new Date(s,o,1,0,0,0,0)).getTime(),a=(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)).getTime();r=t.from==u&&t.to==a}return!t||t.from===null||r?(i.caption="всё время",i.start_date="",i.end_date=""):t.from==t.to?(e=new Date,e.setTime(t.from),i.caption=e.getDate()+" "+this._months2[e.getMonth()]+" "+e.getFullYear(),i.start_date=i.end_date=this._getFormattedDate(t.from,!0)):(e=new Date,e.setTime(t.from),i.caption=e.getDate()+" "+this._months2[e.getMonth()]+" "+e.getFullYear(),i.start_date=this._getFormattedDate(t.from,!0),e.setTime(t.to),i.caption+=" - "+e.getDate()+" "+this._months2[e.getMonth()]+" "+e.getFullYear(),i.end_date=this._getFormattedDate(t.to,!0)),i},_addEvent:function(e,t,n,r){if(e.addEventListener){var i,s=this;i=function(e){s._useTouchEvent?e.touches!==undefined&&(e.touches.length>0&&(e.clientX=e.pageX=e.touches[0].clientX,e.clientY=e.pageY=e.touches[0].clientY),n(e)):n(e)},e.addEventListener(t,i,r===!0),this._ownEventHandlers.push({obj:e,event:t,handler:i,capture:r===!0})}},_getDateForPointer:function(e,t){var n=this._displayMonth,r=this._dayCellSize,i,s=this._monthCache,o=this._calendarProps,u=o.calWidth,a=o.calHeight,f=o.headSize,l,c=0,h,p,d,v,m=o.oneDayMs;for(var g=0,y=n.length;g<y;g++){i="month_"+n[g].month,l=n[g].x;if(e>=l&&e<=l+u&&t<=c+a&&t>=c+f&&s[i]){h=~~((e-l)/r),p=~~((t-c-f)/r),d=p*7+h,v=s[i];if(d>=v.start_cell&&d<=v.end_cell)return{name:i,cell_x:h,cell_y:p,cell_no:d,date:v.start_date+m*(d-v.start_cell)}}}return null},_drawWeekDays:function(e,t,n){if(!this._canvases.weekdays){var r,i=this._dayCellSize,s=this._createCanvas("weekdays",i*7,i),o=["пн","вт","ср","чт","пт","сб","вс"];s.fillStyle="#e5e5e5",s.font="12px Verdana, Helvetica, Arial, Tahoma";for(r=0;r<7;r++)this._drawTextInCell(o[r],r*i,0,s)}e.drawImage(this._canvases.weekdays,t,n)},_drawMonth:function(e,t,n,r){var i="month_"+e,s,o=this._dayCellSize,u=this._calendarProps,a=u.calWidth,f=u.calHeight,l=u.headSize,c=null,h=null,p=null,d,v,m=u.oneDayMs;if(!this._monthCache[i]){var g,y=this._createCanvas(i,a,f),b=1970+~~(e/12),w=e-(b-1970)*12,E=new Date(b,w,1,0,0,0,0),S=this._months,x=0,T=o*1.5,N,C=null,k=null,L=this._timelineProps.minTimeLine,A=this._timelineProps.maxTimeLine,O=this._timelineProps.maxTime,M=(new Date).toDateString(),_=null,D=E.getDay();N=E.getTime()-(D==0?7:D)*m,this._drawWeekDays(y,0,T),T+=o,p=[];for(s=0;s<6;s++){d={start_date:null,end_date:null,start_cell:0,end_cell:0},p.push(d);for(g=0;g<7;g++)v=N+ ++x*m,E.setTime(v),E.getMonth()==w&&e>=L&&e<=A&&v<=O?(y.fillStyle=g<5?"#217cb6":"#f57a59",C===null&&(C=x,c=v),k=x,h=v,d.start_date===null&&(d.start_date=v,d.start_cell=g),d.end_date=v,d.end_cell=g):y.fillStyle="#e5e5e5",this._drawTextInCell(String(E.getDate()),g*o,T+s*o,y),M===E.toDateString()&&(_=[~~(g*o),~~(T+s*o)])}y.font="16px Verdana, Helvetica, Arial, Tahoma",y.fillStyle="#8f8f91",this._drawTextInCell(S[w]+" "+String(b),0,0,y,o*7,o*2),this._monthCache[i]={start_date:c,end_date:h,start_cell:C-1,end_cell:k-1,curr_day_pos:_,weeks:p},this._monthCacheKeys.push(i)}else{var P=this._monthCache[i];c=P.start_date,h=P.end_date,_=P.curr_day_pos,p=P.weeks}_&&(t.strokeStyle="#79c36c",t.lineWidth=2,this._drawDayHighlight(t,n+_[0],r+_[1],1),t.stroke());if(this._selectedRange.from!==null){var H=this._selectedRange.from,B=this._selectedRange.to,j,F,I,q;if(H<=h&&B>=c){j=c<H?H:c,F=h>B?B:h,t.fillStyle="#eeeeec";for(s=0;s<6;s++){d=p[s];if(d.start_date!==null&&j<=d.end_date&&F>=d.start_date){I=~~((j-d.start_date)/m);if(I<0)I=d.start_cell;else{if(I>6)continue;I+=d.start_cell}q=~~((d.end_date-F)/m);if(q<=0)q=d.end_cell;else{if(q>d.end_cell)continue;q=d.end_cell-q}this._drawDayHighlight(t,n+~~(I*o),r+~~(l+s*o),q-I+1),t.fill()}}}}this._dayUnderPoiner&&this._dayUnderPoiner.name==i&&(this._selectedRange.from!==null&&this._dayUnderPoiner.date>=this._selectedRange.from&&this._dayUnderPoiner.date<=this._selectedRange.to?(t.fillStyle="#ffffff",t.strokeStyle="#217cb6"):(t.fillStyle="#ffffff",t.strokeStyle="#e0e0e0"),this._drawDayHighlight(t,n+this._dayUnderPoiner.cell_x*o,r+~~(l+this._dayUnderPoiner.cell_y*o),1),t.fill(),t.stroke()),t.drawImage(this._canvases[i],n,r)},_drawTimeline:function(e){var t=this._timelineProps,n=t.viewWidth,r=t.viewHeight;if(!this._canvases.timeline){var i=this._createCanvas("timeline",t.fullWidth,r),s=t.from,o=t.yearStep,u=10,a=4,f=t.rollerWidth-4,l=t.rollerWidth/2;i.fillStyle="#8f8f91",i.font="12px Verdana, Helvetica, Arial, Tahoma";for(var c=0;c<t.years;c++)this._drawTextInCell(String(s+c),c*o,0,i,o,20);i=this._createCanvas("timeline_line",t.fullWidth,6),i.fillStyle="#cacaca",i.beginPath(),i.moveTo(u+a,a),i.quadraticCurveTo(u,a/2,u+a,0),i.lineTo(t.viewWidth-a-u,0),i.quadraticCurveTo(t.viewWidth-u,a/2,t.viewWidth-a-u,a),i.lineTo(u+a,a),i.closePath(),i.fill(),i=this._createCanvas("timeline_roll",t.rollerWidth,t.rollerWidth+10),i.fillStyle="#ffffff",i.shadowBlur=5,i.shadowColor="rgba(0, 0, 0, .5)",i.shadowOffsetY=2,i.beginPath(),i.arc(l,l,f/2,0,Math.PI*2),i.closePath(),i.fill()}e.drawImage(this._canvases.timeline_line,t.x,t.y+15),e.drawImage(this._canvases.timeline,Math.max(0,t.timeLineViewScollX),0,Math.min(n,t.fullWidth),r,t.x,t.y+30,n,r),e.drawImage(this._canvases.timeline_roll,t.x+t.rollerViewX,t.y)},_drawDayHighlight:function(e,t,n,r){if(r==1){var i=this._dayCellSize/2;e.beginPath(),e.arc(t+i,n+i,i,0,Math.PI*2),e.closePath()}else{var s=this._dayCellSize,o=s/2,u=r*s;n++,s-=2,e.beginPath(),e.moveTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.lineTo(t+u-o,n),e.quadraticCurveTo(t+u,n,t+u,n+o),e.lineTo(t+u,n+s-o),e.quadraticCurveTo(t+u,n+s,t+u-o,n+s),e.lineTo(t+o,n+s),e.quadraticCurveTo(t,n+s,t,n+s-o),e.lineTo(t,n+o),e.closePath()}},_drawTextInCell:function(e,t,n,r,i,s){i===undefined?s=i=this._calendarProps.cellSize2:(i/=2,s/=2);var o=i,u=s,a=this._textWidthCache[e+"_"+r.font];a===undefined&&(this._textWidthCache[e+"_"+r.font]=a=r.measureText(e).width/2),r.fillText(e,~~(t+(o-a)),~~(n+u))},_createCanvas:function(e,t,n){var r=document.createElement("canvas");r.width=t,r.height=n,this._canvases[e]=r;var i=r.getContext("2d");return i.font="14px Verdana, Helvetica, Arial, Tahoma",i.textBaseline="middle",i.lineWidth=2,this._contexts[e]=i,i},_easing:function(e,t,n,r,i){var s=Math.PI*.5,o=Math.PI*2,u=n>r,a=n;u?(a=r,r=n-r,n=a):r-=n;switch(e){default:case"linear":a=r*t/i+n;break;case"cubic":u?a=r*(t/=i)*t*t+n:a=r*((t=t/i-1)*t*t+1)+n;break;case"exponential":a=t==0?n:r*Math.pow(2,10*(t/i-1))+n-r*.001,t==i&&(a=r+n);break;case"sine":u?a=-r*Math.cos(t/i*s)+r+n:a=r*Math.sin(t/i*s)+n;break;case"bounce":(t/=i)<1/2.75?a=r*7.5625*t*t+n:t<2/2.75?a=r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?a=r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:a=r*(7.5625*(t-=2.625/2.75)*t+.984375)+n;break;case"elastic":if(t==0)a=n;else if((t/=i)==1)a=n+r;else{var f=i*.3,l=f/4;a=r*Math.pow(2,-10*t)*Math.sin((t*i-l)*o/f)+r+n}}return u&&(a=n+(r+n-a)),a}}),n.exports=a},"comments/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/request"),u=e("../core/template"),a=e("momentjs"),f=e("../core/log"),l=e("../core"),c=e("../core/util"),h=e("./reply").Reply,p=e("../moderator-tools"),d=e("../popup-box"),v=e("../core/i18n"),m=e("../core/events"),g=e("./reply").eReplyType,y=e("store"),b=null,w={incoming:"incoming",outcoming:"outcoming",story:"story"},E=function(t){var n=this;this.$el=r(t.el),this.options=i.extend({type:w.story},t),this.storyId=Number(t.storyId),this._ratingSet=function(){var t=r(this),i=t.parents(".comment:first").data("id"),s=t.hasClass("comment_rating_up");if(!l.config("logged"))return e("../sign").showNeedSignin();n._setRating(i,s)},this._findNeedToScrollBind=i.bind(this._findNeedToScroll,this),this._$html=r("html, body"),this._$body=r(document.body),this.$els={container:r(".right_container_wrapper"),wrapper:r(".after_header"),next:this.$el.parent().children(".more_action").click(i.bind(this.getNextComments,this)),reply:this.$el.parent().children(".reply")},this._attachAllTools();if(this.options.type===w.outcoming||this.options.type===w.incoming)this.$els.profile={parent:this.$(".comment_parent_cont"),main:this.$(".comment_child_cont"),toggleAnswer:this.$(".reply_count").click(i.bind(this._getProfileAnswers,this)),answers:this.$(".comments-profile__answers"),showParent:this.$(".toggle-parent").click(function(e){var t=n.$els.profile.main.hasClass("comment_child_cont_indent_yes");n.$els.profile.main.toggleClass("comment_child_cont_indent_yes",!t),n.$els.profile.parent[t?"slideUp":"slideDown"](200),n.$els.profile.showParent.toggleClass("comments__show-parent",t).toggleClass("comments__hide-parent",!t)})};this._commentsMap={0:{id:0,idParent:!1,comments:this.$el,shownComments:!0,replyType:g.reply,level:0,$el:this.$el,$els:{comments:this.$el,reply:this.$els.reply,hiddenGroup:this.$el.children(".comments__hidden-group").eq(0)}}};if(l.config("logged"))switch(this.$el.data("ignore-code")){case 1:this.ignored="you-story";break;case 2:this.ignored="story-you";break;default:this.ignored=!1}this.options.type===w.story&&(l.config("logged")?this.ignored?(this.$els.reply.html('<span class="comment__error comment__error_main_yes">'+v("comments:ignore:"+this.ignored)+"</span>"),this.$(".b-comment__control-reply").addClass("b-comment__control_disable_yes")):this.$el.data("user-banned")?(this.$els.reply.html('<span class="comment__error comment__error_main_yes">'+v("comments:errors:banned")+"</span>"),this._userBanned=!0):l.config("carma")>=-100?this.toggleReply(0,!0):(this.$els.reply.html('<span class="comment__error comment__error_main_yes">'+v("comments:errors:carma")+"</span>"),this._carmaError=!0):(this.$els.reply.append(e("./templates/signin.html")),r(this.$els.reply).touch(function(){e("../sign").showNeedSignin()})),this._lastStoreCommentId=this._getStoreLastId()),this.init(!0)};i.extend(E.prototype,m,{_current:0,_currentTree:0,_lastTopPosition:0,_lastCommentId:0,_startCommentId:0,_commentsCount:0,_refreshXHR:!1,_lastNavigator:-1,_navigator:!1,_navigatorNew:!1,$:function(e){return this.$el.find(e)},_getIdComment:function(e){return Number(r(e.target).parents(".comment:first").data("id"))},_getStoreLastId:function(){var e=[];try{e=y.get("newest"),i.isObject(e)||(e={})}catch(t){}return e[this.storyId]||0},_setStoreLastId:function(e){var t=y.get("newest"),n=i.keys(t);i.isObject(t)||(t={}),n.length>100&&!t[this.storyId]&&delete n[0],t[this.storyId]=e;try{y.set("newest",t)}catch(r){}},_updateToggleAnswers:function(e){return this.$els.profile.toggleAnswer.html(e?"скрыть":"ответы"),this},_getProfileAnswers:function(){var e=this.$els.profile.toggleAnswer.data("id"),t=this.$els.profile.answers.css("display")==="none",n=this;if(this._getAnswer)return!0;this.$els.profile.answers.children().length!==0&&(this._answers=!0);if(this._answers)return this._updateToggleAnswers(t),this.$els.profile.answers.toggle(t),!0;this._getAnswer=!0,o("/ajax/comments_actions.php",{type:"POST",dataType:"json",data:{action:"get_comments_subtree",id:e}}).then(function(e){if(!e.result)return f.warn(":comments:",e.message_code,e.message),!1;n._updateToggleAnswers(t),n.$els.profile.answers.html(e.data.html).toggle(t),n.init(),n._answers=!0},function(){}).always(function(){n._getAnswer=!1})},_attachAllTools:function(){var t=this;r(this.$el).on("touch",".comment__control-ban",function(e){e.preventDefault();var t=r(e.target).parents(".comment:first").data("id");if(!t)return;var n=r(this),i=n.data("user-id");if(!i)return;(new p).showBanUserDialog(this,i,t,2)}),r(this.$el).on("touch",".comment__control-delete",function(e){e.preventDefault();var n=r(e.target).parents(".comment:first").data("id");if(!n)return;t.highlight(n,"remove",!0),(new p).addListener("complete",function(e){var r="";e?r='<div class="comment__remove">Комментарий удален. Причина: '+e+".</div>":r='<div class="comment__remove">Комментарий удален</div>',t.getComment(n).$els.content.html(r),t.highlight(n,"remove",!1)}).addListener("cancel",function(){t.highlight(n,"remove",!1)}).showDeleteCommentDialog(this,n)}),r(this.$el).on("touch",".comment__content-toggle",function(e){var t=r(e.target),n=t.parent().next(),i=!n.is(":visible");try{e.stopPropagation(),e.preventDefault()}catch(e){}n.toggle(i),t.text(i?"Скрыть комментарий":"Показать комментарий")}),r(this.$el).on("touch",".comment__control-save",function(n){if(!l.config("logged"))return e("../sign").showNeedSignin();t.saveComment(t._getIdComment(n))}),r(this.$el).on("touch",".comment__control-edit",function(e){t.toggleReply(t._getIdComment(e))}),r(this.$el).on("touch",".comment__control-remove",function(e){t.removeComment(t._getIdComment(e))}),r(this.$el).on("touch",".comment_rating_up",this._ratingSet),r(this.$el).on("touch",".comment_rating_down",this._ratingSet),r(this.$el).on("touch",".comment_hide-tree",function(e){t.toggleComments(t._getIdComment(e)),t.toggleReply(t._getIdComment(e))}),r(this.$el).on("touch",".comment__tree-hide",function(e){t.toggleComments(Number(r(e.target).parent().data("id")),!1)}),r(this.$el).on("touch",".comment__toggle",function(e){e.preventDefault(),e.stopPropagation(),t.toggleComments(t._getIdComment(e),!0)}),this.$el.on("click",".comments-toggle",function(e){var t=r(e.target);t=t.hasClass("comments-toggle")?t:t.closest(".comments-toggle"),t.hide().prev().show()});var n=function(e){if(r(e.target).hasClass("b-image"))return!0;var n=t.getComment(t._getIdComment(e));if(n.replyType===g.edit&&t._currentCommentReply!==n)return n.$els.controls.toggle(!0),this;t.toggleReply(n.id)};return r(this.$el).on("click",".comment_text",n),r(this.$el).on("click",".comment_top_box",n),r(this.$el).on("touch",".comment_new_form_close",function(e){var n=r(e.target).closest(".comment");return t.toggleReply(t._getIdComment(e),!1),!1}),this},getNextComments:function(){var t=this;return this.$els.next.addClass("loading"),e("../core/metrika").goal("load_more_comments"),this.getComments(!1).done(function(e){var n=[];if(!e.result)return f.warn(":comments:",e.message_code,e.message),t.$els.next.children(".b-comments__next-error").text(e.message),!1;i.each(e.data.comments,function(e){if(t.getComment(e.id))return!1;t.addComments(Number(e.parent_id),e.html,e.is_hidden)}),t.init(!0),t._startCommentId=e.data.last_id||t._startCommentId,f.info(":comments:",t._startCommentId,e.data.last_id),i.each(e.data.comments,function(e){e=t.getComment(e.id);var r=e.$el.parents(".comments__hidden-group:hidden").last();n.indexOf(r)===-1&&n.push(r)}),i.each(n,function(e){e.next().addClass("comments-toggle_highlight_yes"),setTimeout(function(){e.next().removeClass("comments-toggle_highlight_yes")},1400)}),n=void 0;if(e.data.comments.length===0||e.data.total<=t._commentsCount)return t.$els.next.hide();t.$els.next.children(".comments__next-count").text(String(e.data.total-t._commentsCount))}).always(function(){t.$els.next.removeClass("loading")}),this},getComments:function(t){var n=this,i;return this._refreshXHR?r.Deferred().resolve().promise():(this._refreshXHR=!0,i={action:"get_story_comments",story_id:this.storyId},i[t?"last_comment_id":"start_comment_id"]=t?this._lastCommentId:this._startCommentId,o("/ajax/comments_actions.php",{type:"POST",data:i,dataType:"json"}).always(function(){n._refreshXHR=!1,e("../gifx").initComment()}))},goToComment:function(e,t){var n=this.getComment(e);return n?(this._recurseOpen(e),this.scrollTo(e),this.highlight(e,t||"new"),this.setCurrent(e),!0):!1},_recurseOpen:function(e){var t=this.getComment(e);return t?(t.inHiddenGroup&&!t.parentHiddenGroupShown&&(t.$el.parent().is(":visible")||t.$el.parent().show().next().hide(),t.parentHiddenGroupShown=!0),!t.shownComments&&(!t.$els.toggle||t.$els.toggle.el.css("display")!=="none")&&this.toggleComments(e,!0),this._recurseOpen(t.idParent)):!1},saveComment:function(e){var t=this.getComment(e),n;return t.$els.tools.save||(t.$els.tools.save=t.$els.body.find(".comment__control-save")),n=!t.$els.tools.save.hasClass("comment__control-save_active_yes"),t._saveXHR?this:(t._saveXHR=!0,o("/ajax/comments_actions.php",{data:{action:n?"save_comment+":"save_comment-",comment_id:e}}).then(function(){t.$els.tools.save.toggleClass("comment__control-save_active_yes",n).data("saved",n)}).always(function(){t._saveXHR=!1}),this)},getComment:function(e){return this._commentsMap[e]},_setRating:function(e,t){var n=this.getComment(e),r;return n?(f.print(":comments:","user vote",n.vote,t?1:-1,n.canVote),n.vote===(t?1:-1)?this:(n.vote=n.vote+(t?1:-1),n.$els.count.find("i").length||(r=n.rating+n.vote,n.$els.count.html(r>0?"+"+r:r).toggleClass("plus",r>0).toggleClass("minus",r<0)),i.forEach(["up","down"],function(e){n.$els[e]||(n.$els[e]=n.$els.body.find(".comment_rating_"+e)),n.$els[e].toggleClass("active",n.vote===(e==="up"?1:-1))}),this._saveXHR=o("/ajax/vote_comment.php",{type:"POST",data:{comment_id:e,vote:n.vote}}).then(function(e){},function(){f.error(":comments:","send rating trouble")}),this)):this},toggleError:function(e,t,n){var r=this.getComment(e);return r.$el.find(".b-comment__control-error:first").toggle(t).html(n),this},showError:function(e){(new d).showMessage(this.$el,e,"error")},removeComment:function(t){var n=this,i=this.getComment(t);o("/ajax/comments_actions.php",{type:"POST",dataType:"json",data:{action:"delete",id:t}}).then(function(s){if(!s.result)return n.showError(s.message),n.setDisableEdit(t),!1;e("../blocks/message")("Комментарий удалён","success",r("body")),i.$el.fadeOut("normal",function(){i.$el.remove();var e=n.getComment(i.idParent);e.$els.comments.children().length<=0&&(n.toggleComments(e.id,!1),n.showToggleComments(e.id,!1))})},function(){})},toggleReply:function(t,n){var s=this.getComment(t),o;switch(s.$el.data("ignore-code")){case 1:o="you-story";break;case 2:o="story-you";break;case 3:o="you-comment";break;case 4:o="comment-you";break;default:o=this.ignored}s.$els.reply||(s.$els.reply=s.$els.body.find(".reply")),n=i.isBoolean(n)?n:this._currentCommentReply!==s,t!=0&&s.$el.toggleClass("shifted",n).css("margin-left",n?-1*s.$el.position().left:0),s.id!==0&&s.$els&&(s.$els.controls.toggle(n),s.$els.more.toggleClass("comment__more_active",n)),s.reply||(s.reply=new h(this,s)),this._currentCommentReply&&s.id!==this._currentCommentReply.id&&this._currentCommentReply.id!==0&&this.toggleReply(this._currentCommentReply.id,!1),this._currentCommentReply=this._currentCommentReply===s?!1:s;if(!l.config("logged"))return s.$els.controlSign||(s.$els.controlSign=r(e("./templates/signin.html")).appendTo(s.$els.controls).touch(function(){e("../sign").showNeedSignin()})),this;s.$els.error||(s.$els.error=s.$el.find(".comment__error"),s.$els.error.toggleClass("comment__error_main_yes",s.id===0));if(this._carmaError||o){s.$el.data("ignored",!0);if(!l.config("isUserModerator"))return s.$els.error.html(this._carmaError?v("comments:errors:carma"):v("comments:ignore:"+o)),this}return this._userBanned?(s.$els.error.html(v("comments:errors:banned")),this):(n&&s.$els.reply.insertAfter(s.replyType===g.edit?s.$els.content:s.$els.controls),s.replyType===g.edit&&s.$els.content.toggle(!n),s.replyType===g.edit&&n?r.when(s.reply.getSource()).then(function(){s.reply.toggle(n),s.reply.clear().paste(s.source)}):s.reply.toggle(n),this.options.type===w.story&&this.getComment(0).reply.toggle(!0),this._currentCommentReply&&this._currentCommentReply.id!==0&&s.$el.find(".b-comment__control-"+s.replyType+":first").text(n?v("comments:control-cancel"):v("comments:control-"+s.replyType)),this)},setDisableEdit:function(e){var t=this.getComment(e);return t.replyType=g.reply,t.$el.find(".comment__control-edit").toggle(!1),t.$el.find(".comment__control-remove").toggle(!1),this},_initComment:function(e){var t=this,n=e.parent(),s={id:Number(e.data("id")),idParent:e.data("parent-id"),shownComments:!1,canVote:!e.data("disabled"),vote:Number(e.data("vote")||0),level:e.data("level"),replyType:e.data("editable")?g.edit:g.reply,inHiddenGroup:n.hasClass("comments__hidden-group"),parentHiddenGroupShown:n.is(":visible"),$el:e,$els:{comments:e.next(),tools:{},toggle:{el:r(e.children(".comment__toggle")[0]),hide:r(e.find(".comment_hide-tree")[0])},body:e}};return i.extend(s.$els,{content:r(s.$els.body.children(".comment_text")[0]),count:s.$els.body.find(".comment_rating_count"),controls:r(s.$els.body.find(".comment_actions_box")[0]),more:r(s.$els.body.find(".comment__more")[0]),hiddenGroup:s.$els.comments.children(".comments__hidden-group").eq(0)}),this._commentsCount++,s.rating=Number(s.$els.count.html()-s.vote),s.replyType===g.edit&&(f.print(":reply:","start look change 10 min"),setTimeout(function(){t.setDisableEdit(s.id)},6e5)),e.find(".user-label").touch(function(e){var t=r(this).closest(".user-label");e.preventDefault(),e.stopPropagation(),b&&b.hide(),b=(new d).setTimeout(1e3).setModalMode(!1).setColorScheme("black"),b.append(t.attr("title")).show(t)}),s},init:function(t){var n=this,i=r(".content_container").data("user-in-comments");return this._newestCount=0,this.$(".comment").each(function(e,t){var s=r(t),o=Number(s.data("id"));if(n.getComment(o))return!0;var u=n._commentsMap[o]=n._initComment(s);o>n._lastCommentId&&(n._lastCommentId=o),u.shownComments=u.$els.comments.css("display")!=="none",n.options.type===w.story&&(u.$els.content.hasClass("comment__content_highlight_newest")?n._newestCount++:!i&&n._lastStoreCommentId&&n._lastStoreCommentId<u.id&&(n._newestCount++,u.$els.content.addClass("comment__content_highlight_newest")))}),this.options.type===w.story&&this._setStoreLastId(this._lastCommentId),this._newestCount>0&&r('<span class="comments__newest">'+(this._newestCount+" "+c.declOfNum(this._newestCount,["новый","новых","новых"]))+"</span>").appendTo(r(".comments_all_count")),this._updateAllToggleCount(),this._startCommentId=r(".comment:last").data("id"),t&&setTimeout(this._findNeedToScrollBind,500),e("../gifx").initComment(),this.emit("inited"),this},_findNeedToScroll:function(){var e=/#comment_(\d+)/gi,t=e.exec(window.location.hash),n=this,r;return window.location.hash&&!this._goToAfterStart&&t!=null&&t[1]>0&&(r=this.getComment(Number(t[1])),r?this._goToAfterStart=this.goToComment(r.id):(this._$html.animate({scrollTop:this.$els.next.offset().top-100},200),this.$els.next.removeClass("comments__next_highlight_yes").addClass("comments__next_highlight_yes"),clearTimeout(this._oldHighlight),this._oldHighlight=setTimeout(function(){n.$els.next.removeClass("comments__next_highlight_yes")},1e3))),this},addComment:function(e,t,n,s,o){var u,a=this,f,c;return!e||!i.isNumber(t)||!n||this.getComment(e)?!1:(f=this.getComment(t),f?(s?u=r(n).prependTo(f.$els.comments):f.$els.hiddenGroup&&f.$els.hiddenGroup.length?u=r(n).insertBefore(f.$els.hiddenGroup):u=r(n).appendTo(f.$els.comments),c=a._commentsMap[e]=this._initComment(u),c.level!==0&&c.level%10===0&&c.$els.comments.addClass("b-comments_new-line"),!f.shownComments&&!this._isRoot()&&this.toggleComments(f.id,o||!(l.config("max_comments_branch_depth")>0&&f.idParent+1===l.config("max_comments_branch_depth")||f.idParent!==0&&c.level%10===0)),o&&this._setStoreLastId(e),c):!1)},_isRoot:function(e){return e&&e.id===0},addComments:function(t,n,s){var o;if(!i.isNumber(t)||!n)return!1;o=this.getComment(t);if(!o)return!1;if(s){if(!o.$els.hiddenGroup||!o.$els.hiddenGroup.length)r(e("./templates/hidden-group.html")).appendTo(o.$els.comments),o.$els.hiddenGroup=o.$els.comments.children(".comments__hidden-group");r(n).appendTo(o.$els.hiddenGroup)}else o.$els.hiddenGroup&&o.$els.hiddenGroup.length?r(n).insertBefore(o.$els.hiddenGroup):r(n).appendTo(o.$els.comments);return o.shownComments||this.toggleComments(t,o.shownComments),!0},_updateToggleButton:function(e){var t=this.getComment(e);return t.id===0?this:(t.$els.toggle.el.toggle(!t.shownComments),t.$els.toggle.hide.html(t.shownComments?"&ndash;":"+"),this)},_updateToggleCount:function(e){var t=this.getComment(e);if(t.id===0)return this;if(t.$els.toggle.el.hasClass("comment__toggle_type_hidden"))return this;var n=t.$els.comments.find(".comment"),r=n.find(".comment__content_highlight_newest").length,i=n.length-r,s=(i===0?"":i)+(r>0?" +"+r:"");return t.$els.toggle.count||(t.$els.toggle.count=t.$els.toggle.el.find(".comment__toggle-count")),t.$els.toggle.el.toggleClass("comment__toggle_newest",r>0),t.$els.toggle.count.html(s),this},_updateAllToggleCount:function(){var e=this;i.each(this._commentsMap,function(t,n){e._updateToggleCount(n)})},toggleComments:function(e,t){var n=this.getComment(e);return n?(n.shownComments=t=i.isBoolean(t)?t:!n.shownComments,n.$els.toggle&&n.$els.toggle.el.hasClass("comment__toggle_type_hidden")&&n.$els.comments.children(".comments__hidden-group").show().next().hide(),n.$els.comments.toggle(t),this._updateToggleButton(e),t||this._updateToggleCount(e),this):this},toggleBranch:function(e){var t=this.getComment(e),n=t.branch=!t.branch,i;return t.$els.tools.tree||(t.$els.tools.tree=t.$els.body.find(".b-comment__tool-tree")),this._currentTree&&this._currentTree!==e&&this.toggleBranch(this._currentTree),t.$els.tools.tree.toggleClass("i-sprite--comments__branch_active",n),n?(this._currentTree=e,this.setCurrent(e)):delete this._currentTree,i=r(document).scrollTop()-t.$el.offset().top,this._toggleBranch(e,0,n),r(document).scrollTop(t.$el.offset().top+i),this},_toggleBranch:function(e,t,n){return this._toggleCommentsExcept(e,t,!n),i.isNumber(this._commentsMap[e].idParent)&&this._toggleBranch(this._commentsMap[e].idParent,e,n),this},setCurrent:function(e,t){return this._current=e,!t&&this.emit("current",e),this},_getPrev:function(e){var t,n=this._currentTree?":visible":"";if(!e||this._commentsMap[e].idParent===!1)t=this.$(".b-comment"+n+":first");else{t=this._commentsMap[e].$el.prev(".b-comment"+n+":first");if(!t||t.length===0)return this._commentsMap[e].idParent||e}return Number(t.data("id"))},_getNext:function(e,t){var n,r=this._currentTree?":visible":"";if(!e)n=this.$(".b-comment:visible:first");else{t||(n=this._commentsMap[e].$els.comments.children(".b-comment"+r+":first"));if(!n||n.length===0)n=this._commentsMap[e].$el.next(".b-comment"+r+":first");if(!n||n.length===0)return this._getNext(this._commentsMap[e].idParent,!0)}return Number(n.data("id"))},_toggleCommentsExcept:function(e,t,n){t&&this._commentsMap[e].$els.comments.children('.b-comment:not([data-id="'+t+'"])').toggle(n)},highlight:function(e,t,n){var r=this;t==="new"||t==="root"?(this.getComment(e).$els.content.addClass("comment__content_highlight_"+t),setTimeout(function(){r.getComment(e).$els.content.removeClass("comment__content_highlight_"+t).removeClass("comment__content_highlight_newest")},2e3)):t==="remove"&&this.getComment(e).$els.body.toggleClass("comment__content_highlight_remove",n)},scrollTo:function(e){e=e||this._current,this._$html.animate({scrollTop:this._commentsMap[e].$el.offset().top},200)}}),n.exports={Comments:E,eCommentsType:w}},"comments/reply":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/request"),u=e("../core/template"),a=e("momentjs"),f=e("../core/log"),l=e("../core"),c=e("../popup-box"),h=e("../core/i18n"),p=e("FileAPI"),d=e("./thumb"),v=e("autosize"),m=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=\(\)]*)?/ig,g=/(?:^|[^\wА-яЁё])(вы|вас|вами|вам|ваш|вашу|ваши|ваших|вашей|вашему|вашем|вашим)(?:$|[^\wА-яЁё])/,y=/(?:^|[^\wА-яЁё])(вы|вас|вами|вам|ваш|вашу|ваши|ваших|вашей|вашему|вашем|вашим)(?:$|[^\wА-яЁё])/g,b={reply:"reply",edit:"edit"},w={MSG_TYPE_OK:1,MSG_TYPE_INVALID_DATA:2,MSG_TYPE_FORBIDDEN:3,MSG_TYPE_ERROR:4},E=10,S=function(t,n){var s=this;this.comments=t,this.storyId=t.storyId,this.comment=n,this.comment.$els.reply||(this.comment.$els.reply=this.comment.$els.body.find(".reply")),this.$el=r(u(e("./templates/reply.html"))({id:n.id,isUserModerator:l.config("isUserModerator")&&(this.comment.replyType===b.reply||this.comment.$el.data("ignored")),accessImage:l.config("carma")>=E})).appendTo(this.comment.$els.reply.show()),this.$els={editor:this.$(".form_input"),thumbs:this.$(".comment_new_form_thumb_box"),submit:this.$(".comment_new_form_send").click(i.bind(this.replySubmit,this)),progress:this.$(".b-progressbar"),progressBar:this.$(".b-progressbar .b-progressbar__bar"),attachFile:this.$(".b-comments-reply__attach-files"),files:this.$(".comment-reply__input-files")},v(this.$els.editor),this.comment.replyType===b.reply&&l.config("isUserModerator")&&(this.$els.moderator=this.$(".comment_new_form__moderator").click(function(){if(n.$el.data("ignored"))return!0;s.$els.moderator.hasClass("comment_new_form__moderator_checked")||e("../../blocks/message")(h("comments:by-moderator"),"success"),s.$els.moderator.toggleClass("comment_new_form__moderator_checked")}),n.$el.data("auto-select")&&this.$els.moderator.click(),n.$el.data("ignored")&&s.$els.moderator.toggleClass("comment_new_form__moderator_checked"),this.$els.editor.on("blur keyup input",i.debounce(function(){var e=s.$els.editor.val();if(!s.$els.moderator.hasClass("comment_new_form__moderator_checked")||!g.test(e))return!1;s.$els.editor.val(e.replace(y,function(e){return e.charAt(0)===" "?e.charAt(0)+e.charAt(1).toUpperCase()+e.slice(2):e.charAt(0).toUpperCase()+e.slice(1)})),s.$els.editor.focus()},200))),this.files={},this.priority=[],this.badList=[],this.thumbs=new d({el:this.$els.thumbs,files:this.files,priority:this.priority,parent:this}),this.$els.files.on("change",function(e){s.inputFile(p.getFiles(e))}),this._addFile=i.bind(this.addFile,this),this.toggle(!1)};i.extend(S.prototype,{_uniqid:1,_autosize:function(){this.$els.editor.height(1),this.$els.editor.height(this.$els.editor[0].scrollHeight-20)},paste:function(e){return this.$els.editor.val(this.$els.editor.html(e).text()),this._autosize(),this},clear:function(){return this.$els.editor.val(""),this},shown:!1,$:function(e){return this.$el.find(e)},toggle:function(e){return e=i.isBoolean(e)?e:!this.shown,this.$el.toggle(e),this.shown=e,!0},checkUrl:function(){var e=this.$els.editor.html(),t,n=[];while((t=m.exec(e))!=null)n.push(t[0]);return i.each(i.union(n),function(e){this.addFileUrl(e)},this),this},inputFile:function(e){this._currentDragType="dragleave",this._currentDragState=!1,p.each(e,this._addFile)},addFile:function(e){var t,n=this;return this.$els.files.val(""),this._extractDuplicateFiles(e,"file")?!1:(p.getInfo(e,function(i,s){if(i||r.isEmptyObject(s)||!s.width)return!1;if(n.checkMaxCount())return n.$els.errors.text("можно прикрепить не более 10 изображений"),!1;t=n._uniqid++,n.files[t]={file:e,type:"file"},p.Image(e).preview(50).get(function(e,r){if(e)return f.error(e),!1;n.thumbs.add(r,t)})}),!0)},addFileUrl:function(e,t){var n,i,s=this,o;if(this.badList.indexOf(e)>-1)return!1;o=function(){if(s.checkMaxCount())return s.$els.errors.text("Можно прикрепить не более 10 изображений"),!1;n=s._uniqid++,s.files[n]={file:e,type:t?"old":"url"},s.thumbs.add(e,n),i.remove()};if(this._extractDuplicateFiles(e,"url"))return!1;i=r(document.createElement("img")).error(function(){s.badList.push(e)}).attr("src",e).addClass("b-thumb__preview__image").load(o),i.complete&&o()},_extractDuplicateFiles:function(e,t){var n=!1,i=this,s=t==="file"?"_fileCompare":"_urlCompare";return r.each(this.files,function(r,o){return o.type===t&&i[s](o.file,e)?(n=!0,!1):!0}),n},showError:function(e){(new c).showMessage(this.$el,e,"error")},_urlCompare:function(e,t){return e===t},_fileCompare:function(e,t){return e.size===t.size&&e.name===t.name},checkMaxCount:function(){return i.size(this.files)>=10},replySubmit:function(e){var t=this,n=r.trim(this.$els.editor.val());e&&e.preventDefault&&e.preventDefault();if(this._sending)return!1;this._countTry=0;if(n.replace(/<(b|strong|i|quote)>([ \t\r\n]*)<\/(b|strong|i|quote)>/gim,"").length===0&&this.thumbs.priority.length===0)return this.showError(h("comments:errors:empty")),!1;i.each(this.files,function(e){if(e.type!=="url")return!1;n=n.replace(new RegExp(e.file,"g"),"")}),this.replyButtonToggle(!0),this.startUpload().then(function(e){if(!e)return t.replyButtonToggle(!1),!1;t._formData={action:t.comment.replyType===b.reply?"create":"edit",story_id:t.storyId,desc:n||" ",plain_text:!0,images:JSON.stringify(i.isArray(e)?e:[])},l.config("isUserModerator")&&(t.$els.moderator&&t.$els.moderator.hasClass("comment_new_form__moderator_checked")||t.comment.replyType===b.edit&&t.comment.$el.find(".post__user_author_comment").first().text()==="moderator")&&(t._formData.by_moderator=!0),t.comment.replyType===b.reply?t._formData.parent_id=t.comment.id:t._formData.id=t.comment.id,t.sendRequest()})},getSource:function(){var e=this;return i.isString(this.comment.source)?!0:o("/ajax/comments_actions.php",{type:"POST",dataType:"json",data:{action:"get_comment_data",id:this.comment.id}}).then(function(t){if(!t.result)return f.warn(":comments:",t.message_code,t.message),!1;try{e.comment.source=t.data.source.replace(/<(\/p|br\/?)>/gi,"\n").replace(/<(?:.|\n)*?>/gm,"")}catch(n){}i.isArray(t.data.images)&&i.each(t.data.images,function(t){e.comment.reply.addFileUrl(t,!0)})},function(){})},replySuccess:function(t){var n,s;this.replyButtonToggle(!1);if(!t.result)return this.showError(t.message),this.comment.replyType===b.edit&&(t.message_type===w.MSG_TYPE_FORBIDDEN||t.message_type===w.MSG_TYPE_ERROR)&&this.comments.setDisableEdit(this.comment.id),!0;if(this.comment.replyType===b.edit)n=r(t.data.html).find(".comment_text").html(),s=this.comment,this.comment.$els.content.html(n);else{s=this.comments.addComment(Number(t.data.comment_id),this.comment.id,t.data.html,this.comment.id!==0,!0);try{s.reply=new S(this.comments,s)}catch(o){}this.comment.reply.clear()}e("../gifx").initComment(),s.source=t.data.plain||t.data.source,this.comments.highlight(s.id,"new",!0),i.each(t.data.images,function(e){s.reply.addFileUrl(e,!0)}),this.replyButtonToggle(!1),this.comments.toggleReply(this.comment.id,!1)},replyFail:function(e){var t=this;this._countTry===2?this.showError(e.message||"Произошла неизвестная ошибка. Возможно, отсутствует интернет или соединение с сервером."):setTimeout(function(){t.sendRequest()},2e3)},sendRequest:function(){var e=this;this._countTry++,this._countTry>2&&!this._formData&&this.replyFail({message:"Произошла неизвестная ошибка. Возможно, отсутствует интернет или соединение с сервером."}),o("/ajax/comments_actions.php",{type:"POST",data:this._formData,dataType:"json"}).then(i.bind(this.replySuccess,this),i.bind(this.replyFail,this)).always(function(){e._countTry===2&&e.replyButtonToggle(!1)})},replyButtonToggle:function(e){this.$els.submit.toggleClass("comment_new_form_send_progress",e).prop("disabled",e),this._sending=e},upload:function(e){var t=r.Deferred(),n=this;return e.type==="old"?(e.result={status:1,message:e.file},e.progress=100,n.progress(),t.resolve(),t.promise()):e.type==="url"?(e.progress=10,e.simulateProgress=setInterval(function(){e.progress=e.progress+5,n.progress()},1e3),o(l.config("upload_server_url")+"/ajax/upload_file.php",{type:"POST",dataType:"json",xhrFields:{withCredentials:!0},data:r.param({type:"comment_image",url:e.file})}).then(function(t){e.result={status:t.result,message:t.result?t.data.tmp_file_name:t.message},e.progress=100,n.progress()},function(){e.result={status:0,message:"Непредвиденная ошибка"},e.progress=100,n.progress()}).always(function(){clearInterval(e.simulateProgress),t.resolve()}),t.promise()):(p.withCredentials=!0,p.upload({url:l.config("upload_server_url")+"/ajax/upload_file.php",type:"POST",headers:{"X-Csrf-Token":l.config("token")},contestType:"multipart/form-data",dataType:"json",data:{type:"comment_image",uid:0},files:[e.file],progress:function(t){e.progress=t.loaded/t.total*100,n.progress()},complete:function(r,i){var s;if(r)return e.result={status:!1,message:i.status===413?"Ошибка. Максимально допустимый размер файла: 10МБ":"Ошибка. Максимально допустимый размер файла: 10МБ"},t.resolve(),!1;try{s=JSON.parse(i.response),e.result={status:s.result,message:s.result?s.data.tmp_file_name:s.message},e.progress=100,n.progress()}catch(o){}t.resolve()}}),t.promise())},startUpload:function(){var e=r.Deferred(),t=[],n=this;return this.toggleProgress(!0).progress(),r.each(this.files,function(e,r){t.push(n.upload(r))}),r.when.apply(this,t).then(function(){e.resolve(n.endUpload())}),e.promise()},endUpload:function(){var e=[],t,n=this;return this.toggleProgress(!1),r.each(this.thumbs.getPriority(),function(r,i){var s=n.files[i];if(!s.result||!s.result.message)return!0;if(!s.result.status)return t=(t?t+"<br>":"")+s.result.message,s.thumb.remove(),!0;s.result.message&&e.push(s.result.message)}),t?(n.showError(t),!1):(this.thumbs.removeAll(),e)},progress:function(e){var t=e?1:0,n=e||0;return typeof e=="undefined"&&r.each(this.files,function(e,r){n+=r.progress||0,t++}),this.$els.progressBar.width((t===0?100:n/t)+"%"),this},toggleProgress:function(e){return this.$els.progress.toggle(typeof e=="boolean"?e:!1),this},destroy:function(){}}),n.exports={Reply:S,eReplyType:b}},"comments/thumb":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log"),u=e("jquery-sortable"),a=s.View.extend({tagName:"li",className:"b-thumb",constructor:function(e,t){this.id=t,this.$image=e,s.View.apply(this)},render:function(){var e=this;return this.$el.attr("data-id",this.id).hide(),this.$el.bind({mousedown:function(){e.$el.addClass("b-thumb_dragged_start")},mouseup:function(){e.$el.removeClass("b-thumb_dragged_start")}}),this.$els={closeButton:r(document.createElement("div")).addClass("b-thumb__remove").appendTo(this.$el).click(function(){e.remove(!0)}),previewWrap:r(document.createElement("div")).addClass("b-thumb__preview").appendTo(this.$el)},i.isString(this.$image)?this.$els.previewWrap.css("background-image",'url("'+this.$image.replace("big_size_comm_an","previews_gif_comm")+'")'):this.$els.previewWrap.append(this.$image),this},remove:function(e){var t=this;return this.$el.hide(150,function(){s.View.prototype.remove.apply(t,arguments),t.trigger("destroy",t.id,e)}),this},show:function(){return this.$el.show(150),this},appendTo:function(e){return this.$el.appendTo(e),this}}),f=s.View.extend({className:"b-thumbs",tagName:"ul",constructor:function(e){this.files=e.files||{},this.priority=i.isUndefined(e.priority)?[]:e.priority,this.parent=e.parent,s.View.apply(this,arguments),this.render()},render:function(){var e;return this},add:function(e,t){return this.$el.show(),this.files[t].thumb=new a(e,t),this.files[t].thumb.render().on("destroy",i.bind(this.remove,this)).appendTo(this.$el).show(),this.getPriority(),this},remove:function(e,t){this.files[e].type==="url"&&this.parent.badList.push(this.files[e].file),delete this.files[e].thumb,delete this.files[e].file,delete this.files[e],t&&(this.getPriority(),this.priority.length===0&&this.$el.hide())},removeAll:function(){this.$el.hide(),i.each(this.files,function(e){e.thumb.remove()}),this.getPriority()},getPriority:function(){return this.priority=i.map(this.$el.children(),function(e){return r(e).data("id")})}});n.exports=f},"common/temporary":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log");o.print(":common:","temporary loaded")},"communities-core/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../popup-box"),u=e("../core/request"),a=e("../core/events"),f=function(){};i.extend(f.prototype,a,{_isLocked:!1,build:function(){this._buildPage(),this._isLocked=Number(r(".b-community-header").data("locked"))==1},_showLockError:function(e){e("Действите заморожено")},_buildPage:function(){},subscribe:function(e,t,n,r){var i={id:e};u("/ajax/communities_actions.php?action=subs"+encodeURIComponent(t?"+":"-"),{data:i,method:"post",dataType:"json"}).then(function(e){e.result?n():r(e.message)},function(){r("Ошибка при выполнении запроса")})},ignore:function(e,t,n,r){var i={id:e};u("/ajax/communities_actions.php?action=ignore"+encodeURIComponent(t?"+":"-"),{data:i,method:"post",dataType:"json"}).then(function(e){e.result?n():r(e.message)},function(){r("Ошибка при выполнении запроса")})},processStoryInQueue:function(e,t,n,r,i){var s={id:e,qid:t};u("/ajax/communities_actions.php?action="+(n?"allow":"deny")+"_story_in_queue",{data:s,method:"post",dataType:"json"}).then(function(e){e.result?r():i(e.message)},function(){i("Ошибка при выполнении запроса")})},getComporatorResultForQueue:function(e,t,n,r){u("/ajax/communities_actions.php",{type:"POST",data:{action:"get_duplicates_in_queue",id:e,qid:t}}).then(function(e){e.result?n(e.data):r(e.message)},function(){r("Ошибка при выполнении запроса")})},voteForCurrentAdmin:function(e,t,n,r){var i={id:e,flag:t?"1":"0"};u("/ajax/communities_actions.php?action=vote_current_admin",{data:i,method:"post",dataType:"json"}).then(function(e){e.result?n():r(e.message)},function(){r("Ошибка при выполнении запроса")})},voteForNewAdmin:function(e,t,n,r,i){var s={id:e,user_name:t,as_new:n?"1":"0"};u("/ajax/communities_actions.php?action=vote_new_admin",{data:s,method:"post",dataType:"json"}).then(function(e){e.result?r():i(e.message)},function(){i("Ошибка при выполнении запроса")})},cancelVotingCandidate:function(e,t,n){var r={id:e};u("/ajax/communities_actions.php?action=cancel_candidate",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t():n(e.message)},function(){n("Ошибка при выполнении запроса")})},_uploadBgImage:function(e,t,n,i){if(this._isLocked){this._showLockError(i);return}if(!t.type.match("image.*")){i("Выбран неправильный формат файла");return}var o=new FormData;o.append("img",t,t.name),r.ajax({url:s.config("upload_server_url")+"/ajax/upload_file.php?type=community_header_bg&uid=img&save=1&community_id="+e,type:"POST",data:o,cache:!1,dataType:"json",processData:!1,contentType:!1,xhrFields:{withCredentials:!0},success:function(e){e.result?n(e.data.small.file_url):i(e.message)},error:function(){i("Ошибка при загрузке изображения")}})},_dropBgImage:function(e,t,n){if(this._isLocked){this._showLockError(n);return}var r={id:e};u("/ajax/communities_actions.php?action=drop_header_bg",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t&&t():n&&n(e.message)},function(){n&&n("Ошибка при выполнении запроса")})},formatNumber:function(e,t){var n=Number(e),r=e.substr(-1,1);return n>=11&&n<=14?e+" "+t[2]:r=="1"?e+" "+t[0]:r=="2"||r=="3"||r=="4"?e+" "+t[1]:e+" "+t[2]}}),n.exports=f},"community-editor-core/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../popup-box"),u=e("../core/request"),a=e("../core/events"),f=function(){};i.extend(f.prototype,a,{_communityID:0,_isLocked:!1,build:function(){this._buildPage();var e=r(".b-community-editor");this._communityID=Number(e.data("community-id"))||0,this._isLocked=Number(e.data("locked"))==1},_buildPage:function(){},_showLockError:function(e){e("Действите заморожено")},_getFormData:function(e,t){var n={},i=this,s=!0;return t=t||function(){return!0},r(".community-error").hide(),e.find("input[name], textarea[name], select[name], div[contenteditable][name]").each(function(){if(!s)return;var e=r(this),o=e.attr("name"),u=e[0].tagName=="DIV"?e.html():e.val(),a=e.attr("type");if(a=="text"){var f=Number(e.attr("data-minlength"))||0,l=u.replace(/[^A-ZА-Яа-я0-9Ёё]/gi,"").length;if(l<f){i._showErrorForField(e,"Введите минимум "+f+" символа"),s=!1;return}}else a=="checkbox"?u=e.prop("checked")?"1":"0":e[0].tagName=="DIV"&&(u=u.replace(/<[^>]+>/g,"").replace(/\s+/g,"").length==0?"":u);var c=t(o,u);if(typeof c=="string"&&c.length>0){i._showErrorForField(e,c),s=!1;return}n[o]=u}),s?n:null},_showErrorForField:function(e,t){var n=e.attr("name")||e.attr("id"),i=n?r('.community-error[data-for="'+n+'"]'):null;i.length>0?(i.find("span").text(t),i.show()):(new o).showMessage(e,t,"warning")},_uploadAvatar:function(e,t,n){if(this._isLocked){this._showLockError(n);return}if(!e.type.match("image.*")){n("Выбран неправильный формат файла");return}var i=new FormData;i.append("img",e,e.name),r.ajax({url:s.config("upload_server_url")+"/ajax/upload_file.php?type=community_avatar&uid=img",type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,xhrFields:{withCredentials:!0},success:function(e){e.result?t(e.data.tmp_file_url,e.data.tmp_file_name):n(e.message)},error:function(){n("Ошибка при загрузке изображения")}})},_createCommunity:function(e,t,n){var r=this._getFormData(e,function(e,t){if(e=="link")if(!/^[a-z0-9_]+$/i.test(t)||!/^[^_].+[^_]$/.test(t)||t.indexOf("__")>=0)return"Ссылка на сообщество может состоять только из символов латинского алфавита, цифр и знака подчеркивания. Например: funny_cats"});if(!r)return;u("/ajax/communities_actions.php?action=create",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.id):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_editCommunity:function(e,t,n){if(this._isLocked){this._showLockError(n);return}var r=this._getFormData(e,function(e,t){});if(!r)return;r.id=this._communityID,u("/ajax/communities_actions.php?action=edit",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.id):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_loadBanList:function(e,t,n,r){var i={user_name:e,from_id:t||0};i.id=this._communityID,u("/ajax/communities_actions.php?action=get_ban_list",{data:i,method:"post",dataType:"json"}).then(function(e){e.result?n(e.data.data,e.data.has_more):r(e.message)},function(){r("Ошибка при выполнении запроса")})},_cancelBan:function(e,t,n){if(this._isLocked){this._showLockError(n);return}var r={user_id:e};r.id=this._communityID,u("/ajax/communities_actions.php?action=cancel_ban",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data,e.data.has_more):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_addModeratorByName:function(e,t,n){if(this._isLocked){this._showLockError(n);return}if(!/^[a-z0-9_.]{3,16}$/i.test(e)){n("Введен неверный ник пользователя");return}var r={user_name:e};r.id=this._communityID,u("/ajax/communities_actions.php?action=add_moderator",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_deleteModerator:function(e,t,n){if(this._isLocked){this._showLockError(n);return}var r={user_id:e};r.id=this._communityID,u("/ajax/communities_actions.php?action=delete_moderator",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_addTrustedUserByName:function(e,t,n){if(this._isLocked){this._showLockError(n);return}if(!/^[a-z0-9_.]{3,16}$/i.test(e)){n("Введен неверный ник пользователя");return}var r={user_name:e};r.id=this._communityID,u("/ajax/communities_actions.php?action=add_trusted_user",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data,e.data.has_more):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_loadTrustedUsersList:function(e,t,n){var r={from_id:e||0};r.id=this._communityID,u("/ajax/communities_actions.php?action=get_trusted_users_list",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data,e.data.has_more):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_deleteTrustedUser:function(e,t,n){if(this._isLocked){this._showLockError(n);return}var r={user_id:e};r.id=this._communityID,u("/ajax/communities_actions.php?action=delete_trusted_user",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_loadHistory:function(e,t,n){var r={from_time:e||0};r.id=this._communityID,u("/ajax/communities_actions.php?action=get_history",{data:r,method:"post",dataType:"json"}).then(function(e){e.result?t(e.data.data,e.data.has_more):n(e.message)},function(){n("Ошибка при выполнении запроса")})},_formatNumber:function(e,t){e=String(e);var n=Number(e),r=e.substr(-1,1);return n>=11&&n<=14?e+" "+t[2]:r=="1"?e+" "+t[0]:r=="2"||r=="3"||r=="4"?e+" "+t[1]:e+" "+t[2]}}),n.exports=f},"compare/fake":function(e,t,n){n.exports={text:[{type:"text",story_url:"http://pikabu.ru/story/pro_svideteley_3740173",story_title:"Про свидетелей",story_time:1445955111,text_before:"Спорили с приятелем на счет ценности свидетельских показаний и я вспомнил одну историю.<br>Однажды в ",text_after:" преподаватель также спокойно и монотонно говорит, чтобы мы достали листочки и описали нападавшего. Стоит ли говорить, что из 50 присутствовавших на лекции никто даже не приблизился к истине в описании &quot;нападавшего&quot;. Лично я сидел в первых рядах, и мое описание было настолько далеко, что когда &quot;нападавший&quot; вошел в аудиторию для сравнения описаний, было очень стыдно.<br>Так нам наглядно объяснили значение фразы &quot;Врет, как очевидец&quot;",text:"универе сидели мы на лекции по криминалистике. Преподаватель монотонно что-то не очень интересное рассказывал про тактику допроса свидетелей. И вдруг посреди лекции в аудиторию врывается нечто то ли с пистолетом, то ли с ножом, хватает студента с первой парты и выволакивает в коридор. Все в шоке. А",relevance:84,is_gtext:!0},{type:"text",story_url:"http://pikabu.ru/story/_195266",story_title:"Черный Юмор",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_822190",story_title:"Солдат знает - осторожность превыше всего",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_357585",story_title:"Привет сосед!",story_time:1445955111,text_before:"прикольный способ отомстить особенно шумным и посубботоивоскресеньямпослеодиннадцати достающим<br>",text_after:"",text:"ссылка в комментах",relevance:33},{type:"text",story_url:"http://pikabu.ru/story/pro_svideteley_3740173",story_title:"Про свидетелей",story_time:1445955111,text_before:"Спорили с приятелем на счет ценности свидетельских показаний и я вспомнил одну историю.<br>Однажды в ",text_after:" преподаватель также спокойно и монотонно говорит, чтобы мы достали листочки и описали нападавшего. Стоит ли говорить, что из 50 присутствовавших на лекции никто даже не приблизился к истине в описании &quot;нападавшего&quot;. Лично я сидел в первых рядах, и мое описание было настолько далеко, что когда &quot;нападавший&quot; вошел в аудиторию для сравнения описаний, было очень стыдно.<br>Так нам наглядно объяснили значение фразы &quot;Врет, как очевидец&quot;",text:"универе сидели мы на лекции по криминалистике. Преподаватель монотонно что-то не очень интересное рассказывал про тактику допроса свидетелей. И вдруг посреди лекции в аудиторию врывается нечто то ли с пистолетом, то ли с ножом, хватает студента с первой парты и выволакивает в коридор. Все в шоке. А",relevance:84,is_gtext:!0},{type:"text",story_url:"http://pikabu.ru/story/_195266",story_title:"Черный Юмор",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_822190",story_title:"Солдат знает - осторожность превыше всего",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_357585",story_title:"Привет сосед!",story_time:1445955111,text_before:"прикольный способ отомстить особенно шумным и посубботоивоскресеньямпослеодиннадцати достающим<br>",text_after:"",text:"ссылка в комментах",relevance:33},{type:"text",story_url:"http://pikabu.ru/story/pro_svideteley_3740173",story_title:"Про свидетелей",story_time:1445955111,text_before:"Спорили с приятелем на счет ценности свидетельских показаний и я вспомнил одну историю.<br>Однажды в ",text_after:" преподаватель также спокойно и монотонно говорит, чтобы мы достали листочки и описали нападавшего. Стоит ли говорить, что из 50 присутствовавших на лекции никто даже не приблизился к истине в описании &quot;нападавшего&quot;. Лично я сидел в первых рядах, и мое описание было настолько далеко, что когда &quot;нападавший&quot; вошел в аудиторию для сравнения описаний, было очень стыдно.<br>Так нам наглядно объяснили значение фразы &quot;Врет, как очевидец&quot;",text:"универе сидели мы на лекции по криминалистике. Преподаватель монотонно что-то не очень интересное рассказывал про тактику допроса свидетелей. И вдруг посреди лекции в аудиторию врывается нечто то ли с пистолетом, то ли с ножом, хватает студента с первой парты и выволакивает в коридор. Все в шоке. А",relevance:84,is_gtext:!0},{type:"text",story_url:"http://pikabu.ru/story/_195266",story_title:"Черный Юмор",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_822190",story_title:"Солдат знает - осторожность превыше всего",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_357585",story_title:"Привет сосед!",story_time:1445955111,text_before:"прикольный способ отомстить особенно шумным и посубботоивоскресеньямпослеодиннадцати достающим<br>",text_after:"",text:"ссылка в комментах",relevance:33},{type:"text",story_url:"http://pikabu.ru/story/pro_svideteley_3740173",story_title:"Про свидетелей",story_time:1445955111,text_before:"Спорили с приятелем на счет ценности свидетельских показаний и я вспомнил одну историю.<br>Однажды в ",text_after:" преподаватель также спокойно и монотонно говорит, чтобы мы достали листочки и описали нападавшего. Стоит ли говорить, что из 50 присутствовавших на лекции никто даже не приблизился к истине в описании &quot;нападавшего&quot;. Лично я сидел в первых рядах, и мое описание было настолько далеко, что когда &quot;нападавший&quot; вошел в аудиторию для сравнения описаний, было очень стыдно.<br>Так нам наглядно объяснили значение фразы &quot;Врет, как очевидец&quot;",text:"универе сидели мы на лекции по криминалистике. Преподаватель монотонно что-то не очень интересное рассказывал про тактику допроса свидетелей. И вдруг посреди лекции в аудиторию врывается нечто то ли с пистолетом, то ли с ножом, хватает студента с первой парты и выволакивает в коридор. Все в шоке. А",relevance:84,is_gtext:!0},{type:"text",story_url:"http://pikabu.ru/story/_195266",story_title:"Черный Юмор",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_822190",story_title:"Солдат знает - осторожность превыше всего",story_time:1445955111,text_before:"",text_after:"",text:"Ссылка в коментах",relevance:100},{type:"text",story_url:"http://pikabu.ru/story/_357585",story_title:"Привет сосед!",story_time:1445955111,text_before:"прикольный способ отомстить особенно шумным и посубботоивоскресеньямпослеодиннадцати достающим<br>",text_after:"",text:"ссылка в комментах",relevance:33}],image:[{type:"image",img_type:1,story_url:"http://pikabu.ru/story/prints_saudovskoy_aravii_zaderzhan_v_ayeroportu_beyruta_s_2_tonnami_narkotikov_3737538",story_title:"Принц Саудовской Аравии задержан в аэропорту Бейрута с 2 тоннами наркотиков",image_url:"http://cs5.pikabu.ru/post_img/2015/10/26/7/1445860115_1694875487.jpeg",preview_url:"",width:"497",height:"404",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:100,is_gtext:!0},{type:"image",img_type:1,story_url:"http://pikabu.ru/story/oldfaga_grust_3381677",story_title:"Олдфага грусть)",image_url:"http://cs4.pikabu.ru/post_img/2015/06/01/6/1433147133_1563825322.jpg",preview_url:"",width:"600",height:"582",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:100},{type:"image",img_type:3,story_url:"http://pikabu.ru/story/khotel_sdelat_post_s_tegom_quotkogda_lyudi_uznayut_chto_ya_izquot_no_chet_priunyil_3151691",story_title:"Хотел сделать пост с тегом &quot;когда люди узнают, что я из...&quot;, но чет приуныл",image_url:"http://cs5.pikabu.ru/post_img/2015/03/09/10/1425918207_1021123917.jpg",preview_url:"",width:"600",height:"582",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:100},{type:"image",img_type:1,story_url:"http://pikabu.ru/story/meynstrim_1937032",story_title:"Мейнстрим",image_url:"http://cs2.pikabu.ru/post_img2/2014/02/04/6/1391501934_1616022410.jpeg",preview_url:"",width:"497",height:"404",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:98},{type:"image",img_type:1,story_url:"http://pikabu.ru/story/yetu_kartinku_ya_posvyashchayu_vsem_politologam_s_postami_pro_khokhlosrach_i_bombezhki_v_sirii_3688430",story_title:"Эту картинку я посвящаю всем политологам с постами про хохлосрач и бомбежки в Сирии",image_url:"http://cs5.pikabu.ru/post_img/2015/10/04/10/1443976272_432116882.jpeg",preview_url:"",width:"497",height:"404",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:97},{type:"image",img_type:1,story_url:"http://pikabu.ru/story/v_svete_poslednikh_sobyitiy_1750911",story_title:"В свете последних событий.",image_url:"http://cs.pikabu.ru/post_img/2013/12/04/10/1386174371_843989572.jpeg",preview_url:"",width:"497",height:"404",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:97},{type:"image",img_type:1,story_url:"http://pikabu.ru/story/zdes_byil_bayan__2133883",story_title:"Здесь был баян =)",image_url:"http://cs4.pikabu.ru/post_img/2014/04/01/8/1396356994_251551265.jpeg",preview_url:"",width:"497",height:"404",frg_x:0,frg_y:0,frg_width:0,frg_height:0,relevance:96},{type:"image",img_type:2,story_url:"http://pikabu.ru/story/volgograd_opyat_koshki_2456432",story_title:"Волгоград! Опять кошки",image_url:"http://cs7.pikabu.ru/post_img/2014/07/07/11/1404759057_1317782973.jpg",preview_url:"",width:"600",height:"3906",frg_x:0,frg_y:764,frg_width:596,frg_height:484,relevance:66}],video:[{type:"video",story_url:"http://pikabu.ru/story/prikol_na_amerikanskoy_peredache_sto_k_odnomu_2_3740667",story_title:"Прикол на американской передаче Сто к одному #2",story_time:1445968744,video_emb_url:"http://www.youtube.com/embed/1ET76L9oD4s",video_host:"youtube",video_id:"1ET76L9oD4s",video_ratio:1.7,preview_url:"http://s4.pikabu.ru/video/2015/10/27/10/1445968743_240.jpg",relevance:100,is_gtext:!0},{type:"video",story_url:"http://pikabu.ru/story/prikol_na_amerikanskoy_peredache_sto_k_odnomu_2_3740667",story_title:"Прикол на американской передаче Сто к одному #2",story_time:1445968744,video_emb_url:"http://www.youtube.com/embed/1ET76L9oD4s",video_host:"youtube",video_id:"1ET76L9oD4s",video_ratio:1.7,preview_url:"http://s4.pikabu.ru/video/2015/10/27/10/1445968743_240.jpg",relevance:100}]}},"compare/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/util"),f=e("../core/log"),l=e("../core/layout"),c=e("../core/template"),h=e("../core/request"),p=e("./item"),d=e("./source").Model,v=e("./storage").Storage,m=e("../core/enums"),g=e("../core/i18n"),y=5,b={video:1,image:1,text:3},w=i.reduce(b,function(e,t){return e<t?t:e}),E=s.Collection.extend({model:d,comparator:function(e,t){return e.get("type")==="text"?-1:1}}),S=s.View.extend({className:"b-compare",initialize:function(e){this.options=i.defaults(e,{}),this._collection=new p.Collection,this.listenTo(this._collection,"add",this._addItem),this._sources=new E,this.render(),this._changeSource();var t=i.debounce(i.bind(this._changeSource,this),300);this.listenTo(this._sources,"add",t),this.listenTo(this._sources,"remove",t),this.listenTo(this._sources,"wait",i.bind(this._changeWait,this)),this.options.blocks&&(this.listenTo(this.options.blocks,"compare:state",i.bind(this._changeState,this)),this.listenTo(this.options.blocks,"compare:wait",i.bind(this._changeWait,this)),this.listenTo(this.options.blocks,"compare:progress",i.bind(this._progressFind,this)),this.listenTo(this.options.blocks,"uploader:progress",i.bind(this._progressUploader,this)))},render:function(){return this.$el.append(c(e("./templates/index.html"))(this.options)),this.$els={empty:this.$(".b-compare__empty").hide(),main:this.$(".b-compare__main").hide(),content:this.$(".b-compare__content"),progressBar:this.$(".b-compare__progress-bar"),progress:this.$(".b-compare__progress"),items:this.$(".b-compare__items"),close:this.$(".b-compare__close").click(i.bind(this.close,this)),controls:this.$(".b-compare__controls"),more:this.$(".b-compare__more").click(i.bind(this.getNextPage,this)),message:this.$(".b-compare__message")},this.$el.on("click",".b-compare-item__text-more",function(){var e=r(this);e.prev().addClass("b-compare-item__text-before_show_yes"),e.hide()}),this},_init:function(){return this._collection.reset(),this.$els.items.empty(),this._currentSource=-1,this._numberElements=this._sources.reduce(function(e,t){return t.init(),e+t.get("items").length},0),this._toggleMoreButton(),this},close:function(){return this.$el.parent().slideToggle(),this},_hasElements:function(){return this._sources.some(function(e){return e.get("items").length})},_toggleMoreButton:function(){var e=this._numberElements-this._collection.length;return this.$els.controls.toggle(e>0),this.$els.more.text([g("compare:more"),e,a.declOfNum(e,g("compare:posts"))].join(" ")),this},_changeSource:function(){return this._sources.length===0?(this._changeWait(!1)._init(),this):this._init().getNextPage()},_changeState:function(e){return this},_changeWait:function(e){var t=this._hasElements();return this.trigger("wait",e),e===!1&&(this.$els.progressBar.css("left",0),this._progressFindValue=1,this._progressUploaderValue=0),this.$els.content.toggleClass("b-compare__content_disabled",e),this.$els.progress.toggle(e),this.$els.empty.toggle(!t).toggleClass("b-compare__content_disabled",e),this.$els.main.toggle(t),this},getNextPage:function(){if(this._numberElements===0&&this._sources.length)return this;var e=this._getNext(y*w);return e.length>0&&(e.sort(function(e,t){return e.get("relevance")<t.get("relevance")?1:e.get("relevance")>t.get("relevance")?-1:0}),this._collection.add(i.sortBy(e,function(e){return e.get("type")==="text"?-1:1}))),this._toggleMoreButton()},_getNext:function(e){var t=0,n,r=[],i,s,o=0,u=this._sources.length,a=1e3;while(e>0&&t<u&&a&&o<u){a--,this._currentSource++,this._currentSource>=u&&(this._currentSource=0);if(this._sources.at(this._currentSource).isEnded())continue;s=this._sources.at(this._currentSource).get("type");if(e<b[s]){if(t+1>=u)break;o++;continue}o=0,i=Math.ceil(w/b[s]),i*b[s]>e&&(i=Math.floor(e/b[s])),n=this._sources.at(this._currentSource).next(i),(!n||n.length===0||this._sources.at(this._currentSource).isEnded())&&t++,n&&n.length&&(r=r.concat(n),e-=n.length*b[s])}return r},_addItem:function(e){return e.get("_view")||(e.set("_view",new p.View({model:e})),e.get("_view").render()),e.get("_view").appendTo(this.$els.items),this},_progressFind:function(e){return this._progressFindValue=e,this._progress()},_progressUploader:function(e){return this._progressUploaderValue=e,this._progress()},_progress:function(){var e=this._progressFindValue;return this._progressUploaderValue>0&&(e=Math.floor(e>0?e/2:0)+this._progressUploaderValue/2),this.$els.progressBar.css("left",e+"%"),this}});n.exports={Source:d,Sources:E,Main:S,Storage:v,Item:p}},"compare/item":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/util"),f=e("../core/log"),l=e("../core/layout"),c=e("../core/template"),h=e("../core/request"),p=e("../core/i18n"),d=e("../core/enums"),v=180,m=2,g=4,y=8,b=16,w=s.Model,E=s.Collection.extend({model:w}),S=s.View.extend({className:"b-compare-item",render:function(){var t=this.model.toJSON(),n=v-(t.is_gtext||t.img_type===2?30:0);this.$el.addClass("b-compare-item_type_"+t.type),(t.story_display_type===b||!t.story_display_type&&t.is_gtext||t.img_type===2)&&this.$el.addClass("b-compare-item_is_part");if(this.model.get("type")===d.block.image){var r=t.frg_width||t.width,i=a.calculateAspectRatioFit({width:r,height:t.frg_height||t.height},{width:n,height:600}),s=t.frg_y*-(i.width/r);t.style=a.format("width: %0px; height: %1px; background: url(%2)"+(this.model.get("img_type")===2?"; background-position-y: %3px":""),i.width,i.height,this.model.get("preview_url")||this.model.get("image_url"),s),this.$el.append(c(e("./templates/item-image.html"))(t))}else this.model.get("type")===d.block.text?(t.now=o(t.story_time*1e3).fromNow(),t.time=o(t.story_time*1e3).format("D MMMM YYYY [в] H:mm"),this.$el.append(c(e("./templates/item-text.html"))(t))):this.model.get("type")===d.block.video&&(t.style=a.format("width: %0px; height: %1px; background: url(%2)",n,n/(t.ratio||1.75),this.model.get("preview_url")||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGP6zwAAAgcBApocMXEAAAAASUVORK5CYII="),this.$el.append(c(e("./templates/item-video.html"))(t)));return this},appendTo:function(e){this.$el.appendTo(e),this.$el.addClass("b-compare-item_show_yes");if(this.model.get("type")===d.block.text)return this;var t=this.model.get("story_title");if(this.model.get("type")==="video"||this.model.get("type")==="image"&&this.model.get("img_type")===3)t='<span class="b-compare-item__media-tips">'+(this.model.get("type")==="video"?"Видео":this.model.get("img_type")===3?"Gif":"")+"</span> "+t;return this}});n.exports={View:S,Collection:E,Model:w}},"compare/single":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("FileAPI"),u=e("../core/request"),a=e("../core/index"),f=e("../core/events"),l=e("../core/log"),c,h=e("../page-gtpost/block"),p=e("../core/enums"),d=function(t){var n=this;c=e("./index"),this._def=r.Deferred(),this._currentState=p.compare.state.ready,this._currentWait=!1,this._sources=t.sources||new c.Sources};i.extend(d.prototype,f,{_emit:function(e,t){return this._blocks.trigger("compare:"+e,t),this.trigger(e),this},_changeWait:function(e){return this._currentWait!==e&&(this._currentWait=e,this._emit("wait",e)),this},_findDuplicates:function(){var t=this,n=this._getNextTask();return n?(n.attempt++,n.progress=15,t.progress(),n._simulateProgress=setInterval(function(){n.progress=n.progress+5,t.progress()},1e3),u("/ajax/stories_actions.php",{type:"POST",data:i.extend(n.model.serialize(),{action:"find_duplicates"})}).then(function(t){n.result=t.result,n.result?n.message=a.config("local")?e("./fake")[n.model.get("type")]:t.data:n.message=t.message},function(){n.result=!1,n.message="Непредвиденная ошибка"}).always(function(){clearInterval(n._simulateProgress),n.progress=100,t.progress(),t._findDuplicates()}),this):(this._endFindDuplicated(),this)},_updateState:function(e){this._currentState=e,this._emit("state",e)},progress:function(e){var t=e?1:0,n=e||0;return i.isUndefined(e)&&i.each(this._tasks,function(e){n+=e.progress||0,t++}),this._emit("progress",t===0?100:n/t),this},getPromise:function(){return this._def.promise()}}),n.exports={Storage:d}},"compare/source":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/util"),f=e("../core/log"),l=e("../core/layout"),c=e("../core/template"),h=e("../core/request"),p=e("./item"),d=e("../core/i18n"),v=s.Model.extend({_end:!0,_last:0,parse:function(e){return e.items=new p.Collection(e.items),e},init:function(){return this._end=!1,this._last=0,this},isEnded:function(){return this._end},next:function(e){var t=this.get("items"),n;return this._end?!1:(n=t.slice(this._last,this._last+e),this._last+=e,this._last>=t.length&&(this._end=!0),n)}});n.exports={Model:v}},"compare/storage":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("FileAPI"),u=e("../core/request"),a=e("../core/index"),f=e("../core/events"),l=e("../core/log"),c,h=e("../page-gtpost/block"),p=e("../core/enums"),d=function(t){var n=this;c=e("./index"),this.options=t||{},this._blocks=t.blocks||new h.Collection,this._blocks.on("add",i.bind(this._addBlock,this)),this._blocks.on("error",i.bind(this._removeBlock,this)),this._blocks.on("remove",i.bind(this._removeBlock,this)),this._blocks.on("change:url change:body",i.bind(this._changeBlock,this)),this._def=r.Deferred(),this._tasks=[],this._waitTask=new Set,this._currentState=p.compare.state.ready,this._currentWait=!1,this._sources=t.sources||new c.Sources,this._textSource=new h.Model({type:"text",body:""}),this._updateTextBlockDebounce=i.debounce(function(){var e=this._getAllText();n._textSource.set("body",e),e===""?n._textSource._source&&n._textSource._source.destroy():n._textSource.get("body")>""&&n._addTask(n._textSource),n._removeWaitTask(n._textSource)},1500)};i.extend(d.prototype,f,{_emit:function(e,t){return this._blocks.trigger("compare:"+e,t),this.trigger(e),this},_changeWait:function(e){return this._currentWait!==e&&(this._currentWait=e,this._emit("wait",e)),this},_addBlock:function(e){var t=e.get("type");return t==="video-input"?this:(t===p.block.image&&e.get("url")||t===p.block.video?this._addTask(e):t===p.block.text?e.get("body")!==""&&this._updateTextBlock():this._addWaitTask(e),this)},_changeBlock:function(e){var t=e.get("type");return t==="image"?this._addTask(e)._removeWaitTask(e):t==="text"&&this._updateTextBlock(),this},_addWaitTask:function(e){return this._waitTask.has(e)?this:(this._waitTask.add(e),this._changeWait(!0),this)},_removeWaitTask:function(e){return this._waitTask.has(e)?(this._waitTask.delete(e),this._waitTask.size===0&&this._currentState===p.compare.state.ready&&this._changeWait(!1),this):this},_updateTextBlock:function(){return this._addWaitTask(this._textSource),this._updateTextBlockDebounce(),this},_removeBlock:function(e){return e.get("type")===p.block.text?(e.get("body")!==""&&this._updateTextBlock(),this):(this._removeWaitTask(e),this._removeTaskByModel(e),e._source&&(e._source.destroy(),this._sources.remove(e._source)),this)},_addTask:function(e){return this._tasks.push({attempt:!1,model:e}),this.start(),this},_removeTaskByModel:function(e){var t=i.find(this._tasks,function(t){return t.model===e});return t?this._tasks=i.drop(this._tasks,t):this._emit("remove",e),Boolean(t)},_endFindDuplicated:function(){var e=[],t={success:0,errors:[]};return i.forEach(this._tasks,function(n){n.result?(t.success++,n.model._source&&(n.model._source.destroy(),this._sources.remove(n.model._source)),n.model._source=new c.Source({type:n.model.get("type"),items:n.message},{parse:!0}),this._sources.add(n.model._source)):(e.push(n),t.errors.push(n.message))},this),this._tasks=e,this._updateState(p.compare.state.ready),this._waitTask.size===0&&this._changeWait(!1),this._def.resolve(t),this},start:function(){return this._currentState!==p.compare.state.ready||this._tasks.length===0?!1:(i.each(this._tasks,function(e){e.attempt=!1}),this._updateState(p.compare.state.progress),this._changeWait(!0),this._findDuplicates().getPromise())},_getNextTask:function(){return i.findWhere(this._tasks,{attempt:!1})},_findDuplicates:function(){var e=this,t=this._getNextTask();if(!t)return this._endFindDuplicated(),this;t.attempt++,t.progress=15,e.progress(),t._simulateProgress=setInterval(function(){t.progress=t.progress+5,e.progress()},1e3);var n=i.extend(t.model.serialize(),{action:"find_duplicates"});return this.options.storyId&&(n.story_id=this.options.storyId),u("/ajax/stories_actions.php",{type:"POST",data:n}).then(function(e){t.result=e.result,t.result?t.message=e.data:t.message=e.message},function(){t.result=!1,t.message="Непредвиденная ошибка"}).always(function(){clearInterval(t._simulateProgress),t.progress=100,e.progress(),e._findDuplicates()}),this},_getAllText:function(){return this._blocks.reduce(function(e,t){return e+(t.get("type")==="text"?t.get("body"):"")},"")},_updateState:function(e){this._currentState=e,this._emit("state",e)},progress:function(e){var t=e?1:0,n=e||0;return i.isUndefined(e)&&i.each(this._tasks,function(e){n+=e.progress||0,t++}),this._emit("progress",t===0?100:n/t),this},getPromise:function(){return this._def.promise()}}),n.exports={Storage:d}},"core/config":function(e,t,n){var r=e("underscore"),i=function(e,t){e&&t?this._tree=e:(this._tree={},e&&this.load(e))};r.extend(i.prototype,{index:function(e,t,n){if(r.isString(t))return this.index(e,t.split(":"),n);if(t[0]&&r.isUndefined(e[t[0]])){if(r.isUndefined(n))return undefined;e[t[0]]={}}return t.length==1&&!r.isUndefined(n)?e[t[0]]=n:t.length==0?e:this.index(e[t[0]],t.slice(1),n)},load:function(e){this._tree=r.extend(this._tree,e)},set:function(e,t){return this.index(this._tree,e,t)},get:function(e){return this.index(this._tree,e)}}),n.exports=i},"core/descriptor":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/util"),u=e("../core/log"),a=new RegExp("\\((.*?)\\)","g"),f=new RegExp("(\\(\\?)?:\\w+","g"),l=new RegExp("\\*\\w+","g"),c=new RegExp("[\\-{}\\[\\]+?.,\\\\^$|#\\s]","g"),h=s.Model.extend({idAttribute:"name",defaults:{active:!1,label:"unknown",routes:"show",layout:undefined,children:[]},parse:function(e,t){t.parent&&(e.parent=t.parent),i.isArray(e.routes)&&i.some(e.routes,function(e){return i.isUndefined(e.pattern)||i.isUndefined(e.method)})&&(u.error(":descriptor:","Bad routes in module",e.name),e.routes={"":"show"});if(i.isUndefined(e.routes)||i.isEmpty(e.routes))e.routes={"":"show"};if(i.isString(e.routes)||i.isFunction(e.routes))e.routes={"":e.routes};return i.isObject(e.routes)&&(e.routes=i.map(e.routes,function(e,t){return{path:t,pattern:this._routeToRegExp(t),method:e}},this)),i.isFunction(e.layout)&&(e.layout=new e.layout({model:this,parent:t.parent,className:e.className||"b-"+e.name})),e.children=new p,e.children.on("change:active",this.childrenChangeActive,this),e},childrenChangeActive:function(e){return e.get("active")?(this.get("active")||this.setActive(),this.current&&this.current!==e&&(this.current.close(),delete this.current),this.current=e,this):this},close:function(){return this.current&&(this.current.close(),delete this.current),this.set("active",!1,{silent:!0}),this.trigger("change:active",this),i.isFunction(this.get("layout").hide)?this.get("layout").hide():u.warn(":layout:","not found method hide",this.get("layout")),this},_routeToRegExp:function(e){return e=e.replace(c,"\\$&").replace(a,"(?:$1)?").replace(f,function(e,t){return t?e:"([^/?]+)"}).replace(l,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},add:function(e){return this.get("children").add(e,{parent:this,parse:!0})},matchActive:function(e){var t=this.matchRoute(e);return t&&t.descriptor.setActive(t.route,t.path),t},setActive:function(e,t){var n;return this.set({active:!0},{silent:!0}),this.trigger("change:active",this),e||(e=this.get("routes")[0]),i.isFunction(e.method)||(!this.get("layout")||!this.get("layout")[e.method]?u.error(":descriptor:","Do not exists method in layout.",this.get("layout"),e.method,e):(t&&(n=i.map(e.pattern.exec(t).slice(1),function(e,n){if(n===t.length-1)return e||null;try{e=e?decodeURIComponent(e):null}catch(r){}return e})),this.get("layout")[e.method].call(this.get("layout"),n))),this},matchRoute:function(e){var t=e.split("/"),n=t[0],r;return t.shift(),r=i.find(this.get("routes"),function(t){return t.pattern.test(e)}),r?{descriptor:this,path:e,route:r}:(r=this.get("children").find(function(e){return e.get("name")===n}),r&&r.matchRoute(t.join("/")))},match:function(e){var t=this.matchRoute(e);return t?t.descriptor:t},path:function(){return i.isUndefined(this.get("parent"))?[]:this.get("parent").path().concat(this.get("name"))}}),p=s.Collection.extend({constructor:function(){this.model=h,s.Collection.apply(this,o.makeArray(arguments))}});n.exports=h},"core/enums":function(e,t,n){n.exports={block:{video:"video",image:"image",text:"text"},compare:{state:{ready:"ready",wait:"wait",hasty:"",progress:"progress"}}}},"core/events":function(e,t,n){var r=e("underscore"),i=e("./util"),s={on:function(e,t){return this._events=this._events||{},!e||!t?this:(this._events[e]=this._events[e]||[],this._events[e].push(t),this)},once:function(e,t){var n=function(){this.off(e,n),t.apply(this,arguments)};return n._callback=t,this.on(e,n)},off:function(e,t){var n=arguments.length,r,i,s;if(n===0||!this._events)return this._events={},this;r=this._events[e];if(!r)return this;if(n==1)return delete this._events[e],this;for(s=r.length;s--;){i=r[s];if(i===t||i._callback&&i._callback===t){r.splice(s,1);break}}return this},removeAllListeners:function(){return this.off()},emit:function(e){var t=i.makeArray(arguments,1),n,s,o=this;return this._events=this._events||{},n=this._events[e],r.isArray(n)?r.every(n.reverse(),function(e){var n=e.apply(o,t);return n!==!1}):!0},listeners:function(e){return this._events=this._events||{},this._events[e]}};s.removeEventListener=s.removeListener=s.off,s.addEventListener=s.addListener=s.on,s.emitEvent=s.trigger=s.emit,n.exports=s},"core/gcaptcha":function(e,t,n){var r=e("./index"),i=e("./util"),s=e("underscore"),o={wait:"wait",start:"start",inited:"inited"},u=o.wait,a=[],f=function(){s.map(a,function(e){grecaptcha.render(e,{sitekey:"6LeWlAkTAAAAAONp_mv4JDvNBIHc48Z6ByhBQKam"})}),a=[]};r.global("onloadCallback",function(){u=o.inited,f()},!0),n.exports=function(e){a.push(e);if(u===o.wait)return i.addScript("https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit","recaptcha"),u=o.start,!0;u===o.inited&&f()}},"core/i18n":function(e,t,n){var r=e("jquery"),i=e("../core/config"),s=new RegExp("\\^([\\w:-]*)(?:\\(([\\w, ]*)\\))?","g"),o=new i(e.config("i18n"));n.exports=function(e,t){if(t)return o.set(e,t);var n=o.get(e);return n?n:e.replace(s,function(e,t,n){return o.get(t)||e})}},"core/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core/descriptor"),a=e("html5-history-api"),f=e("../core/config"),l=e("../core/layout"),c=e("../core/log"),h=e("visibilityjs"),p=e("./location"),d=e("detect"),v=l.extend({className:"b-application",eEnvironment:{production:225,testing:226,local:227},constructor:function(){var t=this;this._isReady=!1,this._config=new f(e.config("application")),l.prototype.constructor.apply(this),this.ua=d.parse(navigator.userAgent),r(document).ready(i.bind(this.onReady,this)),window.app||(window.app={moduleConfig:function(e,n){return t.config("modules:"+e,n)}}),this._globals=new f(window.app,!0)},ready:function(e){return this._isReady&&e(),this.on("dom:ready",e),this},config:function(e,t){return i.isUndefined(t)?this._config.get(e):this._config.set(e,t)},findQuery:function(){var e=document.location||a.location,t=this.config("GET",p.getQueryParams(e.search))||{};return this.config("location")&&(e=document.createElement("a"),e.href=(this.config("location").slice(0,4)==="http"?"":"http://pikabu.ru/")+this.config("location"),this.config("GET",i.extend(t,p.getQueryParams(e.search)))),e},changeUrl:function(){var t=this.findQuery(),n=e("../wm"),i=this.config("GET"),s;return s=t.pathname.replace(/index\.html?/i,""),s.charAt(0)==="/"&&(s=s.slice(1)),c.print(":route:",s,r.param(i)),n.matchActive(s),this},onReady:function(){var e=this;return this._isReady=!0,this.render().init().trigger("dom:ready"),h.change(function(t,n){c.print(":app:","change visibility",n),e.config("state",n),e.trigger("state",n)}),this.config("state",h.state()),r(window).bind({resize:i.debounce(i.bind(this.resizeWindow,this),30),popstate:i.bind(this.changeUrl,this)}),r(document).bind({keydown:i.bind(this.keydownDocument,this),keyup:i.bind(this.keyupDocument,this),scroll:i.throttle(i.bind(this.scrollDocument,this),300)}),this.on("window:doResize",i.bind(this.resizeWindow,this)),this.resizeWindow(),this},init:function(){return this.descriptor=new u({name:"root",active:!0,layout:this},{parse:!0}),this.add=i.bind(this.descriptor.add,this.descriptor),this.matchActive=i.bind(this.descriptor.matchActive,this.descriptor),this.matchRoute=i.bind(this.descriptor.matchRoute,this.descriptor),this.layout=this.descriptor.get("layout"),this},render:function(){var e=r("."+this.className);return e.length>0?this.$el=e:this.$el.prependTo(r("body")),this},global:function(e,t,n){if(i.isUndefined(t))return this._globals.get(e);if(!n||!!window[e])return this._globals.set(e,t);window[e]=t},resizeWindow:function(){var e=r(window).width(),t=r(window).height();return this.width!==e&&this.trigger("window:resize:width",e,t),this.width=e,this.height=t,this.trigger("window:resize",this.width,this.height),this},scrollDocument:function(){return this.trigger("document:scroll",r(document).scrollTop()),this},keydownDocument:function(e){return this.trigger("document:keydown",e.keyCode,e),this},keyupDocument:function(e){return this.trigger("document:keyup",e.keyCode,e),this}}),m=new v;n.exports=m},"core/layout":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/util"),u=e("../core/log"),a=s.View.extend({constructor:function(e){s.View.apply(this,o.makeArray(arguments)),this.isShow=!1},show:function(){return this.isShow?this:(this._rendered||(this.render(),this._rendered=!0),this.isShow=!0,this.$el.show(),this.trigger("show"),this)},hide:function(){return this.isShow?(this.isShow=!1,this.$el.hide(),this.trigger("hide"),this):this},render:function(){return this.$el.hide(),this.model&&this.model.get("parent")&&this.model.get("parent").get("layout")&&this.model.get("parent").get("layout").append?this.model.get("parent").get("layout").append(this.$el):u.error(":layout:","we were not able to place this layer in the parent",this.model),this},append:function(e){var t=this.$children||this.$el;return t.append(e),this},prepend:function(e){var t=this.$children||this.$el;return t.prepend(e),this}});n.exports=a},"core/location":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone");n.exports={pushState:function(t,r,i,s){var o=e("./index");try{window.history.pushState(t,r,i),s?o.changeUrl():o.config("GET",n.exports.getQueryParams())}catch(u){return!1}return!0},replaceState:function(t,r,i,s){var o=e("./index");try{window.history.replaceState(t,r,i),s?o.changeUrl():o.config("GET",n.exports.getQueryParams())}catch(u){return!1}return!0},redirect:function(e){return window.location.href=e},getQueryParams:function(e){var t={};return e=e||(history.location||document.location).search,i.each(i.compact(e.slice(1).replace(/\+/g," ").split("&")),function(e){var n;try{e=decodeURIComponent(e)}catch(r){}return n=e.split("="),t[n[0]]=n[1],!0}),t}}},"core/log":function(e,t,n){var r=e("underscore"),i=e("momentjs"),s=e("../core/util"),o=window,u=function(){this.startTime=(new Date).getTime(),this.verbose=!0};r.extend(u.prototype,{setVerbose:function(e){return this.verbose=e},timeElapsed:function(e){return e.unshift("["+i().format("DD.MM.YY H:mm:ss")+" "+(((new Date).getTime()-this.startTime)/1e3).toFixed(3)+"]"),e},out:function(e,t){if(!o.console)return!1;if(!o.console[e]){if(!o.console.log)return!1;e="log"}return o.console[e].apply(o.console,t)},print:function(){if(!this.verbose)return this;var e=s.makeArray(arguments);return this.out("log",this.timeElapsed(e)),this},warn:function(){var e=s.makeArray(arguments);return this.out("warn",this.timeElapsed(e)),this},info:function(){var e=s.makeArray(arguments);return this.out("info",this.timeElapsed(e)),this},error:function(){var e=s.makeArray(arguments);return this.out("error",this.timeElapsed(e)),this},trace:function(){var e=s.makeArray(arguments);return this.out("trace",this.timeElapsed(e)),this}});var a=new u;n.exports=a},"core/metrika":function(e,t,n){var r=e("./log");n.exports={goal:function(e){try{yaCounter31048081.reachGoal(e)}catch(t){r.print(":metrika:",e,t)}}}},"core/post-message":function(e,t,n){var r=e("underscore"),i=e("./events"),s=function(){this._receiveMessageBind=r.bind(this._receiveMessage,this),window.addEventListener?window.addEventListener("message",this._receiveMessageBind,!1):window.attachEvent("onmessage",this._receiveMessageBind)};r.extend(s.prototype,i,{_receiveMessage:function(e){this.emit(e.origin,e),this.emit("*",e)},send:function(e,t,n){return t?(e=typeof e=="string"?e:$.param(e),n=n||window.parent,n.postMessage(e,t.replace(/([^:]+:\/\/[^\/]+).*/,"$1")),this):this}});var o=new s;n.exports=o},"core/request":function(e,t,n){var r=e("jquery"),i=e("backbone"),s=e("underscore");n.exports=function(){var e=Array.prototype.slice.call(arguments),t,n,i;return e.length===0?(i=r.Deferred(),i.reject("Empty request"),i.promise()):(s.isObject(e[0])?(t=e[0].url,n=e[0]):(t=e[0],n=e[1]),r.ajax(t,n))}},"core/template":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("doT"),o=e("./i18n"),u=e("./log"),a={evaluate:new RegExp("\\<\\%([\\s\\S]+?(\\}?)+)\\%\\>","g"),interpolate:new RegExp("\\<\\%=([\\s\\S]+?)\\%\\>","g"),encode:new RegExp("\\<\\%!([\\s\\S]+?)\\%\\>","g"),use:new RegExp("\\<\\%#([\\s\\S]+?)\\%\\>","g"),useParams:new RegExp("(^|[^\\w$])def(?:\\.|\\[[\\'\\\"])([\\w$\\.]+)(?:[\\'\"]\\])?\\s*\\:\\s*([\\w$\\.]+|\\\"[^\\\"]+\\\"|\\'[^\\']+\\'|\\{[^\\}]+\\})","g"),define:new RegExp("\\<\\%##\\s*([\\w\\.$]+)\\s*(\\:|=)([\\s\\S]+?)#\\%\\>","g"),defineParams:new RegExp("^\\s*([\\w$]+):([\\s\\S]+)/",""),conditional:new RegExp("\\<\\%\\?(\\?)?\\s*([\\s\\S]*?)\\s*\\%\\>","g"),iterate:new RegExp("\\<\\%~\\s*(?:\\%\\>|([\\s\\S]+?)\\s*\\:\\s*([\\w$]+)\\s*(?:\\:\\s*([\\w$]+))?\\s*\\%\\>)","g"),varname:"data",strip:!0,append:!0,selfcontained:!1},f=function(){return""};n.exports=function(e,t){return i.isUndefined(e)?(u.error(":template:","template is missing or empty"),f):(e=o(e),s.template(e,a,t))}},"core/touch":function(e,t,n){function r(e,t,n){if(!n||!n.type)return;var r=0,i=0;if(n.touches&&n.touches.length>0){var s=n.touches[0];r=s.clientX,i=s.clientY;if(n.touches.length>1){t.__touchStarted=!1,e.call(t,n);return}}switch(n.type){case"touchstart":t.__touchStarted=!0,t.__touchSX=r,t.__touchSY=i,t.__touchEvent=n,t.__touchDX=0,t.__touchDY=0;break;case"touchmove":t.__touchStarted&&(t.__touchDX=t.__touchSX-r,t.__touchDY=t.__touchSY-i,t.__touchEvent=n);break;case"touchend":if(t.__touchStarted){t.__touchStarted=!1;var o=Math.abs(t.__touchDX),u=Math.abs(t.__touchDY);if(o>10||u>10)return;n.preventDefault(),e.call(t,t.__touchEvent)}break;default:e.call(t,n)}}function i(e,t){return function(n){r.call(this,e,t,n)}}var s="ontouchstart"in document.documentElement;jQuery.fn.touch=function(e){var t=this,n,r,o=t.length,u;if(s)for(r=0;r<o;r++)n=t[r],u=i(e,n),n.__touchCallback=u,n.addEventListener("touchstart",u,!1),n.addEventListener("touchmove",u,!1),n.addEventListener("touchend",u,!1);else for(r=0;r<o;r++)n=t[r],n.addEventListener("click",e,!1);return this};var o=jQuery.fn.on;jQuery.fn.on=function(){var e=[],t,n;for(t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);if(e.length>1&&typeof e[0]=="string"){var i=e[0];if(/(^|\s)touch(\s|$)/.test(i))if(s){e[0]=i.replace(/(^|\s)touch(\s|$)/,"$1touchstart touchmove touchend$2");for(t=1,n=e.length;t<n;t++)if(typeof e[t]=="function"){var u=e[t];e[t]=function(e){r(u,this,e.originalEvent)};break}}else e[0]=i.replace(/(^|\s)touch(\s|$)/,"$1click$2")}return o.apply(this,e)};var u=jQuery.fn.off;jQuery.fn.off=function(){var e=[],t,n;for(t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);if(e.length>0&&typeof e[0]=="string"){var r=e[0];/(^|\s)touch(\s|$)/.test(r)&&(s?e[0]=r.replace(/(^|\s)touch(\s|$)/,"$1touchstart touchmove touchend$2"):e[0]=r.replace(/(^|\s)touch(\s|$)/,"$1click$2"))}return u.apply(this,e)},function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof t=="object"?n(e("jquery")):n(jQuery)}(function(e){function t(n){n.preventDefault(),e.event.remove(v,"click",t)}function n(e,t){return(l?t.originalEvent.touches[0]:t)["page"+e.toUpperCase()]}function r(n,r,i){var u=e.Event(r,g);e.event.trigger(u,{originalEvent:n},n.target),u.isDefaultPrevented()&&(~r.indexOf("tap")&&!l?e.event.add(v,"click",t):n.preventDefault()),i&&(e.event.remove(v,p+"."+d,s),e.event.remove(v,h+"."+d,o))}function i(i){if(i.which>1)return;var u=i.timeStamp||+(new Date);if(w==u)return;w=u,m.x=g.x=n("x",i),m.y=g.y=n("y",i),m.time=u,m.target=i.target,g.orientation=null,g.end=!1,y=!1,b=!1,E=setTimeout(function(){b=!0,r(i,"press")},T.pressDuration),e.event.add(v,p+"."+d,s),e.event.add(v,h+"."+d,o),T.preventDefault&&(i.preventDefault(),e.event.add(v,"click",t))}function s(t){g.x=n("x",t),g.y=n("y",t),g.dx=g.x-m.x,g.dy=g.y-m.y,g.adx=Math.abs(g.dx),g.ady=Math.abs(g.dy),y=g.adx>T.motionThreshold||g.ady>T.motionThreshold;if(!y)return;clearTimeout(E),g.orientation||(g.adx>g.ady?(g.orientation="horizontal",g.direction=g.dx>0?1:-1):(g.orientation="vertical",g.direction=g.dy>0?1:-1));while(t.target&&t.target!==m.target)t.target=t.target.parentNode;if(t.target!==m.target){t.target=m.target,o.call(this,e.Event(h+"."+d,t));return}r(t,"drag")}function o(e){var t=e.timeStamp||+(new Date),n=t-m.time,i;clearTimeout(E);if(!y&&!b&&e.target===m.target){var s=S===e.target&&t-x<T.doubleTapInterval;i=s?"doubletap":"tap",S=s?null:m.target,x=t}else e.target=m.target,n<T.flickDuration&&r(e,"flick"),g.end=!0,i="drag";r(e,i,!0)}var u=navigator.userAgent,a=/chrome/i.exec(u),f=/android/i.exec(u),l="ontouchstart"in window&&(!a||!!f),c=l?"touchstart":"mousedown",h=l?"touchend touchcancel":"mouseup mouseleave",p=l?"touchmove":"mousemove",d="finger",v=e("html")[0],m={},g={},y,b,w,E,S,x,T=e.Finger={pressDuration:300,doubleTapInterval:300,flickDuration:150,motionThreshold:5};return e.event.add(v,c+"."+d,i),e.each("tap doubletap press drag flick".split(" "),function(t,n){e.fn[n]=function(e){return e?this.on(n,e):this.trigger(n)}}),T})},"core/util":function(e,t,n){"use strict";var r=e("jquery"),i=e("underscore"),s=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/;n.exports={getCommunity:function(){var e=window.location.pathname.indexOf("/community")>-1;return e?"comm_"+window.location.pathname.split("/").slice(2).join("_"):!1},contains:function(){var e=document.documentElement,t=function(n){return n&&(n===e||t(n.parentNode))},n=e.contains?function(t){return e.contains(t)}:e.compareDocumentPosition?function(t){return e.compareDocumentPosition(t)&16}:function(e){return t(e)};return function(t){return!(!t||(t=t.parent)!=e&&!n(t))}}(),calculateAspectRatioFit:function(e,t,r){var s=Math.min(1,t.width/e.width,t.height/e.height);return r=i.isUndefined(r)?!0:r,{width:r?n.exports.toEven(e.width*s):e.width*s,height:r?n.exports.toEven(e.height*s):e.height*s}},addScript:function(e,t,n){var i=document.createElement("script"),s=r("#"+t);i.src=e,s&&s.remove(),t&&(i.id=t),n?r(i).insertAfter(n):r(i).appendTo(r("body"))},getDurationTime:function(e){var t,n;return e=Number(e),t=Math.floor(e/3600),e-=t*3600,n=Math.floor(e/60),e-=n*60,(t?t+":":"")+n+":"+(e<10?"0"+e:e)},declCases:[2,0,1,1,1,2],declOfNum:function(e,t){return t[e%100>4&&e%100<20?2:n.exports.declCases[e%10<5?e%10:5]]},toEven:function(e){return e?Math.floor(Math.ceil(e)/2)*2:e},serialize:function(e,t){var n=i.isObject(t)?i.clone(t):{};return i.each(e.serializeArray(),function(e){if(t&&i.isUndefined(t[e.name])||!e.value)return!1;if(i.isUndefined(t)||!n[e.name]||t[e.name]!==e.value)n[e.name]=e.value}),n},makeArray:function(e,t){return Array.prototype.slice.call(e,t)},urlParser:function(e){var t=s.exec(e);return{href:t[0],withoutHash:t[1],url:t[2],origin:t[3],protocol:t[4],protocolseparator:t[5],credhost:t[6],cred:t[7],user:t[8],pass:t[9],host:t[10],hostname:t[11],port:t[12],pathname:t[13],segment1:t[14],segment2:t[15],search:t[16],hash:t[17]}},extend:function(e,t,r){var s;!i.isFunction(e)&&i.isFunction(this)&&(r=t,t=e,e=this),t&&i.has(t,"constructor")?s=t.constructor:s=function(){return e.apply(this,arguments)},i.extend(s,e,r),s.hasOwnProperty("extend")||(s.extend=n.exports.extend);var o=function(){this.constructor=s};return o.prototype=e.prototype,s.prototype=new o,t&&i.extend(s.prototype,t),s.__super__=e.prototype,s},all:function(e){var t=[],n=[],s=r.Deferred().resolve(),o=r.Deferred();return i.each(e,function(e){s=s.then(function(){var i=r.Deferred();return e.then(function(e){t.push(e)},function(e){n.push(e)}).always(function(){i.resolve()}),i})}),s.then(function(){n.length>0?o.reject(n):o.resolve(t)}),o.promise()},waterfall:function(){var e=[],t=r.Deferred(),n=0;return r.each(arguments,function(i,s){e.push(function(){var i=[].slice.apply(arguments),o;if(typeof s=="function"){if(!(o=s.apply(null,i))||!o.promise)o=r.Deferred()[o===!1?"reject":"resolve"](o)}else s&&s.promise?o=s:o=r.Deferred()[s===!1?"reject":"resolve"](s);o.fail(function(){t.reject.apply(t,[].slice.apply(arguments))}).done(function(r){n++,i.push(r),n==e.length?t.resolve.apply(t,i):e[n].apply(null,i)})})}),e.length?e[0]():t.resolve(),t},format:function(e){var t=n.exports.makeArray(arguments,1);return e.replace(/%(\d+)/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})},random:function(e){return Math.floor(Math.random()*e)},getBlob:function(e){var t=new XMLHttpRequest,n=r.Deferred();return t.open("GET",e,!0),t.responseType="blob",t.onload=function(e){if(this.status==200){var t=this.response;return n.resolve(t)}n.reject(this.status)},t.onerror=function(){n.reject(Error("Network Error"))},t.send(),n.promise()}}},"custom-advert/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core/layout"),u=e("../core/log"),a=e("../core"),f=e("../custom-advert-core"),l=function(){r(document).on("touch",".adv-story-close",i.bind(this._clodeAdvert,this));var e=i.bind(this._processAdvertsInViewport,this);r(window).scroll(i.throttle(e,500)),r(e),this._listenVideoAdverts()};i.extend(l.prototype,f.prototype,{_clodeAdvert:function(e){var t=r(e.target);t[0].tagName!="span"&&(t=t.closest("span"));var n=Number(t.attr("data-id"));if(!n)return;this._getCloseAdvertDialog(n,function(){t.closest(".post").slideUp(200)}).show(e.target)}}),n.exports={init:function(){return["index.php","upcoming.php","authors.php","adult.php","cat.php","subs.php","profile.php","search.php","story.php"].indexOf(a.config("phpSelf"))===-1?!1:this.advert?this.advert:this.advert=new l}}},"custom-advert-core/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core/template"),u=e("../core"),a=e("../core/request"),f=e("../core/events"),l=function(){};i.extend(l.prototype,f,{_viewedVideos:null,saveClickByShowMoreButton:function(e,t){a("/ajax/save_click.php?t=more&aid="+e+"&sid="+t,{dataType:"json"})},_listenVideoAdverts:function(){this._viewedVideos||(this._viewedVideos={});var e=this,t=u.global("YTAdvert");t&&t.on("play",function(t){var n=t.$el.data("id");if(!e._viewedVideos[n]){e._viewedVideos[n]=!0;var i=r('.b-video[data-id="'+n+'"][data-aid]').attr("data-aid");i&&a("/ajax/save_click.php?aid="+i+"&sid="+n,{dataType:"json"})}})},_processAdvertsInViewport:function(){var e=!1;r("a[data-view-key]").each(function(){if(e)return;var t=this.getBoundingClientRect(),n=t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth);if(n){var r=this.getAttribute("data-view-key");this.removeAttribute("data-view-key");if(window.sessionStorage){if(window.sessionStorage.getItem("ad_"+r)=="1")return;window.sessionStorage.setItem("ad_"+r,"1")}e=!0,a("/ajax/save_view.php?k="+r,{dataType:"json"})}})},_getCloseAdvertDialog:function(e,t){var n=this,r=new s;r.setModalMode(!0),r.append('			<div class="ppb-menu cadv-reasons">				<section>Пожалуйста, укажите причину по которой Вы не хотите больше видеть данное объявление?</section>				<div class="ppb-radio">					<input name="cadv_readon" checked type="radio" value="1"><label>Мне не нравится это объявление</label>				</div>				<div class="ppb-radio">					<input name="cadv_readon" type="radio" value="2"><label>Другая причина:</label>				</div>				<div class="cadv-reason-text"><textarea></textarea></div>			</div>		');var i=r.getContent();return r.addButtonIntoFooter("Скрыть",function(){r.hide();var s="",o=i.find("input:checked");o.length==1&&(s=o.val()),n._closeAdvertByReason(e,s,i.find("textarea").val()),t&&t()}),r.addButtonIntoFooter("Отмена",function(){r.hide()}),i.find("input").change(function(){var e=i.find("input:checked").val();e=="2"&&i.find("textarea").focus()}),i.find("textarea").on("keypress keydown",function(){i.find('input[value="2"]').prop("checked",!0).trigger("ppb_check")}),r},_closeAdvertByReason:function(e,t,n){var r={id:e,reason_code:t||"",reason_text:n||""};a("/ajax/users_actions.php?action=close_advert",{data:r,dataType:"json"})}}),n.exports=l},"editor/blockquote":function(e,t,n){var r=e("jquery"),i=function(){var e=this;this.button=document.createElement("button"),this.button.className="medium-editor-action medium-editor-action-quote",this.button.innerHTML='<i class="fa fa-quote-left"></i>',this.button.onclick=function(t){e.onClick.call(e,t)},this.up=function(e,t){do if(e.nodeType==1&&e.nodeName.toLowerCase()==t.toLowerCase())return e;while(e=e.parentNode);return!1}};i.prototype.onClick=function(){var e=window.getSelection().getRangeAt(0),t=this.up(e.startContainer,"blockquote"),n=r(t);if(t)n.parent().append(t.innerHTML),n.remove();else{var i=e.startContainer.parentNode,s=e.endContainer.parentNode,o=this.up(e.startContainer,"p"),u=this.up(e.endContainer,"p");e.startContainer.nodeName=="#text"&&o&&(i=o),e.endContainer.nodeName=="#text"&&u&&(s=u),e.endOffset==0&&s?e.setEndBefore(e.endContainer):s&&e.setEndAfter(s),i&&e.setStartBefore(i),t=document.createElement("blockquote"),e.surroundContents(t)}},i.prototype.getButton=function(){return this.button},i.prototype.checkState=function(e){this.up(e,"blockquote")&&this.button.classList.add("medium-editor-button-active")},i.prototype.coverAll=function(e){var t=[],n;for(n=0;n<this.rangeCount;n++){var r=this.getRangeAt(n);r.setStart(r.startContainer,0),r.setEnd(r.endContainer,r.endContainer.nodeValue.length),t.push(r)}e.removeAllRanges();for(n=0;n<t.length;n++)e.addRange(t[n])},n.exports={BlockquoteEditor:i}},"editor/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/hotkeys"),u=e("../core/request"),a=e("../core/template"),f=e("../core/log"),l=e("medium-editor"),c=e("./blockquote").BlockquoteEditor;n.exports={init:function(e){return new l(e,{buttons:["bold","italic","strikethrough","quote"],placeholder:"Введите текст комментария",extensions:{bq:new c}})}}},"feed/feedpanel":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core/template"),o=e("../calendar"),u=e("../popup-box"),a=e("../core/events"),f=function(){};i.extend(f.prototype,a,{_panel:null,_mode:"hot",_box:null,init:function(){this._panel=r(".b-feed-panel"),this._mode=this._panel.data("mode"),this._mode=="hot"||this._mode=="best"||this._mode=="new"?this._panel.touch(i.bind(this._showMenu,this)):this._mode=="subs"&&this._panel.touch(i.bind(this._showSubscribeTypes,this))},_showMenu:function(){var t,n=this;if(!this._box){var i=r('span[data-type="date"]',this._panel),a=i.data("value");this._box=(new u).setModalMode(!0).addCloseButtonIntoFooter().append(t=r(s(e("./templates/feed-menu-"+this._mode+".html"))()));if(this._mode=="hot"){var f=r('span[data-type="sort"]',this._panel),l=f.data("value");t.find('input[value="'+l+'"]').prop("checked",!0),t.find("input").on("change",function(){var e=t.find("input:checked").val(),r,i;e=="0"?(r="актуальности",i="act"):(r="времени",i="time"),f.text(r),n._box.hide(),window.location.href="/hot?f="+i})}else this._mode=="best"&&(t.find('input[value="'+a+'"]').prop("checked",!0),t.find("input").on("change",function(){var e=t.find("input:checked").val(),r,s;switch(e){default:case"today":r="сегодня",s="";break;case"week":r="неделю",s="/week";break;case"month":r="месяц",s="/month";break;case"all":r="все время",s="/all"}i.text(r),n._box.hide(),window.location.href="/best"+s}));var c={};"localStorage"in window&&window.localStorage!==null&&(c=window.localStorage.getItem("feed_visited_dates"),c||(c={})),t.find('div[data-role="rnd_date"]').touch(function(){var e=(new Date(2011,0,15)).getTime(),t=(new Date).getTime()-e-864e5,r=0,s=new Date,o;while(++r<1e3){s.setTime(e+Math.round(Math.random()*t)),o=n._formatDate(s,"dd-mm-yyyy");if(!c[o])break}c[o]=!0,"localStorage"in window&&window.localStorage!==null&&window.localStorage.setItem("feed_visited_dates",c),i.text(n._formatDate(s,"dd M yyyy")),n._box.hide(),window.location.href="/"+(n._mode!="hot"?n._mode:"best")+"/"+o}),t.find('div[data-role="date"]').touch(function(){n._box.hide();var e=(new o).setWidth(Math.min(500,~~(r(window).width()*.9))).setDatesRangeMode(n._mode=="best"),t;a=="today"?e.setDate(n._formatDate(new Date,"yyyy-mm-dd")):/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(a)?(t=a.split("-"),e.setDate(a)):/^[0-9]{4}-[0-9]{2}-[0-9]{2},[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(a)&&(t=a.split(","),e.setDate(t[0]));var s=(new u).allowScrollContent(!1).setMinWith(0).autoCorrectPosition(!1).setModalMode(!0).setInnerIndent(0).addCloseButtonIntoFooter().append(e.getElement()).show(n._panel);e.addListener("select",function(e){var t=n._formatDate(new Date(e.start_date),"dd-mm-yyyy"),r=n._formatDate(new Date,"dd-mm-yyyy");r==t&&(i.text("сегодня"),s.hide(),window.location.href="/"+(n._mode!="hot"?n._mode:"best")),i.text(e.caption),c[t]=!0,"localStorage"in window&&window.localStorage!==null&&window.localStorage.setItem("feed_visited_dates",c),s.hide(),window.location.href="/"+(n._mode!="hot"?n._mode:"best")+"/"+t})})}else t=this._box.getContent();this._box.show(this._panel)},_formatDate:function(e,t){var n="0"+String(e.getDate()),r="0"+String(e.getMonth()+1),i=String(e.getFullYear());if(t=="dd M yyyy"){var s=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"];return n.substr(-2)+" "+s[e.getMonth()]+" "+i}return t=="yyyy-mm-dd"?i+"-"+r.substr(-2)+"-"+n.substr(-2):t=="dd-mm-yyyy"?n.substr(-2)+"-"+r.substr(-2)+"-"+i:""},_showSubscribeTypes:function(){var t=this,n,i,o=r('span[data-type="subs"]',this._panel),a=Number(o.attr("data-value")),f=Number(o.attr("data-rating-value"));this._box?(n=this._box,i=n.getContent()):n=this._box=(new u).setModalMode(!0).addButtonIntoFooter("Показать",function(){var e=0,t=null,r="";i.find('input[type="checkbox"]:checked').each(function(){e|=Number(this.value)});switch(e){default:case 0:case 7:r="Все подписки";break;case 1:r="Подписки на пользователей";break;case 2:r="Подписки на теги";break;case 3:r="Подписки на пользователей и теги";break;case 4:r="Подписки на сообщества";break;case 5:r="Подписки на пользователей и сообщества";break;case 6:r="Подписки на теги и сообщества"}o.attr("data-value",String(e));if(!isNaN(f)){t=Number(i.find('input[type="radio"]:checked').val()),o.attr("data-rating-value",String(t));switch(t){default:case 0:r+=", с любым рейтингом";break;case 1:r+=", с положительным рейтингом"}}o.text(r),window.location.href=window.location.pathname+"?st="+e+(t!==null?"&r="+t:""),n.hide()},"success").addButtonIntoFooter("Отмена",function(){n.hide()}).setInnerIndent(10).append(i=r(s(e(isNaN(f)?"./templates/feed-menu-subs.html":"./templates/feed-menu-subs-new.html"))())),i.find('input[type="checkbox"]').each(function(){var e=Number(this.value);this.checked=(a&e)==e||a==0}),isNaN(f)||i.find('input[type="radio"][value="'+f+'"]').prop("checked",!0),this._box.show(this._panel)}}),n.exports=f},"feed/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("cookies-js"),h=e("store"),p=e("../core/events"),d=e("../core/util"),v=e("../core/i18n"),m=e("../core/request"),g=e("./feedpanel"),y=e("../story-save"),b=e("../popup-box"),w=e("screenfull"),E=12,S=E/2,x=26,T=x/2,N=1,C=function(t){var n=this;this.$el=t||r(".content_container"),this.$els={container:r(".right_container_wrapper"),wrapper:r(".after_header"),document:r(document),showBeforeHide:r(".more_old_action"),showAfterHide:r(".more_action")},this.$els.rollupWrapper=r(l(e("./templates/rollup-wrapper.html"))()).appendTo(this.$els.wrapper),this.$els.more=this.$els.showAfterHide,this.stories={},this.storiesOrder=[],this._storiesBeforeOld=[],this._storiesAfterOld=[],this._showedStories=[],this._forceShowedStories=[],this._visistedBuffer=this._visistedBuffer||[u.config("bid"),[]],this._saveVisited=i.debounce(i.bind(this.saveVisited,this),3e3),this._cacheState={timestamp:i.now(),ids:[],active:!1,sid:0,page:0,filter_name:""},this._$body=r("body"),this._$html=r("html, body"),this._setCurrentPage(Number(u.config("GET").page||1)),this._hideBeforeDebounce=i.debounce(i.bind(this._hideBefore,this),3500),this.reInit();if(["index.php","upcoming.php","authors.php","adult.php","cat.php","subs.php","profile.php","search.php","search_new.php"].indexOf(u.config("phpSelf"))===-1)return this;(new g).init(),this.checkNeedRestore(),this._addBeforeUnload(),this._attachEvents(),this._attachScroll(),this.on("end",i.bind(this._showOverflowMessage,this)),this._isFeedOverflow=r(".no_items_msg").length>0};i.extend(C.prototype,p,{_xhrComplete:!0,_scrollingToPost:!1,_isFeedOverflow:!1,_currentId:0,_storyToRollup:null,_lastCheckTime:0,_needSaveState:!1,_currentPage:0,_nextPage:0,_prevPage:0,$:function(e){return this.$el.find(e)},_attachEvents:function(){var t=this;return this.$el.on("touch",".post_rating_up",i.bind(this._setRating,this,!0)),this.$el.on("touch",".post_rating_down",i.bind(this._setRating,this,!1)),this.$el.on("touch",".comment__control-save",i.bind(this._savePost,this)),this.$el.on("click",".b-story__show-all",i.bind(this._showPost,this)),this.$els.rollupWrapper.on("touch",i.bind(this._rollupPost,this)),this.$el.on("touch",".post_more",i.bind(this._toggleStoriesShare,this)),this.$el.on("click",".social.fb",function(){e("../core/metrika").goal("sharing_facebook")}),this.$el.on("click",".social.vk",function(){e("../core/metrika").goal("sharing_vk")}),this.$el.on("click",".social.tw",function(){e("../core/metrika").goal("sharing_twitter")}),this.$els.container.on("touch",".feed-overflow__to-hot",function(){window.location="/hot"}),this.$els.container.on("touch",".feed-overflow__to-top",function(){r("html,body").animate({scrollTop:0},200)}),this.$el.on("click","a.to-comments",function(){return u.config("twitMode")&&(t._needSaveState=!0,t._setCurrentStory(r(this).parents(".post").data("story-id"),!0)),!0}),this.$el.find(".b-story__show-all").each(function(e,n){var s=r(n);if(s.parent().find(".b-story-blocks__hide-wrapper").length>0)return!0;var o=s.parent().find(".b-story-blocks__wrapper");o=o.length===0?s.parent():o;if(o.length===0)return!0;var u=o.height(),a=o[0].scrollHeight+i.reduce(s.parent().find(".b-story-block_type_image img"),function(e,t){return e+(r(t).height()===0?Number(t.getAttribute("data-height")):0)},0);if(a-200<u){var f=s.closest(".post");t._forceShowedStories[t._forceShowedStories.length]=parseInt(f.attr("data-story-id")),s.click()}}),this},_attachScroll:function(){return this.$els.showBeforeHide.click(i.bind(this._getOldStories,this,!0)),u.on("document:scroll",i.bind(this._scrollFeed,this)),r(window).on("orientationchange",i.bind(this._changeOrientation,this)),r(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",i.bind(this._changeFullscreen,this)),this},_showPost:function(t){if(t.shiftKey||t.ctrlKey||t.metaKey)return;t.preventDefault(),t.stopPropagation(),e("../core/metrika").goal("tgp-mv__show-all");var n=r(t.target).closest(".b-story__show-all");n.hide();if(n.hasClass("b-story__show-all_legacy"))return n.closest(".post_wrapper").toggleClass("legacy-post").removeClass("post_wrapper"),this;n.parent().find(".b-story-blocks__wrapper").removeClass("b-story-blocks__wrapper_slice_yes").css("max-height","100%"),n.parent().find(".b-story-blocks__hide-wrapper").show();var s=n[0].parentElement;do{var o=s.getAttribute("data-story-id");if(o){this._currentId=parseInt(o,10);break}}while(s=s.parentElement);this._forceShowedStories.indexOf(this._currentId)===-1&&(this._showedStories.push(this._currentId),this._storyToRollup=this._currentId,this.$els.rollupWrapper.css("visibility","visible"));var u=n.parent().find(".b-story-block_type_image img");return i.each(u,function(e){e=r(e),e.data("src")&&(e.attr("src",e.data("src")),e.removeData("src"))}),this},_rollupPost:function(e){if(e.shiftKey||e.ctrlKey||e.metaKey)return;e.preventDefault(),e.stopPropagation();var t=this._storyToRollup,n=this._showedStories.indexOf(t),i=this.stories[this._storyToRollup],s=i[0],o=s.querySelector(".b-story__show-all"),u=o.className.split(" ");if(u.indexOf("b-story__show-all_legacy")!==-1)return s.querySelector(".legacy-post").className+=" post_wrapper",s;var a=o.parentElement.querySelector(".b-story-blocks__hide-wrapper");a&&(a.style.display="none");var f=s.querySelector(".b-story-blocks__wrapper"),l=r(f);return o.style.display="block",f.className+=" b-story-blocks__wrapper_slice_yes",this._$body.animate({scrollTop:i.offset().top-45+550-window.innerHeight/2},800),setTimeout(function(){r(f).css({maxHeight:f.clientHeight+"px"}).animate({maxHeight:"550px"},1100)},100),this._storyToRollup=null,this._showedStories.splice(n,1),this.$els.rollupWrapper.css("visibility","hidden"),this},_addBeforeUnload:function(){var e=this;return r(window).on(u.ua.device.family==="iPhone"?"pagehide":"beforeunload",function(){e.saveVisited(!0),u.config("phpSelf")==="index.php"||u.config("phpSelf")==="upcoming.php"||u.config("phpSelf")==="search.php"?!e._needSaveState||u.config("twitMode")&&e._currentPage<N?e._cacheState={}:(i.extend(e._cacheState,{timestamp:i.now(),ids:e.storiesOrder,idsBefore:e._storiesBeforeOld,idsAfter:e._storiesAfterOld,sid:e._currentId,page:e._currentPage,active:!1,filter_name:u.config("filter_name")}),a.info(":restore:","save",e._cacheState)):!e._cacheStatePrevious.active&&e._cacheStatePrevious.page>0?(e._cacheState=e._cacheStatePrevious,e._cacheState.active=!0):e._cacheState={},h.set("_p_cache",e._cacheState)}),this},_getHistoryLength:function(){return history.length-(u.ua.device.type==="Desktop"&&u.ua.browser.family==="Chrome"?1:0)},checkNeedRestore:function(){return this._cacheStatePrevious={},i.extend(this._cacheStatePrevious,this._cacheState,h.get("_p_cache")||{}),this._cacheStatePrevious.ids.length>0?(a.print(":restore:","Store is enabled",this._cacheStatePrevious),(u.config("phpSelf")==="index.php"||u.config("phpSelf")==="upcoming.php"||u.config("phpSelf")==="search.php")&&u.config("twitMode")&&this._cacheStatePrevious.active&&this._cacheStatePrevious.filter_name===(u.config("filter_name")||"")&&!i.isEmpty(this._cacheStatePrevious.ids)&&i.now()-this._cacheStatePrevious.timestamp<15e5&&this._getHistoryLength()>1&&(a.info(":cache:","ready to used cache"),this._cacheState=this._cacheStatePrevious,this.restoreState(this._cacheState),this._cacheState.active=!1,this._setCurrentPage(this._cacheState.page),h.set("_p_cache",this._cacheState)),!1):!1},_showRestoreMessage:function(t){return this._restoreBox||(this._restoreBox=(new b).setModalMode(!0).append(e("./templates/restore.html"))),t?this._restoreBox.show(this._$body):this._restoreBox.hide(),this},empty:function(){return this.removeStories(this.storiesOrder),this.$el.empty(),this},restoreState:function(e){var t=this;return this._xhrComplete?(this._xhrComplete=!1,this._storiesAfterOld=e.idsAfter||[],this._storiesBeforeOld=e.idsBefore||[],i.isEmpty(this._storiesBeforeOld)||this.$els.showBeforeHide.show(),t._showRestoreMessage(!0),setTimeout(function(){t._showRestoreMessage(!0)},150),this.empty(),this._overflowWhiteToggle(!0),this._scrollingToPost=!0,m("/ajax/stories_actions.php",{type:"POST",dataType:"json",data:{action:"load_stories",ids:e.ids,filter_name:e.filter_name||""}}).then(function(n){try{var s=r(document.createDocumentFragment());i.each(n.data,function(e){s.append(e.html)}),t.$el.append(s),setTimeout(function(){t.reInit(),t._setCurrentPage(e.page),t._setCurrentStory(e.sid,!0),t.scrollToStory(Number(e.sid)),setTimeout(function(){t._checkScrollTop(Number(e.sid),0)?(t._showRestoreMessage(!1),t._overflowWhiteToggle(!1)):(t.scrollToStory(Number(e.sid),0),setTimeout(function(){t._checkScrollTop(Number(e.sid),0)||t.scrollToStory(Number(e.sid),0),t._showRestoreMessage(!1),t._overflowWhiteToggle(!1)},600))},600)},1500)}catch(o){a.error(":feed:","bad loadState",e,o),t._showRestoreMessage(!1)}},function(e){a.error(":feed:","bad loadState",e),t._showRestoreMessage(!1)}).always(function(){t._xhrComplete=!0}),this):this},_changeFullscreen:function(){var e=this;return w&&w.isFullscreen?this._beforeOrientation=window.orientation:setTimeout(function(){e._changeOrientation()},300),this},_lastChangeOrientation:0,_changeOrientation:function(){var e=this;if(i.now()-this._lastChangeOrientation<300||w&&w.isFullscreen)return this;this._lastChangeOrientation=i.now();var t=e._currentId,n=e._progressReadStory;return this._overflowWhiteToggle(!0),setTimeout(function(){e.scrollToStory(t,n),setTimeout(function(){e._checkScrollTop(t,n)?e._overflowWhiteToggle(!1):(e.scrollToStory(t,n),setTimeout(function(){e._checkScrollTop(t,n)||e.scrollToStory(t,n),e._overflowWhiteToggle(!1)},350))},350)},500),this},_overflowWhiteToggle:function(e){var t=this;if(!this.$els.overflowWhite||!this.$els.overflowWhite.length)this.$els.overflowWhite=r(document.createElement("div")).addClass("feed__overflow-white").prependTo(this.$el);return e?this.$els.overflowWhite.show():setTimeout(function(){t.$els.overflowWhite.hide()},300),this.$els.overflowWhite.toggleClass("feed__overflow-white_hide",!e),this},_scrollFeed:function(t){if(u.config("authbox")||this._scrollingToPost||e("../image-viewer").isShown)return this;this._getStoriesViewport(t);var n=this.stories[this._currentId][0];this._showedStories.indexOf(this._currentId)!==-1&&n.getBoundingClientRect().bottom-70>window.innerHeight&&n.getBoundingClientRect().top<n.offsetTop?(this._storyToRollup=this._currentId,this.$els.rollupWrapper.css("visibility","visible"),console.log(n)):this.$els.rollupWrapper.css("visibility","hidden");if(!u.config("twitMode"))return this;if(this._countBeforeCurrent>E&&!this._currentHide)this._hideBeforeDebounce(t);else{if(this._countAfterCurrent>x&&!this._currentHide)return this._hideAfter(t);this._countAfterCurrent<T&&!i.isEmpty(this._storiesAfterOld)&&this._getOldStories(!1)}return i.now()-this._lastCheckTime>2e3&&(this.$els.document.height()-t<1500||this._countAfterCurrent<5)&&(this._lastCheckTime=i.now(),this._getNextStories()),this},_setCurrentStory:function(e,t){return!t&&(this._scrollingToPost||this._currentId===e)?this:(a.info("current story",e),this._currentId=e,this._countBeforeCurrent=this.storiesOrder.indexOf(e)-1,this._countAfterCurrent=this.storiesOrder.length-this._countBeforeCurrent,this)},scrollToStory:function(e,t){var n=this,r;return this.stories[e]?(r=!t||t>1?0:this.stories[e].height()*t,!this.stories[e].data("visited")&&this._setVisited(e),this._scrollingToPost=!0,this._$body.scrollTop(this.stories[e].offset().top-45+r),setTimeout(function(){n._scrollingToPost=!1},600),this):this},_checkScrollTop:function(e,t){var n,r=this._$body.scrollTop();return this.stories[e]?(n=this.stories[e].offset().top-45+(t?this.stories[e].height()*t:0),r-50<n&&r+50>n):!1},_getStoriesViewport:function(e){var t=this,n=e-window.innerHeight,s=e+150,o=r(window).width(),u=r(window).height(),a=[],f=0,l=0;return w&&w.isFullscreen?!0:(i.every(this.storiesOrder,function(r){var i=t.stories[r],o=i.offset().top;return o+i.height()<n||o>s||(!i.data("visited")&&a.push(r),f=r,l=e-o+45,l=l>0?l/i.height():0),o<s}),a.length>0&&this._setVisited(a),f&&(this._lastWindowWidth===o||this._lastWindowHeight===u)&&(this._progressReadStory=Number(l),this._setCurrentStory(Number(f))),this._lastWindowWidth=r(window).width(),this._lastWindowHeight=r(window).height(),!0)},_setVisited:function(e){var t=i.isString(c("visited_news"))?c("visited_news").split("~"):[];return e=i.isArray(e)?e:[e],i.forEach(e,function(e){this.stories[e].data("visited",!0)},this),u.config("logged")?(this._visistedBuffer[1]=this._visistedBuffer[1].concat(e),this._saveVisited()):c.set("visited_news",i.compact(t.concat(e)).join("~"),{expires:31536e3}),this},saveVisited:function(e){var t=this;return t._visistedBuffer[1]=i.compact(this._visistedBuffer[1]),i.isEmpty(this._visistedBuffer[1])?this:(a.print("::navigator::","save buffer"),e?(c.set("vn_buff",JSON.stringify(this._visistedBuffer),{expires:31536e3}),this):(t._saveXHR=m("/ajax/stories_actions.php?action=add_visited",{type:"POST",dataType:"JSON",data:"sr="+JSON.stringify(this._visistedBuffer)}).done(function(e){e.result?(a.print("::navigator::","nice saved buffer",t._visistedBuffer[1]),t._visistedBuffer[1]=[],c.set("vn_buff",JSON.stringify(t._visistedBuffer),{expires:31536e3})):a.error("::navigator::","some trouble with update visited news")}),this))},reInit:function(t){var n=this;return e("../gifx").init(),e("../video").init(),t&&(this._storiesAfterOld=[],this._storiesBeforeOld=[],this.$els.showBeforeHide.hide(),this.$els.showAfterHide.hide(),this._isFeedOverflow=!1),this.storiesOrder=[],i.forEach(this.$(".post"),function(e){var t=Number(e.getAttribute("data-story-id"));n.storiesOrder.push(t),n.stories[t]||(n.stories[t]=r(e))}),!this._currentId&&this.storiesOrder[0]&&this._setCurrentStory(this.storiesOrder[0]),this._lastWindowWidth=r(window).width(),this._lastWindowHeight=r(window).height(),this.$els.overflow&&this.$els.overflow.remove(),this},removeStories:function(e){var t=this;return e=i.isArray(e)?e.slice():[e],i.forEach(e,function(e){var n;if(!t.stories[e])return!0;t.stories[e].remove(),delete t.stories[e],(n=t.storiesOrder.indexOf(e))>-1&&t.storiesOrder.splice(n,1)}),this},_setCurrentPage:function(e){return this._currentPage=e,this._prevPage=e-1,this._nextPage=e+1,this},_setRating:function(t,n){if(this._setRatingXHR)return this;var s=this,o=r(n.target).parent().parent(),f=t?1:-1,l=o.data("story-id"),c=Number(o.data("vote"))+f,h=o.find(".post_rating_up"),p=o.find(".post_rating_count"),d=o.find(".post_rating_down");return u.config("logged")?c<-1||c>1||!o.data("can-vote")||p.hasClass("deleted")?this:(h.toggleClass("active",c===1),d.toggleClass("active",c===-1),o.data("vote",c),p.text(Number(p.text())+f),o.data("debounce")||o.data("debounce",i.debounce(function(e,t){s._setRatingXHR=!0,m("/ajax/vote_story.php",{data:{story_id:e,vote:t},dataType:"JSON",type:"POST"}).then(function(e){},function(){a.error(":story:","send rating trouble")}).always(function(){s._setRatingXHR=!1})},500)),o.data("debounce")(l,c),this):(e("../sign").showNeedSignin(),this)},_toggleStoriesShare:function(e){var t=r(e.target),n=t.closest(".post_actions_box");return t.is(".active")?(t.removeClass("active"),n.find(".post_share_box").addClass("hidden"),n.find(".post_rating_box").removeClass("hidden")):(t.addClass("active"),n.find(".post_share_box").removeClass("hidden"),n.width()-n.find(".post_more_box").outerWidth(!0)-n.find(".post_share_box").outerWidth(!0)<=n.find(".post_rating_box").outerWidth(!0)&&n.find(".post_rating_box").addClass("hidden")),this},_hideBefore:function(e){var t,n,r=this,s;return this._countBeforeCurrent<=E?this:(this._currentHide=!0,s=this.$els.showBeforeHide.is(":visible"),t=this.storiesOrder.splice(0,this._countBeforeCurrent),n=e-this.stories[this._currentId].offset().top,this.stories[i.last(t)].prevAll(".feed_ad_wrapper").remove(),this.removeStories(t),this._storiesBeforeOld=this._storiesBeforeOld.concat(t),this._setCurrentStory(this._currentId,!0),this._scrollingToPost=!0,!s&&this.$els.showBeforeHide.show(),this._$html.scrollTop(this.stories[this._currentId].offset().top+n),setTimeout(function(){r._$html.scrollTop(r.stories[r._currentId].offset().top+n)},50),setTimeout(function(){r._scrollingToPost=!1,r._currentHide=!1},500),this)},_hideAfter:function(){var e,t;return this._currentHide=!0,t=this.$els.showAfterHide.is(":visible"),e=this.storiesOrder.splice(this.storiesOrder.length-1-T,T),this.removeStories(e),this._storiesAfterOld=e.concat(this._storiesAfterOld),this._setCurrentStory(this._currentId,!0),!t&&this.$els.showAfterHide.show(),this._currentHide=!1,this},_showOverflowMessage:function(){var t=r("#end-of-feed-msg-alt");return t.length>0?(t.show().fadeIn(200),this):(this.$els.overflow=r(l(e("./templates/overflow.html"))({best:u.config("best"),date:u.config("listDate")&&["a","w","d"].indexOf(u.config("listDate"))===-1,tag:u.config("tag")})).appendTo(this.$els.wrapper),this.$els.overflow.find("a.b-link_change_date").click(function(){r("html,body").animate({scrollTop:0},200,function(){r(this).find(".calendar-ins").fadeIn(200)})}),this)},_getNextStories:function(){var t=this;return!this._xhrComplete||this._isFeedOverflow?this:(t.$els.showAfterHide.show(),u.config("GET").twitmode=1,u.config("GET").page=this._nextPage,this._xhrComplete=!1,e("../core/metrika").goal("load_more_posts"),m(window.location.origin+window.location.pathname+"?"+decodeURIComponent(r.param(u.config("GET"))),{dataType:"json"}).done(function(e){var n=0;if(!e.result)return this;e.data.is_feed_overflow=Boolean(e.data.is_feed_overflow);if(e.data.stories.length===0||e.data.is_feed_overflow){if(u.config("filter_name")!=="upcoming")return t.trigger("end",t._isFeedOverflow=!0),this;a.warn("feed is overflow",e.data)}var s=r(document.createDocumentFragment());i.each(e.data.stories,function(e){!t.stories[e.id]&&t._storiesBeforeOld.indexOf(e.id)===-1&&t._storiesAfterOld.indexOf(e.id)===-1&&(s.append(e.html),n++)}),n>4&&(i.isEmpty(e.data.ads_before)||s.prepend(e.data.ads_before),i.isEmpty(e.data.ads)||s.append(e.data.ads)),t.$el.append(s),t.reInit(),t._setCurrentPage(t._nextPage),t._setCurrentStory(t._currentId,!0)}).always(function(){t._xhrComplete=!0,t.$els.showAfterHide.hide()}),this)},_getOldStories:function(e){var t=this,n,s,o;if(!this._xhrComplete)return this;this._xhrComplete=!1,o=e?this.$els.showBeforeHide:this.$els.showAfterHide,o.addClass("loading"),e?n=this._storiesBeforeOld.splice(this._storiesBeforeOld.length-E,E).reverse():n=this._storiesAfterOld.splice(0,E),m("/ajax/stories_actions.php",{type:"POST",dataType:"json",data:{action:"load_stories",ids:n,filter_name:u.config("filter_name")}}).then(function(n){var o;try{if(!n.result)return!1;e&&(s=t.$els.document.scrollTop()-t.stories[t._currentId].offset().top),i.isEmpty(t._storiesBeforeOld)&&t.$els.showBeforeHide.hide(),t._scrollingToPost=!0;var u=r(document.createDocumentFragment());i.forEach(n.data,function(t){u[e?"prepend":"append"](t.html),o=t.id}),t.$el[e?"prepend":"append"](u),t.reInit(),e&&o&&setTimeout(function(){t._$html.scrollTop(t.stories[t._currentId].offset().top+s)},200),t._scrollingToPost=!1}catch(f){a.error(":feed:","bad load old",f)}},function(e){a.error(":feed:","bad load old",e)}).always(function(){o.removeClass("loading"),t._xhrComplete=!0})},_savePost:function(t){var n=r(t.target),i=!n.hasClass("comment__control-save_active_yes"),s=n.data("story-id");if(!u.config("logged"))return e("../sign").showNeedSignin(),this;if(n.data("xhr"))return this;i&&e("../core/metrika").goal("save_post");var o=function(){n.toggleClass("comment__control-save_active_yes",i),n.data("xhr",!1)},a=new y(s,n,o);return i?a.save():a.cancel(),this}}),n.exports=C},"gifx/canvas":function(e,t,n){var r=e("jquery"),i=function(e){var t;this.options={framesPerSecond:10,hideVideo:!0,autoplay:!0};for(t in e)this.options[t]=e[t];this.video=this.options.video,this.canvas=this.options.canvas,this.ctx=this.canvas.getContext("2d"),this.playing=!1,this.init(),this.bind()};_.extend(i.prototype,{init:function(){this.video.load(),this.setCanvasSize(),this.options.hideVideo&&(this.video.style.display="none")},bind:function(){var e=this;this.video.addEventListener("timeupdate",function(){e.drawFrame()}),this.video.addEventListener("canplay",function(){e.drawFrame()}),this.video.addEventListener("loadedmetadata",function(){e.play()})},setCanvasSize:function(){this.width=r(this.video).width(),this.height=r(this.video).height(),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height)},play:function(){this.lastTime=Date.now(),this.playing=!0,this.loop()},pause:function(){this.playing=!1},loop:function(){var e=this,t=Date.now(),n=(t-this.lastTime)/1e3;n>=1/this.options.framesPerSecond&&(this.video.currentTime=this.video.currentTime+n,this.lastTime=t),this.video.currentTime>=this.video.duration&&(this.video.currentTime=0),this.playing?this.animationFrame=requestAnimationFrame(function(){e.playing&&e.loop()}):cancelAnimationFrame(this.animationFrame)},drawFrame:function(){this.ctx.drawImage(this.video,0,0,this.width,this.height)}}),n.exports=i},"gifx/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/template"),u=e("../core"),a=e("../core/log"),f=e("../core/util"),l=e("../gifx/technologies"),c=e("../core/detect"),h=e("../core/events"),p=!1,d=!1,v=!1,m=r.Deferred(),g=r(".content_container:first"),y={mp4:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8"'},b=["webm","mp4"],w={loading:"loading",waiting:"waiting",playing:"playing"},E={canvas:"canvas",webp:"webp",video:"video",gif:"gif",flash:"flash"},S={story:"story",comment:"comment"},x=0,T=[],N={story:{width:g.width(),height:9100},comment:{width:580,height:1e3},commentPreview:{width:150,height:1e3}};u.ua.source.indexOf("YaBrowser/")>-1&&(b=["webm","mp4"]),e("knob"),p=l.flash(),d=l.canvas(),l.webp().then(function(){v=!0,a.info(":gifx:","technologies: [ video",l.video(y),"flash",p,"canvas",d,"webp",v,"] formats:",i.compact(i.map(y,function(e,t){return e?t:!1})).join(", "))}).always(function(){m.resolve(),a.info(":gifx:","technologies: [ video",l.video(y),"flash",p,"canvas",d,"webp",v,"] formats:",i.compact(i.map(y,function(e,t){return e?t:!1})).join(", "))});var C,k=function(){C=this instanceof A?this:!1,O.emit("current",C)},L=function(e,t,n){var r;return T[e.data("gifx-id")]?T[e.data("gifx-id")]:(r=x++,e.data("gifx-id",r),T[r]=new A(e,r,t,n),T[r].on("mouseenter",k),e.data("gifx",T[r]),T[r])};u.global("gifx:onInit",function(e){e=Number(e),T[e]&&T[e].onInitFlash()}),u.global("gifx:onError",function(e){e=Number(e),T[e]&&T[e].onErrorFlash()});var A=function(e,t,n,r){var s=this,o;this.$el=e,this.$els={preview:this.$el.find(".b-gifx__preview"),player:this.$el.find(".b-gifx__player"),size:this.$el.find(".b-gifx__size")},this.state=w.loading,i.each(w,function(e){s.$els[e]=s.$(".b-gifx__state_"+e+"_yes")}),this.$els.previewImage=this.$els.preview.find(".b-gifx__image"),this.options={id:t,size:{width:0,height:0},poster:this.$els.previewImage.attr("src"),src:this.$els.player.data("src").slice(0,this.$els.player.data("src").length-3)+(u.config("GET:issue322")?"_error.":""),type:S[this.$el.data("type")],formats:{gif:{size:this.$els.player.data("size-gif"),video:!1}},currentTechnology:undefined,technologies:{gif:E.gif,video:!1,flash:!1,canvas:!1,webp:!1}},this.$el.data("width")&&Number(this.$el.data("width"))>0&&this.changeSize(),this.options.type===S.story&&u.on("window:resize:width",i.bind(this.changeSize,this)),this.checkSupport(),o=this.options.technologies.canvas?E.canvas:this.options.technologies.video?E.video:this.options.technologies.flash?E.flash:this.options.technologies.webp?E.webp:E.gif,u.ua.browser.family==="Firefox"&&this.options.size.height>4e3&&o===E.video&&(o=E.gif),this.setTechnology(o),n?this.toggle():r&&this.init(),this.state===w.loading&&this.setState(w.waiting),this.$els.preview.load(i.bind(this.previewReady,this)),this.$els.previewImage[0].complete&&this.previewReady(),this.$el.mouseenter(function(){s.emit("mouseenter")}),this._click=i.bind(this.toggle,this),this.$el.bind("click",this._click)};i.extend(A.prototype,h,{ready:!1,shown:!1,_hasMeta:!1,$:function(e){return this.$el.find(e)},changeSize:function(){var e=this.options.type===S.story?g.width():this.$el.parent().width(),t=this.$el.data("width")/this.$el.data("height"),n=e/t;this.options.type===S.story&&(N[this.options.type].width=e),N[this.options.type].height=r(window).height()/10*9,this.options.size=f.calculateAspectRatioFit({width:f.toEven(e),height:f.toEven(n)},N[this.options.type]),this.options.type===S.story&&this.$el.toggleClass("b-gifx__margin_yes",e-30>this.options.size.width),this.options.style=this.getStyle(),this.options.type===S.story?this.$el.attr("style",this.getStyle()):this.$els.player.attr("style",this.options.style)},checkSupport:function(){var e=this;return i.each(b,function(t){var n=e.$els.player.data("size-"+t),r=y[t];if(!n)return this;e.options.formats[t]={size:n,video:r},t==="mp4"&&p&&(e.options.technologies.flash=t),t==="mp4"&&d&&(e.options.technologies.canvas=t),r&&!e.options.technologies.video&&(e.options.technologies.video=t)}),v&&this.$els.player.data("size-webp")&&(this.options.formats.webp={size:this.$els.player.data("size-webp")},this.options.technologies.webp=E.webp),this},setTechnology:function(e){var t;return e===this.options.currentTechnology?this:(this.options.currentTechnology=e,this.options.fileSize=this.options.formats[this.options.technologies[e]].size,t=this.options.fileSize&&this.getSize(this.options.fileSize),this.$els.size.text(t||"").toggle(Boolean(t)),this)},previewReady:function(){var e;return this.state===w.loading&&this.setState(w.waiting),this.$els.player.css("background-image","url("+this.$els.previewImage.attr("src")+")"),this},getSize:function(e){return e>1e3?(e/1024).toFixed(1)+" Мб":e+" Кб"},clear:function(){if(this.$els.video&&i.isFunction(this.$els.video[0].pause))try{this.$els.video[0].pause(),this.$els.video.off()}catch(e){}return this.$els.gif&&this.$els.gif.attr("src","/images/1x1.png").remove(),this._canvasPlayer&&(this._canvasPlayer.pause(),cancelAnimationFrame(this._canvasPlayer.animationFrame),delete this._canvasPlayer.ctx,delete this._canvasPlayer.video,delete this._canvasPlayer.canvas,delete this._canvasPlayer,this.$els.canvas.remove()),this.$els.player.empty(),this._loadingVideo&&clearInterval(this._loadingVideo),this.$els._loading&&this.$els._loading.empty().remove(),delete this.$els._loading,this},setState:function(e){var t=this;return e===this.state?this:(i.each(["hide","show"],function(n){var r=!0;if(t.state===w.waiting&&t.options.type==="story"&&!t.options.fileSize||t.state===w.playing&&t.options.size.width&&(t.options.size.width<=50||t.options.size.height<=50))r=!1;t.$els[t.state].attr("style","").toggle(r).removeClass("b-gifx__state_show_no b-gifx__state_show_yes").addClass(n==="hide"?"b-gifx__state_show_no":"b-gifx__state_show_yes"),t.state===w.loading&&n==="hide"&&t.$els[t.state].find("i").removeClass("fa-spin"),t.state===w.loading&&n==="show"&&t.setLoading(),t.state=e}),this.$els.playing.hasClass("tooltipstered")&&this.$els.playing.tooltipster("destroy"),this)},setLoading:function(e){return i.isUndefined(e)||e>=100?(this.$els.loading.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),this.$els._loading&&this.$els._loading.empty().remove(),delete this.$els._loading,this):this.$els._loading?(this.$els._loading.val(e).trigger("change"),this):(this.$els._loading=r('<input type="text" value="'+e+'" class="b-gifx__dial">'),this.$els.loading.empty(),this.$els._loading.appendTo(this.$els.loading).knob({readOnly:!0,width:13,height:13,inline:!1,displayInput:!1,fgColor:"#fff",bgColor:"none"}),this)},toggle:function(e){return e&&e.target&&(r(e.target).is("a")||r(e.target).parent().hasClass("b-gifx__save"))?this:(e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),this.shown=i.isBoolean(e)?e:!this.shown,this.$els.errorOverlay&&this.$els.errorOverlay.is(":visible")&&(this.$els.errorOverlay.hide(),this.$els.player.removeClass("b-gifx__player_error_yes")),this.$els.preview.toggleClass("b-gifx__preview_show_yes",!this.shown),this.$els.player.toggleClass("b-gifx__player_show_yes",this.shown),!this.shown&&this.ready?(this.setState(w.waiting),this.clear().ready=!1,this):(!this.ready&&this.init(),this))},init:function(){switch(this.options.currentTechnology){case E.video:this.createVideo();break;case E.flash:this.createFlash();break;case E.canvas:this.createCanvas();break;case E.webp:this.createWebP();break;case E.gif:default:this.createGif()}return this.ready=!0,this},showErrorOverlay:function(){var t=this;return this.$els.gif.remove(),this.$els.player.addClass("b-gifx__player_error_yes"),this.$els.errorOverlay?(this.$els.errorOverlay.show(),this):(this.$els.errorOverlay=r(o(e("./templates/error-overlay.html"))()).appendTo(this.$el),this.$els.errorOverlay.find(".b-gifx__try-again").click(function(e){e.preventDefault(),t.$els.player.removeClass("b-gifx__player_error_yes"),t.$els.errorOverlay.hide(),t.toggle(!1).toggle(!0)}),this)},createWebP:function(){var e=this;return this.$els.gif=r(document.createElement("img")).appendTo(this.$els.player).addClass("b-gifx__gif").bind("error",function(){return e.setTechnology(E.gif),e.clear().createGif()}).attr("src",this.options.src+"webp"),this.setState(w.playing),this},createGif:function(){var e=this;return this.$els.gif=r(document.createElement("img")).appendTo(this.$els.player).addClass("b-gifx__gif").on("error",i.bind(this.showErrorOverlay,this)).on("load",function(){e.$els.player.css("background-image","")}).attr("src",this.options.src+"gif"),this.setState(w.playing),this},createFlash:function(){return this.options.flash=u.config("freeze:modules:gifx:gifx.swf"),this.$els.player.append(o(e("./templates/flash.html"))(this.options)),this.$els.player.find(".b-gifx__overlay").bind({mousedown:i.bind(this.createHint,this)}),this.setState(w.loading),this._flashTimeout=setTimeout(i.bind(this.onErrorFlash,this),5e3),this},onInitFlash:function(){return clearTimeout(this._flashTimeout),this.loaded=!0,this.setState(w.playing)},onErrorFlash:function(){return a.error(":gifx:","error loading Flash",this.options.technologies[E.flash]),this.options.technologies[E.webp]?(this.setTechnology(E.webp),this.clear().createWebP()):(this.setTechnology(E.gif),this.clear().createGif())},loadingVideo:function(){var e=this,t=this.$els.video[0],n;return this._loadingVideo=setInterval(function(){var r=t.duration,i=t.buffered,s=i.length,o;while(s--)o=i.end(s)/r-i.start(s)/r;n=Number((o*100).toFixed()),e.setLoading(n),n>=100&&(e.setState(w.playing),clearInterval(e._loadingVideo))},50),this},createVideo:function(){var t=this;return this.$els.player.append(o(e("./templates/player.html"))(i.extend({flash:o(e("./templates/flash.html"))(this.options)},this.options))),this.$els.video=this.$els.player.find(".b-gifx__video"),this.loaded?this.setState(w.playing):this.$els.video.bind({loadstart:function(){t.setState(w.loading)},canplay:function(){!t._hasMeta&&t.setState(w.playing),t.loaded=!0},loadedmetadata:function(){return t.state===w.playing?!0:(t.setLoading(0),t._hasMeta=!0,t.loadingVideo(),!0)}}),this.$els.video.bind({mousedown:i.bind(this.createHint,this)}),this.$els.video.find("source").bind({error:function(){a.error(":gifx:","error loading HTML5 video",t.options.technologies[E.video]),t._loadingVideo&&clearInterval(t._loadingVideo),t.clear(),t.options.technologies[E.flash]?(t.setTechnology(E.flash),t.clear().createFlash()):t.options.technologies[E.webp]?(t.setTechnology(E.webp),t.clear().createWebP()):(t.setTechnology(E.gif),t.clear().createGif())}}),this.$els.video[0].play(),this},createCanvas:function(){var t=this;return this.$els.player.append(o(e("./templates/canvas.html"))(this.options)),this.$els.video=this.$els.player.find(".b-gifx__video"),this.$els.canvas=this.$els.player.find("canvas"),this._canvasPlayer=new(e("./canvas"))({video:this.$els.video[0],canvas:this.$els.canvas[0]}),this.loaded?this.setState(w.playing):this.$els.video.bind({loadstart:function(){t.setState(w.loading)},canplay:function(){!t._hasMeta&&t.setState(w.playing),t.loaded=!0},loadedmetadata:function(){return t.state===w.playing?!0:(t.setLoading(0),t._hasMeta=!0,t.loadingVideo(),!0)}}),this.$els.video.bind({mousedown:i.bind(this.createHint,this)}),this._loadVideoFailed=function(){a.error(":gifx:","error loading HTML5 video",t.options.technologies[E.video]),t._loadingVideo&&clearInterval(t._loadingVideo),t.clear(),t.options.technologies[E.flash]?(t.setTechnology(E.flash),t.clear().createFlash()):t.options.technologies[E.webp]?(t.setTechnology(E.webp),t.clear().createWebP()):(t.setTechnology(E.gif),t.clear().createGif())},this.$els.video.on("error",this._loadVideoFailed),this.$els.video.find("source").bind({error:this._loadVideoFailed}),this},createHint:function(e){var t=this;if(e.button!==2)return!0;setTimeout(function(){t.$els.playing.hasClass("tooltipstered")&&t.$els.playing.tooltipster("destroy").attr("title","")},2e3),this.$els.playing.attr("title","Сохранить GIF").tooltipster({position:"right",theme:"tooltipster-shadow-error",delay:100,functionAfter:function(e){e.attr("title","")}}).tooltipster("show")},getStyle:function(e,t){return e=e||"",t=t||this.options.size,[t.width?e+"width: "+t.width+"px;":"",t.height?e+"height: "+t.height+"px;":""].join(" ")}});var O=i.extend({init:function(){m.promise().then(function(){n.exports.initStory(),n.exports.initComment()})},initComment:function(){m.promise().then(function(){return r('.b-gifx[data-type="comment"]').each(function(e,t){L(r(t),u.config("gif:showComment"),!1)})})},initStory:function(){m.promise().then(function(){return r('.b-gifx[data-type="story"]').each(function(e,t){L(r(t),u.config("gif:showStory"),!1)})})},current:function(e){k.apply(e)},show:function(){r(".b-gifx").each(function(e,t){r(t).click()})}},h);n.exports=O},"gifx/technologies":function(e,t,n){var r=e("underscore"),i=e("../core"),s=i.config("GET:gifxForce");n.exports={video:function(e){var t=document.createElement("video"),n=!1,o=i.ua.device.family==="iPhone"||i.ua.browser.family==="Android"&&i.ua.device.type==="Mobile"||i.ua.browser.family==="Chrome Mobile"||i.ua.browser.family==="Chrome"&&i.ua.os.family==="Android"&&i.ua.device.type==="Desktop"||i.ua.browser.family==="Chrome"||i.ua.browser.family==="Chrome Mobile"&&i.ua.source.indexOf("OPR/")>-1||!t.canPlayType;return s&&(r.isFunction(alert)&&alert("gifxForce:on"),o=s!=="video"&&s!=="auto"),r.each(e,function(r,i){e[i]=o?!1:Boolean(t.canPlayType(r).replace(/^no$/,"")),e[i]&&!n&&(n=!0)}),n},webp:function(){var e=$.Deferred();return e.reject(),e.promise()},canvas:function(){return i.ua.device.family==="iPhone"&&i.ua.os.major>7},flash:function(){var e;return!1}}},"image-viewer/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../image-viewer-core"),o=function(){this._init()};o.isShown=!1,i.extend(o.prototype,s.prototype,{_setupViwer:function(){this._startupAnim.duration=501,this._skipImageStartupAnim=!0,this._useSwipeForClose=!0},_preaprePage:function(){o.isShown=!0},_restorePage:function(){o.isShown=!1}}),n.exports=o},"image-viewer-core/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/events"),u=function(){};i.extend(u.prototype,o,{_useTouchEvent:!1,_showImageBackground:!1,_showScrollArrows:!1,_useSwipeForClose:!1,_useHistoryState:!0,_closeByClick:!1,_clickEventName:"click",_container:null,_head:null,_scaleBar:null,_frame:null,_img:null,_arrowDown:null,_arrowUp:null,_hotkeysInfo:null,_hotkeysInfoShadow:null,_closeMsg:null,_closeMsgShowPercent:0,_imgBg:null,_startupAnim:{duration:500},_skipImageStartupAnim:!1,_finishAnim:{duration:500},_animProps:{curr:0,dur:20,method:"cubic",timer:0},_makeAnimationStepBound:null,_transform:{x:0,y:0,scale:1},_transformSaved:{x:0,y:0,scale:1},_transformApplied:{x:0,y:0,scale:1},_minScale:.1,_maxScale:3,_shown:!1,_loaded:!1,_lastScrollY:0,_bigImage:null,_imageURL:"",_imageLargeURL:"",_padding:20,_topIndent:20,_debugBox:null,_init:function(){var e=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(String(navigator.userAgent||navigator.vendor||window.opera).substr(0,4)),t=e||/ipad|android|xoom|sch-i800|playbook|kindle/i.test(navigator.userAgent||navigator.vendor||window.opera);this._useTouchEvent="ontouchstart"in document.documentElement&&(t||e),this._clickEventName=this._useTouchEvent&&jQuery.fn.touch!==undefined?"touch":"click"},show:function(e){var t=this;return e=r(e).get(0),this._setupViwer(),this._padding=this._showImageBackground?40:20,this._topIndent=45,this._useHistoryState&&(window.history.pushState({},document.title),r(window).on("popstate.imageView",function(){t.hide()})),r(document).on("keyup.imageView",function(e){switch(e.key||e.keyCode){case"Escape":case 27:t.hide()}}),r(document).on("keydown.imageView",function(e){switch(e.key||e.keyCode){case"ArrowUp":case 38:e.preventDefault(),t._scrollUp(5);break;case"PageUp":case 33:e.preventDefault(),t._scrollUp(1);break;case"ArrowDown":case 40:e.preventDefault(),t._scrollDown(5);break;case"PageDown":case 34:e.preventDefault(),t._scrollDown(1);break;case"Tab":case 9:t._togglePanels()}}),this._container||(this._makeAnimationStepBound=i.bind(this._makeAnimationStep,this),r(window).on("resize.imageView",i.bind(this._correctPosition,this)),this._create()),this._img.src=this._imageURL=e.src,e.getAttribute("data-large-image")&&(this._imageLargeURL=e.getAttribute("data-large-image")),this._head.css("margin-top","-45px").animate({"margin-top":0},this._startupAnim.duration),this._container.css("opacity",0).animate({opacity:1},this._startupAnim.duration,function(){t._preaprePage(),t._shown=!0,t._loaded&&t._prepareImage()}),r("body").append(this._container),this},_setupViwer:function(){},_preaprePage:function(){},_restorePage:function(){},hide:function(){var e=this;return r(window).off("resize.imageView popstate.imageView"),r(document).off("keyup.imageView keydown.imageView"),this._restorePage(),this._container?(setTimeout(function(){r(e._img).remove(),e._imgBg&&r(e._imgBg).remove(),e._head.animate({"margin-top":-45},e._finishAnim.duration),e._container.css("pointer-events","none").animate({opacity:0},e._finishAnim.duration,function(){e._container.remove(),e._container=null})},50),this._closeMsgShowPercent>0&&this._setCloseMessagePosition(!0),this):this},_togglePanels:function(){this._head.toggleClass("iv-force-hide");var e=this._head.hasClass("iv-force-hide");this._arrowDown&&(this._arrowDown.toggleClass("iv-force-hide",e),this._arrowUp.toggleClass("iv-force-hide",e)),this._hotkeysInfo&&(this._hotkeysInfo.toggleClass("iv-force-hide",e),this._hotkeysInfoShadow.toggleClass("iv-force-hide",e))},_create:function(){this._container=r("<div>").addClass("img-viewer").append(this._createHeading()).append(this._createImgFrame()),"ontouchstart"in document&&this._container.on("touchmove",function(e){e.stopPropagation(),e.preventDefault()})},_createHeading:function(){var e,t,n,s=this;return this._head=r("<div>").addClass("iv-head").append(n=r("<div>").addClass("iv-link").append('<i class="fa fa-external-link"></i> Ссылка')).append(e=r("<div>").addClass("iv-scale").append('<i class="fa fa-search-plus"></i> <span>100%</span>')).append(t=r("<div>").addClass("iv-close").append('<i class="fa fa-close"></i>')),t.on(this._clickEventName,i.bind(this.hide,this)),n.on(this._clickEventName,function(){window.open(s._imageLargeURL||s._imageURL)}),this._scaleBar=e.find("span"),e.on(this._clickEventName,function(){s._setImageStartupProps(),s._animateImgProps()}),this._head},_createImgFrame:function(){var e=this;this._img=document.createElement("img"),this._img.onload=function(){e._loaded=!0,e._shown&&e._prepareImage()},this._frame=r("<div>").addClass("iv-frame").append(this._img);if(this._closeByClick){var t=!1;this._frame.on("mousedown click",function(n){n.type=="mousedown"?t=!0:n.type=="click"&&n.target==e._frame[0]&&t&&e.hide()})}this._showImageBackground&&(this._imgBg=document.createElement("div"),this._imgBg.className="iv-bg",this._frame.append(this._imgBg));if(this._showScrollArrows){this._arrowDown=r("<div>").addClass("iv-arrow iv-arrow-down").html('<i class="fa fa-chevron-down"></i>').click(i.bind(this._scrollDown,this)),this._frame.append(this._arrowDown),this._arrowUp=r("<div>").addClass("iv-arrow iv-arrow-up").html('<i class="fa fa-chevron-up"></i>').click(i.bind(this._scrollUp,this));if(!this._useTouchEvent&&window.innerWidth>1e3){var n=navigator.platform.indexOf("Mac")>-1;this._frame.append(this._hotkeysInfoShadow=r("<div>").addClass("iv-hotkeys-info").html('<i class="fa fa-long-arrow-up"></i><br><span>'+(n?"cmd":"ctrl")+' + scroll</span><br><i class="fa fa-long-arrow-down"></i>')),this._frame.append(this._hotkeysInfo=r("<div>").addClass("iv-hotkeys-info iv-hotkeys-info--shifted").html('<i class="fa fa-long-arrow-up"></i><br><span>'+(n?"cmd":"ctrl")+' + scroll</span><br><i class="fa fa-long-arrow-down"></i>'))}this._frame.append(this._arrowUp)}this._useSwipeForClose&&(this._closeMsg=r("<div>").addClass("iv-close-msg").text("закрыть"),this._frame.append(this._closeMsg));var s=this._frame[0],o=i.bind(this._zoomByWheel,this);return s.addEventListener("MozMousePixelScroll",o,!1),s.addEventListener("mousewheel",o,!1),this._listenImageEvents(),this._frame},_listenImageEvents:function(){var e=this,t=0,n=0,r=0,i=0,s=0,o=0;if(this._useTouchEvent){var u=0,a=!1,f=0,l=this._useSwipeForClose,c=[],h=!1,p=function(e){var t=e.length,n=0,r=0,i,s,o,u,a=0;for(var f=0;f<t;f++){i=e[f].clientX,s=e[f].clientY,n+=i,r+=s;for(var l=0;l<t;l++)f!=l&&(o=e[l].clientX,u=e[l].clientY,a+=Math.sqrt((i-o)*(i-o)+(s-u)*(s-u)))}return a==0&&(a=1),{x:n/t,y:r/t,s:a/t}};this._img.addEventListener("touchstart",function(u){var l=p(u.touches);u.touches.length>1&&(a=!0),c=u.touches,t=l.x,n=l.y,r=l.s,i=e._transform.x,s=e._transform.y,o=e._transform.scale,f=0},!1),this._img.addEventListener("touchmove",function(u){u.stopPropagation(),u.preventDefault();var d;if(h||c.length!=u.touches.length)d=p(u.touches),t=d.x,n=d.y,r=d.s,i=e._transform.x,s=e._transform.y,o=e._transform.scale,a=!0,h=!1;d=p(u.touches);var v=d.x-t,m=d.y-n,g=d.s/r;c=u.touches,f=0;if(Math.abs(v)>10||Math.abs(m)>10)a=!0;var y=Math.min(e._maxScale,Math.max(e._minScale,o*g)),b=e._calculateZoomShift(y,o,i,s);e._transform.x=b.x+v,e._transform.y=b.y+m,e._transform.scale=y,e._applyTransform(),l&&e._setCloseMessagePosition()},!1),this._img.addEventListener("touchend",function(t){var n=t.changedTouches.length;if(c.length>n+f)h=!0,f+=n;else{f=0;if(e._closeMsgShowPercent>.95){e.hide();return}e._closeMsgShowPercent>0&&e._setCloseMessagePosition(!0),e._correctPosition(!0);if(!a){var r=(new Date).getTime();r-u<500?(u=0,e._transform.scale>=1.45?(e._setImageStartupProps(),e._animateImgProps("cubic",10)):(e._transform.scale=1.5,e._correctPosition(!0))):u=r}else a=!1}},!1)}else this._img.addEventListener("mousedown",function(r){r.stopPropagation(),r.preventDefault(),t=r.clientX!==undefined?r.clientX:r.pageX,n=r.clientY!==undefined?r.clientY:r.pageY,i=e._transform.x,s=e._transform.y;var o=e._img.width*e._transform.scale,u=e._img.height*e._transform.scale,a=e._frame.width()-e._padding*2,f=e._frame.height()-e._padding*2-e._topIndent,l=e._transform.x-o/2,c=e._transform.y-u/2,h=0,p=function(r){r.stopPropagation(),r.preventDefault();var p=(r.clientX!==undefined?r.clientX:r.pageX)-t,d=(r.clientY!==undefined?r.clientY:r.pageY)-n;h=Math.max(h,p<0?-p:p,d<0?-d:d);if(l<0||l+o>a)e._transform.x=i+p;if(c<40||c+u>f)e._transform.y=s+d;e._applyTransform()},d=function(t){t.stopPropagation(),t.preventDefault(),document.removeEventListener("mousemove",p,!0),document.removeEventListener("mouseup",d,!0),e._correctPosition(!0),h<2&&t.button==0&&e._closeByClick&&e.hide()};document.addEventListener("mousemove",p,!0),document.addEventListener("mouseup",d,!0)},!1)},_scrollUp:function(e){this._transform.y+=this._frame.height()/(typeof e=="number"?e:2),this._correctPosition(!0)},_scrollDelta:function(e){this._transform.y+=e,this._correctPosition(!0)},_scrollDown:function(e){this._transform.y-=this._frame.height()/(typeof e=="number"?e:2),this._correctPosition(!0)},_loadBigImage:function(){if(this._bigImage)return;if(this._img.naturalWidth<400)return;var e=this,t=this._imageLargeURL;if(!t)return;this._bigImage=new Image,this._bigImage.onload=function(){e._imageURL=t;var n=e._img.naturalWidth/e._bigImage.naturalWidth;r(e._img).replaceWith(e._bigImage),e._img=e._bigImage,e._prepareImage(!0),e._transform.scale*=n,e._transformSaved.scale*=n,e._transformApplied.scale*=n,e._updateImgProps(),e._listenImageEvents()},this._bigImage.src=t},_correctPosition:function(e){var t=this._transform,n=this._img.width*t.scale,r=this._img.height*t.scale,i=this._frame.width(),s=this._frame.height();n<i?t.x=i/2:t.x-n/2>0?t.x=n/2:t.x+n/2<i&&(t.x=i-n/2);if(r<s)t.y=this._topIndent+this._padding+(s-this._padding*2-this._topIndent)/2,this._arrowDown&&this._arrowDown.removeClass("iv-show"),this._arrowUp&&this._arrowUp.removeClass("iv-show"),this._hotkeysInfoShadow&&this._hotkeysInfoShadow.removeClass("iv-show"),this._hotkeysInfo&&this._hotkeysInfo.removeClass("iv-show");else{t.y-r/2>this._padding+this._topIndent?t.y=this._padding+this._topIndent+r/2:t.y+r/2<s-this._padding&&(t.y=s-r/2-this._padding);var o=t.y-r/2<this._padding+this._topIndent,u=t.y+r/2>s-this._padding;this._arrowUp&&this._arrowUp.toggleClass("iv-show",o),this._arrowDown&&this._arrowDown.toggleClass("iv-show",u),this._hotkeysInfoShadow&&this._hotkeysInfoShadow.toggleClass("iv-show",u||o),this._hotkeysInfo&&this._hotkeysInfo.toggleClass("iv-show",u||o)}e&&this._animateImgProps("cubic",10)},_setCloseMessagePosition:function(e){if(e){this._closeMsg.css({bottom:"",opacity:""}),this._closeMsgShowPercent=0;return}var t=this._transform,n=this._img.height*t.scale,r=this._frame.height(),i;n<r?i=this._topIndent+this._padding+(r-this._padding*2-this._topIndent)/2:t.y-n/2>this._padding+this._topIndent?i=this._padding+this._topIndent+n/2:t.y+n/2<r-this._padding&&(i=r-n/2-this._padding);if(t.y<i){var s=Math.min(60,Math.max(0,(i-t.y)/3));this._closeMsgShowPercent=s/60,this._closeMsg.css({bottom:-60+s*2+"px",opacity:Math.max(.1,(this._closeMsgShowPercent-.5)*2)})}else this._closeMsgShowPercent>0&&(this._closeMsg.css({bottom:"",opacity:""}),this._closeMsgShowPercent=0)},_mouseScrollEvent:"",_zoomByWheel:function(e){e.preventDefault();if(e.type!==this._mouseScrollEvent){if(this._mouseScrollEvent!="")return;this._mouseScrollEvent=e.type}var t=e.wheelDelta||e.deltaY||-e.detail;if(e.ctrlKey||e.metaKey){this._scrollDelta(t);return}var n=this._transform,r=Math.min(this._maxScale,Math.max(this._minScale,this._transform.scale+(t>0?.12:-0.12))),i=this._calculateZoomShift(r,n.scale,n.x,n.y);this._transform.scale=r,this._transform.x=i.x,this._transform.y=i.y,this._correctPosition(),this._applyTransform()},_calculateZoomShift:function(e,t,n,r){var i=this._img.width,s=this._img.height,o=this._frame.width(),u=this._frame.height(),a=i*t,f=i*t,l=i*e,c=i*e,h=o/2,p=u/2,d=h-(n-a/2),v=p-(r-f/2),m=h-d/t*e+l/2,g=p-v/t*e+c/2;return{x:m,y:g}},_prepareImage:function(e){var t=this._img.style,n=this._img.naturalWidth,r=this._img.naturalHeight,i=this._frame.width(),s=this._frame.height();if(t.visibility=="visible"&&!e)return;t.left=String(-(n/2))+"px",t.top=String(-(r/2))+"px",this._minScale=Math.min(1/(n/(i*.3)),1/(r/(s*.6))),e||(this._setImageStartupProps(),n>1e3||r>800||this._skipImageStartupAnim?this._applyTransform():(this._transformApplied.x=this._transform.x,this._transformApplied.y=this._transform.y,this._transformApplied.scale=.1,this._animateImgProps("cubic",10))),t.visibility="visible",e||this._loadBigImage()},_setImageStartupProps:function(){var e=this._img.width,t=this._img.height,n=this._frame.width()-this._padding*2,r=this._frame.height()-this._padding*2-this._topIndent,i=Math.min(2,n/e,r/t);i<.9&&t>r*.5&&e*i<n*.5&&(i=Math.min(800,n*.8)/e),this._transform.scale=Math.max(i,this._minScale),this._transform.x=this._padding+n/2,this._transform.y=this._topIndent+this._padding+r/2,this._transform.y-t*i/2<this._padding&&(this._transform.y=t*i/2+this._padding+this._topIndent),t*this._transform.scale<this._frame.height()?(this._arrowDown&&this._arrowDown.removeClass("iv-show"),this._arrowUp&&this._arrowUp.removeClass("iv-show"),this._hotkeysInfo&&this._hotkeysInfo.removeClass("iv-show"),this._hotkeysInfoShadow&&this._hotkeysInfoShadow.removeClass("iv-show")):(this._arrowUp&&this._arrowUp.removeClass("iv-show"),this._arrowDown&&this._arrowDown.addClass("iv-show"),this._hotkeysInfo&&this._hotkeysInfo.addClass("iv-show"),this._hotkeysInfoShadow&&this._hotkeysInfoShadow.addClass("iv-show"))},_applyTransform:function(){this._animProps.timer&&clearTimeout(this._animProps.timer),this._transformApplied.x=this._transform.x,this._transformApplied.y=this._transform.y,this._transformApplied.scale=this._transform.scale,this._updateImgProps()},_animateImgProps:function(e,t){var n=this._animProps;n.timer&&clearTimeout(n.timer),this._transformSaved.x=this._transformApplied.x,this._transformSaved.y=this._transformApplied.y,this._transformSaved.scale=this._transformApplied.scale,n.curr=0,n.dur=t||20,n.method=e||"cubic",this._makeAnimationStep()},_makeAnimationStep:function(){var e=this._animProps;if(++e.curr<=e.dur){var t=this._easing(e.method,e.curr,0,1,e.dur),n=this._transformSaved,r=this._transform;this._transformApplied.x=n.x+(r.x-n.x)*t,this._transformApplied.y=n.y+(r.y-n.y)*t,this._transformApplied.scale=n.scale+(r.scale-n.scale)*t,this._updateImgProps(),e.timer=setTimeout(this._makeAnimationStepBound,41)}},_prevScaleText:null,_updateImgProps:function(){var e=this._img.style,t=this._transformApplied,n="translate3d("+t.x+"px, "+t.y+"px, 0px) scale3d("+t.scale+", "+t.scale+", 1)";e.transform=n,e.MozTransform=n,e.webkitTransform=n;if(this._imgBg){var r=this._img.width*t.scale,i=this._img.height*t.scale;n="translate3d("+(t.x-r/2-10)+"px, "+(t.y-i/2-10)+"px, 0px)",e=this._imgBg.style,e.width=String(r+20)+"px",e.height=String(i+20)+"px",e.transform=n,e.MozTransform=n,e.webkitTransform=n}var s=Math.round(t.scale*100)+"%";this._prevScaleText!=s&&(this._prevScaleText=s,this._scaleBar.text(s))},_easing:function(e,t,n,r,i){var s=Math.PI*2,o=n>r,u=n;o?(u=r,r=n-r,n=u):r-=n;switch(e){default:case"linear":u=r*t/i+n;break;case"cubic":o?u=r*(t/=i)*t*t+n:u=r*((t=t/i-1)*t*t+1)+n;break;case"exponential":u=t==0?n:r*Math.pow(2,10*(t/i-1))+n-r*.001,t==i&&(u=r+n);break;case"bounce":(t/=i)<1/2.75?u=r*7.5625*t*t+n:t<2/2.75?u=r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?u=r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:u=r*(7.5625*(t-=2.625/2.75)*t+.984375)+n;break;case"elastic":if(t==0)u=n;else if((t/=i)==1)u=n+r;else{var a=i*.3,f=a/4;u=r*Math.pow(2,-10*t)*Math.sin((t*i-f)*s/a)+r+n}}return o&&(u=n+(r+n-u)),u}}),n.exports=u},"moderator-tools/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core/log"),o=e("../popup-box"),u=e("../core"),a=e("../core/events"),f=function(){this._reasons={},this._isModalBox=u.config("clientType")=="mobile"};f._reasons={},f._lastBox=null,f._lastTargetKey=null,i.extend(f.prototype,a,{_isModalBox:!1,_lastTarget:null,_processed:!1,showDeleteStoryDialog:function(e,t){this._createBox(e,0,t)},showDeleteCommentDialog:function(e,t){this._createBox(e,1,t)},showBanUserDialog:function(e,t,n,r){this._createBox(e,r==1?2:3,t,n)},setStoryAdultFlag:function(e,t,n){this._setStoryFlag("set_adult",e,t,n)},setStoryAuthorsFlag:function(e,t,n){this._setStoryFlag("set_authors",e,t,n)},setStoryVisibilityFlag:function(e,t,n){this._setStoryFlag("set_story_visibility",e,t,n)},restoreStory:function(e,t,n){var i=this;r.post("/ajax/moderator_actions.php",{action:n?"restore_repost":"restore_story",story_id:t},function(t){t.result?i.trigger("complete"):i.trigger("rejected",t.message)!==!1&&i._showError(e,t.message)},"json").error(function(){i._showError(e,"Нет связи с космосом!")})},restoreComment:function(e,t){var n=this;r.post("/ajax/moderator_actions.php",{action:"restore_comment",comment_id:t},function(t){t.result?n.trigger("complete"):n.trigger("rejected",t.message)!==!1&&n._showError(e,t.message)},"json").error(function(){n._showError(e,"Нет связи с космосом!")})},getCommentRestoreHistory:function(e,t){var n=this;r.post("/ajax/moderator_actions.php",{action:"get_comment_restore_history",comment_id:t},function(t){t.result?n.trigger("complete",t.data):n.trigger("rejected",t.message)!==!1&&n._showError(e,t.message)},"json").error(function(){n._showError(e,"Нет связи с космосом!")})},moveStoryToCommonFeed:function(e,t){var n=this;r.post("/ajax/moderator_actions.php",{action:"move_to_common_feed",story_id:t},function(t){t.result?n.trigger("complete"):n.trigger("rejected",t.message)!==!1&&n._showError(e,t.message)},"json").error(function(){n._showError(e,"Нет связи с космосом!")})},_setStoryFlag:function(e,t,n,i){var s=this;this._lastTarget=r(t),this._processed=!1,f._lastTargetKey="",this._closeCurrentBox(),r.post("/ajax/moderator_actions.php",{action:e,story_id:n,flag:i?"1":"0"},function(e){s._processed=!0,e.result?(s._closeCurrentBox(),s.trigger("complete")):s._showError(s._lastTarget,e.message)},"json").error(function(){s._showError(s._lastTarget,"Нет связи с космосом!")})},_createBox:function(e,t,n,i){i===undefined&&(i=0),this._lastTarget=r(e);var s=this,o=String(t)+"_"+String(n)+"_"+String(i),u=f._lastBox;if(u&&u.isShown()&&f._lastTargetKey==o){f._lastTargetKey="",u.hide();return}this._closeCurrentBox(),f._lastTargetKey=o,this._processed=!1;var a={current_ban:null,ban_count_info:null,ban_for_story:0,ban_for_comment:0,message:""};if(f._reasons[t]===undefined||t==2||t==3){var l={};l.action="get_info",f._reasons[t]===undefined&&(l.provide_reasons="Y"),t==2?(l.check_ban=n,l.check_story_ban=i,l.target_id=i,l.target_type=1):t==3?(l.check_ban=n,l.check_comment_ban=i,l.target_id=i,l.target_type=2):t==0?(l.target_id=n,l.target_type=1):t==1&&(l.target_id=n,l.target_type=2);var c=!1;r.ajax({url:"/ajax/moderator_actions.php",method:"POST",data:l,async:!1,dataType:"json",success:function(e){e.result?(c=!0,e.data.reasons!==undefined&&(f._reasons=e.data.reasons),e.data.ban!==undefined&&(a.current_ban=e.data.ban),e.data.ban_count_info!==undefined&&(a.ban_count_info=e.data.ban_count_info),e.data.ban_for_story!==undefined&&(a.ban_for_story=e.data.ban_for_story),e.data.ban_for_comment!==undefined&&(a.ban_for_comment=e.data.ban_for_comment)):s._showError(s._lastTarget,e.message)},error:function(){s._showError(s._lastTarget,"Нет связи с космосом!")}});if(!c||f._reasons[t]===undefined)return;if(a.current_ban!==null&&a.current_ban.status){this._showBanInfo(this._lastTarget,a.current_ban);return}if(a.ban_for_story||a.ban_for_comment){if(a.ban_for_story==1){this._showError(this._lastTarget,"Пользователь уже понес наказание за данный пост. ","warning");return}if(a.ban_for_story==2)a.message+="Пользователь был забанен ренее за данный пост, но бан был снят администрацией. ";else{if(a.ban_for_comment==1){this._showError(this._lastTarget,"Пользователь уже понес наказание за данный комментарий. ","warning");return}a.ban_for_comment==2&&(a.message+="Пользователь был забанен ренее за данный комментарий, но бан был снят администрацией. ")}}}var h=function(e){s._doAction(t,n,i,e)};this._isModalBox?u=this._createModalBox(e,t,h,a):u=this._createBalloonBox(e,t,h,a),f._lastBox=u,u.addListener("close",function(){f._lastBox=null,f._lastTargetKey="",s._processed||s.trigger("cancel")}),u.isShown()||u.show(e)},_createBalloonBox:function(e,t,n,i){var s=0,u,a=f._reasons[t],l,c,h,p,d,v,m,g,y=10;switch(t){default:case 0:v="Причина удаления поста",m="удалить",g="удалить",c="удалить пост";break;case 1:v="Причина удаления комментария",m="удалить",g="удалить",c="удалить комментарий";break;case 2:v="Причина бана за пост",m="забанить",g="внести",c="внести пользователя в игнор-лист сообщества";break;case 3:v="Причина бана за комментарий",m="забанить",g="внести",c="внести пользователя в игнор-лист сообщества"}if(!a||jQuery.isEmptyObject(a))h="Вы действительно хотите "+c+"?",h+="<div>",h+='<a data-role="yes" class="b-button b-button_type_green" href="javascript: void(0)">Да, '+g+"</a>",h+='<a data-role="no" href="javascript: void(0)">Отмена</a>',h+="</div>",y=20,l=r("<div>").addClass("mt-question-box").html(h),l.find("a").on("click",function(){var e=this.getAttribute("data-role");e=="yes"?n("0"):u.hide()});else{h='<div class="mt-list"><span>'+v+":</span>";for(d in a){if(!a.hasOwnProperty(d))continue;p="mt_reason_"+d,h+='<div>   <input type="radio" id="'+p+'" '+(s++==0?'checked="checked"':"")+' name="mt_reason" value="'+d+'">'+'   <label for="'+p+'">'+a[d].name+"</label>"+"</div>"}h+='<div class="mt-button">   <a data-role="apply">'+m+"</a>"+"</div>"+"</div>",i.message&&(h+='<div class="mt-msg">',h+='<i class="fa fa-warning"></i> '+i.message,h+="</div>"),i.ban_count_info&&(h+='<div class="mt-ban-info"><a href="'+i.ban_count_info.profile+'" target="_blank">История банов ('+i.ban_count_info.count+")</a>"+"</div>"),l=r("<div>").addClass("mt-reasons-box").html(h),l.find('a[data-role="apply"]').on("click",function(){var e=l.find("input:checked");if(e.length>0){var t=e.val();l.find("a").replaceWith('<div class="mt-loader">...выполняется...</div>'),n(t)}})}return u=(new o).allowAutoHide(!0).setAlignment("center").setDirection(t==1||t==3?"top":"bottom").setInnerIndent(y).append(l).setDistance(5)},_createModalBox:function(e,t,n,i){var s=0,u=f._reasons[t],a,l,c,h,p,d;switch(t){default:case 0:h="Удаление поста",p="удалить",d="Вы действительно хотите удалить пост?";break;case 1:h="Удаление комментария",p="удалить",d="Вы действительно хотите удалить комментарий?";break;case 2:h="Бан за пост",p="забанить",d="Вы действительно хотите забанить автора поста?";break;case 3:h="Бан за комментария",p="забанить",d="Вы действительно хотите забанить автора комментария?"}a="";var v;if(!u||jQuery.isEmptyObject(u))return(new o).showConfirm(e,d,function(){n("0")});i.message&&(a+='<div style="margin-bottom: 10px; white-space: normal; max-width: 400px; padding: 10px; background-color: #ffeded; color: #888">',a+='<i class="fa fa-warning" style="color: darkred"></i> '+i.message,a+="</div>");for(c in u){if(!u.hasOwnProperty(c))continue;l="mt_reason_"+c,a+='<div class="ppb-radio">   <input type="radio" id="'+l+'" '+(s++==0?'checked="checked"':"")+' name="mt_reason" value="'+c+'">'+'   <label for="'+l+'">'+u[c].name+"</label>"+"</div>"}i.ban_count_info&&(a+='<div style="margin-top: 10px; padding: 10px; background-color: #ffeded">',a+='<a href="'+i.ban_count_info.profile+'" target="_blank" style="color: #888; text-decoration: underline">История банов ('+i.ban_count_info.count+")</a>",a+="</div>"),v=r("<div>").addClass("ppb-menu").html(a);var m=function(){var t=v.find("input:checked");if(t.length>0){var r=t.val();(new o).showConfirm(e,d,function(){n(r)})}};return(new o).setModalMode(!0).appendHeading(h).showCloseButtonIntoHeading(!1).addButtonIntoFooter(p,m,"warning").addCloseButtonIntoFooter().append(v)},_doAction:function(e,t,n,i){var s=this,o=f._reasons[e],u="";switch(e){case 0:u="remove_story";break;case 1:u="remove_comment";break;case 2:u="ban_for_story";break;case 3:u="ban_for_comment";break;default:return}r.post("/ajax/moderator_actions.php",{action:u,item_id:t,item_subid:n,reason_id:i},function(t){s._processed=!0,t.result?(s._closeCurrentBox(),s.trigger("complete",o&&o[i]?o[i].name:""),(e==2||e==3)&&t.data.status&&s._showBanInfo(s._lastTarget,t.data)):s.trigger("rejected",t.message)!==!1&&s._showError(s._lastTarget,t.message)},"json").error(function(){s._showError(s._lastTarget,"Нет связи с космосом!")})},_closeCurrentBox:function(){var e=f._lastBox;e&&e.isShown()&&(e.hide(),f._lastBox=null)},_showBanInfo:function(e,t){if(!e)return;var n;this._closeCurrentBox(),this._isModalBox?(n="Пользователь забанен модератором "+t.moderator_name+"."+(t.reason?"<hr>Причина: "+t.reason+".":"")+(t.time_end?"<hr>Время: до "+t.time_end:""),f._lastBox=(new o).showMessage(e,n,"warning")):(t.reason&&t.time_end?n='<div style="border-bottom: 1px dotted #aaa">Пользователь забанен модератором '+t.moderator_name+"</div>"+'<div style="color: #aaa; font-size: 0.9em">Причина: '+t.reason+".<br>Время: до "+t.time_end+"</div>":n="Пользователь забанен модератором "+t.moderator_name,f._lastBox=(new o).allowAutoHide(!0).setAlignment("center").setDirection("bottom").setInnerIndent(10).setDistance(5).append('<div style="color: #777; line-height: 25px">'+n+"</div>").show(e))},_showError:function(e,t,n){if(!e)return;t||(t="Что-то плохое случилось :("),this._processed=!0,this._closeCurrentBox(),this.trigger("cancel"),f._lastTargetKey="",f._lastBox=(new o).showMessage(e,t,n?n:"error")}}),n.exports=f},"moderators-chat/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core"),u=e("medium-editor"),a=e("../core/events"),f=function(){this._onClickByUserNameBound=i.bind(this._onClickByUserName,this),this._onClickByUserAvatarBound=i.bind(this._onClickByUserAvatar,this),this._updateListBound=i.bind(this._updateList,this)};i.extend(f.prototype,a,{_isMobileEnv:!1,_roomID:1,_editor:null,_textInput:null,_emojiMap:{nature:[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0],[6,0],[7,0],[8,0],[9,0],[10,0],[11,0],[12,0],[13,0],[14,0],[15,0],[16,0],[17,0],[18,0],[19,0],[20,0],[21,0],[22,0],[23,0],[24,0],[25,0],[26,0],[27,0],[28,0],[29,0],[0,1],[1,1],[2,1],[3,1],[4,1],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[11,1],[12,1],[13,1],[14,1],[15,1],[16,1],[17,1],[18,1],[19,1],[20,1],[21,1],[22,1],[23,1],[24,1],[25,1],[26,1],[27,1],[28,1],[29,1],[0,2],[1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2],[12,2],[13,2],[14,2],[15,2],[16,2],[17,2],[18,2],[19,2],[20,2],[21,2],[22,2],[23,2],[24,2],[25,2],[26,2],[27,2],[28,2],[29,2],[0,3],[1,3],[2,3],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[13,3],[14,3],[15,3],[16,3],[17,3],[18,3],[19,3],[20,3],[21,3],[22,3],[23,3],[24,3],[25,3]],objects:[[26,3],[27,3],[28,3],[29,3],[0,4],[1,4],[2,4],[3,4],[4,4],[5,4],[6,4],[7,4],[8,4],[9,4],[10,4],[11,4],[12,4],[13,4],[14,4],[15,4],[16,4],[17,4],[18,4],[19,4],[20,4],[21,4],[22,4],[23,4],[24,4],[25,4],[26,4],[27,4],[28,4],[29,4],[0,5],[1,5],[2,5],[3,5],[4,5],[5,5],[6,5],[7,5],[8,5],[9,5],[10,5],[11,5],[12,5],[13,5],[14,5],[15,5],[16,5],[17,5],[18,5],[19,5],[20,5],[21,5],[22,5],[23,5],[24,5],[25,5],[26,5],[27,5],[28,5],[29,5],[0,6],[1,6],[2,6],[3,6],[4,6],[5,6],[6,6],[7,6],[8,6],[9,6],[10,6],[11,6],[12,6],[13,6],[14,6],[15,6],[16,6],[17,6],[18,6],[19,6],[20,6],[21,6],[22,6],[23,6],[24,6],[25,6],[26,6],[27,6],[28,6],[29,6],[0,7],[1,7],[2,7],[3,7],[4,7],[5,7],[6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],[13,7],[14,7],[15,7],[16,7],[17,7],[18,7],[19,7],[20,7],[21,7],[22,7],[23,7],[24,7],[25,7],[26,7],[27,7],[28,7],[29,7],[0,8],[1,8],[2,8],[3,8],[4,8],[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[13,8],[14,8],[15,8],[16,8],[17,8],[18,8],[19,8],[20,8],[21,8],[22,8],[23,8],[24,8],[25,8],[26,8],[27,8],[28,8],[29,8],[0,9],[1,9],[2,9],[3,9],[4,9],[5,9],[6,9],[7,9],[8,9],[9,9],[10,9],[11,9],[12,9],[13,9],[14,9],[15,9],[16,9],[17,9],[18,9],[19,9],[20,9],[21,9],[22,9],[23,9],[24,9],[25,9],[26,9],[27,9],[28,9],[29,9],[0,10],[1,10],[2,10],[3,10],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[10,10],[11,10],[12,10],[13,10],[14,10],[15,10],[16,10],[17,10],[18,10],[19,10],[20,10],[21,10],[22,10],[23,10],[24,10],[25,10],[26,10],[27,10],[28,10],[29,10],[0,11],[1,11],[2,11],[3,11],[4,11],[5,11],[6,11],[7,11],[8,11],[9,11],[10,11],[11,11],[12,11],[13,11],[14,11],[15,11]],places:[[16,11],[17,11],[18,11],[19,11],[20,11],[21,11],[22,11],[23,11],[24,11],[25,11],[26,11],[27,11],[28,11],[29,11],[0,12],[1,12],[2,12],[3,12],[4,12],[5,12],[6,12],[7,12],[8,12],[9,12],[10,12],[11,12],[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12],[20,12],[21,12],[22,12],[23,12],[24,12],[25,12],[26,12],[27,12],[28,12],[29,12],[0,13],[1,13],[2,13],[3,13],[4,13],[5,13],[6,13],[7,13],[8,13],[9,13],[10,13],[11,13],[12,13],[13,13],[14,13],[15,13],[16,13],[17,13],[18,13],[19,13],[20,13],[21,13],[22,13],[23,13],[24,13],[25,13],[26,13],[27,13],[28,13],[29,13],[0,14],[1,14],[2,14],[3,14],[4,14],[5,14],[6,14],[7,14],[8,14],[9,14],[10,14],[11,14],[12,14],[13,14],[14,14],[15,14],[16,14],[17,14],[18,14],[19,14],[20,14],[21,14],[22,14],[23,14],[24,14],[25,14],[26,14]],smiley:[[27,14],[28,14],[29,14],[0,15],[1,15],[2,15],[3,15],[4,15],[5,15],[6,15],[7,15],[8,15],[9,15],[10,15],[11,15],[12,15],[13,15],[14,15],[15,15],[16,15],[17,15],[18,15],[19,15],[20,15],[21,15],[22,15],[23,15],[24,15],[25,15],[26,15],[27,15],[28,15],[29,15],[0,16],[1,16],[2,16],[3,16],[4,16],[5,16],[6,16],[7,16],[8,16],[9,16],[10,16],[11,16],[12,16],[13,16],[14,16],[15,16],[16,16],[17,16],[18,16],[19,16],[20,16],[21,16],[22,16],[23,16],[24,16],[25,16],[26,16],[27,16],[28,16],[29,16],[0,17],[1,17],[2,17],[3,17],[4,17],[5,17],[6,17],[7,17],[8,17],[9,17],[10,17],[11,17],[12,17],[13,17],[14,17],[15,17],[16,17],[17,17],[18,17],[19,17],[20,17],[21,17],[22,17],[23,17],[24,17],[25,17],[26,17],[27,17],[28,17],[29,17],[0,18],[1,18],[2,18],[3,18],[4,18],[5,18],[6,18],[7,18],[8,18],[9,18],[10,18],[11,18],[12,18],[13,18],[14,18],[15,18],[16,18],[17,18],[18,18],[19,18],[20,18],[21,18],[22,18],[23,18],[24,18],[25,18],[26,18],[27,18],[28,18],[29,18],[0,19],[1,19],[2,19],[3,19],[4,19],[5,19],[6,19],[7,19],[8,19],[9,19],[10,19],[11,19],[12,19],[13,19],[14,19],[15,19],[16,19],[17,19],[18,19],[19,19],[20,19],[21,19],[22,19],[23,19],[24,19],[25,19],[26,19],[27,19],[28,19],[29,19],[0,20],[1,20],[2,20],[3,20],[4,20],[5,20],[6,20],[7,20],[8,20],[9,20],[10,20],[11,20],[12,20],[13,20],[14,20],[15,20],[16,20],[17,20],[18,20],[19,20],[20,20],[21,20],[22,20],[23,20],[24,20],[25,20],[26,20],[27,20],[28,20],[29,20],[0,21],[1,21],[2,21],[3,21],[4,21],[5,21]],symbols:[[6,21],[7,21],[8,21],[9,21],[10,21],[11,21],[12,21],[13,21],[14,21],[15,21],[16,21],[17,21],[18,21],[19,21],[20,21],[21,21],[22,21],[23,21],[24,21],[25,21],[26,21],[27,21],[28,21],[29,21],[0,22],[1,22],[2,22],[3,22],[4,22],[5,22],[6,22],[7,22],[8,22],[9,22],[10,22],[11,22],[12,22],[13,22],[14,22],[15,22],[16,22],[17,22],[18,22],[19,22],[20,22],[21,22],[22,22],[23,22],[24,22],[25,22],[26,22],[27,22],[28,22],[29,22],[0,23],[1,23],[2,23],[3,23],[4,23],[5,23],[6,23],[7,23],[8,23],[9,23],[10,23],[11,23],[12,23],[13,23],[14,23],[15,23],[16,23],[17,23],[18,23],[19,23],[20,23],[21,23],[22,23],[23,23],[24,23],[25,23],[26,23],[27,23],[28,23],[29,23],[0,24],[1,24],[2,24],[3,24],[4,24],[5,24],[6,24],[7,24],[8,24],[9,24],[10,24],[11,24],[12,24],[13,24],[14,24],[15,24],[16,24],[17,24],[18,24],[19,24],[20,24],[21,24],[22,24],[23,24],[24,24],[25,24],[26,24],[27,24],[28,24],[29,24],[0,25],[1,25],[2,25],[3,25],[4,25],[5,25],[6,25],[7,25],[8,25],[9,25],[10,25],[11,25],[12,25],[13,25],[14,25],[15,25],[16,25],[17,25],[18,25],[19,25],[20,25],[21,25],[22,25],[23,25],[24,25],[25,25],[26,25],[27,25],[28,25],[29,25],[0,26],[1,26],[2,26],[3,26],[4,26],[5,26],[6,26],[7,26],[8,26],[9,26],[10,26],[11,26],[12,26],[13,26],[14,26],[15,26],[16,26],[17,26],[18,26],[19,26],[20,26],[21,26],[22,26],[23,26],[24,26],[25,26],[26,26],[27,26],[28,26],[29,26],[0,27],[1,27],[2,27],[3,27],[4,27],[5,27],[6,27],[7,27],[8,27],[9,27],[10,27],[11,27],[12,27],[13,27],[14,27],[15,27],[16,27],[17,27],[18,27],[19,27],[20,27],[21,27],[22,27],[23,27],[24,27],[25,27],[26,27],[27,27],[28,27],[29,27],[0,28],[1,28],[2,28],[3,28],[4,28]]},_emojiMapGroups:[{name:"smiley",caption:"Смайлики"},{name:"nature",caption:"Природа"},{name:"objects",caption:"Объекты"},{name:"places",caption:"Инфраструктура"},{name:"symbols",caption:"Символы"}],_emojiSize:24,_emojiBox:null,_lastTextSelection:null,_sendLocked:!1,_emptyGIF:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",_usersStringBuffer:null,_usersBox:null,_usersFakeCaret:null,_shownMessages:[],_shownMessagesID:{},_missingMessagesID:{},_lowerMessageTime:null,_upperMessageTime:null,_onClickByUserNameBound:null,_$messagesContainer:null,_$loader:null,_$eofMessage:null,_updateListTimer:null,_updateListBound:null,_initForm:function(){var e=this;this._roomID=r(".b-moderators-chat").attr("data-room"),this._textInput=r("div.mc-text-input"),this._editor=new u(this._textInput,{toolbar:{buttons:["bold","italic","strikethrough","quote"]},placeholder:{text:""}}),this._editor.subscribe("editableInput",i.bind(this._processEnteredMessage,this)),this._usersFakeCaret=r("<div>").addClass("mc-fake-caret"),this._isMobileEnv||(this._textInput.on("keypress",i.bind(this._onKeyPress,this)),this._textInput.on("keydown",i.bind(this._onKeyDown,this)),r(document.body).append(this._usersFakeCaret)),r('a.mc-button[data-role="emoji"]').on(this._isMobileEnv?"touch":"click",i.bind(this._showEmoji,this)),r('.mc-img-upload input[type="file"]').change(i.bind(this._attachImage,this)),r('.mc-attached-image a[data-role="remove"]').on(this._isMobileEnv?"touch":"click",i.bind(this._hideAttachedImage,this)),r('a.mc-submit[data-role="send"]').on(this._isMobileEnv?"touch":"click",i.bind(this._sendMessage,this)),r('a.mc-users-button[data-role="users"]').on(this._isMobileEnv?"touch":"click",function(){e._textInput.focus(),e._isMobileEnv&&(e._editor.saveSelection(),e._textInput.blur()),e._getUsersList().show(this)}),this._updateRooms()},_initChat:function(){var e=this,t,n;this._$messagesContainer=r(".mc-msg-container"),this._$loader=r('.mc-end-message[data-role="loader"]'),this._$eofMessage=r('.mc-end-message[data-role="eof"]');var s=r("#mc-startup-messages").val();if(s){try{s=JSON.parse(s)}catch(o){s=null}if(s&&typeof s=="object")for(t=0,n=s.length;t<n;t++)this._addMessage(s[t],!0)}s=r("#mc-missing-messages").val();if(s){try{s=JSON.parse(s)}catch(o){s=null}if(s&&typeof s=="object")for(t=0,n=s.length;t<n;t++)this._addMessage(s[t],!0,!0)}var u=0,a=0;r(window).scroll(i.throttle(function(){if(e._lowerMessageTime!==null&&u!=e._lowerMessageTime){var t=document.documentElement,n=(window.pageYOffset||t.scrollTop)-(t.clientTop||0),i=r(window).height(),s=e._$messagesContainer[0].lastChild;if(s){var o=r(s).offset().top;if(n+i>o){u=e._lowerMessageTime,e._$loader.show();var f={room:e._roomID,time:u};r.post("/ajax/chat_actions.php?action=get_old_messages",f,function(t){e._$loader.fadeOut(400),t.result?(e._updateRooms(t.data.rooms),e._addNewMessages(t.data.messages,!0),t.data.messages.length==0?e._$eofMessage.fadeIn(500):e._$eofMessage.hide(),a=0):++a<3&&(u=0)},"json").fail(function(){e._$loader.fadeOut(400),++a<3&&(u=0)})}}}},100)),this._runUpdateTimer(),this._$loader.fadeOut(500)},_runUpdateTimer:function(){clearTimeout(this._updateListTimer),this._updateListTimer=setTimeout(this._updateListBound,5e3)},_lastUpdateTime:null,_updateList:function(){var e=(new Date).getTime();clearTimeout(this._updateListTimer);if(this._lastUpdateTime===null)this._lastUpdateTime=e;else if(e-this._lastUpdateTime>18e5){window.location.reload();return}this._lastUpdateTime=e;var t=this,n={room:this._roomID,time:this._upperMessageTime};r.post("/ajax/chat_actions.php?action=get_new_messages",n,function(e){e.result&&(t._addNewMessages(e.data.messages,!1),t._updateRooms(e.data.rooms)),t._runUpdateTimer()},"json").fail(function(){t._runUpdateTimer()})},_sendMessage:function(){var e=r('a.mc-submit[data-role="send"]'),t=r(".mc-form"),n=this;if(this._sendLocked){(new s).showMessage(e,"Да не спешите Вы так :)","warning");return}if(!this._isFormValid()){(new s).showMessage(e,"Укажите текст сообщения или изображение","warning");return}if(t.hasClass("mc-locked"))return;t.addClass("mc-locked"),this._textInput.blur();var i={room:this._roomID,message:this._textInput.html(),image:r(".mc-attached-image img").attr("data-name")};r.post("/ajax/chat_actions.php?action=add_message",i,function(r){t.removeClass("mc-locked"),r.result?(n._clearInputForm(),n._addNewMessages(r.data.messages,!1),n._updateRooms(r.data.rooms)):(new s).showMessage(e,r.message,"error")},"json").fail(function(){t.removeClass("mc-locked"),(new s).showMessage(e,"Что-то не так, сервер ругнулся неприлично...","error")})},_clearInputForm:function(){this._textInput.html(""),this._hideAttachedImage(),this._hideUsersList()},_onKeyPress:function(e){if(e.charCode==64){var t=this;setTimeout(function(){t._usersStringBuffer="";var e=t._getCaretXY();t._usersFakeCaret.css({left:e.x+"px",top:e.y+"px"}),t._getUsersList().show(t._usersFakeCaret),t._highlightUsersList()},0)}else if(this._usersStringBuffer!==null){var n=String.fromCharCode(e.charCode);/[0-9a-z\.]/i.test(n)?(this._usersStringBuffer+=n,this._highlightUsersList()):this._hideUsersList()}},_onKeyDown:function(e){if(this._usersStringBuffer!==null)if(e.keyCode==8)this._usersStringBuffer==""?this._hideUsersList():(this._usersStringBuffer=this._usersStringBuffer.substr(0,this._usersStringBuffer.length-1),this._highlightUsersList());else if(e.keyCode==40||e.keyCode==38){e.preventDefault(),e.stopPropagation();var t=this._usersBox.getContent().find(".mc-command:visible");if(t.length==0)this._hideUsersList();else{var n,i=!1;for(var s=0,o=t.length;s<o;s++){n=r(t[s]);if(n.hasClass("mc-active")){i=!0,e.keyCode==40?s+1<o&&(n.removeClass("mc-active"),r(t[s+1]).addClass("mc-active")):(n.removeClass("mc-active"),s>0&&r(t[s-1]).addClass("mc-active"));break}}!i&&e.keyCode==40&&r(t[0]).addClass("mc-active")}}else if(e.keyCode==13||e.keyCode==32){e.preventDefault(),e.stopPropagation();var u=this._usersBox.getContent().find(".mc-command.mc-active:visible");this._putUserCall(u.attr("data-name")),this._hideUsersList()}else e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||e.keyCode==190||e.keyCode==16||this._hideUsersList();else e.keyCode==13&&(e.ctrlKey||e.metaKey||e.shiftKey)&&(e.preventDefault(),this._sendMessage()),this._usersBox&&this._usersBox.isShown()&&this._hideUsersList()},_hideUsersList:function(){this._usersStringBuffer=null,this._usersFakeCaret.css("left","-100px"),this._usersBox&&this._usersBox.hide()},_putUserCall:function(e){var t=e;this._usersStringBuffer!==null?t=e.substr(this._usersStringBuffer.length):t=" @"+t,t+=", &zwnj;",this._editor.restoreSelection(),this._editor.pasteHTML(t),this._textInput.focus()},_getUsersList:function(){if(!this._usersBox){this._usersBox=new s,this._usersBox.append(r(".mc-users-list").show()),this._usersBox.allowScrollContent(!0),this._isMobileEnv?(this._usersBox.setModalMode(!0),this._usersBox.setInnerIndent(0),this._usersBox.addCloseButtonIntoFooter()):(this._usersBox.setDirection("bottom"),this._usersBox.setAlignment("start"),this._usersBox.setInnerIndent(0),this._usersBox.useRoundBorders(!1),this._usersBox.showArrow(!1));var e=this._usersBox.getContent(),t=this;e.find(".mc-command").on(this._isMobileEnv?"touch":"click",function(){t._putUserCall(r(this).closest(".mc-command").attr("data-name")),t._hideUsersList()})}return this._isMobileEnv||this._editor.saveSelection(),this._usersBox.getContent().find(".mc-command, hr").removeClass("mc-active").show(),this._usersBox},_highlightUsersList:function(){if(this._usersStringBuffer===null)return;var e,t=this._usersBox.getContent(),n=this;if(this._usersStringBuffer!=""&&/^[a-z0-9\.]+$/i.test(this._usersStringBuffer)){t.find("hr").hide(),e=t.find('.mc-command[data-name-lc^="'+this._usersStringBuffer.toLowerCase()+'"]');if(e.length==0){this._hideUsersList();return}r(e.removeClass("mc-active")[0]).addClass("mc-active"),t.find('.mc-command:not([data-name-lc^="'+this._usersStringBuffer.toLowerCase()+'"])').hide()}else e=t.find(".mc-command").removeClass("mc-active"),t.find("hr").show();e.hide();for(var i=0;i<e.length&&i<8;i++)r(e[i]).show();setTimeout(function(){n._editor.saveSelection()},0)},_processEnteredMessage:function(){return r("a.mc-submit").toggleClass("mc-active",this._isFormValid()),this._usersStringBuffer===null&&this._usersBox&&this._usersBox.isShown()&&this._hideUsersList(),!0},_isFormValid:function(){var e=this._textInput.text();return/^\s*$/m.test(e)&&this._textInput.find(".mc-emoji").length==0&&!r(".mc-attached-image img").attr("data-name")?!1:!0},_showEmoji:function(){if(!this._emojiBox){var e=r("#mc-emoji-picker");this._isMobileEnv?this._emojiBox=(new s).setModalMode(!0).allowScrollContent(!0).setInnerIndent(5).addCloseButtonIntoFooter().append(e.show()):this._emojiBox=(new s).allowScrollContent(!0).autoCorrectPosition(!1).setAlignment("end").setDirection("bottom").setInnerIndent(0).setDistance(5).append(e.show());var t=e.find("> div"),n=r('<a href="javascript: void(0)"></a>').addClass("mc-emoji");for(var i=0,o=this._emojiMapGroups.length;i<o;i++){var u=this._emojiMapGroups[i],a=u.name,f=this._emojiMap[a],l=t.clone();l.find("> div").text(u.caption);for(var c=0,h=f.length;c<h;c++)l.append(n.clone().attr("data-x",f[c][0]).attr("data-y",f[c][1]).css("background-position",String(-f[c][0]*this._emojiSize)+"px "+String(-f[c][1]*this._emojiSize)+"px"));e.append(l)}t.remove();var p=this;e.find("a").on(this._isMobileEnv?"touch":"click",function(){var e=r(this);p._putEmoji(Number(e.attr("data-x")),Number(e.attr("data-y")))})}this._lastTextSelection=this._editor.exportSelection(),this._emojiBox.show(r('a.mc-button[data-role="emoji"]'))},_putEmoji:function(e,t){this._textInput.focus(),this._editor.importSelection(this._lastTextSelection),this._editor.pasteHTML('<img data-type="emoji" src="'+this._emptyGIF+'" alt="" />'),this._textInput.find('img[data-type="emoji"]:not(.mc-emoji)').addClass("mc-emoji").attr("data-x",e).attr("data-y",t).css("background-position",String(-e*this._emojiSize)+"px "+String(-t*this._emojiSize)+"px"),this._lastTextSelection=this._editor.exportSelection(),this._emojiBox.hide(),this._processEnteredMessage()},_attachImage:function(e){var t=r(this),n=r(".mc-img-upload"),i=this,u=e.target.files;if(u&&u.length>0){var a=u[0];if(!a.type.match("image.*")){(new s).showMessage(n,"Выбран неправильный формат изображения","warning"),t.val("");return}this._sendLocked=!0,i._showAttachedImage();var f=new FormData;f.append("img",a,a.name),r.ajax({url:o.config("upload_server_url")+"/ajax/upload_file.php?type=chat_image&uid=img",type:"POST",data:f,cache:!1,dataType:"json",processData:!1,contentType:!1,xhrFields:{withCredentials:!0},success:function(e){e.result?i._showAttachedImage(e.data.tmp_file_url,e.data.tmp_file_name):(new s).showMessage(n,e.message,"warning"),i._sendLocked=!1,t.val("")},error:function(){i._sendLocked=!1,(new s).showMessage(n,"Ошибка при загрузке изображения.","error"),t.val("")}})}},_showAttachedImage:function(e,t){var n=r(".mc-attached-image");n.find("img").attr("src",e?e:this._emptyGIF).attr("data-name",t?t:""),n.toggleClass("mc-loading",!e),n.slideDown(400),this._processEnteredMessage()},_hideAttachedImage:function(){var e=r(".mc-attached-image"),t=this;e.removeClass("mc-loading"),e.slideUp(200,function(){e.find("img").attr("data-name","").attr("src",this._emptyGIF),t._processEnteredMessage()}),r('.mc-img-upload input[type="file"]').val("")},_getCaretXY:function(){if(!window.getSelection)return null;try{var e=window.getSelection(),t=e.getRangeAt(0).cloneRange();try{t.setStart(t.startContainer,t.startOffset-1)}catch(n){}var r=t.getBoundingClientRect();return{x:r.left,y:r.bottom}}catch(n){return null}},_addNewMessages:function(e,t){for(var n=0,r=e.length;n<r;n++)this._addMessage(e[n],t)},_addMessage:function(e,t,n){n===undefined&&(n=!1);if(!n){if(this._shownMessagesID[e.id])return;this._shownMessagesID[e.id]=1}var i=e.time,s=this._shownMessages,o,u,a="",f=this,l=n?"m_msg_":"msg_";if(!n)if(i<this._lowerMessageTime||this._lowerMessageTime===null)s.push({time:i,id:e.id}),this._lowerMessageTime=i,this._upperMessageTime===null&&(this._upperMessageTime=i);else if(i>this._upperMessageTime&&this._upperMessageTime!==null)a=s[0].id,s.unshift({time:i,id:e.id}),this._upperMessageTime=i;else{var c=!1;for(o=0,u=s.length;o<u;o++)if(i>s[o].time){a=s[o].id,s.splice(o,0,{time:i,id:e.id}),c=!0;break}c||s.push({time:i,id:e.id})}var h=new Date(i*1e3),p=String("00"+h.getHours()),d=String("00"+h.getMinutes()),v=String("00"+h.getSeconds()),m=p.substr(-2)+":"+d.substr(-2),g=m+":"+v.substr(-2),y=String("00"+h.getDate()),b=String("00"+(h.getMonth()+1)),w=String("0000"+h.getFullYear()),E=y.substr(-2)+"."+b.substr(-2)+"."+w.substr(-4),S;n?S=r(".mc-message.mc-template.mc-missing-message"):S=r(".mc-message.mc-template:not(.mc-missing-message)"),S=S.clone().removeClass("mc-template"),S.attr("id",l+e.id),S.attr("data-id",e.id),S.attr("data-time",i),S.find("img.mc-avatar").attr("src",e.avatar_url).attr("data-name",e.user_name).click(this._onClickByUserAvatarBound),S.find(".mc-msg-title a").attr("href",e.profile_url).text(e.user_name).click(this._onClickByUserNameBound),S.find(".mc-msg-title span").attr("title",E+" "+g).text(m);var x=S.find(".mc-msg-body").html(e.message);x.find(".mc-image").each(function(){f._processImage(r(this))}),x.find('a[data-type="user"]').click(this._onClickByUserNameBound),t!==!0&&(S.addClass("mc-startup-anim"),setTimeout(function(){S.removeClass("mc-startup-anim")},40)),n?S.find('a[data-role="scroll"], a[data-role="remove"]').on("click.mc_tool",function(){var e=r(this).closest("a[data-role]"),t=e.closest(".mc-message"),n=t.attr("data-time"),i=e.attr("data-role"),s=t.attr("data-id");e.off("click.mc_tool").find("i").removeClass("fa-angle-double-down").addClass("fa-spinner fa-pulse").css("cursor","default"),i=="scroll"?f._scrollToMessage(t,s,n):f._markMessageAsReaded(s)}):S.find('a[data-role="delete"]').click(function(){var e=r(this).closest("a[data-role]"),t=e.closest(".mc-message"),n=t.attr("data-id");f._deleteMessage(n)}),a?r("#"+l+a).before(S):n?r(".mc-missing-msg .mc-list").append(S):(this._$messagesContainer.append(S),this._$eofMessage.hide())},_deleteMessage:function(e){var t=this,n={room:this._roomID,id:e};r.post("/ajax/chat_actions.php?action=delete_message",n,function(e){e.result&&(t._addNewMessages(e.data.messages,!1),t._updateRooms(e.data.rooms))},"json")},_markMessageAsReaded:function(e){var t=this,n={room:this._roomID,id:e};r.post("/ajax/chat_actions.php?action=mark_message_as_viewed",n,function(n){t._removeMissingMessage(e)},"json")},_scrollToMessage:function(e,t,n){var i=this,s=function(){i._removeMissingMessage(t);var e=r("#msg_"+t);if(e.length==0)return;e.addClass("mc-highlight"),r("html, body").animate({scrollTop:e.offset().top-300},1e3)};if(r("#msg_"+t).length>0)s();else{var o={room:this._roomID,to_time:this._lowerMessageTime,from_time:n};r.post("/ajax/chat_actions.php?action=get_messages_slice",o,function(e){e.result&&(i._addNewMessages(e.data.messages,!1),i._updateRooms(e.data.rooms)),s()},"json").fail(function(){s()})}},_removeMissingMessage:function(e){delete this._missingMessagesID[e];var t=r("#m_msg_"+e);t.slideUp(100,function(){t.remove(),r(".mc-missing-msg .mc-list").find(".mc-message").length==0&&r(".mc-missing-msg").slideUp(300)})},_processImage:function(e){var t=e.find(".mc-preview-btn"),n=e.find("img");t.length>0?(t.click(function(){r(this).hide(),n.attr("src",n.attr("data-small"))}),n.click(function(e){e.preventDefault(),t.show(),n.attr("src",n.attr("data-preview"))})):n.attr("data-viewable","true")},_onClickByUserName:function(e){if(e.ctrlKey||e.metaKey)return;e.preventDefault();var t=r(e.target).text().replace(/@/g,"");this._isMobileEnv&&window.scrollTo(0,0),this._textInput.focus(),this._putUserCall(t)},_onClickByUserAvatar:function(e){e.preventDefault();var t=r(e.target).attr("data-name");this._isMobileEnv&&window.scrollTo(0,0),this._textInput.focus(),this._putUserCall(t)},_updateRooms:function(e){var t=this;if(e)for(var n in e)e.hasOwnProperty(n)&&r('.mc-nav-counter[data-room="'+n+'"]').attr("data-count",String(e[n]));r(".mc-nav-counter").each(function(){var e=r(this),n=Number(e.attr("data-room")),i=Number(e.attr("data-count"));n!=t._roomID&&i>0?e.text(String(i)):e.text("")})}}),n.exports=f},"page-ban-list/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../wm"),u=e("../popup-box"),a=e("../core/template"),f=e("../core/layout"),l=e("../core/location"),c=f.extend({_loadedKey:"",_lastSearchedText:"",_page:1,show:function(e){this._rendered||(this.render(),this._rendered=!0)},render:function(){var e=this,t=r("#banlist_text");this._page=Number(r(".b-banlist").attr("data-init-page")),this._lastSearchedText=t.val(),this._loadedKey=this._lastSearchedText+"#"+this._page,r(".banlist-cancel").touch(function(){r("#banlist_text").val(""),e._load()}),r("#banlist-form").on("submit",function(t){t.preventDefault(),e._load()}).on("reset",function(t){t.preventDefault(),r("#banlist_text").val(""),e._load()}),r(".banlist-show-more").each(function(){var e=r(this);e.attr("data-has-more")=="1"&&e.css("display","")}).touch(function(){e._page++,e._load()})},_load:function(){var e=r("#banlist_text"),t=e.val(),n=!1;this._lastSearchedText!=t&&(this._lastSearchedText=t,n=!0,this._page=1);var i=t+"#"+this._page;if(this._loadedKey==i)return;this._loadedKey=i;var s=[],o="Бан-лист",a,f=this,c;if(t.length>0){if(t.length<2){e.blur(),(new u).showMessage(e,"Пожалуйста, введите минимум 2 символа для поиска","warning");return}s.push("q="+encodeURIComponent(t)),o=t+" - Поиск";var h=s.join("&");if(h=="")return;a="?"+h}else a="?q=";o=o.replace(/[<>&]/gi,""),c=l.replaceState({},o,a,!0),document.title=o,c?r.get(a,{ajax_mode:"1",page:this._page},function(e){if(e.result){var t=r('.banlist-records > div[data-role="not_found"]').css({display:"none"});n?(r(".banlist-records > ul > li.banlist-ban-record").remove(),e.data.list.length==0?t.css({display:""}):f._appendData(e.data.list)):f._appendData(e.data.list),r(".banlist-show-more").toggle(e.data.list.length>0&&e.data.has_more)}},"json"):window.location.href=a},_appendData:function(e){if(e.length==0)return;var t=r(".banlist-records > ul > li.banlist-template").clone().removeClass("banlist-template").css("display",""),n,i=document.createDocumentFragment(),s,o={};for(var u=0,a=e.length;u<a;u++)s=e[u],o[s.id]=n=t.clone().addClass("banlist-ban-record"),n.find("a.banlist-user").attr("href",s.user_profile).text(s.user_name),n.find("a.banlist-src").attr("href",s.ban_source_url).text(s.ban_type==2?"комментарий":"пост"),n.find("span.banlist-reason").text(s.reason),n.find("a.banlist-moderator").attr("href",s.moderator_profile).text(s.moderator_name),n.find(".banlist-date").text(s.date),i.appendChild(n[0]),this._lastID=s.id;r(".banlist-records > ul").append(i)}});n.exports=o.add({name:"banned_users.php",layout:c,routes:{"":"show"}})},"page-comments-incoming/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../wm"),c=e("../comments"),h=f.extend({show:function(){var e=this;if(this._inited)return this;this._inited=!0,l.get("layout").disablePositionButton(),r(".comment_item").each(function(e,t){new c.Comments({el:t,storyId:t.getAttribute("data-story-id"),type:c.eCommentsType.incoming})})}});l.add({name:"freshitems_v2.php",layout:h}),n.exports=l.add({name:"freshitems.php",layout:h})},"page-comments-outcoming/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/request"),l=e("../core/layout"),c=e("../wm"),h=e("../comments"),p=l.extend({show:function(){var e=this;if(this._inited)return this;this._inited=!0,c.get("layout").disablePositionButton(),r(".comment_item").each(function(t,n){var r=new h.Comments({el:n,storyId:n.getAttribute("data-story-id"),type:h.eCommentsType.outcoming});r.on("inited",e.reCalc)})},reCalc:function(){var e=[],t=r(".profile_news_count_fresh");r(".comment__content_highlight_newest").each(function(t,n){e.push(r(n).parent().data("id"))}),e.length&&f("/ajax/comments_actions.php",{type:"POST",data:{ids:e,action:"mark_readed"}}).then(function(){var n=parseInt(t.text(),10);n===e.length||n<e.length?t.hide():t.text(n-e.length)})}});n.exports=c.add({name:"commented.php",layout:p})},"page-comments-top/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../wm"),c=e("../comments"),h=f.extend({show:function(){if(this._inited)return this;this._inited=!0,l.get("layout").disablePositionButton(),r(".comment__more").remove()}});n.exports=l.add({name:"top50_comm_new.php",layout:h})},"page-communities/common":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../popup-box"),u=e("../core/template"),a=e("../communities-core");i.extend(a.prototype,{initButtons:function(){var t=this;r(".b-community-more").touch(function(){var e=r(this),t=r(".b-community-header > .b-community-info");e.attr("data-role")=="show"?(e.hide(),r('.b-community-more[data-role="hide"]').show(),t.slideDown(200)):(e.hide(),r('.b-community-more[data-role="show"]').show(),t.slideUp(200))}),r(document).on("touch",".community-buttons a[data-role]:not([data-link])",function(n){var i=r(this),u=i.attr("data-role"),a=i.closest(".community-buttons"),f,l=i.closest(".b-community-short, .b-community-header, .b-community-info"),c=l.attr("data-id");if(!s.config("logged")){e("../sign").showNeedSignin();return}var h=r('.b-community-short[data-id="'+c+'"], .b-community-header[data-id="'+c+'"], .b-community-info[data-id="'+c+'"]');switch(u){case"subs+":case"subs-":f=u=="subs+",t.subscribe(c,f,function(){h.find('a[data-role="subs+"]').toggle(!f),h.find('a[data-role="subs-"]').toggle(f);var e=h.find('span[data-role="subs_cnt"]'),n=String(Number(r(e[0]).attr("data-value"))+(f?1:-1));e.attr("data-value",n).text(t.formatNumber(n,["подписчик","подписчика","подписчиков"]))},function(e){(new o).showMessage(i,e,"error")});break;case"ignore+":case"ignore-":f=u=="ignore+",t.ignore(c,f,function(){h.find('[data-role="ignore+"]').toggle(!f),h.find('[data-role="ignore-"]').toggle(f),h.find("div.community-subs").toggle(!f)},function(e){(new o).showMessage(i,e,"error")});break;case"drop-bg":r(".b-community-header").attr("data-has-bg","0"),t._dropBgImage(c,null,function(e){(new o).showMessage(i,e,"error")});break;default:}});var n;r(".community-admin-vote a").touch(function(){var i=r(this),s=i.data("value")==1,a=i.closest(".community-admin-vote").find("span"),f=i.data("id");if(!n){var l=new o;l.setModalMode(!0),l.append(r(u(e("./templates/voting-question.html"))())),l.addButtonIntoFooter("Cохранить",function(){n.hide(),s=c.find('input[type="radio"]:checked').val()=="1",i.data("value",s?1:2),a.text(s?"устраивает":"не устраивает"),t.voteForCurrentAdmin(f,!s,function(){},function(e){(new o).showMessage(i,e,"error")})},"success"),l.addCloseButtonIntoFooter(),n=l;var c=l.getContent();c.find('input[type="radio"][value="'+(s?"1":"2")+'"]').prop("checked",!0)}n.show(i)})}}),n.exports=a},"page-communities/community":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("powerange"),a=e("../popup-box"),f=e("../communities-core");i.extend(f.prototype,{_buildPage:function(){var e=this;this._prepareHeaderBgImageControl();var t=r(".b-community-stories-queue");t.find(".community-button").touch(function(){r(this).closest(".community-button").slideUp(200,function(){r(this).remove()}),r(".b-community-stories-queue .stories").fadeIn(500)}),t.find(".community-plane .community-buttons a[data-role]").touch(function(){var t=r(this).closest("a"),n=t.closest(".community-plane"),i=t.attr("data-role")=="allow",s=n.find("a");if(s.prop("disabled"))return;s.prop("disabled",!0),n.find("span.community-loader").show().fadeIn(100);var o=n.find(".community-message"),u=function(e){var t=3,i=function(){clearInterval(u),n.closest(".post").slideUp(400,function(){r(this).remove()})},s=function(){--t>=0&&(o.find("a > span").text(String(t)),t==0&&i())},u=setInterval(s,1e3);e!=""?(e+=' <a href="javascript: void(0)">закрыть <span>'+t+"</span> сек</a>",o.html(e).slideDown(200),o.find("a").touch(i),n.find(".community-buttons").fadeOut(200).slideUp(200)):(e=' <a href="javascript: void(0)">закрыть <span>'+t+"</span> сек</a>",o.html(e).slideDown(200),o.find("a").touch(i))};n.find(".community-duplicates-info, .community-duplicates-box").hide(),e.processStoryInQueue(r(".b-community-header").data("id"),n.data("queue-id"),i,function(){var e;i?(e='<i class="fa fa-check-circle-o" aria-hidden="true"></i> <span>пост успешно одобрен</span>',o.addClass("good")):e='<i class="fa fa-frown-o" aria-hidden="true"></i> <span>пост успешно удален</span>';var t=r("#community-menu-counter"),n=Number(t.text()||"0");--n>0?t.text(String(n)):t.hide(),u(e)},function(e){(new a).showMessage(t,e,"warning"),n.find("span.community-loader").fadeOut(100),n.find("a").prop("disabled",!1)})}),t.find(".community-plane .community-duplicates-info").touch(function(){(new a).showMessage(this,"«Результат поиска похожих постов доступен в полной версии сайта")}),r('.community-ban-record span[data-role="show-history"]').each(function(){var e=r(this),t=e.closest(".community-ban-record"),n=t.attr("data-id");r('.community-ban-record[data-parent-id="'+n+'"]').length>0&&e.addClass("show")}).off("touch").on("touch",function(){var e=r(this),t=e.closest(".community-ban-record"),n=t.attr("data-id");r('.community-ban-record[data-parent-id="'+n+'"]').toggleClass("show")})},_prepareHeaderBgImageControl:function(){var e=this,t=r("#community-header-bg-file");t.change(function(n){var i=r(this).closest("a"),s=n.target.files;if(e._isLocked){e._showLockError(function(e){(new a).showMessage(t,e,"warning")});return}if(s&&s.length>0){i.prop("disabled",!0);var o=i.find("i.fa-picture-o").hide(),u=i.find("i.fa-refresh").show();e._uploadBgImage(r(".b-community-header").data("id"),s[0],function(e){u.hide(),o.show(),r(".community-header-bg").css("background-image",'URL("'+e+'")'),r(".b-community-header").attr("data-has-bg","1"),t.val("")},function(e){u.hide(),o.show(),(new a).showMessage(i,e,"warning"),t.val("")})}})}}),n.exports=f},"page-communities/feed":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../core/template"),a=e("../popup-box"),f=e("../communities-core");i.extend(f.prototype,{_ratingBox:null,_ratingButton:null,_buildPage:function(){var e=this;this._ratingButton=r('.b-feed-panel span[data-type="rating"]'),r('.b-feed-panel[data-mode="communities"]').touch(function(){e._showStoriesRatingBox()})},_showStoriesRatingBox:function(){var t=this,n,i=!1,s=this._ratingButton,o=Number(s.attr("data-value"));if(!this._ratingBox){var f=this._ratingBox=(new a).setModalMode(!0).addCloseButtonIntoFooter().append(r(u(e("./templates/feed-rating-box.html"))()));i=!0}else{f=this._ratingBox;if(f.isShown()){f.hide();return}}n=f.getContent(),n.find('input[value="'+o+'"]').prop("checked",!0),f.show(s),i&&n.find('input[type="radio"]').on("change",function(){var e=n.find('input[type="radio"]:checked').val();s.attr("data-value")!=e&&(s.attr("data-value",e).text("с рейтингом "+e+" и выше"),t._onChangedRating())})},_onChangedRating:function(){var e=this,t=this._ratingButton,n=t.attr("data-value"),i=r("#stories_container"),o=r(".b-communities .communities-stories .community-preloader").show(),u=r("#no_stories_msg").hide();this._ratingBox.hide(),i.find(".post").remove(),r(".feed-overflow").hide(),r.get("?twitmode=1&page=1",{mr:n,of:"v2"},function(e){o.fadeOut(200).slideUp(200);if(!e.result){u.fadeIn(200);return}var t=e.data;if(!t.stories||t.stories.length==0){u.fadeIn(200);return}var n="";for(var a=0,f=t.stories,l=f.length;a<l;a++)n+=f[a].html;i.prepend(n),n==""&&u.fadeIn(200);var c=r("#page_navigator");c.length==0?t.paginator&&i.after(t.paginator):resp.data.paginator?c.replaceWith(t.paginator):c.remove(),s.feed.reInit(!0)},"json")}}),n.exports=f},"page-communities/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../wm"),u=e("../communities-core"),a=e("../core/layout"),f=a.extend(i.extend(u.prototype,{show:function(e){this._rendered||(this.render(e&&e.length>0?e[0]:""),this._rendered=!0)},showTag:function(e){this._rendered||(this.render("tag"),this._rendered=!0)},showCommunity:function(e){this._rendered||(this.render("community"),this._rendered=!0)},showVoting:function(e){this._rendered||(this.render("voting"),this._rendered=!0)},showStoriesSearch:function(){this._rendered||(this.render("community"),this._rendered=!0)},render:function(t){var n=this;(new(e("./common"))).initButtons(),t=t||s.config("GET").cmd;var r;switch(t){default:r=new(e("./feed"));break;case"all":case"mine":case"tag":case"own":r=new(e("./list")),r.setFeedType(t);break;case"voting":r=new(e("./community")),r.build(),r=new(e("./voting"));break;case"community":r=new(e("./community"))}r&&r.build()}}));o.add({name:"community",layout:f,routes:{"":"showCommunity",":type":"showCommunity",":type/:name":"showCommunity"}}),o.add({name:"community_banlist.php",layout:f,routes:{"":"showCommunity"}}),o.add({name:"community_voting.php",layout:f,routes:{"":"showVoting"}}),n.exports=o.add({name:"communities",layout:f,routes:{"":"show",":type":"show","tag/:type":"showTag"}})},"page-communities/list":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../communities-core");i.extend(u.prototype,{_loadedPage:1,_requestedPage:1,_endOfFeed:!1,_$loader:null,_$cont:null,_$noRecsMsg:null,_isBusy:!1,_lastSearchData:"",_loadTimerID:0,_feedType:"",setFeedType:function(e){this._feedType=String(e)},_buildPage:function(){var e=this;this._$loader=r(".community-preloader"),this._$cont=r(".communities-list"),this._$noRecsMsg=r(".community-no-recs-msg");var t=r(".communities-list-anchor");r(".community-search form").submit(function(){e._search()}),r(window).scroll(i.throttle(function(){if(e._endOfFeed)return;if(e._isBusy)return;var n=document.documentElement,i=(window.pageYOffset||n.scrollTop)-(n.clientTop||0),s=r(window).height(),o=t[0];if(o){var u=r(o).offset().top;i+s>u&&(e._loadedPage==e._requestedPage&&e._requestedPage++,e._loadList(!1))}},100))},_search:function(){if(this._isBusy)return;this._endOfFeed=!1,this._requestedPage=1,this._loadList(!0)},_loadList:function(e,t){var n=this;this._loadTimerID&&clearTimeout(this._loadTimerID);if(!t){this._loadTimerID=setTimeout(function(){n._loadList(e,!0)},100);return}var i=r("#cs_text").val().replace(/^\s+|\s+$/g,""),s={text:i,type:this._feedType,tag:r(".community-tag-block > .community-tag").attr("data-value")||"",page:this._requestedPage},o=JSON.stringify(s);if(this._lastSearchData==o)return;if(this._lastSearchData==""&&i==""&&this._requestedPage==1){this._lastSearchData=o;return}this._requestedPage==1&&this._$cont.empty(),this._lastSearchData=o,this._$loader.show(),this._$noRecsMsg.hide(),this._isBusy=!0,r.post("/ajax/communities_actions.php?action=get_communities",s,function(e){n._$loader.fadeOut(400),n._isBusy=!1,n._loadedPage=n._requestedPage,e.result?(n._$cont.append(e.data.list.join("\n")),n._endOfFeed=!e.data.has_more,e.data.list.length==0&&n._requestedPage==1&&n._$noRecsMsg.slideDown(200)):n._endOfFeed=!0},"json").fail(function(){n._$loader.fadeOut(400),n._endOfFeed=!0,n._isBusy=!1,n._requestedPage=n._loadedPage})}}),n.exports=u},"page-communities/voting":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../popup-box"),a=e("../communities-core");i.extend(a.prototype,{_$voteBalloon:null,_voteBalloonShown:!1,_communityID:0,_selectedCandidate:"",_isNewCandidate:!1,_buildPage:function(){var e=this,t=r(".b-community-voting");this._communityID=t.data("id"),r(".b-community-voting__item--myvote").length==0&&this._prepareVoteTools(),r(".b-community-voting__candidate a").click(function(){e.cancelVotingCandidate(e._communityID),r(".b-community-voting__candidate").slideUp(200,function(){window.location.reload()})})},_prepareVoteTools:function(){var e=r(".b-community-voting__new_user"),t=e.find('input[type="text"]'),n=this;if(e.length==0)return;this._$voteBalloon=r(".b-community-voting__vote_balloon"),this._$voteBalloon.find("a[data-role]").touch(function(i){var s=r(i.target).closest("a[data-role]");s.attr("data-role")=="cancel"?n._cancelVoteBalloon():n.voteForNewAdmin(n._communityID,n._selectedCandidate,n._isNewCandidate,function(){t.val(""),e.toggleClass("b-community-voting__new_user--empty",!1),n._$voteBalloon.hide(),window.location.reload()},function(e){var i;n._isNewCandidate?i=t:i=r('.b-community-voting__item[data-user-name="'+n._selectedCandidate+'"]'),(new u).showMessage(i,e,"warning")})}),t.on("keyup paste change keypress focus blur",function(r){var i=t.val();e.toggleClass("b-community-voting__new_user--empty",i!=""),r.type=="keyup"&&(r.keyCode||r.which)==13?(t.blur(),n._showVoteBalloon(i,!0)):i==""&&n._voteBalloonShown&&n._cancelVoteBalloon()}),e.find('a[data-role="apply"]').touch(function(){t.blur(),n._showVoteBalloon(t.val(),!0)}),r(".b-community-voting__new_user > svg").touch(function(){t.focus()}),r(".b-community-voting__radio i").touch(function(){var e=r(this),t=e.closest(".b-community-voting__radio");t.attr("data-checked")=="1"&&n._voteBalloonShown?n._cancelVoteBalloon():(r('.b-community-voting__radio[data-checked="1"]').attr("data-checked","0"),t.attr("data-checked","1"),n._showVoteBalloon(e.closest(".b-community-voting__item").attr("data-user-name")))})},_showVoteBalloon:function(e,t){if(e.replace(/[^A-Z0-9\.]/gi,"")=="")return;this._selectedCandidate=e,this._isNewCandidate=t===!0,this._$voteBalloon.find(".b-community-voting__vote_balloon__user").attr("href","/profile/"+e).text(e),t?r(".b-community-voting__new_user").after(this._$voteBalloon):r('.b-community-voting__item[data-user-name="'+e+'"]').after(this._$voteBalloon),this._voteBalloonShown=!0,this._$voteBalloon.slideDown(200)},_cancelVoteBalloon:function(){var e=r(".b-community-voting__new_user"),t=e.find('input[type="text"]');this._selectedCandidate="",t.val(""),e.toggleClass("b-community-voting__new_user--empty",!1),r(".b-community-voting__radio").attr("data-checked","0"),this._voteBalloonShown=!1,this._$voteBalloon.slideUp(200)}}),n.exports=a},"page-community-editor/add":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../community-editor-core");i.extend(u.prototype,{_buildPage:function(){r("#community-submit").click(i.bind(this._create,this))},_create:function(){var e=this;this._createCommunity(r(".community-form"),function(e){window.location.href="/community_edit.php?id="+e},function(t){e._showErrorForField(r("#community-submit"),t)})}}),n.exports=u},"page-community-editor/banlist":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../popup-box"),a=e("../community-editor-core");i.extend(a.prototype,{_loadedUserName:"",_lastID:0,_buildPage:function(){var e=this;r(".community-list-panel form").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._searchByName()}),r("#community-user-search").on("blur change",function(t){e._searchByName()}),r(".community-show-more").each(function(){var e=r(this);e.attr("data-has-more")=="1"&&e.css("display","")}).click(function(){var t=r(this);e._loadBanList(e._loadedUserName,e._lastID,function(n,i){n.length>0?e._appendData(n):r(".community-ban-record").length==0&&r('.community-table > tbody > tr[data-role="empty"]').css({display:""}),t.toggle(n.length>0&&i)},function(e){(new u).showMessage(t,e,"error")})});var t=r("#community-banlist").val(),n=[];if(t)try{n=JSON.parse(t)}catch(i){n=[]}this._setData(n,!0)},_searchByName:function(){var e=r("#community-user-search"),t=e.val(),n=this;if(t==this._loadedUserName)return;this._loadedUserName=t,this._lastID=0,e.blur(),this._loadBanList(t,0,function(e,t){n._setData(e),r(".community-show-more").toggle(e.length>0&&t)},function(t){(new u).showMessage(e,t,"error")})},_setData:function(e,t){r(".community-banlist-container ul li:not(.community-template)").remove(),r(".community-banlist-container .no_items_msg").css({display:"none"}),e.length==0?t&&this._loadedUserName==""?r('.community-banlist-container .no_items_msg[data-role="empty"]').css({display:""}):r('.community-banlist-container .no_items_msg[data-role="not_found"]').css({display:""}):this._appendData(e)},_appendData:function(e){if(e.length==0)return;var t=r(".community-banlist-list ul li.community-template").clone().removeClass("community-template").addClass("community-ban-record").css("display",""),n,i=document.createDocumentFragment(),s,o=this,a,f={};for(var l=0,c=e.length;l<c;l++)s=e[l],n=t.clone(),n.attr("data-user-id",s.user_id),n.attr("data-id",s.id),s.parent_id==""?(a=s.user_name+' за <a href="'+s.url+'" target="_blank">'+(s.type=="1"?"коммент":"пост")+"</a>, "+(s.ban_type==2?"отменен":s.ban_type==1?"навсегда":"до "+s.date)+' (<a href="/profile/'+s.moder_name+'" target="_blank">'+s.moder_name+"</a>)"+'<span data-role="show-history">, <a href="javascript: void(0)">история</a></span>',f[s.id]=n):(n.attr("data-parent-id",s.parent_id),a='<i class="fa fa-angle-right community-indent"></i> за <a href="'+s.url+'" target="_blank">'+(s.type=="1"?"коммент":"пост")+"</a>, "+(s.ban_type==2?"отменен":s.ban_type==1?"навсегда":"до "+s.date)+' (<a href="/profile/'+s.moder_name+'" target="_blank">'+s.moder_name+"</a>)",n.find("a.community-banlist-rec-delete").remove(),f[s.parent_id]!==undefined&&(f[s.parent_id].find('span[data-role="show-history"]').addClass("show"),delete f[s.parent_id])),n.find("div").html(a),i.appendChild(n[0]),this._lastID=s.id;r(".community-banlist-container ul").append(i),r(".community-ban-record span.community-banlist-rec-delete").off("touch").on("touch",function(e){e.preventDefault(),e.stopPropagation();var t=r(this),n=t.closest(".community-ban-record"),i=n.attr("data-user-id");o._cancelBan(i,function(){r('.community-ban-record[data-parent-id="'+n.attr("data-id")+'"]').remove(),n.remove(),r(".community-ban-record").length==0&&r(".community-show-more").click()},function(e){(new u).showMessage(t,e,"error")})}),r('.community-ban-record span[data-role="show-history"]').off("touch").on("touch",function(){var e=r(this),t=e.closest(".community-ban-record"),n=t.attr("data-id");r('.community-ban-record[data-parent-id="'+n+'"]').toggleClass("show")})}}),n.exports=a},"page-community-editor/history":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../popup-box"),a=e("../community-editor-core");i.extend(a.prototype,{_lastTime:0,_buildPage:function(){var e=this;r(".community-show-more").each(function(){var e=r(this);e.attr("data-has-more")=="1"&&e.css("display","")}).click(function(){var t=r(this);e._loadHistory(e._lastTime,function(n,i){n.length>0?e._appendData(n):r(".community-hist-record").length==0&&r('.community-history-container .no_items_msg[data-role="empty"]').css({display:""}),t.toggle(n.length>0&&i)},function(e){(new u).showMessage(t,e,"error")})});var t=r("#community-history").val(),n=[];if(t)try{n=JSON.parse(t)}catch(i){n=[]}this._setData(n)},_setData:function(e){r(".community-history-container .item_list ul li:not(.community-template)").remove(),r(".community-history-container .no_items_msg").css({display:"none"}),e.length==0?r('.community-history-container .no_items_msg[data-role="empty"]').css({display:""}):this._appendData(e)},_appendData:function(e){if(e.length==0)return;var t=r(".community-history-container li.community-template").clone().removeClass("community-template").addClass("community-hist-record").css("display",""),n,i=document.createDocumentFragment(),s;for(var o=0,u=e.length;o<u;o++){s=e[o],n=t.clone();var a='<a href="'+s.user_profile+'" target="_blank"><img src="'+s.user_avatar+'"> '+s.user_name+"</a>",f="";switch(s.action){default:case 1:f=' удалил <a href="'+s.url+'" target="_blank">'+(s.type==1?"коммент":"пост")+"</a>  пользователя "+a;break;case 2:f=" забанил "+a+' за <a href="'+s.url+'" target="_blank">'+(s.type==1?"коммент":"пост")+"</a>";break;case 3:f=' одобрил <a href="'+s.url+'" target="_blank">'+(s.type==1?"коммент":"пост")+"</a>  пользователя "+a;break;case 4:f=" отклонил пост пользователя "+a}n.html("<small>"+s.date+"</small> "+'<a href="'+s.moder_profile+'" target="_blank">'+s.moder_name+"</a>"+f),i.appendChild(n[0]),this._lastTime=s.time}r(".community-history-container ul").append(i)}}),n.exports=a},"page-community-editor/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../wm"),u=e("../popup-box"),a=e("../community-editor-core"),f=e("../core/layout"),l=f.extend(i.extend(a.prototype,{_$container:null,show:function(){this._rendered||(this.render(),this._rendered=!0)},render:function(){var t=this;this._$container=r(".b-community-editor");if(this._$container.length==0)return;var n,i=this._$container.data("community-id");switch(s.config("GET").cmd){case"add":case"setup":default:i=="0"?n=new(e("./add")):n=new(e("./setup"));break;case"ban-list":n=new(e("./banlist"));break;case"moderators":n=new(e("./moderators"));break;case"history":n=new(e("./history"));break;case"trusted":n=new(e("./trusted"))}n&&n.build(),this._prepareAvatarControl()},_prepareAvatarControl:function(){var e=this;this._$container.find('.community-avatar:not([disabled]) input[type="file"]').change(function(t){var n=r(this),i=n.closest(".community-avatar"),s=r(".community-loader"),o=i.find('input[type="hidden"]');if(e._isLocked){e._showLockError(function(e){(new u).showMessage(i,e,"warning")});return}var a=t.target.files;a&&a.length>0&&(s.css("visibility","visible"),e._uploadAvatar(a[0],function(e,t){s.css("visibility",""),n.val("");var a=(new u).setModalMode(!0).addButtonIntoFooter("Продолжить",function(){o.val(t).change(),a.hide()},"success").addButtonIntoFooter("Отмена",function(){a.hide()}).append(r("<div>").addClass("community-avatar-preview").css("background-image",'URL("'+e+'")')).show(i)},function(e){s.css("visibility",""),(new u).showMessage(i,e,"warning"),n.val("")}))})}}));n.exports=o.add({name:"community_edit.php",layout:l})},"page-community-editor/moderators":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../core/template"),a=e("../popup-box"),f=e("../community-editor-core");i.extend(f.prototype,{_buildPage:function(){var t=this;r(".community-moder-panel button").on("touch",function(){var n=r(e("./templates/user-search.html"));n.find("label").text("Введите ник нового модератора:");var i=function(e){var t=n.find(".community-error");t.find("span").text(e),t.css("display","")},s=function(e){e&&e.type=="submit"&&(e.preventDefault(),e.stopPropagation());if(o)return;o=!0,n.find(".community-error").css("display","none");var r=n.find("input").blur().val();r?t._addModeratorByName(r,function(e){o=!1,t._setData(e),u.hide()},function(e){o=!1,i(e)}):i("вы не ввели ник пользователя")};n.find("form").on("submit",s);var o=!1,u=(new a).setModalMode(!0).addButtonIntoFooter("Назначить",s,"success").addButtonIntoFooter("Отмена",function(){o=!1,u.hide()}).append(n).show(document.body)});var n=r("#community-moderators").val(),i=[];if(n)try{i=JSON.parse(n)}catch(s){i=[]}this._setData(i)},_setData:function(e){r(".community-moders-container .item_list ul li:not(.community-template)").remove(),r(".community-moders-container .no_items_msg").css({display:"none"}),e.length==0?r('.community-moders-container .no_items_msg[data-role="empty"]').css({display:""}):this._appendData(e)},_appendData:function(e){if(e.length==0)return;var t=r(".community-moders-container ul li.community-template").clone().removeClass("community-template").addClass("community-moder-record").css("display",""),n,i=document.createDocumentFragment(),s,o=this;for(var u=0,f=e.length;u<f;u++)s=e[u],n=t.clone(),n.attr("data-user-id",s.user_id),n.attr("data-user-name",s.name),n.attr("data-profile",s.profile),n.attr("data-del-stories",s.deleted_stories_count),n.attr("data-ban",s.ban_count),n.find("a > .item_list_left").text(s.name),i.appendChild(n[0]);r(".community-moders-container ul").append(i),r(".community-moder-record a").off("touch").on("touch",function(){var e=r(this),t=e.closest(".community-moder-record"),n='Модератор <a href="'+t.attr("data-profile")+'" target="_blank">'+t.attr("data-user-name")+"</a> "+" удалил "+o._formatNumber(t.attr("data-del-stories"),["пост","поста","постов"])+", забанил "+o._formatNumber(t.attr("data-ban"),["пользователь","пользователя","пользователей"]);(new a).setModalMode(!0).append(r('<div class="community-record-info">').html(n)).addCloseButtonIntoFooter().show(e)}),r(".community-moder-record span.del_item").off("touch").on("touch",function(e){e.preventDefault(),e.stopPropagation();var t=r(this),n=t.closest(".community-moder-record"),i=n.attr("data-user-id"),s=n.attr("data-user-name");(new a).showConfirm(t,"Вы действительно хотите отменить права модератора для пользователя "+s+"?",function(){o._deleteModerator(i,function(){n.remove(),r(".community-moder-record").length==0&&r('.community-moders-container .no_items_msg[data-role="empty"]').css({display:""})},function(e){(new a).showMessage(t,e,"error")})})})}}),n.exports=f},"page-community-editor/setup":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("medium-editor"),a=e("../popup-box"),f=e("../community-editor-core");i.extend(f.prototype,{_editor1:null,_editor2:null,_dataBefore:null,_buildPage:function(){r("#community-submit").click(i.bind(this._save,this));var e=i.bind(this._onChange,this),t=r('.community-form .textarea[name="desc"]');this._editor1=new u(t,{toolbar:{buttons:["bold","italic","strikethrough","quote"]},placeholder:{text:t.attr("data-placeholder")}}),this._editor1.subscribe("editableInput",e);var n=r('.community-form .textarea[name="rules"]');this._editor2=new u(n,{toolbar:{buttons:["bold","italic","strikethrough","quote"]},placeholder:{text:n.attr("data-placeholder")}}),this._editor2.subscribe("editableInput",e);var s=r(".community-form");this._dataBefore=this._getFormData(s,function(e,t){}),s.find("input, select, textarea").change(e)},_onChange:function(){var e=this._dataBefore,t=this._getFormData(r(".community-form"),function(e,t){}),n=!1;for(var i in e)if(e.hasOwnProperty(i)&&e[i]!=t[i]){n=!0;break}r("#community-submit").prop("disabled",!n),r(".community-success").fadeOut(200)},_save:function(){var e=this,t=r("#community-submit");t.prop("disabled",!0),this._editCommunity(r(".community-form"),function(n){r(".community-success").fadeIn(200),e._dataBefore=e._getFormData(r(".community-form"),function(e,t){}),t.prop("disabled",!0)},function(n){t.prop("disabled",!1),e._showErrorForField(t,n)})}}),n.exports=f},"page-community-editor/trusted":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/request"),u=e("../popup-box"),a=e("../community-editor-core");i.extend(a.prototype,{_lastID:0,_buildPage:function(){var t=this;r(".community-trusted-panel button").on("touch",function(){var n=r(e("./templates/user-search.html"));n.find("label").text("Введите ник пользователя:");var i=function(e){var t=n.find(".community-error");t.find("span").text(e),t.css("display","")},s=function(e){e&&e.type=="submit"&&(e.preventDefault(),e.stopPropagation());if(o)return;o=!0,n.find(".community-error").css("display","none");var s=n.find("input").blur().val();s?t._addTrustedUserByName(s,function(e){o=!1,t._setData(e),r(".community-show-more").toggle(e.length>0&&hasMore),a.hide()},function(e){o=!1,i(e)}):i("вы не ввели ник пользователя")};n.find("form").on("submit",s);var o=!1,a=(new u).setModalMode(!0).addButtonIntoFooter("Добавить",s,"success").addButtonIntoFooter("Отмена",function(){o=!1,a.hide()}).append(n).show(document.body)}),r(".community-show-more").each(function(){var e=r(this);e.attr("data-has-more")=="1"&&e.css("display","")}).touch(function(){var e=r(this);t._loadTrustedUsersList(t._lastID,function(n,i){n.length>0?t._appendData(n):r(".community-trusted-container .item_list ul li:not(.community-template)").length==0&&r('.community-trusted-container .no_items_msg[data-role="empty"]').css({display:""}),e.toggle(n.length>0&&i)},function(t){(new u).showMessage(e,t,"error")})});var n=r("#community-trusted").val(),i=[];if(n)try{i=JSON.parse(n)}catch(s){i=[]}this._setData(i)},_setData:function(e){r(".community-trusted-container .item_list ul li:not(.community-template)").remove(),r(".community-trusted-container .no_items_msg").css({display:"none"}),e.length==0?r('.community-trusted-container .no_items_msg[data-role="empty"]').css({display:""}):this._appendData(e)},_appendData:function(e){if(e.length==0)return;var t=r(".community-trusted-container ul li.community-template").clone().removeClass("community-template").addClass("community-user-record").css("display",""),n,i=document.createDocumentFragment(),s,o=this;for(var a=0,f=e.length;a<f;a++)s=e[a],n=t.clone(),n.attr("data-user-id",s.user_id),n.attr("data-user-name",s.name),n.attr("data-profile",s.profile),n.attr("data-stories",s.stories),n.find("a > .item_list_left").text(s.name),i.appendChild(n[0]),this._lastID=s.user_id;r(".community-trusted-container ul").append(i),r(".community-user-record a").off("touch").on("touch",function(){var e=r(this),t=e.closest(".community-user-record"),n='Пользователь <a href="'+t.attr("data-profile")+'" target="_blank">'+t.attr("data-user-name")+"</a> "+" добавил в сообщестово "+o._formatNumber(t.attr("data-stories"),["пост","поста","постов"]);(new u).setModalMode(!0).append(r('<div class="community-record-info">').html(n)).addCloseButtonIntoFooter().show(e)}),r(".community-user-record span.del_item").off("touch").on("touch",function(e){e.preventDefault(),e.stopPropagation();var t=r(this),n=t.closest(".community-user-record"),i=n.attr("data-user-id"),s=n.attr("data-user-name");(new u).showConfirm(t,"Вы действительно хотите удалить доверенного пользователя "+s+" из списка?",function(){o._deleteTrustedUser(i,function(){n.remove(),r(".community-user-record").length==0&&r('.community-trusted-container .no_items_msg[data-role="empty"]').css({display:""})},function(e){(new u).showMessage(t,e,"error")})})})}}),n.exports=a},"page-gtpost/adding":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core"),u=e("../core/log"),a=e("../core/template"),f=e("../core/util"),l=e("../core/i18n"),c=e("./block"),h=s.View.extend({className:"gtpost-panel-adding",constructor:function(e){s.View.apply(this,f.makeArray(arguments)),this.options=i.defaults(e||{},{}),this.builder=this.options.builder,this.render(),this.listenTo(this.builder,"change-adding",this._changeCanAdding),this.listenTo(this.builder,"settings",this._openSettings)},_openSettings:function(e){e&&(this._oldShown=this.shown),this.toggle(e?!1:this._oldShown,!0)},render:function(){var t=this;this.$buttons=this.$(".gtpost-panel-adding__button"),this.$buttons.length===0&&(this.$el.append(r(e("./templates/panel-adding.html"))),this.$buttons=this.$(".gtpost-panel-adding__button")),this._dndHoverCurrent=!1,this.$els={wrapper:this.$(".gtpost-panel-adding__wrapper"),video:this.$('.gtpost-panel-adding__button[data-type="video-input"]').click(i.bind(this.clickAdding,this)),image:this.$('.gtpost-panel-adding__button[data-type="image"]').click(i.bind(this.clickAdding,this)),text:this.$('.gtpost-panel-adding__button[data-type="text"]').click(i.bind(this.clickAdding,this)),upload:this.$(".gtpost-panel-adding__upload").on("change",i.bind(this._clickUploadImage,this))},this._changeCanAdding()},_changeCanAdding:function(){var t=o.config("carma"),n=this.builder.hasLimit(this.builder.eLimit.addDisabled),s=this.builder.hasLimit(this.builder.eLimit.blockMax);return n||s?(this.$els.wrapper.off(),this.$els.hintMessage||(this.$els.hintMessage=r(document.createElement("div")).addClass("gtpost-panel-adding__error-overlay").append(this.builder.hasLimit(this.builder.eLimit.addDisabled)?e("./templates/hint-add-disabled.html"):l("page-gtpost:blockMax")).appendTo(this.$el)),this.$els.hintMessage.show(),this):(!n&&!s&&(this.$el.off(),this.$els.hintMessage&&this.$els.hintMessage.hide()),i.forEach(this.builder.eMax,function(e,t){var n=this.builder.hasLimit(this.builder.eLimit[t+"Carma"]),r=this.builder.hasLimit(this.builder.eLimit[t+"Max"]),i=n||r,s=l("page-gtpost:"+t+(i?n?"Carma":"Max":""));t==="image"&&this.$els.upload.toggle(!i),t!=="block"&&this.$els[t].toggleClass("gtpost-panel-adding__button_disabled",i).attr("title",s)},this),this)},_clickUploadImage:function(e){var t=FileAPI.getFiles(e);return this.builder.hasLimit(this.builder.eLimit.imageCarma)||this.builder.hasLimit(this.builder.eLimit.imageMax)?this:(this.$els.upload.val(""),this.builder.addImage(t,{_before:this.options.parentBlock&&this.options.parentBlock.model}).then(function(e){e===0&&u.warn(":gtpost:","ничего не добавили")}),this.options.parentBlock&&this.options.parentBlock._toggleAdding(!1,!0),this)},clickAdding:function(t){var n=r(t.currentTarget),i=n.data("type");if(n.hasClass("gtpost-panel-adding__button_disabled"))return t&&t.preventDefault()&&t.stopPropagation(),e("../../blocks/message")(n.attr("title"),"failure"),this;if(i==="text")t&&t.preventDefault()&&t.stopPropagation(),this.builder.addBlock(new c.Model({type:"text",_disableConfirm:!0,_before:this.options.parentBlock&&this.options.parentBlock.model}));else{if(i!=="video-input")return this;t&&t.preventDefault()&&t.stopPropagation(),this.builder.addBlock(new c.Model({type:"video-input",_disableConfirm:!0,_before:this.options.parentBlock&&this.options.parentBlock.model}))}return this.options.parentBlock&&this.options.parentBlock._toggleAdding(!1,!0),this},toggle:function(e,t){return this.shown=e,t===!0?this.$els.wrapper.toggle(e):this.$els.wrapper[e?"fadeIn":"fadeOut"](200),this}});n.exports={View:h}},"page-gtpost/block":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core"),u=e("../core/log"),a=e("../core/template"),f=e("../core/i18n"),l=e("../core/util"),c=e("../core/enums"),h=s.Model.extend({idAttribute:"__id",defaults:function(){return{id:i.now()-1e3,type:"text",body:"",hover:!1,current:!1}},serialize:function(e){var t={id:this.get("id"),type:this.get("type")};return t.type==="image"?i.extend(t,{url:this.get("url")},e&&{url_preview:this.get("url_preview"),is_animated_image:this.get("is_animated_image"),size:this.get("size")}):t.type==="text"&&this.get("body")!==""?i.extend(t,{body:this.get("body")}):this.get("type")==="video"?i.extend(t,{url:this.get("url")},e&&{url_preview:this.get("url_preview"),ratio:this.get("ratio"),duration:this.get("duration"),host:this.get("host")}):!1}}),p=s.Collection.extend({model:h}),d=s.View.extend({className:"gtpost-block",_toolsShown:!1,constructor:function(e){s.View.apply(this,l.makeArray(arguments)),this.options=i.defaults(e||{},{}),this._builder=this.options.builder,this.listenTo(this.model,"destroy",this.remove),this.listenTo(this._builder,"settings",this._toggleTools)},render:function(){var t=this;return this._canCancelRemove=!0,this.$el.data("block",this.model),this.model.view=this,this.$el.hide().addClass("gtpost-block_type_"+this.model.get("type")),this.$el.append(a(e("./templates/block.html"))({isText:this.model.get("type")===c.block.text})),this.$els={adding:this.$(".gtpost-block__adding-before").click(i.bind(this._toggleAdding,this)).toggle(!this.model.get("disableAdding")),wrapper:this.$(".gtpost-block__wrapper"),content:this.$(".gtpost-block__content"),tools:this.$(".gtpost-block__tools"),move:this.$(".gtpost-block__tool_move").click(i.bind(this._moveModeToggle,this)),close:this.$(".gtpost-block__tool_close").click(function(){t._builder.trigger("settings",!1)}),edit:this.$(".gtpost-block__tool_edit"),up:this.$(".gtpost-block__tool_up").click(i.bind(this._moveDirection,this,!1)),down:this.$(".gtpost-block__tool_down").click(i.bind(this._moveDirection,this,!0)),remove:{icon:this.$(".gtpost-block__tool_remove").click(i.bind(this._toggleRemoveOverlay,this)).toggle(!this.model.get("disableDelete")),overlay:this.$(".gtpost-block__remove-overlay"),message:this.$(".gtpost-block__remove-message"),retry:this.$(".gtpost-block__remove-retry").click(i.bind(this._retry,this)),success:this.$(".gtpost-block__remove-success").click(i.bind(this._removeSuccess,this)),cancel:this.$(".gtpost-block__remove-cancel").click(i.bind(this._toggleRemoveOverlay,this))}},this.model.get("disableAdding")?this:(this.$els.addingPanel=new(e("./adding").View)({collection:this.model.collection,parentBlock:this,builder:this._builder}),this.$els.addingPanel.toggle(!1,!0).$el.insertBefore(this.$els.wrapper),this)},_moveDirection:function(e){var t=this.getBlockBeside(e),n=this.$el.offset().top,r=this;t&&(this.move(t,e),this._moving=!0),this._builder.trigger("settingsChanged")},_moveModeToggle:function(){},_scrollPage:function(e){if(!this._toolsShown)return!1;var t=this.$el.position().top,n=t+this.$el.height(),i=t<e&&e+50<n,s=e+r(window).height();!this._moving&&(e>n||s<t)&&this._toggleTools(!1),this._toolsFixed!==i&&(this._toolsFixed=i,this.$els.tools.toggleClass("gtpost-block__tools_fixed",i))},_toggleTools:function(e){this._toolsShown=i.isBoolean(e)?e:!this._toolsShown,this.$els.tools.toggleClass("gtpost-block__tools_shown",this._toolsShown),this.$els.content.toggleClass("gtpost-block__content_opacity",this._toolsShown),this.$el.height(this._toolsShown?"100px":"100%"),this._toolsShown||this.toggleOverlay(!1),this.$els.adding.toggle(!this._toolsShown)},_retry:function(){this.toggleOverlay(!1),this.model.trigger("uploader:retry",this.model)},focus:function(){return this},move:function(e,t){return e&&e.get("_view")?this.$el[t?"insertAfter":"insertBefore"](e.get("_view").$el):this.$el.appendTo(this._builder.$els.blocks),this},getBlockBeside:function(e){var t=this.$el[e?"next":"prev"]();return t.length>0?t.data("block"):!1},toggleOverlay:function(e,t,n,r){return e=i.isBoolean(e)?e:!this.$els.remove.overlay.is(":visible"),!e&&!this._canCancelRemove?this:(i.isBoolean(n)&&(this.$els.remove.cancel.toggle(i.isBoolean(n)?n:!0),this._canCancelRemove=n),this.$els.remove.retry.toggle(r===!0),this.$els.remove.message.html(i.isString(t)?t:f("page-gtpost:remove")),this.$els.remove.overlay[e?"fadeIn":"fadeOut"](150),this)},_toggleRemoveOverlay:function(e){return e&&e.preventDefault&&e.preventDefault(),this.model.get("_stopList")?(this.model.get("url")&&this.model.get("_stopList").add(this.model.get("url")),this.model.get("_originalUrl")&&this.model.get("_stopList").add(this.model.get("_originalUrl")),this._removeSuccess()):this.model.get("_disableConfirm")?this._removeSuccess():(this.toggleOverlay(e),this)},_removeSuccess:function(t){return t&&t.preventDefault&&t.preventDefault(),e("../core/metrika").goal("tgp-dv__remove-block"),this.model.destroy(),this},_toggleAdding:function(e,t){var n=i.isBoolean(e)?e:!this.$els.adding.hasClass("gtpost-block__adding-before_type_cancel");return e&&e.preventDefault&&e.preventDefault(),this.$els.adding.toggleClass("gtpost-block__adding-before_type_cancel",n),this.$els.addingPanel.toggle(n,t),this},remove:function(){var e=this;return this.toggle(!1),this._builder.trigger("settingsChanged"),setTimeout(function(){e.$el.remove(),e.stopListening(),e._builder.hasBlock()||e._builder.trigger("settings",!1)},200),this},inRange:function(e,t){return this.top=this.$el.offset().top,this.height=this.$el.height(),!(this.top+this.height<e||this.top>t)},toggle:function(e){return this.$el[e?"fadeIn":"fadeOut"](200),e&&i.isFunction(this.focus)&&setTimeout(i.bind(this.focus,this),200),this},active:function(e){return this.model.set("current",e),this}});n.exports={Model:h,Collection:p,View:d}},"page-gtpost/builder":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/template"),u=e("../core/request"),a=e("../core"),f=e("../core/log"),l=e("./block"),c=e("./adding"),h=e("../compare"),p=e("../core/enums"),d={text:e("./blocks/text"),image:e("./blocks/image"),video:e("./blocks/video"),"video-input":e("./blocks/video-input")},v=e("../core/sortable"),m=e("FileAPI"),g=e("../core/util"),y=e("../core/i18n"),b={video:a.config("modules:gtpost:LIMIT_ADD_VIDEO_MIN_RATING")||150,image:-1e3},w={imageCarma:"imageCarma",videoCarma:"videoCarma",textCarma:"textCarma",imageMax:"imageMax",videoMax:"videoMax",textMax:"textMax",blockMax:"blockMax",addDisabled:"addDisabled"},E={image:a.config("modules:gtpost:LIMIT_MAX_MEDIA_BLOCKS_COUNT")||5,text:50,video:a.config("modules:gtpost:LIMIT_MAX_MEDIA_BLOCKS_COUNT")||5,block:a.config("modules:gtpost:LIMIT_MAX_BLOCKS_COUNT")||15},S=s.View.extend({initialize:function(e){var t=a.config("carma");this.options=i.defaults(e,{}),this._blocks=this.options.blocks||new l.Collection,this._countBlocks={video:0,text:0,image:0},this.hasBorder=!1,this.listenTo(this._blocks,"add",this._addBlock),this.listenTo(this._blocks,"destroy",this._removeBlock),this.urlStopList=new Set,this._addingLimits=new Set,i.forEach(E,function(e,n){var r=b[n],i=Math.abs((b[n]||t)-t);r&&(y("page-gtpost:"+n+"Carma",[y("page-gtpost:"+n+"Carma"),i,g.declOfNum(i,y("page-gtpost:carma"))].join(" ")),t<r&&this.addLimit(w[n+"Carma"])),y("page-gtpost:"+n+"Max",[y("page-gtpost:"+n+"Max")].concat(e,g.declOfNum(e,y("page-gtpost:"+n+"s"))).join(" "))},this),this.hasLimit(w.imageCarma)&&this.hasLimit(w.videoCarma)&&(this.addLimit(w.textCarma),this.addLimit(w.addDisabled)),this._checkCanAdding(!0),this.eLimit=w,this.eMax=E,this.render()},render:function(){return this.$els={blocks:this.$(".gtpost__blocks")},this.$els.addingPanel=new c.View({el:this.$els.blocks.next()[0],builder:this}),this.$els.addingPanel.toggle(!0),this},hasLimit:function(e){return this._addingLimits.has(e)},addLimit:function(e){return this._addingLimits.add(e)},removeLimit:function(e){return this._addingLimits.delete(e)},loadStory:function(e){var t=this;return i.each(e,function(e){e.saved=!0;var n=new l.Model(e);t._blocks.add(n)}),this},_removeBlock:function(e){var t=e.get("type")==="video-input"?"video":e.get("type");return this._countBlocks[t]--,this._checkCanAdding(),this},_checkCanAdding:function(e){var t=this,n=i.filter(E,function(e,t){var n=w[t+"Max"],r=this.hasLimit(n),i=t==="block"?this._blocks.length:this._countBlocks[t];return i>=e&&!r?this.addLimit(n):i<e&&r?this.removeLimit(n):!1},this);(e||n)&&this.trigger("change-adding");try{this._blocks.length>0&&this.options.post.$els.hint.blocks.tooltipster("hide")}catch(r){}return this._setBorder()},_setBorder:function(){var e=this._countBlocks.text>=1||this._countBlocks.video>1||this._countBlocks.video>=1&&this._countBlocks.image>1;return e!==this.hasBorder&&(this.hasBorder=e,this.trigger("change-border",e),this.$el.toggleClass("gtpost_with-border",e)),this},_addBlock:function(e){var t=e.get("type")==="video-input"?"video":e.get("type"),n=new(d[e.get("type")].View)({model:e,builder:this});return n.render(),e.set("_view",n),e.get("_before")&&e.get("_before").get("_view")?n.$el.insertBefore(e.get("_before").get("_view").$el):n.$el.appendTo(this.$els.blocks),n.toggle(!0),this._countBlocks[t]++,this._checkCanAdding(),this},addBlock:function(e){return this._blocks.add(e),this},addVideo:function(e,t){var n=i.isString(e)?e:e.url;return this.hasLimit(w.videoCarma)||this.hasLimit(w.videoMax)||this.hasLimit(w.blockMax)?this:this._blocks.some(function(e){return e.get("type")==="video"&&(e.get("url")===n||e.get("_originalUrl")===n)})?this:(i.isString(e)?this._addVideoFromUrl(e,t):this._addVideoFromInformation(e,t),this)},_addVideoFromInformation:function(e,t){return this.addBlock(new l.Model(i.extend(e,{type:"video",url_preview:e.thumb,_stopList:t._stopList,_before:t._before})))},_addVideoFromUrl:function(e,t){var n=this;return d["video-input"].getVideoInfo(e).then(function(r){n.addBlock(new l.Model(i.extend(r,{type:"video",url_preview:r.thumb,_originalUrl:e,_stopList:t._stopList,_before:t._before})))},function(t){n.urlStopList.add(e),f.warn("gtpost","video problem",t)}).always(function(){n._currentTest=!1}),this},addImage:function(e,t){return this.hasLimit(w.imageCarma)||this.hasLimit(w.imageMax)||this.hasLimit(w.blockMax)?this:i.isString(e)?this._addImageFromUrl(e,t):this._addImagesFromFiles(e,t)},_addImagesFromFiles:function(e,t){var n=this,s=r.Deferred();return m.filterFiles(i.isArray(e)?e:[e],function(e,t){return/^image/.test(e.type)&&t&&t.width>2&&t.height>5&&e.size<20*m.MB&&!n._blocks.some(function(t){return t.get("type")==="image"&&t.get("_file")&&t.get("_file").size===e.size&&t.get("_file").name===e.name})},function(e){s.resolve(e.length);if(n.hasLimit(w.imageCarma)||n.hasLimit(w.imageMax))return this;e.slice(0,E.image-n._countBlocks[p.block.image]).forEach(function(e){m.getInfo(e,function(r,i){if(r)return f.error(r),!0;d.image.isAnimated(e,function(r){n._addImage({size:i,is_animated_image:r,_file:e},t)})})})}),s.promise()},_addImageFromUrlFallback:function(e,t,n){var i,s=this,o=function(){var r=i[0];s._addImage({size:{width:r.width,height:r.height},_img:r,_originalUrl:e},t),i.remove(),n.resolve(1)};return i=r(document.createElement("img")).error(function(){s.urlStopList.add(e),n.resolve(0)}).attr("src",e).load(o),i.complete&&o(),n.promise()},_addImageFromUrl:function(e,t){var n=this,i=r.Deferred();return this._blocks.some(function(t){return t.get("type")==="image"&&(t.get("url")===e||t.get("_originalUrl")===e)})?i.resolve(0).promise():(g.getBlob(e).then(function(r){i.resolve(1),m.getInfo(r,function(i,s){if(i)return f.error(i),!0;d.image.isAnimated(r,function(i){n._addImage({size:s,is_animated_image:i,_file:r,_originalUrl:e},t)})})},function(r){n._addImageFromUrlFallback(e,t,i)}),i.promise())},_addImage:function(e,t){var n=this,r,s=m.Image(e._img||e._file).rotate("auto"),o=e.size.exif;return e.size=g.calculateAspectRatioFit(e.size,{width:600,height:9100}),o&&o.Orientation&&o.Orientation>4?r={width:e.size.height,height:e.size.width}:r=e.size,s.preview(e.size.width,e.size.height).get(function(s,o){if(s)return f.error(s),!1;n.addBlock(new l.Model(i.extend(e,{type:"image",size:r,_image:o,_stopList:t._stopList,_before:t._before})))}),this},hasBlock:function(){return Boolean(this._blocks.length)},serialize:function(e){var t=[];return i.forEach(this.$els.blocks.children(),function(n){var i=r(n).data("block");i&&t.push(i.serialize(e))},this),i.compact(t)}});n.exports=S},"page-gtpost/communities":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/request"),l=e("../core/i18n"),c=e("store"),h=e("selectize"),p=e("../core/template"),d=e("../compare"),v=e("./block"),m=e("../core/util"),g=e("../core/enums"),y=e("../core/events"),b=e("../popup-box"),w=function(t){var n=this;this._communitiesInfo={},this._searchedCommunities={},this._searchedRecommendedCommunities={},this.$el=t.$el,this.disabled=t.disabled,this.$el.append(e("./templates/communities.html")),this.$els={select:this.$(".gtpost-builder__community-select").touch(function(){n._showEnterBox()}),rules:t.$rules,rulesWrapper:t.$rulesWrapper,current:this.$(".gtpost-builder__community-current").touch(function(){n._showEnterBox()})},this.init(),this._communityTemplate=p(e("./templates/community-item.html"))};i.extend(w.prototype,y,{_communityId:null,_communitiesInfo:null,_searchedCommunities:null,_searchedRecommendedCommunities:null,_shownCommunitiesFor:null,_shownRecommendedCommunitiesFor:null,_shown:!1,$:function(e){return this.$el.find(e)},init:function(){var t=this;this._communityEnterBox=(new b).setModalMode(!0).addCloseButtonIntoFooter().setInnerIndent(0).append(this.$els.enterBox=r(p(e("./templates/communities-box.html"))())),this.$els.enterBoxEls={close:this.$els.enterBox.find(".communities-box__close").touch(function(){t._communityEnterBox.hide()}),input:this.$els.enterBox.find("input").on("keyup keypress paste",i.debounce(i.bind(this._inputChange,this),300)),empty:this.$els.enterBox.find(".communities-box__empty"),list:this.$els.enterBox.find(".communities-box__list"),recommended:this.$els.enterBox.find(".communities-box__list-recommended")},this.$els.enterBox.on("touch",".gtpost-builder-community",function(e){var n=r(e.target).parents(".gtpost-builder-community"),i=n.data("id");t.setCommunity(i),t._communityEnterBox.hide()})},setCommunity:function(e,t){return e&&t&&(this._communitiesInfo[e]=t),e?(this._communityId=e,this.$els.select.hide(),this.$els.current.html(r(this._communityTemplate(i.extend({edit:this.disabled?!1:!0},this._communitiesInfo[e])))).show(),this.$els.rules.empty().append(this._communitiesInfo[e].rules),this.$els.rulesWrapper.show()):(this._communityId=null,this.$els.select.show(),this.$els.current.hide(),this.$els.rulesWrapper.hide()),this.trigger("change"),this},_inputChange:function(){var e=this,t=i.escape(this.$els.enterBoxEls.input.val()),n=t.toLowerCase();return this._lastInput===t?this:(this._lastInput=t,t.length===0?(this._showFoundCommunities(),this):this._searchedCommunities[n]?(this._showFoundCommunities(t,this._searchedCommunities[n]),this):(this.$els.enterBox.addClass("communities-box_loading"),f("/ajax/gtpost_actions.php?action=search_communities",{method:"POST",data:{name:t}}).then(function(r){r.result&&r.data?e._showFoundCommunities(t,e._searchedCommunities[n]=r.data):(new b).showMessage(elem,"Ошибка запроса на сервер","error")}).always(function(){e.$els.enterBox.removeClass("communities-box_loading")}),this))},setRecommended:function(e){var t=this;return e===this._shownRecommendedCommunitiesFor?this:(this._shownRecommendedCommunitiesFor=e,this._searchedRecommendedCommunities[e]?this:(f("/ajax/gtpost_actions.php?action=search_recommended_communities",{type:"POST",data:{name:e},dataType:"json"}).then(function(n){n.result&&n.data&&(t._searchedRecommendedCommunities[e]=n.data)}),this))},_showFoundCommunities:function(e,t){e=e||"";var n=this,s=e.toLowerCase();return this._communityEnterBox.isShown()?(this.$els.enterBoxEls.list.empty().show(),this.$els.enterBoxEls.recommended.empty().hide(),this.$els.enterBoxEls.empty.hide(),!e&&this._searchedRecommendedCommunities[this._shownRecommendedCommunitiesFor]?this._showRecommended():t&&t.length===0?(this.$els.enterBoxEls.empty.show(),this):(i.forEach(t,function(e){n._communitiesInfo[e.id]=e,n.$els.enterBoxEls.list.append(r(n._communityTemplate(e)).attr("data-id",e.id))}),this)):this},_showRecommended:function(){return this.$els.enterBoxEls.list.hide(),this.$els.enterBoxEls.recommended.empty().show(),i.forEach(this._searchedRecommendedCommunities[this._shownRecommendedCommunitiesFor],function(e){this._communitiesInfo[e.id]=e,this.$els.enterBoxEls.recommended.append(r(this._communityTemplate(e)).attr("data-id",e.id))},this),this},_showEnterBox:function(){return this.disabled?this:(this._lastInput="",this.$els.enterBoxEls.input.val(""),this._communityEnterBox.show(this.$els.select),this._showFoundCommunities(),this.$els.enterBoxEls.input.focus(),this)},toggle:function(e){this._shown=i.isBoolean(e)?e:!this._shown,this.$el.toggle(this._shown),this._shown?!this._communityId&&this._showEnterBox():this.setCommunity()},getCommunityId:function(){return this._communityId||""},getCommunity:function(){return this._communityId?JSON.stringify(this._communitiesInfo[this._communityId]):""}}),n.exports=w},"page-gtpost/exif":function(e,t,n){(function(){var e=function(e,t,n){var r=e,i=t||0,s=0;this.getRawData=function(){return r},"string"==typeof e&&(s=n||r.length,this.getByteAt=function(e){return r.charCodeAt(e+i)&255},this.getBytesAt=function(e,t){for(var n=[],s=0;s<t;s++)n[s]=r.charCodeAt(e+s+i)&255;return n}),this.getLength=function(){return s},this.getSByteAt=function(e){return e=this.getByteAt(e),127<e?e-256:e},this.getShortAt=function(e,t){var n=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return 0>n&&(n+=65536),n},this.getSShortAt=function(e,t){var n=this.getShortAt(e,t);return 32767<n?n-65536:n},this.getLongAt=function(e,t){var n=this.getByteAt(e),r=this.getByteAt(e+1),i=this.getByteAt(e+2),s=this.getByteAt(e+3),n=t?(((n<<8)+r<<8)+i<<8)+s:(((s<<8)+i<<8)+r<<8)+n;return 0>n&&(n+=4294967296),n},this.getSLongAt=function(e,t){var n=this.getLongAt(e,t);return 2147483647<n?n-4294967296:n},this.getStringAt=function(e,t){for(var n=[],r=this.getBytesAt(e,t),i=0;i<t;i++)n[i]=String.fromCharCode(r[i]);return n.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))},this.toBase64=function(){return window.btoa(r)},this.fromBase64=function(e){r=window.atob(e)}},t={};(function(){function e(e){if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return!1;for(var t=2,n=e.getLength();t<n;){if(255!=e.getByteAt(t))return s&&console.log("Not a valid marker at offset "+t+", found: "+e.getByteAt(t)),!1;var r=e.getByteAt(t+1);if(22400==r||225==r)return s&&console.log("Found 0xFFE1 marker"),i(e,t+4,e.getShortAt(t+2,!0)-2);t+=2+e.getShortAt(t+2,!0)}}function n(e,t,n,i,o){for(var u=e.getShortAt(n,o),a={},f=0;f<u;f++){var l=n+12*f+2,c=i[e.getShortAt(l,o)];!c&&s&&console.log("Unknown tag: "+e.getShortAt(l,o)),a[c]=r(e,l,t,n,o)}return a}function r(e,t,n,r,i){var s=e.getShortAt(t+2,i),r=e.getLongAt(t+4,i),n=e.getLongAt(t+8,i)+n;switch(s){case 1:case 7:if(1==r)return e.getByteAt(t+8,i);n=4<r?n:t+8,t=[];for(s=0;s<r;s++)t[s]=e.getByteAt(n+s);return t;case 2:return e.getStringAt(4<r?n:t+8,r-1);case 3:if(1==r)return e.getShortAt(t+8,i);n=2<r?n:t+8,t=[];for(s=0;s<r;s++)t[s]=e.getShortAt(n+2*s,i);return t;case 4:if(1==r)return e.getLongAt(t+8,i);t=[];for(s=0;s<r;s++)t[s]=e.getLongAt(n+4*s,i);return t;case 5:if(1==r)return e.getLongAt(n,i)/e.getLongAt(n+4,i);t=[];for(s=0;s<r;s++)t[s]=e.getLongAt(n+8*s,i)/e.getLongAt(n+4+8*s,i);return t;case 9:if(1==r)return e.getSLongAt(t+8,i);t=[];for(s=0;s<r;s++)t[s]=e.getSLongAt(n+4*s,i);return t;case 10:if(1==r)return e.getSLongAt(n,i)/e.getSLongAt(n+4,i);t=[];for(s=0;s<r;s++)t[s]=e.getSLongAt(n+8*s,i)/e.getSLongAt(n+4+8*s,i);return t}}function i(e,r){if("Exif"!=e.getStringAt(r,4))return s&&console.log("Not valid EXIF data! "+e.getStringAt(r,4)),!1;var i,o=r+6;if(18761==e.getShortAt(o))i=!1;else{if(19789!=e.getShortAt(o))return s&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getShortAt(o+2,i))return s&&console.log("Not valid TIFF data! (no 0x002A)"),!1;if(8!=e.getLongAt(o+4,i))return s&&console.log("Not valid TIFF data! (First offset not 8)",e.getShortAt(o+4,i)),!1;var u=n(e,o,o+8,t.TiffTags,i);if(u.ExifIFDPointer){var a=n(e,o,o+u.ExifIFDPointer,t.Tags,i),f;for(f in a){switch(f){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":a[f]=t.StringValues[f][a[f]];break;case"ExifVersion":case"FlashpixVersion":a[f]=String.fromCharCode(a[f][0],a[f][1],a[f][2],a[f][3]);break;case"ComponentsConfiguration":a[f]=t.StringValues.Components[a[f][0]]+t.StringValues.Components[a[f][1]]+t.StringValues.Components[a[f][2]]+t.StringValues.Components[a[f][3]]}u[f]=a[f]}}if(u.GPSInfoIFDPointer)for(f in i=n(e,o,o+u.GPSInfoIFDPointer,t.GPSTags,i),i){switch(f){case"GPSVersionID":i[f]=i[f][0]+"."+i[f][1]+"."+i[f][2]+"."+i[f][3]}u[f]=i[f]}return u}var s=!1;t.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},t.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},t.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},t.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},t.getData=function(t,n){return t.complete?(t.exifdata?n&&n():BinaryAjax(t.src,function(r){r=e(r.binaryResponse),t.exifdata=r||{},n&&n()}),!0):!1},t.getTag=function(e,t){if(e.exifdata)return e.exifdata[t]},t.getAllTags=function(e){if(!e.exifdata)return{};var e=e.exifdata,t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},t.pretty=function(e){if(!e.exifdata)return"";var e=e.exifdata,t="",n;for(n in e)e.hasOwnProperty(n)&&(t="object"==typeof e[n]?t+(n+" : ["+e[n].length+" values]\r\n"):t+(n+" : "+e[n]+"\r\n"));return t},t.readFromBinaryFile=function(t){return e(t)}})(),FileAPI.support.exif=!0,FileAPI.addInfoReader(/^image/,function(n,r){if(!n.__exif){var i=n.__exif=FileAPI.defer(),s=n;if(s instanceof Blob&&s.size>131072)try{var o=Math.min(s.size,131072);s=(s.slice||s.mozSlice||s.webkitSlice).call(s,0,o)}catch(u){FileAPI.log("exception "+u)}FileAPI.readAsBinaryString(s,function(n){if(n.type=="load"){var r=n.result,o=new e(r,0,s.size),u=t.readFromBinaryFile(o);i.resolve(!1,{exif:u||{}})}else n.type=="error"&&i.resolve("read_as_binary_string_exif")})}n.__exif.then(r)})})()},"page-gtpost/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/request"),c=e("../core/i18n"),h=e("store"),p=e("selectize"),d=e("../core/template"),v=e("./builder"),m=e("../compare"),g=e("./block"),y=e("../core/util"),b=e("../core/enums"),w=e("../popup-box"),E=e("./uploader").ImageUploader,S=e("./exif"),x=e("../wm"),T=5e3,N=15e3,C=f.extend({_ignoredTags:null,_currentStep:1,_settingsShown:!1,_previewNeedRedraw:!0,_removedBlockSaved:!0,show:function(){if(this._inited)return this;this._inited=!0,this._id=u.config("modules:gtpost:page_id"),this._storyId=u.config("modules:gtpost:story_id"),this._isEdit=this._storyId>0,this.render(),this._removedBlockSaved=!0,this._freeze=!1,this._id=u.config("modules:gtpost:page_id"),this.watchMaster(),h.set("_id",this._id),this.init()},render:function(){var t=this;this._startAutosave=i.bind(this.startAutosave,this),this._findRecommendedCommunity=i.debounce(function(){t._community.setRecommended(t._tags.val())},1e3),this._$body=r("body"),r(".content_container").css("height","100%"),this.$el=this._$body.find(".gtpost-builder"),this.$els={container:r(".right_container_wrapper").css("height","100%"),steps:[this.$(".gtpost-builder__step_1"),this.$(".gtpost-builder__step_2"),this.$(".gtpost-builder__step_3"),this.$(".gtpost-builder__step_4")],freeze:this.$(".gtpost-builder__freeze-overlay"),controlsWrapper:this.$(".gtpost-builder__item_last").hover(function(e){var n=e.type==="mouseenter",r=t.$els.controls.hasClass("gtpost-builder_disabled");return clearTimeout(t._showDisabledHintTimeout),r===n?!1:(n?t._wait&&(t._showDisabledHintTimeout=setTimeout(t._showDisabledHint.bind(t,!0),150)):t._showDisabledHint(!1),!0)}),controls:this.$(".gtpost-builder__controls"),controlsBlockOverlay:this.$(".gtpost-builder__block-overlay"),pageFooter:r(".footer_links"),tags:this.$('input[name="tags"]').on("change",function(){t._findRecommendedCommunity(),t._startAutosave()}),title:this.$('textarea[name="title"]').on("keyup",i.bind(this._updateTitleHeight,this)).bind("blur",this._startAutosave),is_authors:this.$('span.checkbox[name="is_authors"]').tap(function(n){var i=r(n.target).is(".checkbox")?r(n.target):r(n.target).closest(".checkbox"),s=i.hasClass("on");return s||e("../../blocks/message")(c("page-gtpost:hint-strawberry"),"success"),t._startAutosave(),this}),is_adult:this.$('span.checkbox[name="is_adult"]').click(this._startAutosave),is_community:this.$('span.checkbox[name="is_community"]').tap(function(){if(t._isEdit)return!0;t._community.toggle(),t._startAutosave()}),community:this.$(".gtpost-builder__community-input"),sidebar:this.$(".gtpost-builder__sidebar"),main:this.$(".gtpost-builder__main"),preview:this.$(".gtpost-builder__preview"),previewLoader:this.$(".gtpost-builder__preview-loader"),draft:{save:this.$(".gtpost-builder__save").click(i.bind(this.saveDraft,this)),message:this.$(".gtpost-builder__save-message")},errors:{el:this.$(".gtpost-builder__errors"),list:this.$(".gtpost-builder__errors-list")},footer:r(".footer-table")},this._isEdit&&this.$els.is_community.parent().hide(),this.$el.on("click",".b-story__show-all",i.bind(this._showPost,this));var n=e("../tags");return this._tags=new n(this.$els.tags),this.$els.header=r(d(e("./templates/header.html"))({isEdit:this._isEdit})).appendTo(r("#right_container .header")),this.$els.nextStep=this.$els.header.find(".gtpost-builder-header__next-step").tap(i.bind(this.changeStep,this,!0)),this._community=new(e("./communities"))({$el:this.$els.community,disabled:this._isEdit,$rules:this.$(".gtpost-builder__community-rules"),$rulesWrapper:this.$(".gtpost-builder__community-rules-wrapper")}),this._community.on("change",this._startAutosave),this.$(".checkbox").prev().tap(function(e){r(e.delegateTarget).next().tap()}),r(window).on("popstate",function(e){var n=e.originalEvent.state&&e.originalEvent.state.step;if(!n||n===t._currentStep)return!1;t.changeStep(t._currentStep<n,!0)}),window.history.replaceState({step:this._currentStep},document.title,""),this.$els.settings=r(document.createElement("div")).addClass("gtpost-builder__settings fa fa-pencil").appendTo(this._$body).tap(i.bind(this.toggleSettings,this)),this.$els.close=this.$els.header.find(".gtpost-builder-header__close").tap(i.bind(this.changeStep,this,!1)),this},init:function(){var e=this;return this._blocks=new g.Collection,this._autosaveDebounce=i.debounce(function(){!e._currentSaved()&&!e._isEdit&&e.saveDraft(!0)},T),this.listenTo(this._blocks,"remove",i.bind(this.startAutosave,this,!0)),this.listenTo(this._blocks,"change:body",function(t){t.set({saved:!1},{silent:!0}),e._autosaveDebounce(),e._checkTextLength()}),this.listenTo(this._blocks,"add change:url",function(t){!t.get("saved")&&(t.get("type")!==b.block.image||t.get("url"))&&e._autosaveDebounce()}),this._builder=new v({el:this.$(".gtpost")[0],blocks:this._blocks,post:this}),this.listenTo(this._builder,"settings",function(t){e._settingsShown=i.isBoolean(t)?t:!e._settingsShown,e._settingsShown?(e.settingsChanged=!1,e._scrollTopBeforeSettings=e.$el.scrollTop(),e.$el.animate({scrollTop:0},160,function(){e._moving=!1})):e._settingsChanged||e.$el.animate({scrollTop:e._scrollTopBeforeSettings},160,function(){e._moving=!1}),e.$els.settings.toggleClass("fa-pencil",!e._settingsShown).toggleClass("fa-close",e._settingsShown)}),this.listenTo(this._builder,"settingsChanged",function(){e._settingsChanged=!0}),this.compare=new m.Main({blocks:this._blocks}),this.compare.on("wait",function(t){e._wait=t,!t}),this.compare.$el.appendTo(this.$(".gtpost-builder__compare")),this._uploader=new E({blocks:this._blocks}),this._compareStorage=new m.Storage({storyId:this._storyId,blocks:this._blocks,sources:this.compare._sources}),this._isEdit?this._loadPost(u.config("modules:gtpost:story")):this.loadDraft(),this},_updateTitleHeight:function(){this.$els.title.height(1),this.$els.title.height(this.$els.title[0].scrollHeight-20)},toggleSettings:function(){this._settingsShown=this._blocks.length===0?!1:!this._settingsShown,this._builder.trigger("settings",this._settingsShown)},changeStep:function(t,n){var r=this;n=i.isBoolean(n)?n:null;if(!i.isBoolean(t)||this._currentChangeStep||this._currentStep===0&&!t||this._currentStep===5&&t)return this;this._currentChangeStep=!0;if(this._currentStep===1&&t)return this._settingsShown?(this.toggleSettings(),this._currentChangeStep=!1,this):(this._uploader.forceStart(),this.validate(["title","blocks"]).then(function(e){r._compareStorage._currentWait||r.compare._hasElements()?r._changeStep(2,n):r._changeStep(3,n)},function(t){var n=i.map(t,function(e){return c(e.error)}).join("<br>");e("../../blocks/message")(n,"failure"),r._currentChangeStep=!1}),this);if(this._currentStep===2&&t){if(this._wait)return e("../../blocks/message")(c("page-gtpost:hint-wait-compare"),"failure"),this._currentChangeStep=!1,this}else{if(this._currentStep===3&&!t&&!r._compareStorage._currentWait&&!r.compare._hasElements())return r._changeStep(1,n);if(this._currentStep===1&&!t)return window.location="/",this;if(this._currentStep===3&&t)return this.validate(["tags","is_community","community"]).then(function(){r._showPreview(),r._changeStep(4,n),r._currentChangeStep=!1},function(t){var n=i.map(t,function(e){return c(e.error)}).join("<br>");e("../../blocks/message")(n,"failure"),r._currentChangeStep=!1}),this;if(this._currentStep===4&&t)return r._submitForm(),this._currentChangeStep=!1,this}return this._changeStep(this._currentStep+(t?1:-1),n),this},_changeStep:function(e,t){var n=this,r=this._currentStep,s=r<e;if(r===e)return this;t||window.history.pushState({step:e},document.title,""),this._currentStep=e,this.$el.scrollTop(0),window.$elss=this.$el,this.$els.nextStep.text(e>3?this._isEdit?"Сохранить":"Добавить":"Далее"),this.$els.close.toggleClass("gtpost-builder-header__close_back",e>1),this.$els.settings.toggle(e===1),i.forEach(this.$els.steps,function(t,n){n+=1;if(n!==r&&n!==e)return this;t.toggleClass("gtpost-builder__step_direction_prevent",!s).toggleClass("gtpost-builder__step_show_on",e===n).toggleClass("gtpost-builder__step_show_off",e!==n),t.toggleClass("gtpost-builder__step_on",!0)},this),setTimeout(function(){i.forEach(n.$els.steps,function(t,n){n+=1;if(n!==r&&n!==e)return this;t.toggleClass("gtpost-builder__step_on",e===n)},n),n._currentChangeStep=!1},700)},_currentSaved:function(){var e=this.serialize(["title","tags","is_authors","is_adult","is_community","community"]),t=i.every(e,function(e,t){return!this._draft||this._draft[t]===e},this);return t&&this._removedBlockSaved&&this._blocks.every(function(e){return e.get("saved")})},_getTextLength:function(){return this._blocks.reduce(function(e,t){return e+(t.get("type")==="text"?t.get("body").length:0)},0)},_checkTextLength:function(){var e=this._getTextLength(),t=e>u.config("modules:gtpost:LIMIT_MAX_TEXT_BLOCKS_LENGTH");return this.$els.errorText||(this.$els.errorText=r(document.createElement("div")).addClass("gtpost-builder__sidebar-error").appendTo(this.$els.sidebar)),this.$els.errorText.html('<i class="fa fa-warning"></i> '+c("page-gtpost:errors:text-length")+e+"/"+u.config("modules:gtpost:LIMIT_MAX_TEXT_BLOCKS_LENGTH")).toggle(t),t},serialize:function(e){var t={};return e=i.isUndefined(e)?["title","blocks","tags","is_authors","is_adult","is_community","community","community_data"]:i.isArray(e)?e:[e],i.forEach(e,function(e){e==="blocks"?t[e]=this._builder.serialize(!0):e==="is_authors"||e==="is_adult"||e==="is_community"?t[e]=this.$els[e].hasClass("on"):e==="tags"?t[e]=this.$els[e].val():e==="community"?t[e]=this._community.getCommunityId():e==="community_data"?t[e]=this._community.getCommunity():t[e]=this.$els[e].val()},this),t},watchMaster:function(){var e=this;try{if(!("localStorage"in window&&window.localStorage!==null&&window.localStorage!==undefined))return this}catch(t){return this}return/trident|MSIE/i.test(navigator.userAgent)?this._watchMasterIntervalID=setInterval(function(){h.get("_id")!=e._id&&e.freeze()},100):r(window).on("storage",function(t){var n=t&&t.originalEvent||n||window.event;n.key=="_id"&&n.newValue!=e._id&&e.freeze()}),N?(this._watchMasterFromServerID=setInterval(function(){l("/ajax/gtpost_actions.php?action=get_last_page_id").then(function(t){(!t.data||t.data.id!=e._id)&&e.freeze()})},N),this):this},freeze:function(){return this._freeze=!0,a.info("gtpost","freeze tgp"),r(window).off(),clearInterval(this._watchMasterIntervalID),clearInterval(this._watchMasterFromServerID),this.$el.addClass("gtpost-builder_disabled"),this.$els.freeze.show(),this},startAutosave:function(e){return this._previewNeedRedraw=!0,i.isBoolean(e)&&(this._removedBlockSaved=!1),this._autosaveDebounce(),this},loadDraft:function(){var e=h.get("_p_p"),t=u.config("modules:gtpost:draft");if(e&&e.time>t.time)this._draft=e;else{if(!t||!t.blocks)return this;this.removeLocalDraft(),this._draft=t}return this._loadPost(this._draft),this},saveLocalDraft:function(){var e=this.serialize();return e.time=Math.floor(i.now()/1e3),h.set("_p_p",e),this._showSaveMessage(),this._removedBlockSaved=!0,i.forEach(e.blocks,function(e){this._blocks.findWhere({id:e.id}).set({saved:!0},{silent:!0})},this),this},saveDraft:function(t){var n=this,r=this.serialize();return n._freeze||n._currentSaved()||n._isEdit?(n._showSaveMessage(),this):(e("../core/metrika").goal(t===!0?"tgp-dv__autosave":"tgp-dv__save-button"),a.info("gtpost","save draft"),l("/ajax/gtpost_actions.php?t=d",{type:"POST",data:{action:"save_draft",data:JSON.stringify(r)}}).then(function(){n._draft=r,n.removeLocalDraft(),n._showSaveMessage(),setTimeout(function(){n.$els.draft.message.removeClass("gtpost-builder__save-message_show_yes")},500),n._removedBlockSaved=!0,i.forEach(r.blocks,function(e){n._blocks.findWhere({id:e.id}).set({saved:!0},{silent:!0})})},function(){n.saveLocalDraft()}),this)},_loadPost:function(e){this.$els.title.val(e.title);var t=e.tags.split(", ");i.forEach(t,function(e){this._tags.addTag(e,!0)},this),this._community.setRecommended(this._tags.val()),this.$els.is_adult.toggleClass("on",e.is_adult),this.$els.is_authors.toggleClass("on",e.is_authors),this.$els.is_community.toggleClass("on",e.is_community||!1);if(e.community&&e.community_data){var n;try{n=JSON.parse(e.community_data)}catch(r){n=null}typeof n=="object"&&(this._community.setCommunity(e.community,n),this._community.toggle(!0))}this._builder.loadStory(e.blocks),this._updateTitleHeight()},removeLocalDraft:function(){return h.remove("_p_p"),this},removeDraft:function(){return this},_showSaveMessage:function(){var e=this;this.$els.draft.message.addClass("gtpost-builder__save-message_show_yes").html(c("page-gtpost:draft-save")+o().format("HH:mm")).show(),setTimeout(function(){e.$els.draft.message.removeClass("gtpost-builder__save-message_show_yes")},500)},toggleMainErrors:function(e,t){e&&this.$els.errors.list.html(i.reduce(i.isArray(t)?t:[t],function(e,t){return e+"<li>"+t+"</li>"},"")),this.$els.errors.el.toggle(e)},validate:function(e){var t=[],n=r.Deferred(),s=!1,o=!1,a;return e=i.isUndefined(e)?this.serialize():this.serialize(e),i.forEach(e,function(n,i){i==="title"?(e[i]=n=r.trim(n),n.length<u.config("modules:gtpost:LIMIT_MIN_TITLE_LENGTH")&&t.push({param:i,error:"page-gtpost:errors:title-short"}),n.length>u.config("modules:gtpost:LIMIT_MAX_TITLE_LENGTH")&&t.push({param:i,error:c("page-gtpost:errors:title-long")+n.length+"/"+u.config("modules:gtpost:LIMIT_MAX_TITLE_LENGTH")})):i==="tags"?(e[i]=n=r.trim(n),n=n.split(", ").slice(0,u.config("modules:gtpost:LIMIT_MAX_TAGS_COUNT")-1),n.length<u.config("modules:gtpost:LIMIT_MIN_TAGS_COUNT")&&t.push({param:i,error:"page-gtpost:errors:tags-min"})):i==="blocks"?(n.length<1&&t.push({param:i,error:"page-gtpost:errors:blocks"}),a=this._getTextLength(),a>u.config("modules:gtpost:LIMIT_MAX_TEXT_BLOCKS_LENGTH")&&t.push({param:i+"_text",error:c("page-gtpost:errors:text-length")+a+"/"+u.config("modules:gtpost:LIMIT_MAX_TEXT_BLOCKS_LENGTH")})):i==="is_community"?(s=n,o&&t.push({param:"community",error:"page-gtpost:errors:community-empty"})):i==="community"&&(n||(s?t.push({param:"community",error:"page-gtpost:errors:community-empty"}):o=!0))},this),t.length>0?n.reject(t):n.resolve(e),n.promise()},_submitForm:function(t){var n=this;return t&&t.preventDefault&&t.preventDefault(),this._submitDisabled?this:(this.toggleMainErrors(!1),this.$els.nextStep.addClass("gtpost-builder-header__next-step_progress"),this._submitDisabled=!0,this._uploader.forceStart().then(function(){n.validate().then(function(t){if(n._freeze)return n.$els.nextStep.prop("disabled",!1),!0;t={action:"publish",data:JSON.stringify(t)},n._isEdit&&(t.story_id=n._storyId),l("/ajax/gtpost_actions.php?t=p",{type:"POST",data:t}).then(function(t){t.result?(n._freeze=!0,e("../core/location").redirect(t.data.story_url)):(n.toggleMainErrors(!0,t.message),n.$els.nextStep.removeClass("gtpost-builder-header__next-step_progress"),n._submitDisabled=!1)}).fail(function(){n.$els.nextStep.removeClass("gtpost-builder-header__next-step_progress"),n._submitDisabled=!1})},function(e){n.$els.nextStep.removeClass("gtpost-builder-header__next-step_progress")})}),this)},_showPreview:function(){var t=this;return this._waitPreview?this:(this._waitPreview=!0,this._previewNeedRedraw?(this.$els.preview.hide(),this.$els.previewLoader.show(),e("../core/metrika").goal("tgp-mv__preview"),this._uploader.forceStart().then(function(){t.validate().then(function(n){if(t._freeze)return!0;l("/preview.php?f=json",{method:"POST",data:{type:"story",data:JSON.stringify(n)}}).then(function(n){if(!n.result)return t.toggleMainErrors(!0,n.message),!1;t.$els.preview.html(n.data.html).show(),e("../gifx").init()}).always(function(){t.$els.previewLoader.hide(),t._waitPreview=!1,t._previewNeedRedraw=!1})},function(e){t._waitPreview=!1,t._previewNeedRedraw=!1})}),this):(this.$els.preview.show(),this.$els.previewLoader.hide(),this))},_showPost:function(t){if(t.shiftKey||t.ctrlKey||t.metaKey)return;t.preventDefault(),t.stopPropagation(),e("../core/metrika").goal("tgp-mv__show-all");var n=r(t.target).closest(".b-story__show-all");n.hide();if(n.hasClass("b-story__show-all_legacy"))return n.closest(".post_wrapper").removeClass("post_wrapper"),this;n.parent().find(".b-story-blocks__wrapper").removeClass("b-story-blocks__wrapper_slice_yes").css("max-height","100%"),n.parent().find(".b-story-blocks__hide-wrapper").show();var s=n.parent().find(".b-story-block_type_image img");return i.each(s,function(e){e=r(e),e.data("src")&&(e.attr("src",e.data("src")),e.removeData("src"))}),this}});x.add({name:"add",layout:C}),x.add({name:"edit",layout:C,routes:{"":"show",":id":"show"}}),n.exports=x.add({name:"gtpost.php",layout:C})},"page-gtpost/uploader":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("FileAPI"),u=e("../core/request"),a=e("../core/index"),f=e("../core/events"),l=e("./block"),c=e("../core/i18n"),h=e("../core/log"),p=e("../core/enums"),d=3e3,v=function(e){this._def=null,this._tasks=[],this._waitTask=new Set,this._currentWait=!1,this._currentRun=!1,this._blocks=e.blocks||new l.Collection,this._blocks.on("add",i.bind(this._addBlock,this)),this._blocks.on("remove",i.bind(this._removeBlock,this)),this._blocks.on("uploader:retry",i.bind(this._retry,this))};i.extend(v.prototype,f,{checkNeedUpload:function(){return Boolean(this._waitTask.size)},_emit:function(e,t){return this._blocks.trigger("uploader:"+e,t),this.trigger(e),this},_changeWait:function(e){this._currentWait!==e&&(this._currentWait=e,this._emit("wait",e))},_retry:function(e){this.start()},forceStart:function(){return this._waitTask.size?(this._waitTask.forEach(function(e){this._addTask(e)},this),this.getPromise()):r.Deferred().resolve()},_addBlock:function(e){var t=e.get("type");return t!==p.block.image||e.get("url")?this:this._waitTask.has(e)?this:(this._waitTask.add(e),this._changeWait(!0),setTimeout(i.bind(this._addTask,this,e),d),this)},_addTask:function(e){return this._waitTask.has(e)?(this._tasks.push({attempt:!1,attempts:0,model:e}),this.start(),this._removeWaitTask(e),this):this},_removeBlock:function(e){return e.get("type")!==p.block.image?this:(this._removeWaitTask(e),this._removeTaskByModel(e),this)},_removeWaitTask:function(e){return this._waitTask.has(e)?(this._waitTask.delete(e),this._waitTask.size===0&&this._currentState===p.compare.state.ready&&this._changeWait(!1),this):this},_removeTaskByModel:function(e){var t=i.find(this._tasks,function(t){return t.model===e});return i.isUndefined(t)?this._emit("remove",e):this._tasks=i.without(this._tasks,t),!i.isUndefined(t)},start:function(){return this._currentRun||this._tasks.length===0?!1:(this._def&&this._def.reject("restart"),this._def=r.Deferred(),this._currentRun=!0,i.each(this._tasks,function(e){e.attempt=!1}),this._changeWait(!0),this._upload().getPromise())},_endUpload:function(){var e={success:[],error:[]};return i.forEach(this._tasks,function(t){t.result?(t.message.small.is_animated_image&&t.message.preview&&t.model.set({is_animated_image:t.message.small.is_animated_image,url_preview:t.message.preview.file_url}),t.model.set("url",t.message.small.file_url),this._removeTaskByModel(t.model)):(t.model.trigger("error",t.model,t.message,t.attempts<3),e.error.push(t.message))},this),this._currentRun=!1,this._waitTask.size===0&&this._changeWait(!1),this._def.resolve(e),this},_getNextTask:function(){return i.findWhere(this._tasks,{attempt:!1})},_upload:function(){var e=this._getNextTask();return e?(e.attempt=!0,e.attempts++,this[e.model.get("_originalUrl")?"_uploadUrl":"_uploadFile"](e).then(this._upload.bind(this)),this):(this._endUpload(),this)},_uploadUrl:function(e){var t=this,n=r.Deferred();return e.progress=5,t.progress(),e._simulateProgress=setInterval(function(){e.progress=e.progress+5,t.progress()},1e3),u(a.config("upload_server_url")+"/ajax/upload_file.php",{type:"POST",dataType:"json",data:{type:"story_image",url:e.model.get("_originalUrl"),save:1},xhrFields:{withCredentials:!0}}).then(function(n){e.result=n.result,e.message=n.result?n.data:n.message,e.progress=100,t.progress()},function(){e.result=!1,e.message="Непредвиденная ошибка",e.progress=100,t.progress()}).always(function(){clearInterval(e._simulateProgress),n.resolve()}),n.promise()},_uploadFile:function(e){var t=this,n=r.Deferred();return o.withCredentials=!0,o.upload({url:a.config("upload_server_url")+"/ajax/upload_file.php",type:"POST",headers:{"X-Csrf-Token":a.config("token")},contestType:"multipart/form-data",dataType:"json",data:{type:"story_image",uid:0,save:1},files:[e.model.get("_file")],progress:function(n){e.progress=n.loaded/n.total*100,t.progress()},complete:function(r,i){var s;if(r)return e.result=!1,e.message=i.status===413?c("page-gtpost:errors:upload-max"):c("page-gtpost:errors:upload"),n.resolve(),!1;try{s=JSON.parse(i.response),e.result=s.result,e.message=s.result?s.data:s.message,e.progress=100,t.progress()}catch(o){}n.resolve()}}),n.promise()},progress:function(e){var t=e?1:0,n=e||0;return i.isUndefined(e)&&r.each(this._tasks,function(e,r){n+=r.progress||0,t++}),this._emit("progress",t===0?100:n/t),this},getPromise:function(){return this._def.promise()}}),n.exports={ImageUploader:v}},"page-gtpost/blocks/image":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../../core/template"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/util"),l=e("../../core/i18n"),c=e("../../core/request"),h=e("FileAPI"),p=e("../block"),d=r(".gtpost:first"),v=p.View.extend({type:"image",render:function(){var e=this;p.View.prototype.render.apply(this),i.isArray(this.model.get("size"))&&this.model.set("size",{width:this.model.get("size")[0],height:this.model.get("size")[1]}),this.changeSize(),this.listenTo(this.model,"error",this.onError),this.listenTo(this.model,"change:url",this.update),this.model.get("is_animated_image")&&u.on("window:resize",this._changeSize),this.update()},update:function(){var t=this;this.$els.content.empty();if(this.model.get("url")){this.$els.body=r(document.createElement("img")).attr("src",this.model.get("url_preview")||this.model.get("url"));try{this.$els.body.attr("width",this.model.get("size").width).attr("height",this.model.get("size").height)}catch(n){}}else if(r(this.model.get("_image")).is("canvas"))try{this.$els.body=r(document.createElement("img")).attr("src",r(this.model.get("_image"))[0].toDataURL("image/png"))}catch(n){this.$els.body=r(this.model.get("_image"))}else this.$els.body=r(this.model.get("_image"));this.model.get("is_animated_image")?(this._changeSize=i.bind(this.changeSize,this),this.$els.gifx=r(e("../templates/block-gifx.html")).appendTo(this.$els.content),this.$els.preview=this.$(".gtpost-gifx__preview").append(this.$els.body),this.$els.gifx.click(function(){t.$els.hintMessage||(t.$els.hintMessage=r(document.createElement("div")).addClass("gtpost-block__hint-overlay").append(l("page-gtpost:play")).hide().appendTo(t.$els.gifx));var e=t.$els.hintMessage.is(":visible");t.$els.hintMessage[e?"fadeOut":"fadeIn"](200),t.$els.preview.toggleClass("gtpost-block_disabled",!e)})):this.$els.body.appendTo(this.$els.content)},changeSize:function(){var e=d.width(),t=this.model.get("size").width/this.model.get("size").height,n=e/t,i={width:e,height:this.model.get("is_animated_image")?r(window).height()/10*9:n};this.model.set("size",f.calculateAspectRatioFit({width:f.toEven(e),height:f.toEven(n)},i)),this.$els.content.toggleClass("gtpost-block__content_margin",e-30>this.model.get("size").width),this.$els.content.attr("style","width: "+this.model.get("size").width+"px; height: "+this.model.get("size").height+"px;")},onError:function(e,t,n){this.toggleOverlay(!0,t,!1,n)},remove:function(){return this._changeSize&&u.off("window:resize",this._changeSize),this._builder.trigger("uploadStop",this.model),p.View.prototype.remove.apply(this),this.model.get("url")&&c("/ajax/gtpost_actions.php?t=d",{type:"POST",data:{action:"delete_block",block_data:JSON.stringify(this.model.serialize())}}),this}});n.exports={View:v,isAnimated:function(e,t){if("image/gif"!==e.type)return t(!1);h.readAsArrayBuffer(e,function(e){if(e.type=="load"){var n=new Uint8Array(e.result),r,i,s=n.length,o=0,u=0;if(n[0]!==71||n[1]!==73||n[2]!==70||n[3]!==56)return t(!1);for(r=0,i=s-9;r<i,o<2,u<2e5;++r)n[r]!==0||n[r+1]!==33||n[r+2]!==249||n[r+3]!==4||n[r+8]!==0||n[r+9]!==44&&n[r+9]!==33?u++:o++;return t(o>1)}if(e.type=="progress")var a=e.loaded/e.total*100})}}},"page-gtpost/blocks/text":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../../core/template"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/util"),l=e("medium-editor"),c=/(https?:\/\/)[^\s"'`\]\[{}<>^|]+/ig,h=e("../blocks/video-input"),p=e("../block"),d=p.View.extend({type:"text",render:function(){var t=this;p.View.prototype.render.apply(this),this.$els.body=r(document.createElement("div")).addClass("gtpost-block__editor").attr("maxlength","100").appendTo(this.$els.content).html(this.model.get("body")||""),this.$els.content.click(this.focus.bind(this)),this._urlStopList=new Set,this.model.get("body")&&i.forEach(this._getUrls(this._getText()),function(e){this._urlStopList.add(e)},this),this.$els.body.bind({focusin:function(){t.active(!0)},focusout:function(){t.active(!1)}}),l.extensions.anchor.prototype.checkLinkFormat=function(e){var t=c.test(e);return t||(this.base.restoreSelection(),this.execAction("unlink"),this.base.checkSelection()),t?(/^(https?|ftps?|rtmpt?):\/\/|mailto:/.test(e)?"":"http://")+e:""},l.extensions.paste.prototype.handlePaste=function(e,t){var n,r="",i,s="text/html",o="text/plain",u,a;this.window.clipboardData&&e.clipboardData===undefined&&(e.clipboardData=this.window.clipboardData,s="Text",o="Text");if(e.clipboardData&&e.clipboardData.getData&&!e.defaultPrevented){e.preventDefault(),u=e.clipboardData.getData(s),a=e.clipboardData.getData(o);if(this.cleanPastedHTML&&u)return this.cleanPaste(u);if(!this.getEditorOption("disableReturn")&&!t.getAttribute("data-disable-return")){n=a.replace("\r\n","\n").split(/[\r\n]/g);if(n.length>1)for(i=0;i<n.length;i+=1)n[i]!==""?r+="<p>"+l.util.htmlEntities(n[i])+"</p>":r+="<p><br></p>";else r=l.util.htmlEntities(n[0])}else r=l.util.htmlEntities(a);l.util.insertHTMLCommand(this.document,r)}},this.editor=new l(this.$els.body,{toolbar:{buttons:["bold","italic",{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>S</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},"anchor","quote"]},placeholder:{text:"Введите текст"},anchor:{placeholderText:"Введите ссылку",linkValidation:!0,targetCheckbox:!1}}),this.editor.subscribe("editableInput",i.bind(i.debounce(this._changeEditor,1e3),this)),e("../../users/list")(this.$els.body,"@",",")},_getText:function(){return this.$els.body.html().replace(/&nbsp;/g," ")},focus:function(){r(this.editor.elements[0]).focus()},_changeEditor:function(){var e=this._text=this.$els.body.html(),t=this._builder.hasLimit(this._builder.eLimit.imageCarma)||this._builder.hasLimit(this._builder.eLimit.imageMax),n=this._builder.hasLimit(this._builder.eLimit.videoCarma)||this._builder.hasLimit(this._builder.eLimit.videoMax);return this.model.set("_disableConfirm",this.$els.body.text().length===0),this.model.set("body",e),t&&n?this:(i.each(this._getUrls(this._getText()),function(e){!this._urlStopList.has(e)&&!this._builder.urlStopList.has(e)&&this._testUrl(e,n)},this),this)},_getUrls:function(e){var t,n=[];while((t=c.exec(e))!=null)n.push(t[0]);return i.union(n)},_testUrl:function(e,t){var n=this._text.indexOf(e)>(this._text.length-e.length)/2,r=n?this.getBlockBeside(!0):this.model;this._builder[!t&&h.isVideoUrl(e)?"addVideo":"addImage"](e,{_stopList:this._urlStopList,_before:r})}});n.exports={View:d}},"page-gtpost/blocks/video-input":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../../core/template"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/util"),l=e("../block"),c=e("../mini-block"),h=e("../../core/request"),p=[/^https?:\/\/www\.youtube\.com.*v=([0-9A-Za-z_\-]+)/,/^https?:\/\/m\.youtube\.com.*v=([0-9A-Za-z_\-]+)/,/youtu\.be\/([0-9A-Za-z_\-]+)/,/^https?:\/\/rutube\.ru\/tracks\/[0-9]+\.html\?v=([0-9a-z]+)/,/^https?:\/\/rutube\.ru\/video\/([0-9a-z]+)/,/^https?:\/\/vimeo\.com\/([0-9]+)/,/http:\/\/www\.liveleak\.com\/view\?i=([0-9A-Za-z_]+)/,/https?:\/\/coub\.com\/view\/([0-9A-Za-z_]+)/],d=l.View.extend({type:"video",render:function(){var t=this;return l.View.prototype.render.apply(this),this._testUrlDebounce=i.debounce(i.bind(this._testUrl,this),300),this.$els.addVideo=r(e("../templates/block-video-input.html")).appendTo(this.$els.content),this.$els.remove=this.$(".gtpost-video-input__state").touch(function(){t.remove()}),this.$els.input=this.$(".gtpost-video-input__input").keyup(this._testUrlDebounce).change(this._testUrlDebounce),this},focus:function(){return this.$els.input&&this.$els.input.focus(),this},_testUrl:function(){var e=this;console.log(this._currentTest);if(this._currentTest)return this;var t=r.trim(this.$els.input.val()),s=n.exports.isVideoUrl(t);return this._builder.urlStopList.has(t)&&(s=!1),this.toggleError(t===""?!1:!s),s?(this._currentTest=!0,n.exports.getVideoInfo(t).then(function(n){e._builder.addVideo(i.extend(n,{type:"video",_originalUrl:t}),{_before:e.model}),e.model.destroy()},function(n){e._builder.urlStopList.add(t),e.toggleError(!0),a.warn("gtpost","video problem",n)}).always(function(){e._currentTest=!1}),this):this},toggleError:function(t){return this.$els.addVideo.toggleClass("gtpost-video-input_error_yes",t),t&&e("../../blocks/message")("Видео не найдено, поддерживаются ссылки YouTube, Vimeo, Coub, Rutube и Liveleak","failure"),this}});n.exports={View:d,_waitList:{},isVideoUrl:function(e){return i.some(p,function(t){return t.test(e)})},getVideoInfo:function(e){var t=this;if(this._waitList[e])return this._waitList[e];var n=r.Deferred();return h("/ajax/gtpost_actions.php?t=v",{type:"post",data:{action:"get_video_info",url:e}}).then(function(e){e.result?(delete e.data.id,n.resolve(e.data)):n.reject(e.message)},function(){n.reject("Непредвиденная ошибка")}).always(function(){t._currentXHR=!1}),this._waitList[e]=n.promise()}}},"page-gtpost/blocks/video":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../../core/template"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/util"),l=e("../block"),c=e("../../core/i18n"),h=e("../../core/request"),p={youtube:"YouTube",coub:"Coub",vimeo:"Vimeo",rutube:"RuTube",liveleak:"LiveLeak"},d=r(".gtpost:first"),v=l.View.extend({type:"video",render:function(){var t=this;return l.View.prototype.render.apply(this),this.model.set("duration",f.getDurationTime(this.model.get("duration"))),this.$els.body=r(o(e("../templates/block-video.html"))(this.model.toJSON())).appendTo(this.$els.content),this._changeSize=i.bind(this.changeSize,this),u.on("window:resize:width",this._changeSize),this.changeSize(),this.$els.preview=this.$(".video__preview"),this.$els.body.click(function(){t.$els.hintMessage||(t.$els.hintMessage=r(document.createElement("div")).addClass("gtpost-block__hint-overlay").append(c("page-gtpost:play")).hide().appendTo(t.$els.body));var e=t.$els.hintMessage.is(":visible");t.$els.hintMessage[e?"fadeOut":"fadeIn"](200),t.$els.preview.toggleClass("gtpost-block_disabled",!e)}),this},changeSize:function(){return this.model.get("ratio")&&this.model.get("ratio")>0&&this.$els.body.css("height",d.width()/this.model.get("ratio")),this},remove:function(){return u.off("window:resize:width",this._changeSize),l.View.prototype.remove.apply(this),this}});n.exports={View:v}},"page-moderators-chat/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../wm"),u=e("../popup-box"),a=e("../core/layout"),f=e("../moderators-chat"),l=a.extend(i.extend(f.prototype,{show:function(){this._rendered||(this.render(),this._rendered=!0)},render:function(){this._isMobileEnv=!0,this._initForm(),this._initChat()}}));n.exports=o.add({name:"chat",layout:l})},"page-restore-password/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core/request"),u=e("../core"),a=e("../wm"),f=e("../core/layout"),l=f.extend({lastError:null,show:function(e){this._rendered||(this.render(),this._rendered=!0)},render:function(){var e=this;r(".b-passwd-restore form").on("submit",function(t){t.preventDefault();var n=r(this).closest(".b-passwd-restore").attr("data-role");e.lastError&&e.lastError.isShown()&&(e.lastError.hide(),e.lastError=null),n=="request"?e._submitRequestForm():e._submitNewPasswordForm()})},_submitRequestForm:function(){var e=r("#restore_login"),t=r("#restore_email"),n={action:"request",login:e.val(),email:t.val()};if(!/^[A-Za-z0-9.]{3,32}$/.test(n.login)){this.lastError=(new s).showMessage(e,"Введите валидный логин","warning");return}if(n.email.indexOf("@")==-1){this.lastError=(new s).showMessage(t,"Введите валидный email","warning");return}this._makeRequest(n)},_submitNewPasswordForm:function(){var e=JSON.parse(r(".b-passwd-restore").attr("data-params")),t=r("#restore_passwd1"),n=t.val(),i=r("#restore_passwd2");if(n.length<Number(t.attr("data-min-length"))){this.lastError=(new s).showMessage(t,"Пароль слишком которкий","warning");return}e.action="set_password";if(n!=i.val()){this.lastError=(new s).showMessage(i,"Пароли не совпадают!","warning");return}e.p=n,this._makeRequest(e,function(){setTimeout(function(){window.location.href="/"},500)})},_makeRequest:function(e,t){var n=r('.b-passwd-restore button[type="submit"]'),i=r(".b-passwd-restore_success").removeClass("show"),u=r(".b-passwd-restore_input-control").find("input, button");u.prop("disabled",!0),o("/ajax/restore_passwd.php",{type:"POST",dataType:"json",data:e}).then(function(e){if(!e.result){u.prop("disabled",!1),(new s).showMessage(n,e.message,"error");return}r(".b-passwd-restore_social").slideUp(),i.addClass("show"),t&&t()},function(){u.prop("disabled",!1),(new s).showMessage(n,"Ошибка запроса","error")})}});n.exports=a.add({name:"restore.php",layout:l})},"page-saved-stories/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/layout"),u=e("../core/request"),a=e("../core/location"),f=e("../popup-box"),l=e("../story-save"),c=e("../core/template"),h=e("../wm"),p=o.extend({_lastSearchText:"",_editBox:null,show:function(){return this._inited?this:(this.render(),this)},render:function(){var e=this,t=i.debounce(i.bind(this.search,this),100);r("form.ss-text .close-input-icon").click(function(){r("#ss_text").val(""),t()}),r("form.ss-text").on("submit",function(e){e.preventDefault(),t()});var n=r("#ss_text");this._lastSearchText=n.val(),r(document).on("touch",".ss-cats-list a[data-id]",function(t){t.preventDefault(),e.openCategory(r(this).closest("a[data-id]").attr("data-id"))}),r(".ss-edit-cats").touch(function(){e._showEditCategoriesBox()}),s.feed.reInit(!0)},_getCategoriesList:function(){var e=[];return r(".ss-cats-list a[data-id]").each(function(){var t=r(this),n=Number(t.attr("data-id"));e.push({name:t.find("span").text(),count:Number(t.find("b").text()),id:n})}),e},_showEditCategoriesBox:function(){var t=this._getCategoriesList(),n=r('<div class="b-save-categories-box">'),o=r('<div class="ss-cats">'),u=i.bind(this._onRenameCategory,this),a=i.bind(this._onDeleteCategory,this),l,h,p=r(c(e("./templates/category-edit.html"))());for(var d=0,v=t.length;d<v;d++){h=t[d];if(h.id==0)continue;l=p.clone(),l.attr("data-id",h.id),l.find("span.ss-cat-name").text(h.name),l.find("span.ss-cat-count").text(String(h.count)),l.find('a[data-role="rename"]').touch(u),l.find('a[data-role="delete"]').touch(a),o.append(l)}n.append(o),n.append(r("<div>").addClass("save-story-new-cat").on("touch",i.bind(this._onCreateNewCategory,this)).append('<svg class="ss-ncat-plus" width="26" height="26"><path d="M5 11 h16 M13 3 v16" /></svg>').append("<span>Новая категория</span>")),n.append(r('<div class="save-story-cat-default">').append('<svg width="16" height="12"><path d="M0 12 L8 0 L16 12" /></svg>').append("<span>Вы можете создавать категории и сохранять в них посты</span>").toggle(t.length==1)),n.append(r("<div>").addClass("save-story-hide-menu").click(i.bind(this._onClickByHideMenu,this)).append('<i class="fa '+(s.config("isHideSaveMenu")?"fa-check-square":"fa-square-o")+'"></i>').append("<span>Скрыть меню выбора категорий при сохранении поста. Посты будут сохраняться в категорию «"+t[0].name.replace(/</gi,"&lt;")+"»</span>"));var m=this._editBox=new f;m.setModalMode(!0),m.addCloseButtonIntoFooter(),m.append(n),m.show(r(".ss-edit-cats"))},_onClickByHideMenu:function(){var e=r(".save-story-hide-menu > i"),t=e.hasClass("fa-check-square");t?e.removeClass("fa-check-square").addClass("fa-square-o"):e.removeClass("fa-square-o").addClass("fa-check-square"),t=!t;var n=this;u("/ajax/users_actions.php",{data:{action:"change_settings",hide_save_stories_menu:t?1:0},dataType:"json"}).then(function(e){e.result?s.config("isHideSaveMenu",t):n._createError(e.message)},function(){n._createError("Ошибка при выполнении запроса на сервер")})},_onRenameCategory:function(e){var t=r(e.target).closest(".save-story-cat"),n=t.attr("data-id"),i=t.find("span.ss-cat-name"),s=i.text(),o,a=r('<div class="b-save-category-rename">').append("<section>Новое название категории:</section>").append(o=r('<input type="text" value="" maxlength="25" />').val(s)),l=this,c=new f;c.setModalMode(!0),c.addButtonIntoFooter("Применить",function(){var e=o.val();if(e!=s&&!l._checkNewCategoryName(o,e,n))return;i.text(e),r('.ss-cats-list a[data-id="'+n+'"] span').text(e),u("/ajax/stories_actions.php",{data:{action:"rename_save_category",cat_id:n,name:e},dataType:"json"}).then(function(e){e.result?c.hide():(new f).showMessage(o,e.message,"error")},function(){(new f).showMessage(o,"Ошибка при выполнении запроса на сервер","error")})},"success"),c.addButtonIntoFooter("Отмена",function(){c.hide()}),c.append(a),c.show(t)},_onDeleteCategory:function(t){var n=r(t.target).closest(".save-story-cat"),i=Number(n.attr("data-id")),s=Number(n.find("span.ss-cat-count").text());if(s>0){var o=r(c(e("./templates/category-delete.html"))()),u=o.find("select"),a,l=this,h=this._getCategoriesList();u.click(function(){o.find('input[type="radio"][value="2"]').prop("checked",!0).trigger("ppb_check")});for(var p=0,d=h.length;p<d;p++)h[p].id!=i&&(a=r("<option>").attr("value",h[p].id).text(h[p].name),h[p].id==0&&a.attr("selected","selected"),u.append(a));var v=(new f).setModalMode(!0).append(o).addButtonIntoFooter("Удалить!",function(){var e=o.find('input[type="radio"]:checked').val();l._deleteCategory(n,i,e==2?Number(o.find("select").val()):-1,s)},"warning").addButtonIntoFooter("Отмена",function(){v.hide()}).show(n)}else this._deleteCategory(n,i,-1,0)},_deleteCategory:function(e,t,n,i){var s=this;u("/ajax/stories_actions.php",{data:{action:"delete_save_category",cat_id:t,move_to_cat_id:n},dataType:"json"}).then(function(o){if(o.result){r('.ss-cats-list a[data-id="'+t+'"]').remove(),r('.save-story-cat[data-id="'+t+'"]').remove();if(n>-1){var u=r('.save-story-cat[data-id="'+n+'"] span.ss-cat-count'),a=String(Number(u.text())+i);u.text(a),r('.ss-cats-list a[data-id="'+n+'"] b').text(a)}var c=s._editBox.getContent();r("div.save-story-cat-default",c).toggle(r(".save-story-cat[data-id]",c).length==0),s._editBox.updatePosition(),(new l).updateCategoriesList(s._getCategoriesList())}else(new f).showMessage(e,o.message,"error")},function(){(new f).showMessage(e,"Ошибка при выполнении запроса на сервер","error")})},_onCreateNewCategory:function(){var e,t=r('<div class="b-save-category-rename">').append("<section>Название новой категории:</section>").append(r('<input type="text" value="" maxlength="25" />').on("touchstart",function(){e=r(window).scrollTop()}).blur(function(){r(window).scrollTop(e)})),n=this,i=new f;i.setModalMode(!0),i.addButtonIntoFooter("Создать",function(){n._createCategory(t.find("input").val(),i)},"success"),i.addButtonIntoFooter("Отмена",function(){i.hide()}),i.append(t),i.show(r(document.body))},_createCategory:function(e,t){var n=r(document.body),i=this;if(e.replace(/\s+/g,"")==""){(new f).showMessage(n,"Необходимо ввести название новой категории");return}if(!this._checkNewCategoryName(n,e,-1))return;u("/ajax/stories_actions.php",{data:{action:"create_save_category",name:e},dataType:"json"}).then(function(s){if(s.result){t.hide(),i._editBox.hide();var o=r(".b-saved-stories-panel .ss-cats-list");if(o.length>0){var u=o.find('a[data-id="0"]').clone().removeClass("ss-active").attr("data-id",s.data.id);u.attr("href",u.attr("href")+"&cid="+s.data.id),u.find("span").text(e),u.find("b").text("0"),o.append(u)}(new l).updateCategoriesList(i._getCategoriesList())}else(new f).showMessage(n,s.message,"error")},function(){(new f).showMessage(n,"Ошибка при выполнении запроса на сервер","error")})},_checkNewCategoryName:function(e,t,n){var r=t.toLowerCase().replace(/^\s+|\s+$/g,""),i=this._getCategoriesList();for(var s=0,o=i.length;s<o;s++)if(i[s].id!=n&&i[s].name.toLowerCase().replace(/^\s+|\s+$/g,"")==r)return(new f).showMessage(e,"Введенное название уже используется другой категорией"),!1;return!0},openCategory:function(e){r(".ss-cats-list a.ss-active").removeClass("ss-active");var t=r('.ss-cats-list a[data-id="'+e+'"]');r("#ss_text").val("").attr("placeholder","Поиск в «"+t.find("span").text()+"»"),t.addClass("ss-active"),this.search(!0)},search:function(e){var t=r("#ss_text").val();if(this._lastSearchText!=t||e){this._lastSearchText=t;var n=r(".ss-cats-list a.ss-active").attr("href");t!=""&&(n+="&search="+encodeURIComponent(t));var i=a.replaceState({},"",n,!0);if(!i){window.location.href=n;return}var o=r("#stories_container");o.find(".post").remove(),r("#no_stories_msg").hide(),r(".b-saved-stories-preloader").show(),u(n,{data:{of:"v2"},dataType:"json"}).then(function(e){r(".b-saved-stories-preloader").hide();if(e.result){var t="";for(var n=0,i=e.data.stories,u=i.length;n<u;n++)t+=i[n].html;o.prepend(t),t==""&&r("#no_stories_msg").show();var a=r("#page_navigator");a.length==0?e.data.paginator&&o.after(e.data.paginator):e.data.paginator?a.replaceWith(e.data.paginator):a.remove(),s.feed.reInit(!0)}},function(){r(".b-saved-stories-preloader").hide()})}}}),d=null;n.exports=h.add({name:"index.php",layout:{show:function(){if(s.config("GET").cmd!=="saved")return!1;d||(d=(new p).show())}}})},"page-signin/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../wm"),v=f.extend({show:function(){r(".tologin_control").hide(),this.$el=r(".page-signin"),this.$els={captcha:this.$el.find(".page-signin__captcha"),error:this.$el.find(".page-signin__error"),form:this.$el.find("form").submit(i.bind(this.submit,this))},e("../core/gcaptcha")(this.$els.captcha[0]),this._needCaptcha=!0},_reloadCaptcha:function(){try{grecaptcha.reset()}catch(e){}},submit:function(e){e&&e.preventDefault&&e.preventDefault()&&e.stopPropagation();var t=this,n;this.$els.error.hide(),n=c.serialize(t.$els.form,{username:"",password:"",mode:"","g-recaptcha-response":""}),t._needCaptcha||delete n["g-recaptcha-response"],p("/ajax/auth.php",{data:n,dataType:"JSON",method:"POST"}).then(function(e){if(e.result)return window.location.href=document.referrer,!0;t._needCaptcha=e.data.need_captha||e.data.message_code===4;var n=t._needCaptcha?"Введите капчу":e.message;t.$els.error.fadeIn(100).find(".auth_box_s").html('<div class="auth_box_s text">'+n+"</div>"),t._needCaptcha&&t._reloadCaptcha()})}});n.exports=d.add({name:"signin.php",layout:v})},"page-signup/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i,d=e("../core/request"),v=e("cookies-js"),m=e("password_strength"),g=e("../wm"),y=f.extend({show:function(){var t=this;this.$el=r(".page-signup"),this.$els={container:r("#auth_container"),error:r(".page-signup__error"),form:this.$el.find("form").submit(i.bind(this._checkSignUp,this)),username:this.$el.find('input[name="username"]'),password:this.$el.find('input[name="password"]'),email:this.$el.find('input[name="email"]'),captcha:this.$el.find('input[name="captcha"]'),submit:this.$el.find('button[type="submit"]')},e("../core/gcaptcha")(this.$el.find(".page-signup__captcha")[0]),this.$el.find("input").bind({blur:function(){var e=r(this),n=e.attr("name");t._checkSignUp(n)},focus:function(t){var n=r(t.target);n.hasClass("form_input_error")&&(n.removeClass("form_input_error"),setTimeout(function(){e("../blocks/message")(n.attr("title"),"failure",r("body"))},150))}})},$inputs:{},_checkUsernameCache:{},_checkUsername:function(e){var t=this,n=r.Deferred();return i.isBoolean(this._checkUsernameCache[e])?n[t._checkUsernameCache[e]?"resolve":"reject"]():d("/ajax/username_check.php",{data:{username:e},dataType:"JSON",method:"POST"}).then(function(r){t._checkUsernameCache[e]=r.result,n[t._checkUsernameCache[e]?"resolve":"reject"]()}),n.promise()},_reloadCaptcha:function(){try{grecaptcha.reset()}catch(e){}},_checkSignUp:function(e){e&&e.preventDefault&&e.preventDefault()&&e.stopPropagation();var t=this,n=[],s={},o=i.isString(e)?[e]:["all","username","password","email","g-recaptcha-response"],u=r.Deferred(),a=[u.promise()];return this.$els["g-recaptcha-response"]=this.$el.find('textarea[name="g-recaptcha-response"]'),i.forEach(o,function(e){var i=t.$els[e]?t.$els[e].val()||"":"";e==="username"&&(i=r.trim(i),i.length<4?n.push({param:e,error:"sign:up:errors:username-short"}):i.length>16?n.push({param:e,error:"sign:up:errors:username-long"}):/^([A-Za-z0-9.]*)$/.test(i)?/[^.]$/.test(i)?a.push(t._checkUsername(i).fail(function(){n.push({param:"username",error:"sign:up:errors:username-busy"})})):n.push({param:e,error:"sign:up:errors:username-last-dot"}):n.push({param:e,error:"sign:up:errors:username-whitelist"})),e==="email"&&i&&(p.test(i)||n.push({param:e,error:"sign:up:errors:email"}));if(e==="password"){if(i.length<1)n.push({param:e,error:h("sign:up:errors:password-short")});else{var o=m.test("",i),u=i.length>6?o.score<15?0:o.score<35?1:o.score<60?2:3:0;u===0&&n.push({param:e,error:"sign:up:errors:password-week"})}s["password"+t.$els.password.data("additional")]=i}e==="g-recaptcha-response"&&i.length<4&&n.push({param:"all",error:"sign:up:errors:captcha"}),e!=="all"&&e!=="password"&&(s[e]=i)}),u[n.length>0?"reject":"resolve"](),t._showErrors(n,o),n.length>0&&(n=[]),c.all(a).then(function(){!i.isString(e)&&n.length===0&&(s=i.defaults(s,{mode:"auth"}),t.$els.submit.prop("disabled",!0),d("/ajax/register.php",{data:s,dataType:"JSON",method:"POST"}).then(function(e){e.result?(v.set("_nuser",1,{expires:31536e6}),window.location.href=document.referrer):(t._reloadCaptcha(),t._showErrors([{param:e.data.param||"all",error:e.message}]),r(document).scrollTop(80))}).always(function(){t.$els.submit.prop("disabled",!1)}))},function(){t._showErrors(n,"username")}),u.promise()},_signup:function(e){e&&e.preventDefault()&&e.stopPropagation();var t={},n=this,s;return this._destroyErrors(),this.closeBox(),s=i.defaults(c.serialize(this.$els.form),{mode:"auth",username:"",email:"","g-recaptcha-response":""}),r.trim(s.username)||(t.username=h("sign:username")),s.email!==""&&!p.test(s.email)&&(t.email=h("sign:email")),r.trim(s.password).length<4&&(t.password=h("sign:password")),r.trim(s["g-recaptcha-response"]).length<4&&(t.all=h("sign:captcha")),s["password"+this.$els.password.data("additional")]=s.password,i.isEmpty(t)?(d("/ajax/register.php",{data:s,dataType:"JSON",method:"POST"}).then(function(e){e.result?(v.set("_nuser",1,{expires:31536e6}),n._signin({username:s.username,password:s.password})):(n._reloadCaptcha(),t[e.data.param||"all"]=e.message,n._showErrors(t),r(document).scrollTop(80))}),this):(this._showErrors(t),this)},_showErrors:function(e,t){var n=this;t=t||["all","username","password","email","g-recaptcha-response"],i.forEach(t,function(e){e==="all"?n.$els.error.hide():n.$inputs[e]&&n.$inputs[e].removeClass("form_input_error")}),i.each(e,function(e){var t=n.$els[e.param];t&&t.length>0?(t.attr("title",h(e.error)).addClass("form_input_error"),n.$inputs[e.param]=t):e.param==="all"&&n.$els.error.text(h(e.error)).show()})}});n.exports=g.add({name:"signup.php",layout:y})},"page-story/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../core/location"),v=e("../popup-box"),m=e("../moderator-tools"),g=e("../story-save"),y=e("cookies-js"),b=e("../comments"),w=e("../wm"),E=f.extend({_inited:!1,show:function(e){if(this._inited)return this;this._inited=!0,e=e&&e[0],e||(e=u.config("GET:id")),this._url="/story/"+e,this._$html=r("body, html"),this.render()},render:function(){var t=this;this.$els={container:r(".right_container_wrapper"),post:r(".post_inside")},this.comments=new b.Comments({el:r(".comments"),storyId:this.$els.post.data("story-id"),type:b.eCommentsType.story}),r(".control-order").touch(i.bind(this._changeOrder,this)),this.$els.post.on("touch",".post_rating_up",i.bind(this._setRating,this,!0)),this.$els.post.on("touch",".post_rating_down",i.bind(this._setRating,this,!1)),this.$els.post.on("touch",".comment__control-save",i.bind(this._savePost,this)),this.$els.post.on("click",".b-story__show-all",i.bind(this._showPost,this)),/#comments/gi.test(window.location.hash)&&this._$html.scrollTop(r(".post_comments").offset().top-45),u.config("facebookWidget")&&document.referrer.indexOf("facebook.com")>=0&&!y("disable_fb_widget")&&(u.global("FB")?t.initFacebook():(u.global("fbAsyncInit",function(){window.FB.init({appId:"586543721489673",xfbml:!0,version:"v2.1"}),t.initFacebook()},!0),r("body").append('<div id="fb-root"></div>'),c.addScript("//connect.facebook.net/ru_RU/sdk.js","facebook-jssdk"))),e("../gifx").init(),e("../video").init(),this._applyModeratorsTools(),this._initRelatedStories(),this.initCommunity()},_showPost:function(t){if(t.shiftKey||t.ctrlKey||t.metaKey)return;t.preventDefault(),t.stopPropagation(),e("../core/metrika").goal("tgp-mv__show-all");var n=r(t.target).closest(".b-story__show-all");n.hide();if(n.hasClass("b-story__show-all_legacy"))return n.closest(".post_wrapper").removeClass("post_wrapper"),this;n.parent().find(".b-story-blocks__wrapper").removeClass("b-story-blocks__wrapper_slice_yes").css("max-height","100%"),n.parent().find(".b-story-blocks__hide-wrapper").show();var s=n.parent().find(".b-story-block_type_image img");return i.each(s,function(e){e=r(e),e.data("src")&&(e.attr("src",e.data("src")),e.removeData("src"))}),this},initFacebook:function(){var t=this,n=r(".comments_all_count").offset().top+100;u.on("document:scroll",function(i){if(i>n&&!t._facebookPopupShown){e("../core/metrika").goal("showing_fb_widget"),t._facebookPopupShown=r(l(e("./templates/facebook.html"))({width:r(window).width()})).hide().appendTo(r("body")).slideDown(200),t._facebookPopupShown.find(".facebook-popup__close").touch(function(){e("../core/metrika").goal("disable_fb_widget"),y.set("disable_fb_widget",!0,{expires:31536e3}),t._facebookPopupShown.slideUp(200)});try{FB.XFBML.parse()}catch(s){}}})},_savePost:function(t){var n=r(t.target),i=!n.hasClass("comment__control-save_active_yes"),s=n.data("story-id");if(!u.config("logged"))return e("../sign").showNeedSignin(),this;if(n.data("xhr"))return this;i&&e("../core/metrika").goal("save_post");var o=function(){n.toggleClass("comment__control-save_active_yes",i),n.data("xhr",!1)},a=new g(s,n,o);return i?a.save():a.cancel(),this},_setRating:function(t,n){if(this._setRatingXHR)return this;var s=this,o=r(n.target).parent().parent(),f=t?1:-1,l=o.data("story-id"),c=Number(o.data("vote"))+f,h=o.find(".post_rating_up"),d=o.find(".post_rating_count"),v=o.find(".post_rating_down");return u.config("logged")?c<-1||c>1||!o.data("can-vote")||d.hasClass("deleted")?this:(h.toggleClass("active",c===1),v.toggleClass("active",c===-1),o.data("vote",c),d.text(Number(d.text())+f),o.data("debounce")||o.data("debounce",i.debounce(function(e,t){s._setRatingXHR=!0,p("/ajax/vote_story.php",{data:{story_id:e,vote:t},dataType:"JSON",type:"POST"}).then(function(e){},function(){a.error(":story:","send rating trouble")}).always(function(){s._setRatingXHR=!1})},500)),o.data("debounce")(l,c),this):(e("../sign").showNeedSignin(),this)},_changeOrder:function(t){var n,i=this;this._ordertBox||(this._ordertBox=(new v).setModalMode(!0).addCloseButtonIntoFooter().autoCorrectPosition(!1).append(n=r(l(e("./templates/order.html"))({current:r(".control-order.active").data("value")}))),n.css("display","block").find("input").on("change",function(){d.redirect(i._url+"?f="+n.find("input:checked").val())})),this._ordertBox.show(r(".comments"))},_applyModeratorsTools:function(){var e=r(".moderator-tools");if(e.length==0)return;var t=e.data("user-id"),n=e.data("story-id");if(!t||!n)return;e.find(".story__control-ban").touch(function(e){e.stopPropagation(),e.preventDefault(),(new m).showBanUserDialog(this,t,n,1)}),e.find(".story__control-delete").touch(function(e){e.stopPropagation(),e.preventDefault(),(new m).addListener("complete",function(){window.location.reload()}).showDeleteStoryDialog(this,n)}),e.find(".story__control-move-to-feed").touch(function(e){e.stopPropagation(),e.preventDefault();if(!confirm("Вы уверены, что хотите переместить данный пост из сообщества в общую ленту Пикабу?"))return;(new m).addListener("complete",function(){window.location.reload()}).moveStoryToCommonFeed(this,n)}),e.find(".add-strawberry").touch(function(e){e.stopPropagation(),e.preventDefault();var t=r(this),i=!t.hasClass("active");(new m).addListener("complete",function(){r('div.post[data-story-id="'+n+'"] .post_tag_strawberry').toggle(i),t.toggleClass("active",i)}).setStoryAdultFlag(t,n,i)}),e.find(".add-tag-mine").touch(function(e){e.stopPropagation(),e.preventDefault();var t=r(this),i=!t.hasClass("active");(new m).addListener("complete",function(){r('div.post[data-story-id="'+n+'"] a.post_tag_my').toggle(i),t.toggleClass("active",i)}).setStoryAuthorsFlag(t,n,i)})},_initRelatedStories:function(){var t=r("#related-stories");if(t.length==0)return;this._feedRelatedStories=new(e("../feed"))(r(".rs-stories")),this._feedRelatedStories._isFeedOverflow=!0,this._feedRelatedStories._attachEvents(),this._feedRelatedStories._attachScroll();var n=this,s=!1,o=!1,u=r(window);u.scroll(i.throttle(function(){var i=document.documentElement,a=(window.pageYOffset||i.scrollTop)-(i.clientTop||0),f=1500,l=Number(t.data("count")),c=t.data("id"),h=t.offset().top;!o&&a+u.height()+200>h&&(e("../core/metrika").goal("related_stories_scrolled"),o=!0);if(s)return;if(a+f>=h){s=!0;var p=t.find(".b-related-stories").css("display","block");if(l==0){p.find(".b-related-stories-tags").css("opacity",1),p.fadeIn(300);return}t.find("div.rs-title").animate({opacity:1},300),t.find(".b-related-stories-tags").animate({opacity:1},300);var d={story_id:c,count:l};r.post("/ajax/stories_actions.php?action=get_related_stories",d,function(e){if(!e.result)return;var r=e.data;if(!r.stories||r.stories.length==0)return;var i="",s=0,o=r.stories,u=o.length,a=r.ads||ads.ads_before,f=u>=10?u>>1:-1;for(;s<u;s++)s==f&&a&&(i+=a),i+=o[s].html;r.stories.length<l&&t.find("a.rs-more-btn").css("display","block").attr("href","/index.php?cmd=related&id="+c+"&page=2"),t.find("div.rs-stories").html(i).fadeIn(500).css("visibility","visible"),n._feedRelatedStories.reInit()},"json")}},100))},initCommunity:function(){(new(e("../page-communities/common"))).initButtons()}});w.add({name:"story.php",layout:E,routes:{"":"show"}}),n.exports=w.add({name:"story",layout:E,routes:{"":"show",":story":"show"}})},"page-test-ua/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../wm"),v=f.extend({ua:function(){r(".after_header").append(l(e("./templates/ua.html"))({ua:JSON.stringify(u.ua,null,4)}))}});n.exports=d.add({name:"test",layout:v,routes:{ua:"ua"}})},"page-user-notifications/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../wm"),u=e("../core/request"),a=e("../popup-box"),f=e("../core/layout"),l=f.extend({show:function(e){this._rendered||(this.render(),this._rendered=!0)},render:function(){var e=!1;r(".b-user-notifications__item > div > span[data-time]").each(function(){var e=r(this);e.text(moment.utc(e.attr("data-time")).local().format("DD MMMM YYYY, HH:mm"))}),r('.b-user-notifications a[data-role="remove"]').click(function(){var t=r(this);if(e)return;e=!0,t.prop("disabled",!0),u("/ajax/users_actions.php?action=remove_notifications",{method:"get",dataType:"json"}).then(function(n){e=!1,n.result?window.location.reload():(t.prop("disabled",!1),(new a).showMessage(t,n.message,"warning"))},function(){e=!1,t.prop("disabled",!1),(new a).showMessage(t,"Ошибка при выполнении запроса","error")})}),r(".b-user-notifications__item").removeClass("b-user-notifications__item--hide")}});n.exports=o.add({name:"notifications.php",layout:l,routes:{"":"show"}})},"page-user-profile/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../wm"),v=e("../popup-box"),m=f.extend({_inited:!1,show:function(e){if(this._inited)return this;this.profileName=e[0]||"",this.render()},render:function(){var t=this;this.$els={note:r(".note-add").on("keyup",function(){t.$els.note.height(1),t.$els.note.height(t.$els.note[0].scrollHeight)}).on("keyup",i.debounce(function(){var n=t.$els.note.val(),r=t.$els.note.data("user-id");t.$els.note.addClass("note-add_update_yes"),t._xhrNote=p("/ajax/users_actions.php",{type:"POST",data:{action:"note+",message:n,id:r}}).then(function(t){t.result&&e("../blocks/message")("Заметка сохранена","success")}).always(function(){t._xhrNote=!1,t.$els.note.removeClass("note-add_update_yes")})},1500)),ignore:r(".switch_disabled_tag").on("click",function(){var e=r(this),n=e.hasClass("on"),i=e.data("user-id");if(t._xhrIgnore)return this;e.toggleClass("on",!n).text(n?"В игнор-лист":"Из игнор-листа"),t._xhrIgnore=p("/ajax/users_actions.php",{type:"POST",dataType:"json",data:{action:n?"ignore-":"ignore+",id:i}}).then(function(t){t.result?e.toggleClass("on",!n).text(n?"В игнор-лист":"Из игнор-листа"):(new v).showMessage(e,t.message,"error")}).always(function(){t._xhrIgnore=!1})}),subscribe:r(".button_subscribe").on("click",function(){var e=r(this),n=e.hasClass("on"),i=e.data("user-id");if(t._xhrSubscribe)return!1;e.toggleClass("on",!n).text(n?"Подписаться":"Отписаться"),t._xhrSubscribe=p("/ajax/user_sub.php",{type:"POST",data:{state:n?1:0,user_id:i}}).then(function(t){t==="1"&&e.toggleClass("on",!n).text(n?"Подписаться":"Отписаться")}).always(function(){t._xhrSubscribe=!1})})}}});n.exports=d.add({name:"profile",layout:m,routes:{":profile":"show"}})},"page-user-settings/ignore":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../blocks/tabs").Tabs,v=e("../wm"),m=e("../popup-box"),g=f.extend({_inited:!1,show:function(){if(this._inited)return this;this.render()},render:function(){this.tabs=new d({$el:r(".right_container_wrapper")}),r(".user_list .del_item").click(this._removeBanUser),r(".tag_list .del_item").click(this._removeBanTag)},_removeBanUser:function(e){var t=r(e.target),n=t.data("user-id");e.preventDefault(),e.stopPropagation();if(t.data("xhr"))return!1;t.data("xhr",p("/ajax/users_actions.php",{type:"POST",dataType:"json",data:{action:"ignore-",id:n}}).then(function(e){e.result?r('li[data-user-id="'+n+'"]').fadeOut():(new m).showMessage(t,e.message,"error")}).always(function(){t.data("xhr",!1)}))},_removeBanTag:function(e){var t=r(e.target),n=t.data("tag");e.preventDefault(),e.stopPropagation();if(t.data("xhr"))return!1;t.data("xhr",p("/ajax/tags_actions.php?action=ignore-",{type:"POST",data:{value:n},dataType:"json"}).then(function(e){try{e.result&&r('li[data-tag="'+n+'"]').fadeOut()}catch(t){}}).always(function(){t.data("xhr",!1)}))}});n.exports=new g},"page-user-settings/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../wm");n.exports=d.add({name:"editprofile.php",layout:{show:function(){u.config("GET").cmd==="notes"?e("./notes").show():u.config("GET").cmd==="ignore_list"?e("./ignore").show():e("./profile").show()}}})},"page-user-settings/notes":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../wm"),v=f.extend({_inited:!1,show:function(){if(this._inited)return this;this.render()},render:function(){r(".notice_list .del_item").click(this._removeNote)},_removeNote:function(e){var t=r(e.target),n=t.data("note-id");e.preventDefault(),e.stopPropagation();if(t.data("xhr"))return!1;t.data("xhr",p("/ajax/users_actions.php?action=note-",{type:"POST",data:{id:n}}).then(function(e){e.result&&r('li[data-note-id="'+n+'"]').fadeOut()}).always(function(){t.data("xhr",!1)}))}});n.exports=new v},"page-user-settings/profile":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../core/request"),d=e("../blocks/tabs").Tabs,v=e("FileAPI"),m=e("../popup-box"),g=e("../wm"),y={vk:"vk",fb:"facebook",tw:"twitter",google:"google"},b={vk:"Вконтакте",fb:"Facebook",tw:"Twitter",google:"Google"},w=f.extend({_inited:!1,show:function(){if(this._inited)return this;this.render()},render:function(){var t=this;this.$inputs={},this.tabs=new d({$el:r(".right_container_wrapper"),tabClass:".item_list.settings"}),this.$els={passwordElement:r(".settings_with_dialog_control"),passwordDialog:r(".password_dialog"),avatar:r('input[name="avatarfile"]').on("change",function(n){var i=v.getFiles(n);t.$els.avatar.val("");if(i.length!==1)return!1;i=i[0],v.getInfo(i,function(n,s){if(n||r.isEmptyObject(s)||!s.width)return!1;t.avatar=i,v.Image(i).preview(200).get(function(n,i){if(n)return a.error(n),!1;var s=r(e("./templates/avatar.html")).append(i);t._avatarBox=(new m).setModalMode(!0).appendHeading("Смена аватарки").showCloseButtonIntoHeading(!1).addButtonIntoFooter("установить",function(){if(t.$els.avatarProgress&&t.$els.avatarProgress.is(":visible"))return!0;t.$els.avatarProgress=s.find(".profile-avatar__progress"),t.avatarSuccess()},"success").addCloseButtonIntoFooter().append(s),t._avatarBox.show(t.$els.avatar)})})})},r(".oauth-link").parent().touch(function(){var n=r(this).find(".oauth-link"),i=n.data("type"),s=n.text();if(!n.data("enabled"))return window.location.href=window.location.origin+"/oauth.php?type="+i,!0;n.data("box")||n.data("box",(new m).setModalMode(!0).appendHeading("Отвязать аккаунт?").showCloseButtonIntoHeading(!1).addCloseButtonIntoFooter().addButtonIntoFooter("отвязать",function(){n.data("box").hide(),p("/oauth.php?type="+i+"&remove=1").then(function(e){if(!e.result){var n=(new m).setModalMode(!0).showCloseButtonIntoHeading(!1).addCloseButtonIntoFooter().addButtonIntoFooter("установить",function(){n.hide(),t.toggleSettingsPasswordBox(!0)},"success").append('<div class="oauth-dialog">Чтобы отвязать аккаунт '+b[i]+", необходимо установить пароль</div>");n.show(r("body"))}else location.reload()})},"warning").append(l(e("./templates/oauth.html"))({type:y[i],name:s}))),n.data("box").show(r("body"))}),r(".settings_trig_select_control").on("click",function(e){if(r(e.target).is("select"))return!0;var t=r(e.target).is(".settings_control")?r(e.target):r(e.target).closest(".settings_control"),n=t.find("select")[0];if(n.fireEvent)n.fireEvent("onmousedown");else if(document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}}),r(".settings_control select, .settings_control input").focus(function(t){var n=r(t.target);n.hasClass("form_input_error")&&(n.removeClass("form_input_error"),setTimeout(function(){e("../blocks/message")(n.attr("title"),"failure")},150))}).on("change",function(e){if(r(e.target).parent().hasClass("dialog_content"))return!0;var n=r(e.target).is(".settings_control")?r(e.target):r(e.target).closest(".settings_control");if(n.hasClass("settings_upload_userpic")||n.parent().hasClass(".dialog_content"))return!0;t.savingSettings(n)}),r(".settings_control .checkbox").on("touch",function(e){var n=r(e.target).siblings("input");return n.attr("checked",!r(e.target).is(".on")),t.savingSettings(n),!0}),r(".settings_email").off("touch").on("touch",function(e){var n=r(e.target).is(".settings_control")?r(e.target):r(e.target).closest(".settings_control"),i=r('input[name="email"]');n=n.find(".item_list_right");var s=prompt("E-mail",n.text());s&&(n.text(s),i.val(s)),t.savingSettings(n)}),r(".settings_password").off("click").on("click",function(e){if(r(e.target).closest(".password_dialog").length)return!0;var n=r(e.target).is(".settings_control")?r(e.target):r(e.target).closest(".settings_control");t.toggleSettingsPasswordBox(!0)}),r(".close_dialog_control").off("touch").on("touch",function(e){t.toggleSettingsPasswordBox(!1)}),r(".save_dialog_control").off("touch").on("touch",function(e){t.savingPassword()}),r("#global_logout").off("touch").on("touch",function(){p("/ajax/logout.php?type=global",{method:"post",dataType:"json"}).then(function(t){t.result&&e("../core/location").redirect(t.data.url)})})},progress:function(e){return this.$els.avatarProgress.toggle(e!==101),this.$els.avatarProgress.css("width",e+"%"),this},avatarSuccess:function(){var e=this;e.progress(1),v.upload({url:"/ajax/upload_file.php",type:"POST",headers:{"X-Csrf-Token":u.config("token")},contestType:"multipart/form-data",data:{type:"user_avatar",save:1,uid:0},dataType:"json",files:[this.avatar],progress:function(t){e._progress=t.loaded/t.total*100,e.progress(e._progress)},complete:function(t,n){var r;if(t)return!1;try{r=JSON.parse(n.response)}catch(i){}e._progress=101,e.progress(e._progress),e._avatarBox.hide(),r.result||(new m).showMessage(document.body,r.message)}})},destroyMessage:function(){i.each(this.$inputs,function(e){e.removeClass("form_input_error")}),this.$inputs={}},showPasswordError:function(e){var t=this;if(i.isEmpty(e))return!1;i.each(e,function(e,n){var r=this.$('input[name="'+n+'"]');r.length>0&&(r.attr("title",e).addClass("form_input_error"),t.$inputs[n]=r)})},savingPassword:function(){var e=this,t=c.serialize(r('form[name="general"]')),n={};t={password_current:t.password_current,password_new:t.password_new,password_confirm:t.password_confirm},t.password_new||(n.password_new="Новый пароль не может быть пустым"),t.password_new!==t.password_confirm&&(n.password_confirm="Пароли не совпадают"),this.destroyMessage();if(!i.isEmpty(n))return this.showPasswordError(n);this.xhrGeneral=p("/ajax/users_actions.php?action=change_password",{type:"POST",dataType:"json",data:r.param(t)}).done(function(t){e.formChange=!1;if(!t.result){var n={};n[t.data.error_property]=t.message,a.warn(":profile:","Ошибка при обновлении",t),e.showPasswordError(n)}else e.toggleSettingsPasswordBox(!1),e.$els.passwordElement.closest("li").removeClass("saving").addClass("save"),setTimeout(function(){e.$els.passwordElement.closest("li").removeClass("save")},1e3),a.warn(":profile:","all good",t)}).fail(function(){a.warn(":profile:",2,"Ошибка при обновлении"),e.$els.passwordElement.closest("li").removeClass("saving").addClass("save"),setTimeout(function(){e.$els.passwordElement.closest("li").removeClass("save")},1e3)})},toggleSettingsPasswordBox:function(e){this.$els.passwordDialog.toggleClass("hidden",!e)},savingSettings:function(e){var t=c.serialize(r('form[name="general"]'));t.is_twitmode_mv=t.is_twitmode_mv?1:0,t.show_porno=t.show_porno?1:0,t.is_horror=t.is_horror?1:0,t.is_full_story_view_mv=t.is_full_story_view_mv?1:0,t.show_related_stories=t.related_stories?1:0,delete t.password_current,delete t.password_new,delete t.password_confirm,e.closest("li").addClass("saving"),this.xhrGeneral=p("/ajax/users_actions.php?action=change_settings",{type:"POST",dataType:"json",data:r.param(t)}).done(function(t){self.formChange=!1,t.result?a.warn(":profile:","all good",t):a.warn(":profile:","Ошибка при обновлении",t),e.closest("li").removeClass("saving").addClass("save"),setTimeout(function(){e.closest("li").removeClass("save")},1e3)}).fail(function(){a.warn(":profile:",2,"Ошибка при обновлении"),e.closest("li").removeClass("saving").addClass("save"),setTimeout(function(){e.closest("li").removeClass("save")},1e3)})}});n.exports=new w},"popup-box/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../core/events"),u=function(){this._updateBound=i.bind(this.updatePosition,this),this._hideBound=i.bind(this.hide,this),this._hideByClickBound=i.bind(this._hideByClick,this),this._onMouseMoveBound=i.bind(this._onMouseMove,this),this._onMouseDownBound=i.bind(this._onMouseDown,this),this._onChangeOrientationBound=i.bind(this._onChangeOrientation,this),this._onTouchBackgroundBound=i.bind(this._onTouchBackground,this),this._onTouchElementBound=i.bind(this._onTouchElement,this),this._onClickBackgroundBound=i.bind(this._onClickBackground,this),this._isModalBox=s.config("clientType")=="mobile",this._colorProps={fill:"",text:""},this._pointerGlobPosition={x:0,y:0},this._useTouchEvent="ontouchstart"in document.documentElement;if(!this._useTouchEvent){var e=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(String(navigator.userAgent||navigator.vendor||window.opera).substr(0,4)),t=e||/ipad|android|xoom|sch-i800|playbook|kindle/i.test(navigator.userAgent||navigator.vendor||window.opera);this._useTouchEvent=t||e}this._clickEventName=this._useTouchEvent&&jQuery.fn.touch!==undefined?"touch":"click",this.setColorScheme("white")};u._modalBoxes=[],i.extend(u.prototype,o),i.extend(u.prototype,{_isModalBox:!1,_allowScrollContent:!0,_clickEventName:"click",_element:null,_elementBg:null,_containerTop:null,_container:null,_heading:null,_headingTitle:null,_headingButton:null,_footer:null,_footerCont:null,_useTouchEvent:null,_arrow:null,_showArrow:!0,_target:null,_shown:!1,_updateBound:null,_hideBound:null,_hideByClickBound:null,_onMouseMoveBound:null,_onMouseDownBound:null,_onChangeOrientationBound:null,_onTouchBackgroundBound:null,_onClickBackgroundBound:null,_onTouchElementBound:null,_alignment:"center",_direction:"bottom",_distance:5,_innerIndent:10,_useRoundBorders:!0,_autoHide:!0,_autoCorrectPosition:!0,_colorScheme:"",_timeout:0,_timeoutTimer:0,_colorProps:null,_pointerGlobPosition:null,_skipNextClick:!1,_lastArrowDirection:"",_minContWith:400,show:function(e){if(!e)return this;var t=this;this._element||(this._create(),this._prepareContent()),this._element.toggleClass("ppb-no-overflow",!this._allowScrollContent),e!=this._target&&(this._target=r(e),this._shown&&this.updatePosition());if(!this._shown){if(this._isModalBox){var n=u._modalBoxes;i.indexOf(n,this)&&(n=u._modalBoxes=i.without(n,this)),n.push(this),this._updateModalBoxesList()}var s=r(document.body).append(this._element.hide().fadeIn(100));this._elementBg&&s.append(this._elementBg.hide().fadeIn(300)),this._isModalBox?(i.delay(function(){window.addEventListener("orientationchange",this._onChangeOrientationBound,!1)},50),this._useTouchEvent?(this._elementBg[0].addEventListener("touchmove",this._onTouchBackgroundBound,!1),this._elementBg[0].addEventListener("touchend",this._onClickBackgroundBound,!1),this._element[0].addEventListener("touchmove",this._onTouchElementBound,!1)):this._elementBg[0].addEventListener("click",this._onClickBackgroundBound,!1),window.history.pushState({},document.title),r(window).on("popstate.popupBox",function(){t.hide()})):(this._useTouchEvent?(document.addEventListener("touchstart",this._onMouseDownBound,!1),document.addEventListener("touchmove",this._onMouseMoveBound,!1),window.addEventListener("orientationchange",this._onChangeOrientationBound,!1)):(document.addEventListener("mousedown",this._onMouseDownBound,!1),document.addEventListener("mousemove",this._onMouseMoveBound,!1)),i.delay(function(){t._useTouchEvent?document.addEventListener("touchend",t._hideByClickBound,!1):document.addEventListener("click",t._hideByClickBound,!1)},50)),this._skipNextClick=!0,this._shown=!0,this.updatePosition()}return this._timeoutTimer&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null),!this._isModalBox&&this._timeout>0&&(this._timeoutTimer=setTimeout(this._hideBound,this._timeout)),this},showMessage:function(e,t,n){if(this._isModalBox){this.addCloseButtonIntoFooter(),this.setInnerIndent(0);switch(n){default:case"warning":t='<i class="fa fa fa-exclamation-circle" style="color: darkred"></i> '+t;break;case"error":t='<i class="fa fa-exclamation-triangle" style="color: darkred; font-size: 2em;"></i><br><span style="color: darkred;">'+t+"</span>";break;case"success":t='<i class="fa fa-check" style="color: #8ac858; font-size: 2em;"></i><br><span style="color: #8ac858;">'+t+"</span>"}this.append('<div class="ppb-message">'+t+"</div>")}else{this.setInnerIndent(15).setTimeout(2e4).setDirection("top").setAlignment("center").setDistance(10).allowAutoHide(!0),t='<span class="ppb-message-cont">'+t+"</span>";switch(n){default:case"warning":this.setColorScheme("black"),t='<i class="fa fa fa-exclamation-circle"></i> '+t;break;case"error":this.setColorScheme("red"),t='<i class="fa fa-exclamation-triangle"></i> '+t;break;case"success":}this.append(t)}return this.show(e),this},showConfirm:function(e,t,n,r){var i=this,s=function(){i.hide(),typeof n=="function"&&n()},o=function(){i.hide(),typeof r=="function"&&r()};return this.setModalMode(!0),this.append('<div class="ppb-message" style="max-width: 500px"><i class="fa fa-question-circle" style="color: #0965a0; font-size: 2em;"></i><br><span style="color: #0965a0;">'+t+"</span>"+"</div>"),this.addButtonIntoFooter('<i class="fa fa-check"></i> Да',s,"success"),this.addButtonIntoFooter('<i class="fa fa-times"></i> Нет',o,"normal"),this.show(e),this},isPointerOverBox:function(){if(!this._shown)return!1;var e=this._element.offset(),t=this._element.width(),n=this._element.height(),r=this._pointerGlobPosition.x,i=this._pointerGlobPosition.y;return r>=e.left&&r<=e.left+t&&i>=e.top&&i<=e.top+n},isShown:function(){return this._shown},hide:function(e){return this._shown&&(e&&e.preventDefault&&e.preventDefault(),this._isModalBox&&(i.indexOf(u._modalBoxes,this)&&(u._modalBoxes=i.without(u._modalBoxes,this)),this._updateModalBoxesList()),this._isModalBox?(window.removeEventListener("orientationchange",this._onChangeOrientationBound,!1),window.removeEventListener("resize",this._onChangeOrientationBound,!1),this._useTouchEvent?(this._elementBg[0].removeEventListener("touchmove",this._onTouchBackgroundBound,!1),this._elementBg[0].removeEventListener("touchend",this._onClickBackgroundBound,!1),this._element[0].removeEventListener("touchmove",this._onTouchElementBound,!1)):this._elementBg[0].removeEventListener("click",this._onClickBackgroundBound,!1),r(window).off("popstate.popupBox")):this._useTouchEvent?(document.removeEventListener("touchstart",this._onMouseDownBound,!1),document.removeEventListener("touchmove",this._onMouseMoveBound,!1),document.removeEventListener("touchend",this._hideByClickBound,!1),window.removeEventListener("orientationchange",this._onChangeOrientationBound,!1)):(document.removeEventListener("mousedown",this._onMouseDownBound,!1),document.removeEventListener("mousemove",this._onMouseMoveBound,!1),document.removeEventListener("click",this._hideByClickBound,!1)),this._timeoutTimer&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null),this._element.fadeOut(100,function(){this.parentNode&&this.parentNode.removeChild(this)}),this._elementBg&&this._elementBg.fadeOut(300,function(){this.parentNode&&this.parentNode.removeChild(this)}),this._shown=!1,this._target=null,this.trigger("close")),this},showArrow:function(e){return this._showArrow!==e&&(this._showArrow=e===!0,this._element&&this._create()),this},useRoundBorders:function(e){return this._useRoundBorders!==e&&(this._useRoundBorders=e===!0,this._element&&this._create()),this},setAlignment:function(e){return this._alignment!=e&&(this._alignment=e,this._shown&&this.updatePosition()),this},setDirection:function(e){return this._direction!=e&&(this._direction=e,this._element&&this._create()),this},setDistance:function(e){return e=Number(e),e===e&&this._distance!=e&&(this._distance=e,this._shown&&this.updatePosition()),this},setTimeout:function(e){return e=Number(e),e===e&&this._distance!=e&&(this._timeout=e),this},setInnerIndent:function(e){return e=Number(e),e===e&&this._innerIndent!=e&&(this._innerIndent=e,this._element&&this._create()),this},setModalMode:function(e){return e=Boolean(e),e===e&&this._isModalBox!=e&&(this._isModalBox=e,this._element&&this._create()),this},setMinWith:function(e){return e=Number(e),e===e&&this._minContWith!=e&&(this._minContWith=e,this._element&&this._create()),this},allowScrollContent:function(e){return this._allowScrollContent=e===!0,this._element&&this._element.toggleClass("ppb-no-overflow",!this._allowScrollContent),this},allowAutoHide:function(e){return this._autoHide!==e&&(this._autoHide=e==1),this},autoCorrectPosition:function(e){return this._autoCorrectPosition!==e&&(this._autoCorrectPosition=e==1),this},setColorScheme:function(e){if(this._colorScheme!=e){var t=this._colorProps;switch(e){case"white":this._colorScheme="white",t.fill="white",t.text="#676767";break;case"black":this._colorScheme="black",t.fill="black",t.text="white";break;case"red":this._colorScheme="red",t.fill="red",t.text="white"}this._element&&this._create()}return this},append:function(e){return this._createContainer().append(e),this},appendHeading:function(e,t){return this._createHeading().show(),t&&this._headingTitle.html(""),this._headingTitle.append(e),this},appendFooter:function(e,t){return this._createFooter().show(),t&&this._footerCont.html(""),this._footerCont.append(e),this},showCloseButtonIntoHeading:function(e){return this._createHeading(),this._headingButton.find("i").toggle(e===!0),this},addCloseButtonIntoFooter:function(){return this.addButtonIntoFooter("закрыть",i.bind(this.hide,this)),this},addButtonIntoFooter:function(e,t,n){this._createFooter().show();if(n===undefined||!n)n="normal";return this.appendFooter(r("<div>").addClass("ppb-btn-"+n).html(e).on(this._clickEventName,t)),this},getContent:function(){return this._createContainer()},_updateModalBoxesList:function(){var e=u._modalBoxes,t,n;for(var r=0,i=e.length;r<i;r++)t=e[r]._element,n=e[r]._elementBg,t&&n&&(t.css("z-index",1e4+r*10),n.css("z-index",9999+r*10))},_hideByClick:function(e){if(!this._shown||!this._autoHide)return;if(this._skipNextClick){this._skipNextClick=!1;return}var t=this._element.offset(),n=this._element.width(),r=this._element.height();e.pageX=e.pageX||e.clientX,e.pageY=e.pageY||e.clientY;if(e.pageY<t.top||e.pageY>t.top+r||e.pageX<t.left||e.pageX>t.left+n)t=this._target.offset(),n=this._target.width(),r=this._target.height(),(e.pageY<t.top||e.pageY>t.top+r||e.pageX<t.left||e.pageX>t.left+n)&&this.hide()},_onMouseMove:function(e){this._useTouchEvent&&"touches"in e?e.touches.length>0&&(this._pointerGlobPosition.x=e.touches[0].clientX,this._pointerGlobPosition.y=e.touches[0].clientY):(this._pointerGlobPosition.x=e.pageX||e.clientX,this._pointerGlobPosition.y=e.pageY||e.clientY)},_onMouseDown:function(e){this._useTouchEvent&&"touches"in e&&e.touches.length>0&&(this._pointerGlobPosition.x=e.touches[0].clientX,this._pointerGlobPosition.y=e.touches[0].clientY),this._skipNextClick=this.isPointerOverBox()},_onChangeOrientation:function(e){this.hide()},_onTouchBackground:function(e){e.preventDefault(),e.stopPropagation()},_onClickBackground:function(e){if(!this._element.hasClass("ppb-shake")){this._element.addClass("ppb-shake");var t=this;i.delay(function(){t._element.removeClass("ppb-shake")},600)}},_onTouchElement:function(e){if(e.target&&e.target.tagName=="SELECT")return;e.stopPropagation()},_create:function(){if(this._isModalBox){this._elementBg=r("<div>").addClass("popup-box-modal-bg");var e="popup-box-modal"+(this._useRoundBorders?" ppb-round":"")+(this._useTouchEvent?"":" ppb-no-touch");this._element=r("<div>").addClass(e).css("background-color","white").css("color","#555").append(this._createHeading()).append(this._containerTop=r("<div>").addClass("ppb-top-cont").append(this._createContainer().css("margin",String(this._innerIndent)+"px"))).append(this._createFooter())}else this._element=r("<div>").addClass("popup-box"+(this._useRoundBorders?" ppb-round":"")).css("background-color",this._colorProps.fill).css("color",this._colorProps.text).append(this._createArrow()).append(this._createContainer().css("margin",String(this._innerIndent)+"px"))},_createArrow:function(e){if(this._isModalBox)return null;e=e||this._direction;if(this._arrow&&this._lastArrowDirection==e)return this._arrow;this._lastArrowDirection=e;var t="",n={top:"",left:"",right:"",bottom:""};switch(e){default:case"bottom":t="M 0 10 L 5 3 L 10 10 L 0 10",n.top="-9px",n.left="0";break;case"right":t="M 10 0 L 3 5 L 10 10 L 10 0",n.left="-9px",n.top="0";break;case"left":t="M 0 0 L 7 5 L 0 10 L 0 0",n.right="-9px",n.top="0";break;case"top":t="M 0 0 L 10 0 L 5 7 L 0 0",n.bottom="-9px",n.left="0"}return this._arrow||(this._arrow=r("<div>").addClass("ppb-arrow")),this._arrow.css(n).html('<svg width="10" height="10"><path d="'+t+'" fill="'+this._colorProps.fill+'" stroke="none" />'+"</svg>"),this._showArrow||this._arrow.hide(),this._arrow},_createContainer:function(){return this._container?this._container:(this._container=r("<div>").addClass("ppb-cont"),this._container)},_createHeading:function(){if(this._heading)return this._heading;var e=this;return this._heading=r("<div>").addClass("ppb-heading").append(r("<div>").append(r("<div>").append(this._headingTitle=r("<div>").addClass("ppb-title"))).append(this._headingButton=r("<div>").html('<i class="fa fa-close"></i>').on(this._clickEventName,function(t){t.preventDefault(),e.hide()}))).hide(),this._heading},_createFooter:function(){return this._footer?this._footer:(this._footer=r("<div>").addClass("ppb-footer").append(this._footerCont=r("<div>")).hide(),this._footer)},_prepareContent:function(){var e=this;r(".ppb-checkbox",this._container).each(function(){var e=r(this),t=e.find('input[type="checkbox"]');t.wrap('<div class="ppb-indicator"></div>').before('<i class="fa fa-square-o ppb-unchecked"></i><i class="fa fa-check-square ppb-checked"></i>'),e.toggleClass("ppb-selected",t.prop("checked"))}).on(this._clickEventName+" ppb_check",function(e){e.preventDefault();var t=r(this);t.toggleClass("ppb-selected");var n=t.hasClass("ppb-selected");t.find('input[type="checkbox"]').prop("checked",n).attr("checked",n?"checked":"").change()}),r(".ppb-radio",this._container).each(function(){var e=r(this),t=e.find('input[type="radio"]');t.wrap('<div class="ppb-indicator"></div>').before('<i class="fa fa-circle-o ppb-unchecked"></i><i class="fa fa-dot-circle-o ppb-checked"></i>'),e.toggleClass("ppb-selected",t.prop("checked"))}).on(this._clickEventName+" ppb_check",function(t){t.preventDefault();var n=r(this);n.find('input[type="radio"]').prop("checked",!0).attr("checked","checked").change(),r(".ppb-radio",e._container).each(function(){var e=r(this),t=e.find('input[type="radio"]');e.toggleClass("ppb-selected",t.prop("checked"))})}),r("div.ppb-dropdown",this._container).each(function(){var e=r(this),t=e.find("select");t.after('<span></span><i class="fa fa-caret-down"></i>');var n=e.find("span"),i=t.val(),s=t[0].options,o;for(var u=0;u<s.length;u++)s[u].value==i&&(o=s[u]);!o&&s.length>0&&(o=s[0]),o&&n.text(o.text)}).on(this._clickEventName,function(t){t.preventDefault();var n=r(this).closest(".ppb-dropdown"),i=n.find("select"),s=i.val(),o=i[0].options,a={},f,l=r(document.createDocumentFragment());for(var c=0;c<o.length;c++){var h=o[c],p=r("<div>").addClass("ppb-dropdown-option"+(h.selected?" ppb-selected":"")).attr("data-value",h.value).text(h.text);a[h.value]=h.text,h.selected&&p.append('<i class="fa fa-check"></i>'),l.append(p)}l.find(".ppb-dropdown-option").on(e._clickEventName,function(){var e=r(this),t=e.attr("data-value");i.val(t),n.find("span").text(a[t]),f.hide()}),f=(new u).setModalMode(!0).addCloseButtonIntoFooter().append(l).show(n)})},updatePosition:function(){if(!this._shown)return;if(this._target.closest("html").length==0){this.hide();return}this._isModalBox?this._updatePositionModal():this._updatePositionBalloon(),i.delay(this._updateBound,200)},_updatePositionModal:function(){var e=this._target,t=this._element,n=this._headingTitle,i=this._heading.is(":visible"),s=this._container,o=s.outerWidth(!0),u=s.outerHeight(!0),a=this._containerTop,f=i?n.outerWidth()+this._headingButton.outerWidth():0,l=i?n.outerHeight():0,c=this._footer.is(":visible"),h=c?this._footer.outerHeight():0,p=e.offset(),d=0,v=0,m=0,g=0,y=0,b=0,w=e.outerWidth(),E=e.outerHeight(),S=t.width(),x=t.height(),T=r(window),N=T.width(),C=T.height(),k=T.scrollLeft(),L=T.scrollTop(),A=~~Math.min(20,N*.05,C*.05);if(w==0||E==0){this.hide();return}this._autoCorrectPosition||(w=50,E=20),C-=~~(C*.03),y=Math.min(Math.max(o,f,this._minContWith),N-A*2),b=Math.min(u,C-A*2-h-l),s.css({display:"block"}),a.css({width:String(y)+"px",height:String(b)+"px"}),m=y,g=b+h+l,d=~~(N/2-m/2),v=~~(C/2-g/2),t.css({top:String(v)+"px",left:String(d)+"px",width:String(m)+"px",height:String(g)+"px"})},_updatePositionBalloon:function(){var e=this._target,t=this._element,n=e.offset(),i=this._distance,s=0,o=0,u={},a=10,f=e.outerWidth(),l=e.outerHeight(),c=t.width(),h=t.height(),p=r(window),d=p.width(),v=p.height(),m=p.scrollLeft(),g=p.scrollTop(),y=!1,b,w,E,S=0,x=Number.MAX_VALUE,T,N=n.left-c-5,C=n.left-f,k=n.top-h-5,L=n.top-l;if(f==0){this.hide();return}this._autoCorrectPosition?b=[this._direction].concat(["bottom","top","left","right"]):(l=f=20,b=[this._direction]);for(w=0,E=b.length;w<E;w++){s=0,o=0;switch(b[w]){default:case"bottom":o=n.top+l+i,S=o+h-(g+v);break;case"top":o=n.top-h-i,S=g-o;break;case"left":s=n.left-c-i,S=m-s;break;case"right":s=n.left+f+i,S=s+c-(m+d)}S<0&&(S=0),S<x&&(x=S,T=[b[w],s,o])}y=T[0]=="bottom"||T[0]=="top",s=T[1],o=T[2],this._createArrow(T[0]);switch(this._alignment){case"start":y?(s=n.left,u.left=String(~~Math.max(5,Math.min(20,c/2-a/2)))+"px"):(o=n.top,u.top=String(~~Math.max(5,Math.min(20,h/2-a/2)))+"px");break;case"end":y?(s=n.left+f-c,u.left=String(~~Math.min(c-a-5,Math.max(c-20-a,c/2-a/2)))+"px"):(o=n.top+l-h,u.top=String(~~Math.min(h-a-5,Math.max(h-20-a,h/2-a/2)))+"px");break;default:case"center":if(y){var A=c/2;s=n.left+f/2-A,u.left=String(~~Math.max(5,A-a/2))+"px"}else{var O=h/2;o=n.top+l/2-O,u.top=String(~~Math.max(5,O-a/2))+"px"}}if(s<m+5||s+c>m+d-5){s<m+5&&(s=m+5),s+c>m+d-5&&(s=m+d-c-5),s<N&&(s=N),s>C&&(s=C),s<5&&(s=5);if(y){var M=Math.max(n.left,s+5),_=Math.min(n.left+f,s+c-5);M<_?(u.visibility="visible",u.left=String(~~(M-s+((_-M)/2-a/2)))+"px"):u.visibility="hidden"}else u.visibility="hidden"}else u.visibility="visible";if(o<g+5||o+h>g+v-5){o<g+5&&(o=g+5),o+h>g+v-5&&(o=g+v-h-5),o<k&&(o=k),o>L&&(o=L),o<5&&(o=5);if(!y){var D=Math.max(n.top,o+5),P=Math.min(n.top+l,o+h-5);D<P?(u.visibility="visible",u.top=String(~~(D-o+((P-D)/2-a/2)))+"px"):u.visibility="hidden"}else u.visibility="hidden"}else u.visibility="visible";t.offset({top:~~o,left:~~s}),this._showArrow&&this._arrow.css(u)}}),n.exports=u},"sign/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/layout"),l=e("../core/template"),c=e("../core/util"),h=e("../core/i18n"),p=e("../popup-box"),d=/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i,v=e("cookies-js"),m=e("../core/request"),g=function(){var t=this;this.$els={container:r("#auth_container"),need:r("#auth_box_need"),error:r("#auth_box_error"),restoreError:r("#restore_box_error"),captcha:r(".captcha__image"),oauth:{el:r("#oauth_box"),error:r("#oauth_box_error"),form:r("form","#oauth_box").submit(i.bind(this._oauth,this))},signup:{el:r("#registration_box"),error:r("#registration_box_error"),form:r("form","#registration_box").submit(i.bind(this._checkSignUp,this))},signin:{el:r("#login_box"),form:r("form","#login_box").submit(i.bind(this._signin,this))},retrieve:{el:r("#retrieve_box"),form:r("form","#retrieve_box").submit(function(n){n.preventDefault()&&n.stopPropagation(),t.$els.restoreError.hide();var i=c.serialize(t.$els.retrieve.form,{login:"",email:""});if(i.email===""||i.login==="")return!0;i.action="request",m("/ajax/restore_passwd.php",{data:i,dataType:"JSON",method:"POST"}).then(function(n){if(n.result)try{e("../blocks/message")("Ссылка на восстановление пароля отправлена на e-mail","success",r("body")),t.toggleSign(!1)}catch(i){}else t.$els.restoreError.show().find(".text").text(n.message)})})}},i.extend(this.$els.signup,{username:this.$els.signup.el.find('input[name="username"]'),password:this.$els.signup.el.find('input[name="password"]'),email:this.$els.signup.el.find('input[name="email"]'),captcha:this.$els.signup.el.find('input[name="captcha"]'),submit:this.$els.signup.el.find('button[type="submit"]')}),this.$els.signup.el.find("input").bind({blur:function(){var e=r(this),n=e.attr("name");t._checkSignUp(n)}}),this._isOauth=this.$els.container.data("type")==="oauth",this._captchaUrl=this.$els.captcha.attr("src"),this._attachEvents(),this._isOauth&&!u.config("logged")&&setTimeout(function(){t.toggleSign(!0,"oauth")},1e3),v("_nuser")&&(e("../blocks/message")(h("sign:welcome")+u.config("user:name")+"!","success",r("body")),v.expire("_nuser"))};i.extend(g.prototype,{_scrollTop:0,_attachEvents:function(){return r(".tologin_control").on("click",i.bind(this.toggleSign,this,!0,this._isOauth?"oauth":"signin")),r("#auth_box .close_control").on("click",i.bind(this.toggleSign,this,!1)),r("#auth_box .auth_tologin_control").on("click",i.bind(this.toggleForm,this,"signin",!1)),r("#auth_box .oauth_tooauth_control").on("click",i.bind(this.toggleForm,this,"oauth",!1)),r("#auth_box .auth_tooauth_login_control").on("click",i.bind(this.toggleForm,this,"signin",!1)),r('.auth_logout, .main_menu a[data-role="logout"]').touch(function(){m("/ajax/logout.php",{method:"post",dataType:"json"}).then(function(t){t.result&&e("../core/location").redirect(t.data.url)})}),r("#auth_box").on("click",".auth_retrieve_control",i.bind(this.toggleForm,this,"retrieve",!1)),r("#auth_box input").focus(function(t){var n=r(t.target);n.hasClass("form_input_error")&&(n.removeClass("form_input_error"),setTimeout(function(){e("../blocks/message")(n.attr("title"),"failure",r("body"))},150))}),this},$inputs:{},_oauth:function(e){e&&e.preventDefault()&&e.stopPropagation();var t={},n=this,s;return this._destroyErrors(),this.closeBox(),s=i.defaults(c.serialize(this.$els.oauth.form),{mode:"oauth",username:""}),r.trim(s.username)||(t.username=h("sign:username")),i.isEmpty(t)?(m("/ajax/register.php",{data:s,dataType:"JSON",method:"POST"}).then(function(e){e.result?(v.set("_nuser",1,{expires:31536e6}),location.reload()):(n._reloadCaptcha(),n.$els.oauth.error.text(e.message).show(),n.$els.container.scrollTop(0))}),this):(i.each(t,function(e,t){var i=r('input[name="'+t+'"]',"#oauth_box");i.length>0&&(i.attr("title",e).addClass("form_input_error"),n.$inputs[t]=i)}),this)},_checkUsernameCache:{},_checkUsername:function(e){var t=this,n=r.Deferred();return i.isBoolean(this._checkUsernameCache[e])?n[t._checkUsernameCache[e]?"resolve":"reject"]():m("/ajax/username_check.php",{data:{username:e},dataType:"JSON",method:"POST"}).then(function(r){t._checkUsernameCache[e]=r.result,n[t._checkUsernameCache[e]?"resolve":"reject"]()}),n.promise()},_checkSignUp:function(e){e&&e.preventDefault&&e.preventDefault()&&e.stopPropagation();var t=this,n=[],s={},o=i.isString(e)?[e]:["all","username","password","email","captcha"],u=r.Deferred(),a=[u.promise()];return i.forEach(o,function(e){var i=t.$els.signup[e]?t.$els.signup[e].val()||"":"";e==="username"&&(i=r.trim(i),i.length<4?n.push({param:e,error:"sign:up:errors:username-short"}):i.length>16?n.push({param:e,error:"sign:up:errors:username-long"}):/^([A-Za-z0-9.]*)$/.test(i)?/[^.]$/.test(i)?a.push(t._checkUsername(i).fail(function(){n.push({param:"username",error:"sign:up:errors:username-busy"})})):n.push({param:e,error:"sign:up:errors:username-last-dot"}):n.push({param:e,error:"sign:up:errors:username-whitelist"})),e==="email"&&i&&(d.test(i)||n.push({param:e,error:"sign:up:errors:email"})),e==="password"&&(i.length<4&&n.push({param:e,error:"sign:up:errors:password-short"}),s["password"+t.$els.signup.password.data("additional")]=i),e==="captcha"&&i.length<4&&n.push({param:e,error:"sign:up:errors:captcha"}),e!=="all"&&e!=="password"&&(s[e]=i)}),u[n.length>0?"reject":"resolve"](),n.length>0&&(t._showErrors(n,o),n=[]),c.all(a).then(function(){!i.isString(e)&&n.length===0&&(s=i.defaults(s,{mode:"auth"}),t.$els.signup.submit.prop("disabled",!0),m("/ajax/register.php",{data:s,dataType:"JSON",method:"POST"}).then(function(e){e.result?(v.set("_nuser",1,{expires:31536e6}),window.location.reload()):(t._reloadCaptcha(),t._showErrors([{param:e.data.param||"all",error:e.message}]),r(document).scrollTop(80))}).always(function(){t.$els.signup.submit.prop("disabled",!1)}))},function(){t._showErrors(n,"username")}),u.promise()},_signup:function(e){e&&e.preventDefault()&&e.stopPropagation();var t={},n=this,s;return this._destroyErrors(),this.closeBox(),s=i.defaults(c.serialize(this.$els.signup.form),{mode:"auth",username:"",email:""}),r.trim(s.username)||(t.username=h("sign:username")),s.email!==""&&!d.test(s.email)&&(t.email=h("sign:email")),r.trim(s.password).length<4&&(t.password=h("sign:password")),r.trim(s.captcha).length<4&&(t.captcha=h("sign:captcha")),s["password"+r('input[name="password"]',"#registration_box").data("additional")]=s.password,i.isEmpty(t)?(m("/ajax/register.php",{data:s,dataType:"JSON",method:"POST"}).then(function(e){e.result?(v.set("_nuser",1,{expires:31536e6}),n._signin({username:s.username,password:s.password})):(n._reloadCaptcha(),t[e.data.param||"all"]=e.message,n._showErrors(t),r(document).scrollTop(80))}),this):(this._showErrors(t),this)},_showErrors:function(e,t){var n=this;t=t||["all","username","password","email","captcha"],i.forEach(t,function(e){e==="all"?n.$els.signup.error.hide():n.$inputs[e]&&n.$inputs[e].removeClass("form_input_error")}),i.each(e,function(e){var t=r('input[name="'+e.param+'"]',"#registration_box");t.length>0?(t.attr("title",h(e.error)).addClass("form_input_error"),n.$inputs[e.param]=t):e.param==="all"&&n.$els.signup.error.text(h(e.error)).show()})},_destroyErrors:function(){return this.$els.signup.error.hide(),i.each(this.$inputs,function(e){e.removeClass("form_input_error")}),this.$inputs={},this},_reloadCaptcha:function(){return this.$els.captcha.attr("src",this._captchaUrl+"&"+Math.random()),this},_checkCaptcha:function(){return this.$els.signin.captcha?this.$els.signin.captcha.find(".captcha__image").attr("src",this._captchaUrl+"&"+Math.random()):this.$els.signin.captcha=r(l(e("./templates/captcha.html"))({src:this._captchaUrl})).insertAfter(r('input[name="password"]').removeClass("last")),this},_signin:function(e){if(e.isTrigger)return this;e&&e.preventDefault&&e.preventDefault()&&e.stopPropagation();var t=this,n;return this.closeBox(),n=e&&e.username?e:c.serialize(t.$els.signin.form,{username:"",password:"",captcha:""}),i.defaults(n,{mode:this._isOauth?"oauth":"login"}),m("/ajax/auth.php",{data:n,dataType:"JSON",method:"POST"}).then(function(e){try{if(e.data.need_captha)return t._needCaptcha=!0,t.$els.signin.form.submit(),this;e.result?window.location.reload():t.$els.error.html('<div class="auth_box_s text">'+e.message+"</div>").fadeIn(100)}catch(n){}}),this},closeBox:function(){return this.$els.error.fadeOut(100),this.$els.need.fadeOut(100),this.$els.signup.error.hide(),this.$els.oauth.error.hide(),this},toggleForm:function(e,t){return!t&&this.closeBox(),this.$els.signin.el.toggleClass("hidden",e!=="signin"),this.$els.signup.el.toggleClass("hidden",e!=="signup"),this.$els.oauth.el.toggleClass("hidden",e!=="oauth"),this.$els.retrieve.el.toggleClass("hidden",e!=="retrieve"),this},toggleSign:function(e,t,n){var i=r(window).scrollTop(),s=this;return e&&(this._scrollTop=i>0?i:this._scrollTop,this.toggleForm(t,n)),u.config("authbox",e),s.$els.container[e?"fadeIn":"fadeOut"](100,function(){r("#left_container").toggleClass("hidden",e),r("#right_container").toggleClass("hidden",e),r(".right_container_wrapper").toggleClass("hidden",e),r(document).scrollTop(e?0:s._scrollTop)}),this},showNeedSignin:function(){return this.toggleSign(!0,"signin",!0),this.$els.need.show(),this}}),n.exports=new g},"story-save/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core/template"),u=e("../core"),a=e("../core/request"),f=e("../core/events"),l=null,c=null,h=function(e,t,n){this._cats=l;if(!this._cats){var i=r('input[type="hidden"][name="save-cats"]').val();if(!i)return this;l=this._cats=JSON.parse(i)}this._storyID=e||0,this._$target=t,this._onComplete=n||new Function("",""),c&&c._box&&c._box.hide(),c=this};i.extend(h.prototype,f,{_cats:null,_box:null,_storyID:null,_$target:null,_onComplete:null,_categoryID:-1,updateCategoriesList:function(e){return this._cats=l=e,this},save:function(){if(!this._storyID)return this;if(this._cats.length==0)return this;if(u.config("isHideSaveMenu"))return this._saveStory(-2),this;var e=this._box=new s;return e.setModalMode(!0),e.addCloseButtonIntoFooter(),e.append(this._getBoxContent()),e.show(this._$target),this},cancel:function(){if(!this._storyID)return this;var e=this;return a("/ajax/stories_actions.php?action=save_story-",{data:{story_id:this._storyID},dataType:"json"}).then(function(t){t.result?(e._categoryID=-1,e._updateCounter(t.data.cat_id,-1),e._box&&e._box.isShown()&&e._box.hide(),e._onComplete()):(new s).showMessage(e._$target,t.message,"error")},function(){(new s).showMessage(e._$target,"Ошибка при выполнении запроса на сервер","error")}),this},_getBoxContent:function(){var e=r('<div class="b-save-story-box">'),t=r('<div class="ss-cats">'),n,s=i.bind(this._onClickByCategory,this);for(var o=0,u=this._cats,a=u.length;o<a;o++)n=u[o],t.append(r('<div class="save-story-cat">').toggleClass("ss-cat-selected",this._categoryID==n.id).attr("data-cat-id",n.id).on("touch",s).append('<i class="fa fa-check"></i>').append(r('<span class="ss-cat-name">').text(n.name)).append(r('<span class="ss-cat-cnt">').text(String(n.count))));return e.append(t),e.append(r("<div>").addClass("save-story-new-cat").on("touch",i.bind(this._onCreateNewCategory,this)).append('<svg class="ss-ncat-plus" width="26" height="26"><path d="M5 11 h16 M13 3 v16" /></svg>').append("<span>Новая категория</span>")),u.length==1&&(e.append(r('<div class="save-story-cat-default">').append('<svg width="16" height="12"><path d="M0 12 L8 0 L16 12" /></svg>').append("<span>Вы можете создавать категории и сохранять в них посты</span>")),e.append(r("<div>").addClass("save-story-hide-menu").click(i.bind(this._onClickByHideMenu,this)).append('<i class="fa fa-square-o"></i>').append("<span>Скрыть меню выбора категорий при сохранении поста. Для этого переместите категорию, насчитывающую менее 10 тыс постов, на первую позицию</span>"))),e},_onClickByHideMenu:function(){var t=r(".save-story-hide-menu > i");if(t.hasClass("fa-check-square"))return;t.removeClass("fa-square-o").addClass("fa-check-square");var n=this;a("/ajax/users_actions.php",{data:{action:"change_settings",hide_save_stories_menu:1},dataType:"json"}).then(function(t){if(t.result){if(n._box&&n._box.isShown()){n._box.hide();var i=new s;i.setModalMode(!0),i.addCloseButtonIntoFooter(),i.append(r(o(e("./templates/disabled-menu-msg.html"))())),i.show(n._$target),u.config("isHideSaveMenu",!0)}}else n._createError(t.message)},function(){n._createError("Ошибка при выполнении запроса на сервер")})},_onClickByCategory:function(e){var t=r(e.target).closest(".save-story-cat"),n=t.attr("data-cat-id"),i=t.find(".ss-cat-name").text();r(".ss-cat-selected",this._box.getContent()).removeClass("ss-cat-selected"),t.addClass("ss-cat-selected"),this._saveStory(n,i)},_onCreateNewCategory:function(){var e,t=r('<div class="b-new-save-category">').append("<section>Название новой категории:</section>").append(r('<input type="text" value="" maxlength="25" />').on("touchstart",function(){e=r(window).scrollTop()}).blur(function(){r(window).scrollTop(e)})),n=this,i=new s;i.setModalMode(!0),i.addButtonIntoFooter("Создать",function(){n._createCategory(t.find("input").val(),i)},"success"),i.addButtonIntoFooter("Отмена",function(){i.hide()}),i.append(t),i.show(this._$target)},_saveStory:function(t,n){var r=this;if(this._categoryID==t){r._box&&r._box.isShown()&&r._box.hide(),r._onComplete();return}var i=this._categoryID;t!=-2&&(this._categoryID=t),a("/ajax/stories_actions.php",{data:{story_id:this._storyID,action:"save_story+",cat_id:t,cat_name:n},dataType:"json"}).then(function(s){s.result?(t==-2&&(t=s.data.cat_id),r._createError(),i>-1&&r._updateCounter(i,-1),r._updateCounter(t,1),n&&r._box&&r._box.isShown()&&(r._box.hide(),e("../blocks/message")("Сохранено в «"+n+"»","success")),r._onComplete()):r._createError(s.message)},function(){r._createError("Ошибка при выполнении запроса на сервер")})},_createCategory:function(e,t){var n=e.toLowerCase().replace(/^\s+|\s+$/g,""),i,s=this;if(e.replace(/\s+/g,"")==""){this._createError("Введите название новой категории");return}for(var o=0,u=this._cats,f=u.length;o<f;o++){i=u[o];if(i.name.toLowerCase().replace(/^\s+|\s+$/g,"")==n){this._createError("Категория с введенным названием уже сущетвует");return}}this._createError(),a("/ajax/stories_actions.php?action=create_save_category",{data:{name:e},dataType:"json"}).then(function(n){if(n.result){t.hide(),l=s._cats=n.data.cats;if(s._box&&s._box.isShown()){s._box.getContent().empty();var i=s._getBoxContent();s._box.append(i);var o=r(".b-saved-stories-panel .ss-cats-list");if(o.length>0){var u=o.find('a[data-id="0"]').clone().removeClass("ss-active").attr("data-id",n.data.id);u.attr("href",u.attr("href")+"&cid="+n.data.id),u.find("span").text(e),u.find("b").text("0"),o.append(u)}}}else s._createError(n.message)},function(){s._createError("Ошибка при выполнении запроса на сервер")})},_updateCounter:function(e,t){e=Number(e),t=Number(t);var n=r('.ss-cats-list a[data-id="'+e+'"]');if(n.length>0){var i=n.find("b");i.text(String(Number(i.text())+t))}for(var s=0,o=this._cats,u=o.length;s<u;s++)o[s].id==e&&(o[s].count=Number(o[s].count)+t)},_createError:function(e){e=e||"",e!=""&&(new s).showMessage(this._$target,e,"error")}}),n.exports=h},"story-search/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../calendar"),u=e("../core/template"),a=e("../core"),f=e("../core/request"),l=e("../wm"),c=e("../core/layout"),h=e("../core/location"),p=c.extend({_formContainer:null,_isAdultVisible:!1,_tagEnterBox:null,_tagMenuBox:null,_calendar:null,_storyTypeBox:null,_storyDateMenuBox:null,_storyDateBox:null,_storySortBox:null,_storyRatingBox:null,_ratings:[-200,-100,0,25,100,250,500,1e3,2500,5e3,1e4],_subscribedTags:null,_ignoredTags:null,_logged:!1,_selectedTag:null,_updatePageElementsBound:null,_appliedData:null,_isDataChanged:function(e){if(this._appliedData===null)return!1;var t=this._appliedData;for(var n in e)if(e.hasOwnProperty(n)&&e[n]!==t[n])return!0;return!1},show:function(){this._rendered||(this.render(),this._rendered=!0)},render:function(){var t=this;a.config("GET:cl")&&e("../page-communities").attributes.layout.showStoriesSearch(),a.config("GET:u")&&e("../page-user-profile").attributes.layout.show([a.config("GET:u")]),this._formContainer=r(".story-search").first(),this._isAdultVisible=this._formContainer.data("adult-visible")=="true",this._logged=a.config("logged"),this._updatePageElementsBound=i.bind(this._updatePageElements,this),this._logged||(this._ignoredTags={},this._subscribedTags={},this._isAdultVisible=!1),r(".ss-filters-small, .ss-slideup-btn").touch(function(){r(".ss-filters-small").slideToggle(300),r(".ss-filters-large").slideToggle(300),r(".ss-slideup-btn").fadeToggle(300,t._updatePageElementsBound)}),r("#ss_text").on("change paste keyup keypress",function(e){t._updateSubmitButton(),e&&e.type=="keyup"&&e.keyCode==13&&(this.blur(),t.submit())}),r('div[data-type="story-type"]',this._formContainer).touch(i.bind(this._showStoryTypePopupBox,this)),r('div[data-type="story-date"]',this._formContainer).touch(i.bind(this._showStoryDatePopupBox,this)),r('div[data-type="story-sort"]',this._formContainer).touch(i.bind(this._showStorySortingPopupBox,this)),r('div[data-type="story-digs"]',this._formContainer).touch(i.bind(this._showStoryRatingPopupBox,this)),r("a.ss-add",this._formContainer).touch(i.bind(this._showAddTagBox,this)),r(".ss-submit",this._formContainer).touch(i.bind(this.submit,this)),r(".ss-reset",this._formContainer).touch(i.bind(this.reset,this)),r("div.ss-tag",this._formContainer).touch(function(){t._showTagMenu(r(this),this.getAttribute("data-tag"))}),this._createCalendar(),this._updateAllElements()},submit:function(){var e=this._getFormData();if(e.isEmpty&&!this._isDataChanged(e))return this;this._appliedData=e,r(".search-result-msg").hide();var t=function(e){var t=e.split("-"),n=new Date(2008,0,1,0,0,0,0),r=(new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]),0,0,0,0)).getTime(),i=r-n;return i<0&&(i=0),~~(i/864e5)},n=[],i="Поиск",s={ajax_mode:1,cl:e.cl!=""?e.cl:undefined,u:e.u!=""?e.u:undefined,n:e.type!=="0"?e.type:undefined,st:e.sort!=="1"?e.sort:undefined,r:e.rating!=="0"?e.rating:undefined,d:e.date1?t(e.date1):undefined,D:e.date2?t(e.date2):undefined,t:e.tags?e.tags:undefined,q:e.text?e.text:undefined};e.cl!=""&&n.push("cl="+encodeURIComponent(e.cl)),e.u!=""&&n.push("u="+encodeURIComponent(e.u)),e.type!="0"&&n.push("n="+encodeURIComponent(e.type)),e.sort!="1"&&n.push("st="+encodeURIComponent(e.sort)),e.rating!="0"&&n.push("r="+encodeURIComponent(e.rating)),e.date1!=""&&n.push("d="+encodeURIComponent(t(e.date1))),e.date2!=""&&n.push("D="+encodeURIComponent(t(e.date2))),e.tags!=""&&(n.push("t="+encodeURIComponent(e.tags)),i=e.tags.replace(/,/gi,", ")),e.text!=""&&(n.push("q="+encodeURIComponent(e.text)),i=e.text+" - Поиск");var o=n.join("&");if(o=="")return this;var u="/search.php?"+o,l=this,c;return i=i.replace(/[<>&]/gi,""),c=h.replaceState(e,i,u,!0),document.title=i,c?(r("div.search-preloader").slideDown(200,this._updatePageElementsBound),r("div.search-result").hide(),l._updateAllElements(),this._collapseFilters(),f(u,{data:s,dataType:"json"}).then(function(e){if(e.tags!==undefined){var t=r("#stories_container");t.empty().html(e.stories),r("#no_stories_msg").toggle(e.stories=="");var n=r("#page_navigator");n.length==0?e.paginator&&t.after(e.paginator):e.paginator?n.replaceWith(e.paginator):n.remove(),r("div.search-result").show(),r("div.search-preloader").slideUp(200,l._updatePageElementsBound),a.feed.reInit(!0),l._updateAllElements()}},"json")):window.location.href=u,this},reset:function(){return r("#ss_text").val(""),r("#ss_tags").val(""),r("#ss_type").val("0"),r("#ss_sort").val("1"),r("#ss_rating").val("0"),r("#ss_date_from").val(""),r("#ss_date_to").val(""),r(".ss-tag",this._formContainer).remove(),this._calendar.setDate(),this._collapseFilters(),this._updateAllElements(),this},_collapseFilters:function(){r(".ss-filters-large").slideUp(300),r(".ss-filters-small").slideDown(300),r(".ss-slideup-btn").fadeOut(300,this._updatePageElementsBound)},_showStoryTypePopupBox:function(t){var n,i=r("#ss_type").val(),o=0,a=this;t.stopPropagation(),i!=""&&Number(i)==Number(i)&&(o=Number(i)),this._storyTypeBox||(this._storyTypeBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().autoCorrectPosition(!1).append(n=r(u(e("./templates/story-type.html"))())),this._isAdultVisible||n.find('input[value="32"]').parent().hide(),n.css("display","block").find("input").on("change",function(){var e=n.find("input:checked"),t=0;for(var i=0,s=e.length;i<s;i++)t|=Number(e[i].value);r("#ss_type").val(String(t)),a._updateStoryTypeCaption(),a._updateSubmitButton()})),this._storyTypeBox.getContent().find("input").each(function(){var e=Number(this.value);r(this).prop("checked",(o&e)==e)}),this._storyTypeBox.show(r('div[data-type="story-type"]',this._formContainer))},_updateStoryTypeCaption:function(){var e=Number(r("#ss_type").val()),t="";(e&2)==2&&(t+="Текст"),(e&4)==4&&(t==""?t+="Картинки":(e&8)!=8?t+=" и картинки":t+=", картинки"),(e&8)==8&&(t==""?t+="Видео":t+=" и видео"),(e&16)==16&&(t==""?t+="С тегом [моё]":t+=" с тегом [моё]"),(e&32)==32&&(t==""?t+="Клубничка (16+)":(e&32)==32?t+=" и с клубничкой (16+)":t+=" с клубничкой (16+)"),t==""&&(t="Любые посты"),r('*[data-type="story-type"]',this._formContainer).text(t)},_prevScreenWidth:0,_createCalendar:function(){var e=r(window),t=e.width(),n=this;if(t==this._prevScreenWidth&&this._calendar)return;this._calendar&&r(this._calendar.getElement()).remove(),this._calendar=(new o).setWidth(Math.min(500,~~(t*.9))).setDate(r("#ss_date_from").val(),r("#ss_date_to").val()).setDatesRangeMode(!0).showButtonsPanel(!1).addEventListener("select",function(e){r("#ss_date_from").val(e.start_date),e.end_date&&e.end_date!=e.start_date?r("#ss_date_to").val(e.end_date):r("#ss_date_to").val(""),n._updateStoryDateCaption(),n._updateSubmitButton()})},_showStoryDatePopupBox:function(t){t.stopPropagation();var n,i=this;this._createCalendar(),this._storyDateMenuBox||(this._storyDateMenuBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().append(n=r(u(e("./templates/story-date.html"))())),n.find("div[data-role]").touch(function(){var e=r(this).data("role");switch(e){default:case"all_time":case"month":case"week":case"today":i._calendar.setRangeByType(e),i._storyDateMenuBox.hide();break;case"cal":i._storyDateMenuBox.hide(),i._showCalendar()}})),this._storyDateMenuBox.show(r('div[data-type="story-date"]',this._formContainer))},_showCalendar:function(){this._storyDateBox=(new s).allowScrollContent(!1).setMinWith(0).autoCorrectPosition(!1).setModalMode(!0).addCloseButtonIntoFooter().setInnerIndent(0).append(this._calendar.getElement()),this._storyDateBox.show(r('div[data-type="story-date"]',this._formContainer))},_updateStoryDateCaption:function(){var e=this._calendar.getSelectedDatesCaption();r('span[data-type="story-date"]',this._formContainer).text(e),r('div[data-type="story-date"]',this._formContainer).text("За "+e)},_showStorySortingPopupBox:function(t){t.stopPropagation();var n,i=r("#ss_sort").val(),o="1",a=this;i!=""&&(o=i),this._storySortBox||(this._storySortBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().autoCorrectPosition(!1).append(n=r(u(e("./templates/story-sort.html"))())),n.css("display","block").find("input").on("change",function(){var e=n.find("input:checked").val();r("#ss_sort").val(String(e)),a._updateStorySortingCaption(),a._updateSubmitButton()})),this._storySortBox.getContent().find("input").each(function(){r(this).prop("checked",this.value==o)}),this._storySortBox.show(r('div[data-type="story-sort"]',this._formContainer))},_updateStorySortingCaption:function(){var e=r("#ss_sort").val(),t="";e==""||e=="1"?t="свежее":t="лучшее",r('span[data-type="story-sort"]',this._formContainer).text(t),r('div[data-type="story-sort"]',this._formContainer).text("Сначала "+t)},_showStoryRatingPopupBox:function(t){t.stopPropagation();var n,i=r("#ss_rating").val(),o="0",a=this;i!=""&&(o=i),this._storyRatingBox||(this._storyRatingBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().autoCorrectPosition(!1).append(n=r(u(e("./templates/story-rating.html"))())),n.css("display","block").find("input").on("change",function(){var e=n.find("input:checked").val();r("#ss_rating").val(String(e)),a._updateStoryRatingCaption(),a._updateSubmitButton()})),this._storyRatingBox.getContent().find("input").each(function(){r(this).prop("checked",this.value==o)}),this._storyRatingBox.show(r('div[data-type="story-digs"]',this._formContainer))},_updateStoryRatingCaption:function(){var e=this._ratings,t=Number(r("#ss_rating").val()),n="";if(t!=t||t<0&&t>=e.length)t=0;t==0?n="любым рейтингом":n="рейтингом больше "+e[t],r('span[data-type="story-digs"]',this._formContainer).text(n),r('div[data-type="story-digs"]',this._formContainer).text("C "+n)},_showAddTagBox:function(){var t=this,n=null,i=null;if(!this._tagEnterBox){this._tagEnterBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().setInnerIndent(0).append(n=r(u(e("./templates/tag-enter-box.html"))())),i=n.find("input"),n.find('a[data-role="close"]').touch(function(){t._tagEnterBox.hide()});var o={},a="",f=0;i.on("keyup keypress paste",function(){var e=i.val();if(e.length>=1&&!/^\s+$/.test(e)){e=e.toLowerCase();if(o[e]!==undefined)t._showFoundTagsList(o[e]);else{if(a==e)return;a=e,n.addClass("ssf-loading"),clearTimeout(f),f=setTimeout(function(){r.post("/ajax/tags_actions.php?action=droplist",{value:e},function(r){r.result&&(o[e]=r.data,e==a&&(t._showFoundTagsList(o[e]),n.removeClass("ssf-loading")))},"json").fail(function(){n.removeClass("ssf-loading")})},500)}}else t._showFoundTagsList([])})}var l=this._tagEnterBox.getContent();i=l.find('input[type="text"]').val(""),this._tagEnterBox.show(r("a.ss-add",this._formContainer)),this._showFoundTagsList([]),i.focus()},_showFoundTagsList:function(e){if(!this._tagEnterBox.isShown())return;var t=this._tagEnterBox.getContent(),n=t.find("input").val().toLowerCase(),r=t.find(".ssf-tag-enter > div:last-child"),s,o="",u="",a=0,f,l=this;if(!e||e.length==0)r.html("<i>похожих тегов не найдено...</i>");else{for(var c=0,h=e.length;c<h;c++)s=e[c],f=s[0],a=f.toLowerCase().indexOf(n),a>-1?(u="",a>0&&(u+=i.escape(f.substr(0,a))),u+="<span>",u+=i.escape(f.substr(a,n.length)),u+="</span>",a+n.length<f.length&&(u+=i.escape(f.substr(a+n.length)))):u=i.escape(f),o+='<div data-tag="'+i.escape(f)+'"><span>'+u+"</span><i>"+s[1]+"</i></div> ";r.html(o),r.find("> div").touch(function(){l._addTag(this.getAttribute("data-tag")),l._tagEnterBox.hide()})}},_addTag:function(e){var t,n=this,s="h1";r("div.ss-tag",this._formContainer).length>1&&(s="h2"),r(".ss-add",this._formContainer).before(t=r("<div>").data("tag",e).addClass("ss-tag").html("<"+s+">"+i.escape(e)+"</"+s+">")),t.touch(function(){n._showTagMenu(r(this),e)}),this._updateAllElements()},_showTagMenu:function(t,n){var o=this,a=null;this._ignoredTags===null&&r.ajax({url:"/ajax/tags_actions.php?action=info",async:!1,dataType:"json",success:function(e){if(e.result){var t,n,r,i={},s={};t=e.data.subs;for(n=0,r=t.length;n<r;n++)s[t[n].toLowerCase()]=1;t=e.data.ignore;for(n=0,r=t.length;n<r;n++)i[t[n].toLowerCase()]=1;o._ignoredTags=i,o._subscribedTags=s}}});if(this._ignoredTags===null){(new s).showMessage(t,"Не удалось загрузить данные с сервера","error");return}this._tagMenuBox||(this._tagMenuBox=(new s).setModalMode(!0).addCloseButtonIntoFooter().showCloseButtonIntoHeading(!1).append(a=r(u(e("./templates/tag-menu-box.html"))())),a.find("div[data-role]").touch(function(){var t=r(this),n=t.data("role"),i="",u=o._selectedTag.data("tag"),a=u.toLowerCase();if(n!="del"&&!o._logged){o._tagMenuBox.hide(),e("../sign").showNeedSignin();return}switch(n){default:case"del":o._tagMenuBox.hide(),o._selectedTag.remove(),o._updateAllElements();return;case"subs+":i='Подписка на тег "'+u+'" успешно добавлена!',o._subscribedTags[a]=1;break;case"subs-":i='Подписка на тег "'+u+'" удалена.',delete o._subscribedTags[a];break;case"ignore+":i='Тег "'+u+'" добавлен в игнор-лист!',o._ignoredTags[a]=1;break;case"ignore-":i='Тег "'+u+'" удален из игнор-листа.',delete o._ignoredTags[a]}o._tagMenuBox.hide(),r.ajax({url:"/ajax/tags_actions.php?action="+encodeURIComponent(n),async:!1,method:"POST",data:{value:u},dataType:"json",success:function(e){e.result?(new s).showMessage(o._selectedTag,i,"success"):(new s).showMessage(o._selectedTag,e.message,"error")},error:function(){(new s).showMessage(o._selectedTag,"Нет связи с космосом, шеф!","error")}})})),this._selectedTag=t;var f=n.toLowerCase(),l=this._ignoredTags[f]===1,c=this._subscribedTags[f]===1,h=this._tagMenuBox.getContent();h.find('div[data-role="subs+"]').toggle(!c),h.find('div[data-role="subs-"]').toggle(c),h.find('div[data-role="ignore+"]').toggle(!l),h.find('div[data-role="ignore-"]').toggle(l),this._tagMenuBox.appendHeading(i.escape(n),!0).show(t)},_updateTagsBar:function(){var e=[];r(".ss-tag",this._formContainer).each(function(){e.push(r(this).data("tag"))}),r("#ss_tags").val(e.join(",")),r(".ss-add").toggle(e.length<9)},_getFormData:function(){var e={};return e.cl=a.config("GET:cl")||"",e.u=a.config("GET:u")||"",e.text=r("#ss_text").val().replace(/^\s+/,"").replace(/\s+$/,""),e.tags=r("#ss_tags").val(),e.type=r("#ss_type").val(),e.type==""&&(e.type="0"),e.sort=r("#ss_sort").val(),e.sort==""&&(e.sort="1"),e.rating=r("#ss_rating").val(),e.rating==""&&(e.rating="0"),e.date1=r("#ss_date_from").val(),e.date2=r("#ss_date_to").val(),e.date1==""&&(e.date2=""),e.isEmpty=e.text.length<3&&e.tags==""&&e.type=="0"&&e.sort=="1"&&e.rating=="0"&&e.date1=="",e},_updateSubmitButton:function(){var e=this._getFormData();r(".ss-submit",this._formContainer).prop("disabled",e.isEmpty&&!this._isDataChanged(e)),r(".ss-reset",this._formContainer).toggle(!e.isEmpty)},_updateAllElements:function(){this._updateStoryTypeCaption(),this._updateStoryDateCaption(),this._updateStorySortingCaption(),this._updateStoryRatingCaption(),this._updateTagsBar(),this._updateSubmitButton(),this._updatePageElements()},_updatePageElements:function(){window.positionFooter!==undefined&&window.positionFooter()}}),d=new p;l.add({name:"tag",layout:d,routes:{"*all":"show"}}),n.exports=l.add({name:"search.php",layout:d})},"tags/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/request"),l=e("../core/i18n"),c=e("store"),h=e("selectize"),p=e("../core/template"),d=e("../compare"),v=e("./block"),m=e("../core/util"),g=e("../core/enums"),y=e("../popup-box"),b=function(t){return this.$el=t,this._tags=new Set,this._tagsLC=new Set,this._informationReceived=!1,this._ignoredTags=new Set,this._subscribedTags=new Set,this._cachedSearchTags={},this._tagTemplate=p(e("./templates/tag.html")),this.options={min:t.data("min"),max:t.data("max"),canCreate:t.data("can-create"),placeholder:t.attr("placeholder")},this.init(),this.$el.data("tags",this),this};i.extend(b.prototype,{init:function(){var t=this;this.$wrapper=r(e("./templates/list.html")).insertAfter(this.$el),this.$wrapper.touch(i.bind(this._showEnterBox,this)),this.$els={add:this.$(".tags-list__add").text(this.options.placeholder),list:this.$(".tags-list__list")},this.$els.list.on("touch",".tags-list-tag",i.bind(this._showTagMenu,this)),f("/ajax/tags_actions.php?action=info").then(function(e){if(!e.result)return!1;t._informationReceived=!0,i.forEach(e.data.subs,i.bind(t._subscribedTags.add,t._subscribedTags)),i.forEach(e.data.ignore,i.bind(t._ignoredTags.add,t._ignoredTags))}),this._tagMenuBox=(new y).setModalMode(!0).addCloseButtonIntoFooter().showCloseButtonIntoHeading(!1).append(this.$els.tagMenu=r(p(e("./templates/menu-box.html"))())),this.$els.tagMenuRoles={sub:this.$els.tagMenu.find('div[data-role="subs+"]'),unSub:this.$els.tagMenu.find('div[data-role="subs-"]'),ignore:this.$els.tagMenu.find('div[data-role="ignore+"]'),unIgnore:this.$els.tagMenu.find('div[data-role="ignore-"]')},this.$els.tagMenu.find("div[data-role]").touch(function(){var n=r(this),i=n.data("role"),s="",o=t._selectedTag.data("tag"),a=o.toLowerCase();if(i!="del"&&!u.config("logged")){t._tagMenuBox.hide(),e("../sign").showNeedSignin();return}switch(i){default:case"del":t._tagMenuBox.hide(),t._removeTag(o);return;case"subs+":s='Подписка на тег "'+o+'" успешно добавлена!',t._subscribedTags.add(a);break;case"subs-":s='Подписка на тег "'+o+'" удалена.',t._subscribedTags.delete(a);break;case"ignore+":s='Тег "'+o+'" добавлен в игнор-лист!',t._ignoredTags.add(a);break;case"ignore-":s='Тег "'+o+'" удален из игнор-листа.',t._ignoredTags.delete(a)}t._tagMenuBox.hide(),f("/ajax/tags_actions.php?action="+encodeURIComponent(i),{method:"POST",data:{value:o}}).then(function(e){e.result?(new y).showMessage(t._selectedTag,s,"success"):(new y).showMessage(t._selectedTag,e.message,"error")},function(){(new y).showMessage(inst._selectedTag,"Нет связи с космосом, шеф!","error")})}),this._tagEnterBox=(new y).setModalMode(!0).addCloseButtonIntoFooter().setInnerIndent(0).append(this.$els.enterBox=r(p(e("./templates/enter-box.html"))())),this.$els.enterBoxEls={close:this.$els.enterBox.find(".tags-enter-box__close").touch(function(){t._tagEnterBox.hide()}),input:this.$els.enterBox.find("input").on("keyup keypress paste",i.debounce(i.bind(this._inputChange,this),300)),empty:this.$els.enterBox.find(".tags-enter-box__empty"),list:this.$els.enterBox.find(".tags-enter-box__list")},this.$els.enterBoxEls.list.on("touch",".tags-list-tag",function(e){var n=r(e.target).parents(".tags-list-tag"),i=n.data("tag");t.addTag(i),t._tagEnterBox.hide()})},_removeTag:function(e){var t=e.toLowerCase();this.$els.list.find('.tags-list-tag[data-tag="'+e+'"]').remove(),this._tags.delete(e),this._tagsLC.delete(t),this.$el.val(this.val()),this.$el.change(),this._canAdd()},canAdd:function(){return!this.options.max||this._tags.size<this.options.max},_canAdd:function(){return this.options.max?(this.$els.add.toggle(this.canAdd()),this):this},_inputChange:function(){var e=this,t=i.escape(this.$els.enterBoxEls.input.val().replace(/[^0-9A-Za-zА-Яа-яЁё!?:\-+;" ]+/g,""));return this._lastInput===t?this:(this._lastInput=t,t.length<2||/^\s+$/.test(t)?(this._showFoundTags(t),this):this._cachedSearchTags[t]?(this._showFoundTags(t,this._cachedSearchTags[t]),this):(this.$els.enterBox.addClass("tags-enter-box_loading"),f("/ajax/tags_actions.php?action=droplist",{method:"POST",data:{value:t}}).then(function(n){if(!n.result)return!1;e._showFoundTags(t,e._cachedSearchTags[t]=n.data)}).always(function(){e.$els.enterBox.removeClass("tags-enter-box_loading")}),this))},_showFoundTags:function(e,t){e=e||"";var n=this,s=e.toLowerCase(),o=new Map,u=new Map;return this._tagEnterBox.isShown()?(this.$els.enterBoxEls.list.empty(),this.$els.enterBoxEls.empty.hide(),i.forEach(t,function(e){var t=e[0],r=t.toLowerCase(),i=Number(e[1]);if(n._tags.has(t))return this;o.set(r,{tag:t,tagLC:r,count:i})}),this.options.canCreate&&e.length>2&&!o.has(s)?(u.set(s,{tag:e,tagLC:s}),o.forEach(function(e,t){u.set(t,e)})):u=o,u.size?(u.forEach(function(t){var n=t.tagLC.indexOf(s);n>-1&&(t.label="",n>0&&(t.label+=i.escape(t.tag.substr(0,n))),t.label+="<span>",t.label+=i.escape(t.tag.substr(n,e.length)),t.label+="</span>",n+e.length<t.tag.length&&(t.label+=i.escape(t.tag.substr(n+e.length)))),r(this._tagTemplate(t)).appendTo(this.$els.enterBoxEls.list)},this),this):(this.$els.enterBoxEls.empty.show(),this)):this},_showEnterBox:function(e){var t=r(e.target);return!this.canAdd()||!t.hasClass("tags-list")&&!t.hasClass("tags-list__add")?this:(this.$els.enterBoxEls.input.val(""),this._tagEnterBox.show(this.$els.add),this._showFoundTags(),this.$els.enterBoxEls.input.focus(),this)},_showTagMenu:function(e){var t=r(e.target).parents(".tags-list-tag"),n=t.data("tag"),s=n.toLowerCase(),o=this._ignoredTags.has(s),u=this._subscribedTags.has(s);return this._selectedTag=t,this._informationReceived?(this.$els.tagMenuRoles.sub.toggle(!u),this.$els.tagMenuRoles.unSub.toggle(u),this.$els.tagMenuRoles.ignore.toggle(!o),this.$els.tagMenuRoles.unIgnore.toggle(o),this._tagMenuBox.appendHeading(i.escape(n),!0).show(t),this):((new y).showMessage(t,"Не удалось загрузить данные с сервера","error"),this)},addTag:function(e,t){var n=e.toLowerCase();return!n.length||this._tags.has(e)?this:(this._tagsLC.add(n),this._tags.add(e),this.$els.list.append(r(this._tagTemplate({label:e,tag:e}))),this.$el.val(this.val()),!t&&this.$el.change(),this._canAdd(),this)},$:function(e){return this.$wrapper.find(e)},val:function(){var e="";return this._tags.forEach(function(t){e=e+(e?", ":"")+t}),e}}),n.exports=b},"tags-bar/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../core"),o=e("../tags-droplist"),u=e("../popup-box"),a=e("../core/events"),f=function(e,t){t===undefined&&(t=!0),this._editMode=t,this._logged=s.config("logged"),e&&(this._container=this._createContainer()),this._editMode&&(this._dropList=this._createDropList(),this._container&&(this._tagMenu=this._createMenu()),this._container&&this._updateAddButton()),this._container&&e&&r(e).html("").append(this._container)};i.extend(f.prototype,a),i.extend(f.prototype,{_container:null,_addButton:null,_moreButton:null,_tmpSpan:null,_dropList:null,_currentInput:null,_currentElem:null,_editMode:!1,_tagMenu:null,_currentMenuElement:null,_subscribedTags:null,_ignoredTags:null,_skipNextCloseEvent:!1,_tagMenuBusy:!1,_logged:!1,addNewTag:function(){if(!this._editMode)return this;var e=this,t=20,n=null;if(this._container.find("div.tb-tag-complete").length>8)return this;var s=r("<div>").addClass("tb-tag").append(n=r("<input>").attr("placeholder","тег...").attr("autocomplete","off").attr("maxlength","30").on("keyup keydown keypress blur change focus paste",function(){var n=Math.max(100,e._calcTextWidth(this.value)+t);r(this).css("width",String(n)+"px")}).on("focus",function(e){r(this).parent().addClass("tb-selected")}).on("blur",function(){r(this).parent().removeClass("tb-selected")})).append(r("<div>").attr("title","Удалить тег").addClass("i-sprite_tags-bar_close").on("click",function(){r(s).remove(),e._currentInput=null,e._currentElem=null,e._updateAddButton()}));return this._dropList.assign(n,s),this._currentInput=n,this._currentElem=s,this._addButton.before(s),i.defer(function(){n.focus()}),this._updateAddButton(),this},clear:function(){return this._container.find("div.tb-tag-complete").remove(),this._container.find("div.tb-tag").remove(),this._updateAddButton(),this},getTags:function(){var e=[];return this._container.find("div.tb-tag-complete").each(function(){e.push(this.getAttribute("data-tag"))}),e},setTags:function(e){var t,n,r=0;for(var i=0,s=e.length;i<s;i++)t=String(e[i]),t!=""&&t.replace(/ /gi,"").length>0&&(t=t.replace(/^\s+/,"").replace(/\s+$/,""),n=this._createTagElem(t,e.length==1),++r>6&&n.hide(),this._editMode?this._addButton.before(n):this._moreButton.before(n));return this._editMode?this._updateAddButton():(this._moreButton.attr("data-state","0"),this._updateMoreButton()),this},_completeTag:function(){if(!this._currentElem)return;var e=this._createTagElem(this._currentInput.val(),!1);this._currentElem.replaceWith(e),this._currentInput=null,this._currentElem=null,this.trigger("change"),this._updateAddButton()},_createTagElem:function(e,t){var n=this,i=r('<table>   <tr>       <td class="tb-tag-brd-left"></td>       <td class="tb-tag-name"></td>'+(this._editMode?'<td class="tb-tag-btn"><div class="i-sprite_tags-bar_arrow"></div></td>':"")+'       <td class="tb-tag-brd-right"></td>'+"   </tr>"+"</table>");this._editMode?i.find("td.tb-tag-name").append(r("<"+(t?"H1":"H2")+">").text(e)):i.find("td.tb-tag-name").append(r("<a>").text(e).attr("href","/tag/"+encodeURIComponent(e)+"/hot"));var s=r("<div>").addClass("tb-tag-complete").attr("data-tag",e).append(i);return this._editMode?(this._dropList.hide(),s.click(function(){n._currentMenuElement==s&&n._tagMenu.isShown()?(n._currentMenuElement=null,n._tagMenu.hide()):n._showMenu(s)})):s.addClass("tb-readonly"),s},_createContainer:function(){var e=r("<div>").addClass("tags-bar");return this._editMode?e.append(this._tmpSpan=this._createTempSpan()).append(this._addButton=this._createAddButton()):e.append(this._moreButton=this._createMoreButton()),e},_createAddButton:function(){return r("<a>").text("добавить тег").addClass("tb-add-btn").on("click",i.bind(this.addNewTag,this))},_createMoreButton:function(){var e=this;return r("<a>").text("...").attr("data-state","0").addClass("tb-more-btn").on("click",function(){if(r(this).hasClass("tb-inactive"))return;var t=this.getAttribute("data-state");t=="0"?t="1":t="0";var n=e._container.find("div.tb-tag-complete");for(var i=6,s=n.length;i<s;i++)t=="1"?r(n[i]).show():r(n[i]).hide();this.setAttribute("data-state",t),e._updateMoreButton()})},_updateAddButton:function(){if(!this._editMode)return;this._container.find("div.tb-tag").length>0||this._container.find("div.tb-tag-complete").length>8?this._addButton.css("display","none"):this._addButton.css("display","inline-block")},_updateMoreButton:function(){if(this._editMode)return;var e=this._container.find("div.tb-tag-complete").length,t,n=this._moreButton.attr("data-state");if(n=="0"){t=String(e);var r="";switch(t.substr(-1)){case"1":e=="11"?r="тегов":r="тег";break;case"2":case"3":case"4":t=="12"||t=="13"||t=="14"?r="тегов":r="тега";break;default:r="тегов"}this._moreButton.text(t+" "+r),e<6?this._moreButton.addClass("tb-inactive"):this._moreButton.removeClass("tb-inactive")}else this._moreButton.text("свернуть")},_createDropList:function(){var e=new o,t=this;return e.addListener("requested_next",function(){t.addNewTag()}),e.addListener("select",function(){t._completeTag()}),e},_createMenu:function(){var e=this,t=r("<div>").addClass("tags-bar-menu").html('<div data-type="del">убрать</div>'+this._getPreloaderHTML()+'<div style="display: none" data-type="subs+">подписаться</div>'+'<div style="display: none" data-type="subs-">отписаться</div>'+'<div style="display: none" data-type="ignore+">в игнор-лист</div>'+'<div style="display: none" data-type="ignore-">удалить из игнор-листа</div>'),n=(new u).setAlignment("end").setDirection("bottom").setDistance(0).showArrow(!1).useRoundBorders(!1).setInnerIndent(2).append(t);return this._logged||(this._ignoredTags={},this._subscribedTags={}),t.find("div").click(function(){var t=n.getContent().attr("data-tag"),i=this.getAttribute("data-type");switch(i){case"del":r(e._currentMenuElement).remove(),e._updateAddButton(),e.trigger("change");break;case"ignore-":case"ignore+":case"subs-":case"subs+":if(!e._logged){show_reg_msg();return}if(!t||!e._currentMenuElement)return;e._tagMenuBusy=!0,e._showMenu(e._currentMenuElement);var s="",o=e._currentMenuElement;i=="ignore+"?(e._ignoredTags[t.toLowerCase()]=1,s="Добавлен в игнор-лист"):i=="ignore-"&&(delete e._ignoredTags[t.toLowerCase()],s="Удален из игнор-листа"),i=="subs+"?(e._subscribedTags[t.toLowerCase()]=1,s="Подписка добавлена"):i=="subs-"&&(delete e._subscribedTags[t.toLowerCase()],s="Подписка удалена"),r.post("/ajax/tags_actions.php?action="+encodeURIComponent(i),{value:t},function(t){e._tagMenuBusy=!1,e._dropList.hide(),t.result?(new u).setInnerIndent(15).append(s).setTimeout(2e3).setDirection("top").setDistance(10).show(o):(new u).setColorScheme("red").setInnerIndent(15).append(t.message).setTimeout(2e3).setDirection("top").setDistance(10).show(o)},"json").error(function(){(new u).setColorScheme("red").setInnerIndent(15).setTimeout(2e3).append("Нет связи с космосом, шеф!").setDirection("top").setDistance(10).show(o),e._tagMenuBusy=!1,e._dropList.hide()})}n.hide()}),n},_getPreloaderHTML:function(){return'<div class="tb-preloader">   <svg width="40" height="4">       <circle cx="2" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" repeatCount="indefinite" />       </circle>       <circle cx="10" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" begin="0.2s" repeatCount="indefinite" />       </circle>       <circle cx="18" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" begin="0.2s" repeatCount="indefinite" />       </circle>   </svg></div>'},_showMenu:function(e){this._currentMenuElement=e;var t=this._tagMenu.getContent(),n=this;if(this._tagMenuBusy)t.find("div.tb-preloader").show(),t.find('div[data-type^="subs"], div[data-type^="ignore"]').hide();else if(this._ignoredTags===null)t.find("div.tb-preloader").show(),this._tagMenuBusy=!0,r.get("/ajax/tags_actions.php?action=info",{},function(t){n._tagMenuBusy=!1;if(t.result){var r,i,s,o={},u={};r=t.data.subs;for(i=0,s=r.length;i<s;i++)u[r[i].toLowerCase()]=1;r=t.data.ignore;for(i=0,s=r.length;i<s;i++)o[r[i].toLowerCase()]=1;n._ignoredTags=o,n._subscribedTags=u,n._tagMenu.isShown()&&n._showMenu(e)}else n._tagMenu.hide()},"json").error(function(){n._tagMenuBusy=!1,n._tagMenu.hide()});else{var i=r(e).attr("data-tag");t.attr("data-tag",i),t.find("div.tb-preloader").hide(),i=i.toLowerCase(),this._subscribedTags[i]?(t.find('div[data-type="subs+"]').hide(),t.find('div[data-type="subs-"]').show()):(t.find('div[data-type="subs+"]').show(),t.find('div[data-type="subs-"]').hide()),this._ignoredTags[i]?(t.find('div[data-type="ignore+"]').hide(),t.find('div[data-type="ignore-"]').show()):(t.find('div[data-type="ignore+"]').show(),t.find('div[data-type="ignore-"]').hide())}this._tagMenu.show(e)},_createTempSpan:function(){return r("<span>").addClass("tb-tmp-span")},_calcTextWidth:function(e){var t=this._tmpSpan.text(e).show().width();return this._tmpSpan.text("").hide(),t}}),n.exports=f},"tags-droplist/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../core/events"),u=function(){this._tagsCache={},this._tagsCacheInverted={},this._loadTagsStack={},this._onEventHandlerBound=i.bind(this._onEventHandler,this),this._create()};i.extend(u.prototype,o),i.extend(u.prototype,{_dropList:null,_dropListCont:null,_tagsCache:null,_tagsCacheInverted:null,_loadTagsTimer:null,_loadTagsStack:null,_currentInput:null,_currentInputCont:null,_hintBox:null,_onEventHandlerBound:null,_lastCompletedTag:"",_lastSearchTag:"",_required:!0,assign:function(e,t){var n;return this._lastCompletedTag="",this._currentInput&&this._currentInput.off("keydown keypress keyup blur focus",this._onEventHandlerBound),e&&(n=this._currentInput=r(e),this._currentInputCont=t,n.attr("autocomplete","off"),n.on("keydown keypress keyup blur focus",this._onEventHandlerBound)),this},setRequireValueMode:function(e){return this._required=e===!0,this},_onEventHandler:function(e){switch(e.type){case"keydown":e.which==38?(this._dropListSelectOption(-1),e.preventDefault()):e.which==40&&(this._dropListSelectOption(1),e.preventDefault());break;case"keypress":this._required&&String.fromCharCode(e.charCode||e.keyCode||e["char"])==","&&(e.preventDefault(),this._checkOnComplete()&&this.trigger("requested_next"));break;case"keyup":if(e.which!=38&&e.which!=40)if(e.which==13)if(this._required)this._checkOnComplete();else{var t=this._currentInput.attr("data-tag-option");t&&(this._checkOnComplete(),e.preventDefault())}else this._updateInputElement();break;case"blur":this._required&&!this._dropList.isPointerOverBox()&&this._checkOnComplete();break;case"focus":this._hintBox&&this._hintBox.hide()}},hide:function(){return this._dropList.hide(),this},_create:function(){var e=this._dropListCont=r("<div>").addClass("tags-drop-list"),t=this;e.append(this._getPreloaderHTML());for(var n=0;n<8;n++)e.append('<div class="tdl-option"><div>...</div><div>0</div></div>');var i=this._dropList=(new s).setAlignment("start").setDirection("bottom").setDistance(0).showArrow(!1).useRoundBorders(!1).setInnerIndent(2).append(e);i.addListener("close",function(){if(!t._skipNextCloseEvent){if(this._currentInput&&this._currentInput.closest("html").length==0)return;this._required&&t._checkOnComplete()}else t._skipNextCloseEvent=!1})},_getPreloaderHTML:function(){return'<div class="tdl-preloader">   <svg width="40" height="4">       <circle cx="2" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" repeatCount="indefinite" />       </circle>       <circle cx="10" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" begin="0.2s" repeatCount="indefinite" />       </circle>       <circle cx="18" cy="2" r="2" fill="#ffffff" stroke="none">           <animate attributeName="fill" calcMode="paced" from="#eaeaea" to="#ffffff" dur="0.6s" begin="0.2s" repeatCount="indefinite" />       </circle>   </svg></div>'},_dropListSelectOption:function(e){if(!this._dropList.isShown())return;var t=this._currentInput[0],n,i=-1,s=this._dropListCont.find(".tdl-option:visible"),o=s.length,u=0;for(var a=0;a<o;a++)if(r(s[a]).hasClass("tdl-selected")){n=r(s[a]),i=a;break}n?u=i+e:u=-1+e,u>o-1?u=o-1:u<-1&&(u=-1),n&&u!=i&&n.removeClass("tdl-selected"),u>-1?(r(s[u]).addClass("tdl-selected"),t.value=s[u].getAttribute("data-tag"),this._required||t.setAttribute("data-tag-option",t.value)):(t.value=t.getAttribute("data-saved-text"),t.setSelectionRange!==undefined&&t.setSelectionRange(t.value.length,t.value.length),this._required||t.removeAttribute("data-tag-option"))},_onSelectTag:function(e){this._skipNextCloseEvent=!0,this._dropList.hide(),this._currentInput.val(e).blur(),this._required||this._checkOnComplete()},_checkOnComplete:function(){var e=this._getEnteredTag();if(e=="")return!1;if(this._tagsCacheInverted[e])return this._lastCompletedTag===e?!0:(this._lastCompletedTag=e,this.trigger("select",e),!0);var t=this;return this._lastCompletedTag="",this._loadTagsStack[e]||(this._required&&i.delay(function(){t._hintBox&&t._hintBox.hide(),t._hintBox=(new s).append("Укажите существующий тег").setTimeout(2e3).setDirection("top").setAlignment("center").setColorScheme("black").show(t._currentInput)},100),this._dropList.hide()),!1},_getEnteredTag:function(){if(!this._currentInput[0].parentNode)return"";var e=this._currentInput.val().toLowerCase();return e==""||e.replace(/ /gi,"").length==0?"":e},_updateInputElement:function(){if(!this._currentInput)return;this._currentInput.attr("data-saved-text",this._currentInput.val());var e=this._getEnteredTag(),t,n=this;if(e==""){this._dropList.hide();return}var s=4;this._currentInputCont?this._dropListCont.css("min-width",this._currentInputCont.outerWidth()-s):this._dropListCont.css("min-width",this._currentInput.outerWidth()-s);if(this._tagsCache[e]!==undefined){t=this._tagsCache[e],this._dropListCont.find("div.tdl-preloader").css("visibility","hidden");var o=this._dropListCont.find("div.tdl-option");o.removeClass("tdl-selected");var u=t.length,a,f,l,c,h;for(var p=0,d=o.length;p<d;p++)a=o[p],p<u?(f=t[p][0],l=f.toLowerCase().indexOf(e),a.style.display="none",a.setAttribute("data-tag",f),c=a.firstChild,c.innerHTML="",l>-1?(l>0&&c.appendChild(document.createTextNode(f.substr(0,l))),h=document.createElement("span"),h.appendChild(document.createTextNode(f.substr(l,e.length))),c.appendChild(h),l+e.length<f.length&&c.appendChild(document.createTextNode(f.substr(l+e.length)))):c.appendChild(document.createTextNode(f)),c=a.lastChild,c.innerHTML=String(Number(t[p][1])),a.style.display="block",a.onclick=i.bind(this._onSelectTag,this,f)):a.style.display="none";if(t.length==0&&document.activeElement!=this._currentInput[0]){this._checkOnComplete();return}this._dropList.allowAutoHide(!0),this._dropList.show(this._currentInputCont?this._currentInputCont:this._currentInput)}else{if(this._loadTagsStack[e]==2)return;this._loadTagsTimer&&clearTimeout(this._loadTagsTimer);if(e.length>4&&this._lastSearchTag!=""&&this._tagsCache[this._lastSearchTag]&&this._tagsCache[this._lastSearchTag].length==0&&e.indexOf(this._lastSearchTag)===0){this._dropListCont.find("div.tdl-preloader").css("visibility","hidden");return}this._dropListCont.find("div.tdl-preloader").css("visibility",""),this._dropList.allowAutoHide(!1),n._loadTagsStack[e]=1,this._loadTagsTimer=setTimeout(function(){n._loadTagsStack[e]=2,n._lastSearchTag=e,r.post("/ajax/tags_actions.php?action=droplist",{value:e},function(t){if(t.result){n._currentInput&&e==n._currentInput.val().toLowerCase&&(n._loadTagsTimer=null),n._tagsCache[e]=t.data;for(var r=0,i=t.data.length;r<i;r++)n._tagsCacheInverted[t.data[r][0].toLocaleLowerCase()]=!0;delete n._loadTagsStack[e],n._updateInputElement()}},"json")},300),this._dropList.show(this._currentInputCont?this._currentInputCont:this._currentInput)}}}),n.exports=u},"tags-search/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("../popup-box"),o=e("../wm"),u=e("../core/layout"),a=e("../core/location"),f=u.extend({_lastSearchText:"",show:function(){this._rendered||(this.render(),this._rendered=!0)},render:function(){var e=this;this._lastSearchText=r("#ts_text").val(),r("#ts-form").on("submit",function(t){t.preventDefault(),e.submit()}).on("reset",function(t){t.preventDefault(),r("#ts_text").val(""),e.submit()})},submit:function(){var e=r("#ts_text"),t=e.val().replace(/^\s+/,"").replace(/\s+$/,"");if(this._lastSearchText==t)return this;this._lastSearchText=t;var n=[],i="Поиск",o,u=this,f;if(t.length>0){if(t.length<2)return e.blur(),(new s).showMessage(e,"Пожалуйста, введите минимум 2 символа для поиска","warning"),this;n.push("q="+encodeURIComponent(t)),i=t+" - Поиск";var l=n.join("&");if(l=="")return this;o="?"+l}else o="?q=";return i=i.replace(/[<>&]/gi,""),f=a.replaceState({},i,o,!0),document.title=i,f?(r("div.b-tag-search-preloader").show(),r("div.b-tag-search-result").hide(),r.get(o,{ajax_mode:"1"},function(e){e.result&&(r("div.b-tag-search-result").html(e.data.html).show(),r("div.b-tag-search-preloader").hide())},"json")):window.location.href=o,this}}),l=new f;n.exports=o.add({name:"tag_list.php",layout:l})},"users/list":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("../core/log"),u=e("../core/request"),a={},f={avatar:"//cs.pikabu.ru/images/avatars_n/297/l297508.jpg?-544750586",avatar_rnd:"-544750586",id:297508,name:"moderator"},l=i.debounce(function(e,t,n){if(a[e])return t(a[e]);u("/ajax/users_actions.php",{type:"POST",data:{action:"droplist",q:e}}).done(function(r){a[e]=r.result?r.data||[]:[],n&&(a[e]=[f].concat(a[e].slice(0,6))),t(a[e])})},300);e("jquery-textcomplete"),n.exports=function(e,t,n){var i=r(e)}},"video/index":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/util"),l=e("../core/events"),c=e("store"),h=e("../core/request"),p=0,d=e("./provider").VideoProvider,v={youtube:e("./providers/youtube"),coub:e("./providers/coub"),vimeo:e("./providers/vimeo"),rutube:e("./providers/rutube"),liveleak:e("./providers/liveleak")},m=[],g,y,b=function(){g&&i.isFunction(g.toggle)&&g!==this&&g.toggle(!1),this instanceof d?(g=this,y=this):(g=!1,y=this),S.emit("current",y)},w=function(){y=this instanceof d?this:!1,S.emit("current",y)},E=function(e){var t,n,r;if(m[e.data("video-id")])return m[e.data("video-id")];t=p++,e.data("video-id",t),n=f.urlParser(e.data("url"));switch(n.host){case"player.vimeo.com":r="vimeo";break;case"coub.com":r="coub";break;case"www.rutube.ru":case"rutube.ru":r="rutube";break;case"www.liveleak.com":r="liveleak";break;case"www.youtube.com":case"youtube.com":case"youtu.be":default:r="youtube"}return r&&(m[t]=new v[r].Provider(t,e),m[t].on("init",b),m[t].on("mouseenter",w)),e.data("video",m[t]),m[t]},S=i.extend({init:function(){return r(".b-video").each(function(e,t){E(r(t))})},players:m,current:function(e){w.apply(e)},stop:function(){b()}},l);n.exports=S},"video/provider":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../core"),a=e("../core/log"),f=e("../core/util"),l=e("../core/events"),c=e("store"),h=e("../core/request"),p=r(".content_container:first"),d=p.width(),v=d*.5625,m={loading:"loading",waiting:"waiting",playing:"playing",advert:"advert"},g=e("screenfull"),y=function(t,n){var s=this;this.$el=n,this.options={play:!1,id:t,idPlayer:"player_"+t,uri:f.urlParser(n.data("url")),url:n.data("url"),autoplay:n.data("ratio")>0?!0:!n.data("authors"),ratio:n.data("ratio")||1.777777777777778,width:d,height:v,thumb:n.data("thumb"),duration:n.data("duration")||0,original:Boolean(n.data("original")),callback:Boolean(n.data("callback"))},this.changeSize(),u.on("window:resize:width",i.bind(this.changeSize,this)),this.$els={logo:this.$(".b-video__logo"),preview:this.$(".b-video__preview"),player:this.$(".b-video__player"),duration:this.$(".b-video__duration").text(f.getDurationTime(this.options.duration))},this.$els.player.css("background-image",this.$els.preview.css("background-image")),i.each(m,function(e){s.$els[e]=s.$(".b-video__state_"+e+"_yes")}),this.$els.advertPanel=r(document.createElement("div")).addClass("b-video__advert").appendTo(this.$el),this._toggle=i.bind(this.toggle,this),this.$els.preview.bind({click:this._toggle}),this.$el.mouseenter(function(){s.emit("mouseenter")}),this.on("init",function(){s._firstStart||(s._firstStart=!0,e("../core/metrika").goal("video_start"))})};i.extend(y.prototype,l,{_playing:!1,state:m.loading,_shown:!1,_ready:!1,_firstStart:!1,_firstEnd:!1,$:function(e){return this.$el.find(e)},changeSize:function(){var e=p.width(),t=e/this.options.ratio;this.$el.css("height",t+"px"),this.$el.css("width",e+"px")},toggle:function(e){return e&&e.preventDefault&&e.preventDefault(),i.isBoolean(e)&&e===this._shown?this:(this._shown=i.isBoolean(e)?e:!this._shown,!this._shown&&this._ready?(this.setState(m.waiting),this.clear()._ready=!1,this):(this._shown&&!this._ready&&(this.emit("init"),this._ready=!0,this.init()),this))},setState:function(e){var t=this;return e===this.state||this.options.original?this:(i.each(["hide","show"],function(n){var r=!0;if(t.state===m.waiting&&!t.options.duration||t.state===m.playing)r=!1;t.$els[t.state].attr("style","").toggle(r).removeClass("b-video__state_show_no b-video__state_show_yes").addClass(n==="hide"?"b-video__state_show_no":"b-video__state_show_yes"),t.state===m.loading&&n==="show"&&t.setLoading(),t.state===m.loading&&n==="hide"&&t.$els[t.state].find("i").removeClass("fa-spin"),n==="show"&&(t.$els.preview.toggleClass("b-video__preview_show_yes",e===m.waiting),t.$els.player.toggleClass("b-video__player_show_yes",e===m.loading||e===m.playing),t.$els.advertPanel.toggleClass("b-video__advert_show_yes",e===m.advert)),t.state=e}),this.emit("state",e),this)},setLoading:function(){return this.$els.loading.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),this.$els._loading&&this.$els._loading.empty().remove(),delete this.$els._loading,this},showAdvert:function(){return this.advertCanPlay=!0,this._firstEnd||(this._firstEnd=!0,e("../core/metrika").goal("video_end")),g.isFullscreen?this:this},addFrame:function(e){return r(document.createElement("iframe")).attr("id",this.options.idPlayer).attr("src",e).attr("width","100%").attr("height","100%").attr("frameborder","0").attr("webkitallowfullscreen",!0).attr("mozallowfullscreen",!0).attr("allowfullscreen",!0)},clear:function(){try{this.advert&&this.advert.destroy(),delete this.advert}catch(e){a.error(":advert:",e)}return this._playing=!1,this}}),y.extend=f.extend,n.exports={VideoProvider:y,eState:m}},"video/providers/coub":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/request"),l=e("../../core/util"),c=e("../../core/template"),h=e("../provider").VideoProvider,p=e("../provider").eState,d=e("../../core/events"),v=e("../../core/post-message"),m=i.extend({},d),g=e("../../gifx/technologies").flash(),y=6e4,b={original:"original",flash:"flash"};v.on("http://coub.com",function(e){e.data==="playStarted"&&m.emit("playStarted",e.source),e.data==="playPaused"&&m.emit("playPaused",e.source)},"http://coub.com");var w=h.extend({constructor:function(){w.__super__.constructor.apply(this,arguments),this.setState(p.waiting),this._coubPlayBind=i.bind(this._coubPlay,this),this._coubPauseBind=i.bind(this._coubPause,this),this.type=b.original,this.$els.logo.addClass("i-sprite--video__coub")},init:function(){return this.type===b.original?(this._initOriginal(),this.setState(p.loading)):(r(c(e("../templates/coub.html"))(this)).appendTo(this.$els.player),this.setState(p.playing)),this},_coubPlay:function(e){var t=this;if(e!==this.$els.frame[0].contentWindow)return!1;this._closeTimeout&&clearTimeout(this._closeTimeout),this._advertComplete||(this._startTime=i.now(),this._interval=setInterval(function(){i.now()-t._startTime>y&&(clearInterval(t._interval),t.once("advert-complete",function(){t._advertComplete=!0,v.send("play","http://coub.com",t.$els.frame[0].contentWindow)}),t.once("advert-waiting",function(){v.send("stop","http://coub.com",t.$els.frame[0].contentWindow)}),t.showAdvert())},1e3)),this.setState(p.playing)},_coubPause:function(e){var t=this;if(e!==this.$els.frame[0].contentWindow)return!1;this._interval&&clearInterval(this._interval),this._closeTimeout&&clearTimeout(this._closeTimeout),this._closeTimeout=setTimeout(function(){t.toggle(!1)},2500)},_initOriginal:function(){var e=this.options.url+"?"+r.param({muted:!1,autostart:this.options.autoplay,originalSize:!1,hideTopBar:!0});m.on("playStarted",this._coubPlayBind),m.on("playPaused",this._coubPauseBind),this.$els.frame=this.addFrame(e).appendTo(this.$els.player)},clear:function(){return w.__super__.clear.apply(this),this.type===b.original&&(m.off("playStarted",this._coubPlayBind),m.off("playPaused",this._coubPauseBind),this.$els.frame.hide().remove()),this.$els.player.empty(),this}});n.exports={Provider:w}},"video/providers/liveleak":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/request"),l=e("../../core/util"),c=e("../../core/template"),h=e("../provider").VideoProvider,p=e("../provider").eState,d=h.extend({constructor:function(){d.__super__.constructor.apply(this,arguments),this.setState(p.waiting),this.$els.logo.addClass("i-sprite--video__liveleak")},init:function(){var e=this.options.url+"?"+r.param({autostart:this.options.autoplay});return this.$els.frame=this.addFrame(e).appendTo(this.$els.player),this.setState(p.playing),this},clear:function(){return d.__super__.clear.apply(this),this.$els.frame.hide().remove(),this}});n.exports={Provider:d}},"video/providers/rutube":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/request"),l=e("../../core/util"),c=e("../../core/template"),h=e("../provider").VideoProvider,p=e("../provider").eState,d=e("../../core/events"),v=i.extend({},d),m=e("../../core/post-message");m.on("http://rutube.ru",function(e){var t;t=JSON.parse(e.data),window.focus(),t.type==="player:changeState"&&t.data.state==="playing"?v.emit("play",e.source):t.type==="player:ready"&&v.emit("ready",e.source)});var g=h.extend({constructor:function(){g.__super__.constructor.apply(this,arguments),this.setState(p.waiting),this._rutubePlayBind=i.bind(this._rutubePlay,this),this._rutubeReadyBind=i.bind(this._rutubeReady,this),this.$els.logo.addClass("i-sprite--video__rutube")},_rutubeReady:function(e){var t=this;if(e!==this.$els.frame[0].contentWindow)return!1;this.options.autoplay||setTimeout(function(){m.send(JSON.stringify({type:"player:play"}),"http://rutube.ru",t.$els.frame[0].contentWindow)},1e3)},_rutubePlay:function(e){if(e!==this.$els.frame[0].contentWindow)return!1;this.setState(p.playing)},init:function(){var e=this.options.url+"?"+r.param({autostart:this.options.autoplay,sTitle:!1,sAuthor:!1});return this.$els.frame=this.addFrame(e).appendTo(this.$els.player),v.on("play",this._rutubePlayBind),v.on("ready",this._rutubeReadyBind),this.setState(p.loading),this},clear:function(){return g.__super__.clear.apply(this),v.off("play",this._rutubePlayBind),v.off("ready",this._rutubeReadyBind),this.$els.frame.hide().remove(),this}});n.exports={Provider:g}},"video/providers/vimeo":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/request"),l=e("../../core/util"),c=e("../../core/template"),h=e("../provider").VideoProvider,p=e("../provider").eState,d=e("froogaloop"),v=h.extend({constructor:function(){v.__super__.constructor.apply(this,arguments),this.setState(p.waiting),this._readyBind=i.bind(this.ready,this),this._checkTimeBind=i.bind(this._checkTime,this),this.$els.logo.addClass("i-sprite--video__vimeo")},_checkTime:function(e){return!this.advert&&Number(e.seconds)>=Number(e.duration)-15&&this.prepareAdvert(),this},init:function(){var e=this.options.url+"?"+r.param({api:1,autoplay:this.options.autoplay?1:0,autohide:1,wmode:"opaque",showinfo:0,fs:1,player_id:this.options.idPlayer});return this.$els.frame=this.addFrame(e).appendTo(this.$els.player),this.player=d(this.$els.frame[0]),this.player.addEvent("ready",this._readyBind),this.setState(p.loading),this},ready:function(){var e=this;return this.player.api("getDuration",function(t){e.duration=Number(t)}),this.player.addEvent("play",function(){e.state!==p.playing&&e.setState(p.playing)}),this.player.addEvent("finish",function(){e.showAdvert()}),this.player.addEvent("playProgress",this._checkTimeBind),this.options.autoplay||this.player.api("play"),this},clear:function(){return v.__super__.clear.apply(this),this.player.removeEvent("ready"),this.player.removeEvent("play"),this.player.removeEvent("finish"),this.player.api("unload"),this.$els.frame.hide().remove(),this}});n.exports={Provider:v}},"video/providers/youtube":function(e,t,n){var r=e("jquery"),i=e("underscore"),s=e("backbone"),o=e("momentjs"),u=e("../../core"),a=e("../../core/log"),f=e("../../core/request"),l=e("../../core/util"),c=e("../../core/events"),h=e("../../core/post-message"),p=e("../provider").VideoProvider,d=e("../provider").eState,v=[],m=!1,g=!1,y=r.Deferred();h.on("https://www.youtube.com",function(e){var t=JSON.parse(e.data);if(t.event==="infoDelivery"||t.event==="onStateChange"&&t.info===-1||t.event==="apiInfoDelivery")return!1;window.focus()});var b=function(){if(m)return!0;m=!0,y.resolve(window.YT),i.each(v,function(e){e.providerReady()}),v=[]};u.global("onYouTubeIframeAPIReady",b,!0);var w=i.extend({},c);u.global("YTAdvert",w);var E=function(e){if(m||window.YT)return m=!0,e&&e.providerReady();e&&v.push(e);if(g)return!1;g=!0,r.getScript("//www.youtube.com/iframe_api",function(){window.YT&&window.YT.ready(b)})},S=p.extend({constructor:function(){var e=this;S.__super__.constructor.apply(this,arguments),setTimeout(function(){E(e)},30),this._readyBind=i.bind(this._readyYouTube,this),this._stateChangeBind=i.bind(this._stateChange,this),this.$els.logo.addClass("i-sprite--video__youtube")},init:function(){return this.options.original?this.$els.player.find("iframe").attr("id",this.options.idPlayer):r("<div></div>").attr("id",this.options.idPlayer).appendTo(this.$els.player),this.setState(d.loading),new YT.Player(this.options.idPlayer,{width:"100%",height:"100%",videoId:i.last(this.options.url.split("/")),events:{onReady:this._readyBind,onStateChange:this._stateChangeBind},playerVars:{rel:0,showinfo:"0",fs:"1",autoplay:String(this.options.autoplay?1:0)}}),this},_setUpdateTime:function(){var e=this;return this._interval=setInterval(function(){e.player.getCurrentTime()>=e.duration-15&&(e.prepareAdvert(),e._removeUpdateTime())},1e3),this},_removeUpdateTime:function(){return this._interval&&clearInterval(this._interval),this},_readyYouTube:function(e){this.$els.frame=this.$els.player.find("iframe"),this.player=e.target,this.options.callback&&this.on("play",i.bind(w.emit,w,"play")),this.duration=this.player.getDuration(),this.options.autoplay||this.player.playVideo()},_stateChange:function(e){if(!e||i.isUndefined(e.data))return this;e.data===1&&!this._playing?(a.info(":video-youtube:","play",this),this._playing=!0,this.setState(d.playing),this._setUpdateTime(),this.emit("play",this)):e.data===2?(this._removeUpdateTime(),this.emit("pause",this)):e.data===0&&(a.info(":video-youtube:","stop",this),this._removeUpdateTime(),this.showAdvert(),this.emit("stop",this))},providerReady:function(){return this.options.original&&this.init(),this.setState(d.waiting),this},clear:function(){return S.__super__.clear.apply(this),this.player.destroy(),this.$els.player.empty(),this}});n.exports={Provider:S}},"wm/index":function(e,t,n){var r=e("../core"),i=e("../core/log"),s=e("../core/util"),o=e("../core/layout"),u=e("../core/hotkeys"),a={up:"up",down:"down"},f=o.extend({_positionButtonShown:!1,_positionButtonDirection:a.up,_positionButtonCurrent:0,render:function(){return this.$el=$("body"),this.$els={positionButton:$(e("./templates/toggleButton.html")).appendTo(this.$el).click(_.bind(this.togglePositionButton,this)).hide()},this.$els.positionButtonUp=this.$els.positionButton.find(".b-position-button__up"),this.$els.positionButtonDown=this.$els.positionButton.find(".b-position-button__down"),r.on("document:scroll",_.bind(this.scroll,this)),r.on("window:resize",_.bind(this.resizePositionButton,this)),this.resizePositionButton(),r.config("scrollToTop")||this.disablePositionButton(),this},disablePositionButton:function(){this.$els.positionButton=$(document.createElement("div"))},scroll:function(e){return e>80&&!this._positionButtonShown&&(this._positionButtonShown=!0,this.$els.positionButton.fadeIn()),e<80&&this._positionButtonShown&&this._positionButtonCurrent===0&&(this._positionButtonShown=!1,this.$els.positionButton.fadeOut()),this},resizePositionButton:function(e){return e=e>1600?48:e>1400?36:e>1100?24:18,this.$els.positionButton.css("width",e),this},togglePositionButton:function(){var e=0;this._positionButtonDirection=this._positionButtonDirection===a.down?a.up:a.down,this.$els.positionButtonUp.toggle(this._positionButtonDirection===a.up),this.$els.positionButtonDown.toggle(this._positionButtonDirection===a.down),this._positionButtonDirection===a.down?this._positionButtonCurrent=$(document).scrollTop():e=this._positionButtonCurrent,$("html, body").animate({scrollTop:e},200)}}),l=r.add({name:"wm",layout:f});n.exports=l},"comments/templates/hidden-group.html":'<div class="comments__hidden-group" style="display: none"></div>\r\n<div class="comments-toggle">Еще комментарии</div>\r\n',"comments/templates/reply.html":'<div class="comment_new_form">\r\n	<form>\r\n		<textarea rows="1" class="form_input text flex_input" placeholder="<%= data.id === 0 ? \'Написать комментарий\' : \'Написать ответ\' %>"></textarea>\r\n		<ul class="comment_new_form_thumb_box">\r\n\r\n		</ul>\r\n		<div class="comment_new_form_action">\r\n			<span class="comment_new_form_close close_control control hidden">&nbsp;</span>\r\n			<button type="submit" class="comment_new_form_send button boldlabel active">Отправить</button>\r\n			<% if (data.isUserModerator) { %>\r\n			<div class="comment_new_form__moderator i-sprite--comments__moderator" title="Добавить комментарий от лица модератора"></div>\r\n			<% } %>\r\n			<% if (data.accessImage) { %>\r\n			<span class="comment_new_form_upload">\r\n				<input class="comment-reply__input-files" type="file" accept="image/*" multiple="multiple">\r\n			</span>\r\n			<% } %>\r\n		</div>\r\n	</form>\r\n</div>\r\n',"comments/templates/signin.html":'<div class="comments__need-signin">\r\n	<p class="comments__do-signin">Войти или зарегистрироваться</p>\r\n	<p>чтобы оставить комментарий</p>\r\n</div>\r\n',"compare/templates/index.html":'<div class="b-compare__progress">\r\n	<div class="b-compare__progress-bar"></div>\r\n	<div class="b-compare__progress-message"><i class="fa fa-spin fa-refresh"></i> <span>Поиск дубликатов</span></div>\r\n</div>\r\n<div class="b-compare__empty"><i class="i-sprite--compare__not-found"></i> Похожих постов не найдено</div>\r\n<div class="b-compare__main">\r\n	<div class="b-compare__content">\r\n		<% if (!data.existStory) { %>\r\n		<div class="b-compare__bottom">Пожалуйста, не добавляйте пост, если он уже был на Пикабу</div>\r\n		<% } %>\r\n		<div class="b-compare__head">Возможные дубликаты</div>\r\n		<div class="b-compare__items"></div>\r\n		<div class="b-compare__controls">\r\n			<span class="b-compare__more">Ещё</span>\r\n		</div>\r\n	</div>\r\n</div>\r\n',"compare/templates/item-image.html":'\r\n<div class="b-compare-item__content-wrapper">\r\n	<span class="b-compare-item__relevance <%= data.relevance >= 80 ? \'b-compare-item__relevance_critical\' : \'\' %>"><%= data.relevance %>%</span>\r\n	<div class="b-compare-item__content">\r\n		<div class="b-compare-item__loading fa fa-circle-o-notch fa-spin"></div>\r\n		<a href="<%= data.story_url %>" target="_blank">\r\n			<% if (data.img_type === 3) { %>\r\n				<div class="b-compare-item__play i-sprite--gifx__play"></div>\r\n			<% } %>\r\n			<div class="b-compare-item__image" style="<%= data.style %>;background-size: cover;"></div>\r\n		</a>\r\n	</div>\r\n</div>\r\n',"compare/templates/item-text.html":'<div class="b-compare-item__head">\r\n	<span class="b-compare-item__relevance <%= data.relevance >= 80 ? \'b-compare-item__relevance_critical\' : \'\' %>"><%= data.relevance %>%</span> <a target="_blank" href="<%= data.story_url %>" class="b-compare-item__title"><%= data.story_title %></a> <span class="b-compare-item__date" title="<%= data.time %>"><%= data.now %></span>\r\n</div>\r\n<div class="b-compare-item__content-wrapper">\r\n	<div class="b-compare-item__content">\r\n		<% if (data.text_before) { %>\r\n		<span class="b-compare-item__text-before"><%= data.text_before %></span><span class="b-compare-item__text-more">...</span>\r\n		<% } %>\r\n		<%= data.text %>\r\n		<% if (data.text_after) { %>\r\n		<span class="b-compare-item__text-before"><%= data.text_after %></span><span class="b-compare-item__text-more">...</span>\r\n		<% } %>\r\n	</div>\r\n</div>\r\n',"compare/templates/item-video.html":'<div class="b-compare-item__content-wrapper">\r\n	<span class="b-compare-item__relevance <%= data.relevance >= 80 ? \'b-compare-item__relevance_critical\' : \'\' %>"><%= data.relevance %>%</span>\r\n	<div class="b-compare-item__content">\r\n		<div class="b-compare-item__loading fa fa-circle-o-notch fa-spin"></div>\r\n		<a href="<%= data.story_url %>" target="_blank">\r\n			<div class="b-compare-item__play i-sprite--gifx__play"></div>\r\n			<div class="b-compare-item__video" style="<%= data.style %>;background-size: cover;"></div>\r\n		</a>\r\n	</div>\r\n</div>\r\n',"feed/templates/feed-menu-best.html":'<div class="ppb-menu">\n	<div class="ppb-radio">\n		<input name="fp_daterange_type" type="radio" value="today"><label>За сегодня</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="fp_daterange_type" type="radio" value="week"><label>За неделю</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="fp_daterange_type" type="radio" value="month"><label>За месяц</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="fp_daterange_type" type="radio" value="all"><label>За все время</label>\n	</div>\n	<hr>\n	<div class="ppb-option" data-role="date"><i class="fa fa-calendar"></i><label>Выбрать дату</label></div>\n	<div class="ppb-option" data-role="rnd_date"><i class="fa fa-random"></i><label>Случайная дата</label></div>\n</div>',"feed/templates/feed-menu-hot.html":'<div class="ppb-menu">\n	<div class="ppb-radio">\n		<input name="fp_sort_type" type="radio" value="0"><label>По актуальности</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="fp_sort_type" type="radio" value="1"><label>По времени</label>\n	</div>\n	<hr>\n	<div class="ppb-option" data-role="date"><i class="fa fa-calendar"></i><label>Выбрать дату</label></div>\n	<div class="ppb-option" data-role="rnd_date"><i class="fa fa-random"></i><label>Случайная дата</label></div>\n</div>',"feed/templates/feed-menu-new.html":'<div class="ppb-menu">\n	<div class="ppb-option" data-role="date"><i class="fa fa-calendar"></i><label>Выбрать дату</label></div>\n	<div class="ppb-option" data-role="rnd_date"><i class="fa fa-random"></i><label>Случайная дата</label></div>\n</div>',"feed/templates/feed-menu-subs-new.html":'<div class="ppb-menu">\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="1"><label>Пользователи</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="2"><label>Теги</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="4"><label>Сообщества</label>\n	</div>\n	<hr>\n	<div class="ppb-radio">\n		<input name="fp_subs_rating" type="radio" value="0"><label>С любым рейтингом</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="fp_subs_rating" type="radio" value="1"><label>С положительным рейтингом</label>\n	</div>\n</div>',"feed/templates/feed-menu-subs.html":'<div class="ppb-menu">\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="1"><label>Пользователи</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="2"><label>Теги</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input name="fp_subs_type" type="checkbox" value="4"><label>Сообщества</label>\n	</div>\n</div>',"feed/templates/overflow.html":'<div class="feed-overflow">\r\nОтличная работа, все прочитано!\r\n<% if (!data.best) {%>\r\n	<div><span class="feed-overflow__to-hot">Перейти в "горячее"</span> или <span class="feed-overflow__to-top">подняться наверх</span></div>\r\n<% } %>\r\n</div>\r\n',"feed/templates/restore.html":'<div class="restore-feed-message">\r\n	<span class="fa fa-refresh fa-spin restore-feed-message__icon"></span> Возвращаемся назад\r\n</div>\r\n',"feed/templates/rollup-wrapper.html":'<div class="after_header__rollup-wrapper">\r\n	<div class="after_header__rollup-button">\r\n		<div class="after_header__rollup-button-holder">\r\n			<?xml version="1.0" encoding="utf-8"?>\r\n			<svg version="1.1" width="100%" height="100%" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >\r\n				<path d="M4 1 L10 7 L16 1" fill="transparent" stroke="#444" stroke-width="2" stroke-linecap="round" />\r\n				<path d="M4 19 L10 13 L16 19" fill="transparent" stroke="#444" stroke-width="2" stroke-linecap="round" />\r\n			</svg>\r\n		</div>\r\n	</div>\r\n</div>\r\n',"gifx/templates/canvas.html":'<video class="b-gifx__video" poster="<%= data.poster %>" muted="muted" preload="auto" <%= data.style ? \'style="\' + data.style + \'"\' : \'\'%>>\r\n	<source src="<%= data.src %>mp4" type="video/mp4">\r\n</video>\r\n<canvas></canvas>\r\n',"gifx/templates/error-overlay.html":'<div class="b-gifx__error-overlay">\r\n	<div class="b-gifx__error-message">\r\n		<p>^gifx:error-loading</p>\r\n\r\n		<p><a href="#" class="b-gifx__try-again">^gifx:retry</a></p>\r\n	</div>\r\n</div>\r\n',"gifx/templates/flash.html":'<object class="b-gifx__flash" type="application/x-shockwave-flash" name="gifxPlayer_<%= data.id %>"\r\n        data="<%= data.flash %>" style="<%= data.style %>">\r\n	<param name=\'AllowScriptAccess\' value=\'always\'/>\r\n	<param name="movie" value="<%= data.flash %>"/>\r\n	<param name="quality" value="high"/>\r\n	<param name="wmode" value="transparent"/>\r\n	<param name="flashvars"\r\n	       value="video=<%= encodeURIComponent(data.src + \'mp4\') %>&id=<%= (data.id) %>&preview=<%= encodeURIComponent(data.poster) %>&autoplay=y&onerror=app.gifx.onError&oninit=app.gifx.onInit"/>\r\n</object>\r\n<div class="b-gifx__overlay"></div>\r\n',"gifx/templates/player.html":'<video class="b-gifx__video" poster="<%= data.poster %>" loop="loop" webkit-playsinline muted="muted" preload="auto" <%= data.style ? \'style="\' + data.style + \'"\' : \'\'%>>\r\n	<% _.each(data.formats, function (format, name) { if (format.video) { %>\r\n		<source src="<%= data.src + name %>" type="video/<%= name %>">\r\n	<% }});%>\r\n</video>\r\n',"page-communities/templates/feed-rating-box.html":'<div class="ppb-menu">\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="-10"><label>-10 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="0"><label>0 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="25"><label>25 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="100"><label>100 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="250"><label>250 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="500"><label>500 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="1000"><label>1000 и выше</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="fp_daterange_type" type="radio" value="2500"><label>2500 и выше</label>\r\n	</div>\r\n</div>',"page-communities/templates/voting-question.html":'<div class="ppb-menu b-communities-newadmin-voting-bbox">\n	<div class="ppb-radio">\n		<input type="radio" name="newadmin-vote" id="newadmin-vote1" value="1"><label for="newadmin-vote1">устраивает</label>\n	</div>\n	<div class="ppb-radio">\n		<input type="radio" name="newadmin-vote" id="newadmin-vote2" value="2"><label for="newadmin-vote2">не устраивает</label>\n	</div>\n</div>',"page-community-editor/templates/user-search.html":'<div class="community-user-search">\r\n	<label for="user_name"></label>\r\n	<form action="#" onsubmit="return false">\r\n		<input type="text" id="user_name" value="">\r\n		<input type="submit" style="display: none">\r\n	</form>\r\n	<div class="community-error" style="display: none">\r\n		<i class="fa fa-warning"></i> <span></span>\r\n	</div>\r\n</div>',"page-gtpost/templates/block-gifx.html":'<div class="gtpost-gifx">\r\n	<div class="gtpost-gifx__preview"></div>\r\n	<div class="gtpost-gifx__play i-sprite--gifx__play"></div>\r\n</div>\r\n',"page-gtpost/templates/block-video-input.html":'<div class="gtpost-video-input">\r\n	<div class="gtpost-video-input__state gtpost-block__tool gtpost-block__tool_remove"></div>\r\n	<input class="gtpost-video-input__input gtpost-builder__input" placeholder="Ссылка на видео">\r\n</div>\r\n',"page-gtpost/templates/block-video.html":'<div class="gtpost-video">\r\n	<div class="b-video__state video__state_waiting_yes video__state_show_yes">\r\n		<span class="b-video__duration"><%= data.duration %></span>\r\n	</div>\r\n\r\n	<div class="b-video__preview b-video__preview_show_yes" style="background-image: url(\'<%= data.url_preview %>\'); ">\r\n		<div class="b-video__logo i-sprite--video__<%= data.host %>"></div>\r\n		<div class="b-video__play i-sprite--gifx__play"></div>\r\n	</div>\r\n</div>\r\n',"page-gtpost/templates/block.html":'<button class="gtpost-block__adding-before" style="display: block" title="Добавить блок"><div class="fa fa-plus"></div></button>\r\n<div class="gtpost-block__wrapper">\r\n	<div class="gtpost-block__content"></div>\r\n	<div class="gtpost-block__tools">\r\n		<div class="gtpost-block__tool gtpost-block__tool_up" style="display: block" title="Переместить вверх"></div>\r\n		<div class="gtpost-block__tool gtpost-block__tool_remove" style="display: block" title="Удалить"></div>\r\n		<div class="gtpost-block__tool gtpost-block__tool_down" style="display: block" title="Преместить вниз"></div>\r\n	</div>\r\n</div>\r\n<div class="gtpost-block__remove-overlay" style="display: none">\r\n	<span class="gtpost-block__remove-message"></span>\r\n	<div><button class="gtpost-block__remove-retry" style="display: none;">повторить</button> <button class="gtpost-block__remove-cancel">оставить</button> <button class="gtpost-block__remove-success">удалить</button></div>\r\n</div>\r\n',"page-gtpost/templates/builder.html":"<div>\r\n\r\n</div>\r\n","page-gtpost/templates/communities-box.html":'<div class="communities-box">\r\n	<div class="communities-box__head">\r\n		<input type="text" class="communities-box__input" placeholder="Название сообщества..." maxlength="30">\r\n		<span class="communities-box__close"><i class="fa fa-times"></i></span>\r\n		<span class="communities-box__loader"><i class="fa fa-spinner fa-spin"></i></span>\r\n	</div>\r\n	<div class="communities-box__list-wrapper">\r\n		<div class="communities-box__empty">Похожих сообщества не найдены</div>\r\n		<div class="communities-box__list-recommended"></div>\r\n		<div class="communities-box__list"></div>\r\n	</div>\r\n</div>\r\n',"page-gtpost/templates/communities.html":'<div class="gtpost-builder__community-select">Выбрать сообщество</div>\r\n<div class="gtpost-builder__community-current" style="display: none;"></div>\r\n',"page-gtpost/templates/community-item.html":'<div class="gtpost-builder-community" data-id="<%= data.id %>">\r\n	<div class="gtpost-builder-community__avatar">\r\n		<img src="<%= data.avatar %>" alt="<%= data.name %>">\r\n	</div>\r\n	<div class="gtpost-builder-community__wrapper">\r\n		<div class="gtpost-builder-community__label"><%= data.name %></div>\r\n		<div class="gtpost-builder-community__information">\r\n			<% if (data.edit) { %> <span class="gtpost-builder-community__change">изменить</span> <% } else { %> <%= data.stories %> <b>•</b> <%= data.subs %> <% } %>\r\n		</div>\r\n	</div>\r\n</div>\r\n',"page-gtpost/templates/droparea.html":'<div class="gtpost-builder__droparea">\r\n	<div class="gtpost-builder__dropwrapper">\r\n		<i class="i-sprite--inline-block i-sprite--page-gtpost__add-image"></i>\r\n	</div>\r\n</div>\r\n',"page-gtpost/templates/header.html":'<div class="gtpost-builder-header">\r\n	<div class="gtpost-builder-header__close">\r\n		<div class="gtpost-builder-header__close-a"></div>\r\n		<div class="gtpost-builder-header__close-b"></div>\r\n	</div>\r\n	<h1 class="page_title"><%= data.isEdit ? \'Редактирование\' : \'Новый пост\' %></h1>\r\n	<button class="gtpost-builder-header__next-step">Далее</button>\r\n	<!--div class="gtpost-builder__settings fa fa-pencil"></div-->\r\n</div>\r\n',"page-gtpost/templates/hint-add-disabled.html":'<p>Для добавления дополнительных блоков необходимо иметь рейтинг > 10</p>\r\n<p><a href="/html.php?id=faq#3" target="_blank"><i class="fa fa-info-circle"></i> Узнать подробней</a></p>\r\n',"page-gtpost/templates/panel-adding.html":'<div class="gtpost-panel-adding__wrapper">\r\n	<button class="gtpost-panel-adding__button" data-type="text" name="текст"></button>\r\n	<div class="gtpost-panel-adding__button" data-type="image" name="картинка">\r\n		<input type="file" name="avatarfile" class="gtpost-panel-adding__upload" accept="image/*" multiple>\r\n	</div>\r\n	<button class="gtpost-panel-adding__button" data-type="video-input" name="видео"></button>\r\n</div>\r\n',"page-saved-stories/templates/category-delete.html":'<div class="ppb-menu ss-cat-delete-msg">\r\n	<section>\r\n		В удаляемой категории имеются сохраненные посты.<br>\r\n		Какое действие необходимо выполнить с постами из этой категории?\r\n	</section>\r\n	<div class="ppb-radio">\r\n		<input name="ss-cat-del" checked type="radio" value="1">\r\n		<label>удалить все посты вместе с категорией</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="ss-cat-del" type="radio" value="2" >\r\n		<div class="ppb-label ss-del-option2">\r\n			переместить все посты в другую категорию<br>\r\n			<div class="ppb-dropdown">\r\n				<select></select>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>',"page-saved-stories/templates/category-edit.html":'<div class="save-story-cat">\r\n	<a data-role="rename" href="javascript: void(0)">\r\n		<svg width="22" height="22">\r\n			<path d="M3 8 L6 11 L11 6 L8 3 z M7 12 L12 17 L18 18 L17 12 L12 7 z" />\r\n		</svg>\r\n	</a>\r\n	<span class="ss-cat-name"></span>\r\n	<a data-role="delete" href="javascript: void(0)">\r\n		<svg width="22" height="22">\r\n			<path d="M3 5 L19 5 M9 5 v-3 h4 v3 M6 7 v10 l1 1 h8 l1 -1 v-10" />\r\n		</svg>\r\n	</a>\r\n	<span class="ss-cat-count"></span>\r\n</div>',"page-story/templates/facebook.html":'<div class="facebook-popup">\r\n	<div class="facebook-popup__close close_control"></div>\r\n	<!-- <div class="facebook-popup__title">Интересные статьи сообщества «Пикабу»</div> -->\r\n	<br>\r\n	<div class="facebook-popup__hint">Нажмите «Нравится», чтобы читать нас в Фэйсбуке.</div>\r\n	<div class="facebook-popup__widget">\r\n		<div class="fb-page" data-href="https://www.facebook.com/pikabu.ru" data-small-header="false" data-width="<%= data.width %>" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/pikabu.ru"><a href="https://www.facebook.com/pikabu.ru">Пикабу</a></blockquote></div></div>\r\n	</div>\r\n</div>\r\n',"page-story/templates/order.html":'<div class="ppb-menu">\r\n	<div class="ppb-radio">\r\n		<input name="ss_sort" type="radio" value="1" <%= data.current === 1 ? \'checked\' : \'\'%>><label>Лучшие сверху</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="ss_sort" type="radio" value="2" <%= data.current === 2 ? \'checked\' : \'\'%>><label>Первые сверху</label>\r\n	</div>\r\n	<div class="ppb-radio">\r\n		<input name="ss_sort" type="radio" value="3" <%= data.current === 3 ? \'checked\' : \'\'%>><label>Актуальные сверху</label>\r\n	</div>\r\n</div>\r\n',"page-test-ua/templates/ua.html":'<div class="page-test-ua">\r\n	<h1>Информация передана разработчикам, спасибо за содействие!</h1>\r\n</div>\r\n',"page-user-settings/templates/avatar.html":'<div class="profile-avatar">\r\n\r\n	<div class="profile-avatar__progress"></div>\r\n</div>\r\n',"page-user-settings/templates/oauth.html":'<div class="profile-oauth">\r\n	<i class="oauth-provider oauth-provider_type_<%= data.type %>"></i> <span class="profile-oauth__name"><%= data.name %></span>\r\n</div>\r\n',"sign/templates/captcha.html":'<label class="captcha" for="captcha-signin"><img class="captcha__image" src="<%= data.src %>"></label>\r\n<input type="captcha" name="captcha" id="captcha-signin" class="form_input last" placeholder="Код с каптчи" />\r\n',"sign/templates/error-password.html":'<div class="auth_box_s text">\r\n	Неверный логин или пароль\r\n	<br>\r\n	<span class="control auth_retrieve_control">Восстановить пароль?</span>\r\n</div>\r\n',"story-save/templates/disabled-menu-msg.html":'<div class="b-save-story-menu-msg">\r\n	Вы можете вернуть меню на странице <a href="./index.php?cmd=saved">«Сохраненное»</a>\r\n</div>',"story-search/templates/story-date.html":'<div class="ppb-menu">\n	<div class="ppb-option" data-role="all_time">За все время</div>\n	<div class="ppb-option" data-role="month">За месяц</div>\n	<div class="ppb-option" data-role="week">За неделю</div>\n	<hr>\n	<div class="ppb-option" data-role="cal">Выбрать дату</div>\n</div>',"story-search/templates/story-rating.html":'<div class="ppb-menu">\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="0"><label>Любой рейтинг</label>\n	</div>\n	<hr>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="1"><label>выше -100</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="2"><label>выше 0</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="3"><label>выше 25</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="4"><label>выше 100</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="5"><label>выше 250</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="6"><label>выше 500</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="7"><label>выше 1000</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="8"><label>выше 2500</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="9"><label>выше 5000</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_rating" type="radio" value="10"><label>выше 10000</label>\n	</div>\n</div>',"story-search/templates/story-sort.html":'<div class="ppb-menu">\n	<div class="ppb-radio">\n		<input name="ss_sort" type="radio" value="1"><label>Свежее</label>\n	</div>\n	<div class="ppb-radio">\n		<input name="ss_sort" type="radio" value="2"><label>Лучшее</label>\n	</div>\n</div>',"story-search/templates/story-type.html":'<div class="ppb-menu">\n	<div class="ppb-checkbox">\n		<input type="checkbox" value="2"><label>Текст</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input type="checkbox" value="4"><label>Картинки</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input type="checkbox" value="8"><label>Видео</label>\n	</div>\n	<hr>\n	<div class="ppb-checkbox">\n		<input type="checkbox" value="16"><label>Тег [Моё]</label>\n	</div>\n	<div class="ppb-checkbox">\n		<input type="checkbox" value="32"><label>Клубничка</label>\n	</div>\n</div>',"story-search/templates/tag-enter-box.html":'<div class="ssf-tag-enter">\n	<div>\n		<div>\n			<input type="text" placeholder="Введите тег..." maxlength="30">\n		</div>\n		<div>\n			<a data-role="close" href="javascript: void(0);"><i class="fa fa-times"></i></a>\n			<a data-role="loader" href="javascript: void(0);"><i class="fa fa-spinner fa-spin"></i></a>\n		</div>\n	</div>\n	<div>\n	</div>\n</div>',"story-search/templates/tag-menu-box.html":'<div class="ppb-menu">\n	<div class="ppb-option" data-role="del">Убрать</div>\n	<hr>\n	<div class="ppb-option" data-role="subs+">Подписаться</div>\n	<div class="ppb-option" data-role="subs-">Отписаться</div>\n	<div class="ppb-option" data-role="ignore+">В игнор-лист</div>\n	<div class="ppb-option" data-role="ignore-">Удалить из игнор-листа</div>\n</div>',"tags/templates/enter-box.html":'<div class="tags-enter-box">\r\n	<div class="tags-enter-box__head">\r\n		<input type="text" class="tags-enter-box__input" placeholder="Введите тег..." maxlength="30">\r\n		<span class="tags-enter-box__close"><i class="fa fa-times"></i></span>\r\n		<span class="tags-enter-box__loader"><i class="fa fa-spinner fa-spin"></i></span>\r\n	</div>\r\n	<div class="tags-enter-box__list-wrapper">\r\n		<div class="tags-enter-box__empty">Похожих тегов не найдено...</div>\r\n		<div class="tags-enter-box__list"></div>\r\n	</div>\r\n</div>\r\n',"tags/templates/list.html":'<div class="tags-list">\r\n	<span class="tags-list__list"></span><span class="tags-list__add"></span>\r\n</div>\r\n',"tags/templates/menu-box.html":'<div class="ppb-menu">\r\n	<div class="ppb-option" data-role="del">Убрать</div>\r\n	<hr>\r\n	<div class="ppb-option" data-role="subs+">Подписаться</div>\r\n	<div class="ppb-option" data-role="subs-">Отписаться</div>\r\n	<div class="ppb-option" data-role="ignore+">В игнор-лист</div>\r\n	<div class="ppb-option" data-role="ignore-">Удалить из игнор-листа</div>\r\n</div>',"tags/templates/tag.html":'<div class="tags-list-tag" data-tag="<%= data.tag %>">\r\n	<span class="tags-list-tag__label"><%= data.label || data.tag %></span>\r\n	<% if (data.count) { %>\r\n	<span class="tags-list-tag__count"><%= data.count %></span>\r\n	<% } %>\r\n</div>\r\n',"video/templates/coub.html":'<object type="application/x-shockwave-flash" name="<%= data.options.idPlayer %>" data="//c-cdn.coub.com/fb-player.swf?coubID=<%= data.options.uri.segment2 %>" width="<%= data.options.width %>" height="<%= data.options.height %>">\r\n	<param name=\'AllowScriptAccess\' value=\'always\'/>\r\n	<param name="quality" value="high"/>\r\n	<param name="wmode" value="transparent"/>\r\n	<param name="flashvars" value=""/>\r\n</object>\r\n',"wm/templates/toggleButton.html":'<div class="b-position-button">\r\n	<i class="b-position-button__up fa fa-angle-up"></i>\r\n	<i class="b-position-button__down fa fa-angle-down" style="display: none;"></i>\r\n</div>\r\n',i18n:{ru:{comments:{"control-reply":"ответить","control-edit":"редактировать","control-cancel":"отмена","by-moderator":"Комментарий будет добавлен от пользователя @moderator",ignore:{"you-story":"Вы не можете отвечать, автор поста находится в вашем игнор-листе","story-you":"Вы не можете отвечать, автор поста добавил Вас в игнор-лист","you-comment":"Вы не можете отвечать, автор комментария находится в вашем игнор-листе","comment-you":"Вы не можете отвечать, автор комментария добавил Вас в игнор-лист"},errors:{banned:"Вы забанены и не можете оставлять комментарии.",carma:"У вас слишком низкий рейтинг для добавления комментариев.",empty:"Введите сообщение, либо добавьте картинку"}},compare:{posts:["пост","поста","постов"],more:"Показать ещё "},core:{},gifx:{"error-loading":"Не удалось загрузить изображение",retry:"Попробовать еще раз"},"page-gtpost":{images:["картинку","картинки","картинок"],videos:["видео","видео","видео"],texts:["текстовый блок","текстовых блока","текстовых блоков"],blocks:["блок","блока","блоков"],addDisabled:"Для добавления дополнительных блоков необходимо заработать. Подробней",play:"Воспроизведение будет доступно после создания",image:"Добавить картинку",text:"Добавить текст",video:"Добавить видео",carma:["единицу рейтинга","единицы рейтинга","единиц рейтинга"],imageCarma:"Для добавления картинок необходимо заработать ещё",videoCarma:"Для добавления видео необходимо заработать ещё",textCarma:"Для добавления текста необходимо заработать ещё",imageMax:"Максимально можно добавить",videoMax:"Максимально можно добавить",textMax:"Максимально можно добавить",blockMax:"Маскимально можно добавить","before-close":"Не вся информация была сохранена. Вы действительно хотите покинуть данную страницу?",errors:{"title-short":"Слишком короткий заголовок","title-long":"Длина заголовка превышена: ","tags-min":"Добавьте минимум два тега",blocks:"Укажите содержимое поста","text-length":"Длина текста превышена: ",upload:"Ошибка. Максимально допустимый размер файла: 10МБ","upload-max":"Ошибка загрузки изображения. Максимальный размер файла: 10МБ","community-empty":"Выберите сообщество, в которое Вы хотите добавить пост"},"draft-save":"Сохранено в ","hint-count-tags":"Количество постов с данным тегом",remove:"Хотите удалить?","hint-wait-compare":"Подождите результатов поиска дубликатов","hint-find-compare":"Пожалуйста, не добавляйте пост, если он уже был на Пикабу","hint-strawberry":"Вы подтверждаете, что являетесь автором содержания поста: фотографий, текста, видео"},"page-user-settings":{"need-set-password":"Чтобы отвязать аккаунт, установить пароль"},sign:{email:"Email введён не корректно",username:"Логин введён не корректно",password:"Пароль слишком простой",captcha:"Каптча введена не корректно",next:"продолжить",welcome:"Добро пожаловать, ",up:{errors:{email:"Неверный email","username-short":"Логин коротковат","username-long":"Логин длинноват","username-whitelist":"Используйте A-z, 0-9 '.'","username-last-dot":"Не может заканчиваться на точку","username-busy":"Логин занят","password-short":"Пароль коротковат","password-week":"Пароль слишком простой",captcha:"Пройдите капчу"}}}}}},{},{config:{application:{base:"://pikabu.ru/",media:":///",freeze:{vendors:{jquery:{js:{"jquery.min.js":"/app-mobile/1.3.130/vendors/jquery/js/jquery.min.js"}},"font-awesome":{css:{"font-awesome.min.css":"/app-mobile/1.3.130/vendors/font-awesome/css/font-awesome.min.css"},fonts:{"fontawesome-webfont.eot":"/app-mobile/1.3.130/vendors/font-awesome/fonts/fontawesome-webfont.eot","fontawesome-webfont.svg":"/app-mobile/1.3.130/vendors/font-awesome/fonts/fontawesome-webfont.svg","fontawesome-webfont.ttf":"/app-mobile/1.3.130/vendors/font-awesome/fonts/fontawesome-webfont.ttf","fontawesome-webfont.woff":"/app-mobile/1.3.130/vendors/font-awesome/fonts/fontawesome-webfont.woff","fontawesome-webfont.woff2":"/app-mobile/1.3.130/vendors/font-awesome/fonts/fontawesome-webfont.woff2","FontAwesome.otf":"/app-mobile/1.3.130/vendors/font-awesome/fonts/FontAwesome.otf"}}},main:{},images:{"comments__link.png":"/app-mobile/1.3.130/images/comments__link.png","compare__tgp-bg.png":"/app-mobile/1.3.130/images/compare__tgp-bg.png","i-sprite.png":"/app-mobile/1.3.130/images/i-sprite.png"},modules:{gifx:{"gifx.swf":"/app-mobile/1.3.130/modules/gifx/gifx.swf"}}},__description:"Данные настройки пакуются вместе с клиентом"},i18n:{comments:{"control-reply":"ответить","control-edit":"редактировать","control-cancel":"отмена","by-moderator":"Комментарий будет добавлен от пользователя @moderator",ignore:{"you-story":"Вы не можете отвечать, автор поста находится в вашем игнор-листе","story-you":"Вы не можете отвечать, автор поста добавил Вас в игнор-лист","you-comment":"Вы не можете отвечать, автор комментария находится в вашем игнор-листе","comment-you":"Вы не можете отвечать, автор комментария добавил Вас в игнор-лист"},errors:{banned:"Вы забанены и не можете оставлять комментарии.",carma:"У вас слишком низкий рейтинг для добавления комментариев.",empty:"Введите сообщение, либо добавьте картинку"}},compare:{posts:["пост","поста","постов"],more:"Показать ещё "},core:{},gifx:{"error-loading":"Не удалось загрузить изображение",retry:"Попробовать еще раз"},"page-gtpost":{images:["картинку","картинки","картинок"],videos:["видео","видео","видео"],texts:["текстовый блок","текстовых блока","текстовых блоков"],blocks:["блок","блока","блоков"],addDisabled:"Для добавления дополнительных блоков необходимо заработать. Подробней",play:"Воспроизведение будет доступно после создания",image:"Добавить картинку",text:"Добавить текст",video:"Добавить видео",carma:["единицу рейтинга","единицы рейтинга","единиц рейтинга"],imageCarma:"Для добавления картинок необходимо заработать ещё",videoCarma:"Для добавления видео необходимо заработать ещё",textCarma:"Для добавления текста необходимо заработать ещё",imageMax:"Максимально можно добавить",videoMax:"Максимально можно добавить",textMax:"Максимально можно добавить",blockMax:"Маскимально можно добавить","before-close":"Не вся информация была сохранена. Вы действительно хотите покинуть данную страницу?",errors:{"title-short":"Слишком короткий заголовок","title-long":"Длина заголовка превышена: ","tags-min":"Добавьте минимум два тега",blocks:"Укажите содержимое поста","text-length":"Длина текста превышена: ",upload:"Ошибка. Максимально допустимый размер файла: 10МБ","upload-max":"Ошибка загрузки изображения. Максимальный размер файла: 10МБ","community-empty":"Выберите сообщество, в которое Вы хотите добавить пост"},"draft-save":"Сохранено в ","hint-count-tags":"Количество постов с данным тегом",remove:"Хотите удалить?","hint-wait-compare":"Подождите результатов поиска дубликатов","hint-find-compare":"Пожалуйста, не добавляйте пост, если он уже был на Пикабу","hint-strawberry":"Вы подтверждаете, что являетесь автором содержания поста: фотографий, текста, видео"},"page-user-settings":{"need-set-password":"Чтобы отвязать аккаунт, установить пароль"},sign:{email:"Email введён не корректно",username:"Логин введён не корректно",password:"Пароль слишком простой",captcha:"Каптча введена не корректно",next:"продолжить",welcome:"Добро пожаловать, ",up:{errors:{email:"Неверный email","username-short":"Логин коротковат","username-long":"Логин длинноват","username-whitelist":"Используйте A-z, 0-9 '.'","username-last-dot":"Не может заканчиваться на точку","username-busy":"Логин занят","password-short":"Пароль коротковат","password-week":"Пароль слишком простой",captcha:"Пройдите капчу"}}}}}})